bios.asm:
     1                          ; BIOS.ASM
     2                          
     3                          ; MSX BIOS ROM, MSX 1 version (version 1.0)
     4                          
     5                          ; Source re-created by Z80DIS 2.2
     6                          ; Z80DIS was written by Kenneth Gielow, Palo Alto, CA
     7                          
     8                          ; Code Copyrighted by ASCII and maybe others
     9                          ; Source comments by Arjen Zeilemaker
    10                          
    11                          ; Sourcecode supplied for STUDY ONLY
    12                          ; Recreation NOT permitted without authorisation of the copyrightholders
    13                          
    14                                  INCLUDE "const.def"
const.def:
     1                          DEFC S_COLOR     = $0155
     2                          DEFC S_SCREEN    = $0159
     3                          DEFC S_WIDTHS    = $015D
     4                          DEFC EXTROM      = $015F
     5                          DEFC S_VDP       = $0161
     6                          DEFC CHKSLZ      = $0162
     7                          DEFC S_VDPF      = $0165
     8                          DEFC CHKNEW      = $0165
     9                          DEFC S_BASE      = $0169
    10                          DEFC BIGFIL      = $016B
    11                          DEFC S_BASEF     = $016D
    12                          DEFC S_VPOKE     = $0171
    13                          DEFC S_VPEEK     = $0175
    14                          DEFC S_SETS      = $0179
    15                          DEFC CHGCPU      = $0180
    16                          DEFC S_PROMPT    = $0181
    17                          DEFC GETCPU      = $0183
    18                          DEFC S_SDFSCR    = $0185
    19                          DEFC S_SETSCR    = $0189
    20                          DEFC S_SCOPY     = $018D
    21                          DEFC S_GETPUT    = $01B1
    22                          DEFC VARWRK      = $F380
    23                          DEFC LOW_        = $F406
    24                          DEFC HIGH_       = $F408
    25                          DEFC HEADER      = $F40A
    26                          DEFC ERRFLG      = $F414
    27                          DEFC LPTPOS      = $F415
    28                          DEFC PRTFLG      = $F416
    29                          DEFC NTMSXP      = $F417
    30                          DEFC RAWPRT      = $F418
    31                          DEFC VLZADR      = $F419
    32                          DEFC VLZDAT      = $F41B
    33                          DEFC CURLIN      = $F41C
    34                          DEFC KBFMIN      = $F41E
    35                          DEFC KBUF        = $F41F
    36                          DEFC BUFMIN      = $F55D
    37                          DEFC BUF         = $F55E
    38                          DEFC ENDBUF      = $F660
    39                          DEFC TTYPOS      = $F661
    40                          DEFC DIMFLG      = $F662
    41                          DEFC VALTYP      = $F663
    42                          DEFC DORES       = $F664
    43                          DEFC DONUM       = $F665
    44                          DEFC CONTXT      = $F666
    45                          DEFC CONSAV      = $F668
    46                          DEFC CONTYP      = $F669
    47                          DEFC CONLO       = $F66A
    48                          DEFC MEMSIZ      = $F672
    49                          DEFC STKTOP      = $F674
    50                          DEFC TXTTAB      = $F676
    51                          DEFC TEMPPT      = $F678
    52                          DEFC TEMPST      = $F67A
    53                          DEFC DSCTMP      = $F698
    54                          DEFC FRETOP      = $F69B
    55                          DEFC TEMP3       = $F69D
    56                          DEFC TEMP8       = $F69F
    57                          DEFC ENDFOR      = $F6A1
    58                          DEFC DATLIN      = $F6A3
    59                          DEFC SUBFLG      = $F6A5
    60                          DEFC FLGINP      = $F6A6
    61                          DEFC TEMP        = $F6A7
    62                          DEFC PTRFLG      = $F6A9
    63                          DEFC AUTFLG      = $F6AA
    64                          DEFC AUTLIN      = $F6AB
    65                          DEFC AUTINC      = $F6AD
    66                          DEFC SAVTXT      = $F6AF
    67                          DEFC SAVSTK      = $F6B1
    68                          DEFC ERRLIN      = $F6B3
    69                          DEFC DOT         = $F6B5
    70                          DEFC ERRTXT      = $F6B7
    71                          DEFC ONELIN      = $F6B9
    72                          DEFC ONEFLG      = $F6BB
    73                          DEFC TEMP2       = $F6BC
    74                          DEFC OLDLIN      = $F6BE
    75                          DEFC OLDTXT      = $F6C0
    76                          DEFC VARTAB      = $F6C2
    77                          DEFC ARYTAB      = $F6C4
    78                          DEFC STREND      = $F6C6
    79                          DEFC DATPTR      = $F6C8
    80                          DEFC DEFTBL      = $F6CA
    81                          DEFC PRMSTK      = $F6E4
    82                          DEFC PRMLEN      = $F6E6
    83                          DEFC PARM1       = $F6E8
    84                          DEFC PRMPRV      = $F74C
    85                          DEFC PRMLN2      = $F74E
    86                          DEFC PARM2       = $F750
    87                          DEFC PRMFLG      = $F7B4
    88                          DEFC ARYTA2      = $F7B5
    89                          DEFC NOFUNS      = $F7B7
    90                          DEFC TEMP9       = $F7B8
    91                          DEFC FUNACT      = $F7BA
    92                          DEFC SWPTMP      = $F7BC
    93                          DEFC TRCFLG      = $F7C4
    94                          DEFC FBUFFR      = $F7C5
    95                          DEFC DECTMP      = $F7F0
    96                          DEFC DECTM2      = $F7F2
    97                          DEFC DECCNT      = $F7F4
    98                          DEFC DAC         = $F7F6
    99                          DEFC HOLD8       = $F806
   100                          DEFC ARG         = $F847
   101                          DEFC RNDX        = $F857
   102                          DEFC MAXFIL      = $F85F
   103                          DEFC FILTAB      = $F860
   104                          DEFC NULBUF      = $F862
   105                          DEFC PTRFIL      = $F864
   106                          DEFC FILNAM      = $F866
   107                          DEFC FILNM2      = $F871
   108                          DEFC NLONLY      = $F87C
   109                          DEFC SAVEND      = $F87D
   110                          DEFC FNKSTR      = $F87F
   111                          DEFC CGPNT       = $F91F
   112                          DEFC NAMBAS      = $F922
   113                          DEFC CGPBAS      = $F924
   114                          DEFC PATBAS      = $F926
   115                          DEFC ATRBAS      = $F928
   116                          DEFC CLOC        = $F92A
   117                          DEFC CMASK       = $F92C
   118                          DEFC MINDEL      = $F92D
   119                          DEFC MAXDEL      = $F92F
   120                          DEFC ASPECT      = $F931
   121                          DEFC CENCNT      = $F933
   122                          DEFC CLINEF      = $F935
   123                          DEFC CNPNTS      = $F936
   124                          DEFC CPLOTF      = $F938
   125                          DEFC CPCNT       = $F939
   126                          DEFC CPCNT8      = $F93B
   127                          DEFC CRCSUM      = $F93D
   128                          DEFC CSTCNT      = $F93F
   129                          DEFC CSCLXY      = $F941
   130                          DEFC CSAVEA      = $F942
   131                          DEFC CSAVEM      = $F944
   132                          DEFC CXOFF       = $F945
   133                          DEFC CYOFF       = $F947
   134                          DEFC LOHMSK      = $F949
   135                          DEFC LOHDIR      = $F94A
   136                          DEFC LOHADR      = $F94B
   137                          DEFC LOHCNT      = $F94D
   138                          DEFC SKPCNT      = $F94F
   139                          DEFC MOVCNT      = $F951
   140                          DEFC PDIREC      = $F953
   141                          DEFC LFPROG      = $F954
   142                          DEFC RTPROG      = $F955
   143                          DEFC MCLTAB      = $F956
   144                          DEFC MCLFLG      = $F958
   145                          DEFC QUETAB      = $F959
   146                          DEFC QUEBAK      = $F971
   147                          DEFC VOICAQ      = $F975
   148                          DEFC PRSCNT      = $FB35
   149                          DEFC SAVSP       = $FB36
   150                          DEFC VOICEN      = $FB38
   151                          DEFC SAVVOL      = $FB39
   152                          DEFC MCLLEN      = $FB3B
   153                          DEFC MCLPTR      = $FB3C
   154                          DEFC QUEUEN      = $FB3E
   155                          DEFC MUSICF      = $FB3F
   156                          DEFC PLYCNT      = $FB40
   157                          DEFC VCBA        = $FB41
   158                          DEFC VCBB        = $FB66
   159                          DEFC VCBC        = $FB8B
   160                          DEFC ENSTOP      = $FBB0
   161                          DEFC BASROM      = $FBB1
   162                          DEFC LINTTB      = $FBB2
   163                          DEFC FSTPOS      = $FBCA
   164                          DEFC CURSAV      = $FBCC
   165                          DEFC FNKSWI      = $FBCD
   166                          DEFC FNKFLG      = $FBCE
   167                          DEFC ONGSBF      = $FBD8
   168                          DEFC CLIKFL      = $FBD9
   169                          DEFC OLDKEY      = $FBDA
   170                          DEFC NEWKEY      = $FBE5
   171                          DEFC KEYBUF      = $FBF0
   172                          DEFC LINWRK      = $FC18
   173                          DEFC PATWRK      = $FC40
   174                          DEFC BOTTOM      = $FC48
   175                          DEFC HIMEM       = $FC4A
   176                          DEFC TRPTBL      = $FC4C
   177                          DEFC INTFLG      = $FC9B
   178                          DEFC PADY        = $FC9C
   179                          DEFC PADX        = $FC9D
   180                          DEFC JIFFY       = $FC9E
   181                          DEFC INTVAL      = $FCA0
   182                          DEFC INTCNT      = $FCA2
   183                          DEFC LOWLIM      = $FCA4
   184                          DEFC WINWID      = $FCA5
   185                          DEFC GRPHED      = $FCA6
   186                          DEFC ESCCNT      = $FCA7
   187                          DEFC INSFLG      = $FCA8
   188                          DEFC CSRSR       = $FCA9
   189                          DEFC CSTYLE      = $FCAA
   190                          DEFC CAPST       = $FCAB
   191                          DEFC KANAST      = $FCAC
   192                          DEFC KANAMD      = $FCAD
   193                          DEFC FLBMEM      = $FCAE
   194                          DEFC SCRMOD      = $FCAF
   195                          DEFC OLDSCR      = $FCB0
   196                          DEFC CASPRV      = $FCB1
   197                          DEFC BRDATR      = $FCB2
   198                          DEFC GXPOS       = $FCB3
   199                          DEFC GYPOS       = $FCB5
   200                          DEFC GRPACX      = $FCB7
   201                          DEFC GRPACY      = $FCB9
   202                          DEFC DRWFLG      = $FCBB
   203                          DEFC DRWSCL      = $FCBC
   204                          DEFC DRWANG      = $FCBD
   205                          DEFC RUNBNF      = $FCBE
   206                          DEFC SAVENT      = $FCBF
   207                          DEFC EXPTBL      = $FCC1
   208                          DEFC SLTTBL      = $FCC5
   209                          DEFC SLTATR      = $FCC9
   210                          DEFC SLTWRK      = $FD09
   211                          DEFC PROCNM      = $FD89
   212                          DEFC DEVICE      = $FD99
   213                          DEFC H_KEYI      = $FD9A
   214                          DEFC H_TIMI      = $FD9F
   215                          DEFC H_CHPU      = $FDA4
   216                          DEFC H_DSPC      = $FDA9
   217                          DEFC H_ERAC      = $FDAE
   218                          DEFC H_DSPF      = $FDB3
   219                          DEFC H_ERAF      = $FDB8
   220                          DEFC H_TOTE      = $FDBD
   221                          DEFC H_CHGE      = $FDC2
   222                          DEFC H_INIP      = $FDC7
   223                          DEFC H_KEYC      = $FDCC
   224                          DEFC H_KEYA      = $FDD1
   225                          DEFC H_NMI       = $FDD6
   226                          DEFC H_PINL      = $FDDB
   227                          DEFC H_QINL      = $FDE0
   228                          DEFC H_INLI      = $FDE5
   229                          DEFC H_ONGO      = $FDEA
   230                          DEFC H_DSKO      = $FDEF
   231                          DEFC H_SETS      = $FDF4
   232                          DEFC H_NAME      = $FDF9
   233                          DEFC H_KILL      = $FDFE
   234                          DEFC H_IPL       = $FE03
   235                          DEFC H_COPY      = $FE08
   236                          DEFC H_CMD       = $FE0D
   237                          DEFC H_DSKF      = $FE12
   238                          DEFC H_DSKI      = $FE17
   239                          DEFC H_ATTR      = $FE1C
   240                          DEFC H_LSET      = $FE21
   241                          DEFC H_RSET      = $FE26
   242                          DEFC H_FIEL      = $FE2B
   243                          DEFC H_MKI       = $FE30
   244                          DEFC H_MKS       = $FE35
   245                          DEFC H_MKD       = $FE3A
   246                          DEFC H_CVI       = $FE3F
   247                          DEFC H_CVS       = $FE44
   248                          DEFC H_CVD       = $FE49
   249                          DEFC H_GETP      = $FE4E
   250                          DEFC H_SETF      = $FE53
   251                          DEFC H_NOFO      = $FE58
   252                          DEFC H_NULO      = $FE5D
   253                          DEFC H_NTFL      = $FE62
   254                          DEFC H_MERG      = $FE67
   255                          DEFC H_SAVE      = $FE6C
   256                          DEFC H_BINS      = $FE71
   257                          DEFC H_BINL      = $FE76
   258                          DEFC H_FILE      = $FE7B
   259                          DEFC H_DGET      = $FE80
   260                          DEFC H_FILO      = $FE85
   261                          DEFC H_INDS      = $FE8A
   262                          DEFC H_RSLF      = $FE8F
   263                          DEFC H_SAVD      = $FE94
   264                          DEFC H_LOC       = $FE99
   265                          DEFC H_LOF       = $FE9E
   266                          DEFC H_EOF       = $FEA3
   267                          DEFC H_FPOS      = $FEA8
   268                          DEFC H_BAKU      = $FEAD
   269                          DEFC H_PARD      = $FEB2
   270                          DEFC H_NODE      = $FEB7
   271                          DEFC H_POSD      = $FEBC
   272                          DEFC H_GEND      = $FEC6
   273                          DEFC H_RUNC      = $FECB
   274                          DEFC H_CLEA      = $FED0
   275                          DEFC H_LOPD      = $FED5
   276                          DEFC H_STKE      = $FEDA
   277                          DEFC H_ISFL      = $FEDF
   278                          DEFC H_OUTD      = $FEE4
   279                          DEFC H_CRDO      = $FEE9
   280                          DEFC H_DSKC      = $FEEE
   281                          DEFC H_DOGR      = $FEF3
   282                          DEFC H_PRGE      = $FEF8
   283                          DEFC H_ERRP      = $FEFD
   284                          DEFC H_ERRF      = $FF02
   285                          DEFC H_READ      = $FF07
   286                          DEFC H_MAIN      = $FF0C
   287                          DEFC H_DIRD      = $FF11
   288                          DEFC H_FINI      = $FF16
   289                          DEFC H_FINE      = $FF1B
   290                          DEFC H_CRUN      = $FF20
   291                          DEFC H_CRUS      = $FF25
   292                          DEFC H_ISRE      = $FF2A
   293                          DEFC H_NTFN      = $FF2F
   294                          DEFC H_NOTR      = $FF34
   295                          DEFC H_SNGF      = $FF39
   296                          DEFC H_NEWS      = $FF3E
   297                          DEFC H_GONE      = $FF43
   298                          DEFC H_CHRG      = $FF48
   299                          DEFC H_RETU      = $FF4D
   300                          DEFC H_PRTF      = $FF52
   301                          DEFC H_COMP      = $FF57
   302                          DEFC H_FINP      = $FF5C
   303                          DEFC H_TRMN      = $FF61
   304                          DEFC H_FRME      = $FF66
   305                          DEFC H_NTPL      = $FF6B
   306                          DEFC H_EVAL      = $FF70
   307                          DEFC H_OKNO      = $FF75
   308                          DEFC H_FING      = $FF7A
   309                          DEFC H_ISMI      = $FF7F
   310                          DEFC H_WIDT      = $FF84
   311                          DEFC H_LIST      = $FF89
   312                          DEFC H_BUFL      = $FF8E
   313                          DEFC H_FRQI      = $FF93
   314                          DEFC H_SCNE      = $FF98
   315                          DEFC H_FRET      = $FF9D
   316                          DEFC H_PTRG      = $FFA2
   317                          DEFC H_PHYD      = $FFA7
   318                          DEFC H_FORM      = $FFAC
   319                          DEFC H_ERRO      = $FFB1
   320                          DEFC H_LPTO      = $FFB6
   321                          DEFC H_LPTS      = $FFBB
   322                          DEFC H_SCRE      = $FFC0
   323                          DEFC H_PLAY      = $FFC5
   324                          DEFC EXTBIO      = $FFCA
   325                          DEFC D_FFFF      = $FFFF
   326                          
bios.asm:
    15                                  INCLUDE "msx.def"
msx.def:
     1                          ; MSX version
     2                                  DEFC    MSXVER  = 0
     3                          
     4                          ;       OPTM    Optimized code
     5                          ;               0 = Use orginal code
     6                          ;               1 = Use optimized code
     7                          
     8                                  DEFC    OPTM    = 0
     9                          
    10                          ;       NDEVFIX
    11                          ;               0 = Use null device bug
    12                          ;               1 = Use null device bugfix
    13                          
    14                                  DEFC    NDEVFIX = 1
    15                          
    16                          ;       SLOTFIX
    17                          ;               0 = Use slot bug
    18                          ;               1 = Use slot bugfix
    19                          
    20                                  DEFC    SLOTFIX = 0
    21                          
    22                          ;       CNTRY   Country
    23                          ;               0 = Japan
    24                          ;               1 = USA
    25                          ;               2 = International
    26                          ;               3 = UK
    27                          ;               4 = France
    28                          ;               5 = Germany
    29                          ;               6 = Italy
    30                          ;               7 = Spain
    31                          ;               8 = Arabic
    32                          ;               9 = Korea
    33                          ;               10 = Russia
    34                          
    35                          ; Uncomment this to define the language
    36                          ;        DEFC    CNTRY   = 1
    37                          
    38                          
    39                          ;       symbols used to procedure alternate code
    40                          
    41                          ;       INTHZ   interrupt frequency
    42                          ;       CHRGEN  character generator
    43                          ;               0 = japanese
    44                          ;               1 = international
    45                          ;               2 = USSR ??
    46                          ;       DATFMT  date format
    47                          ;               0 = Y-M-D
    48                          ;               1 = M-D-Y
    49                          ;               2 = D-M-Y
    50                          ;       KEYTYP  keyboard layout
    51                          ;               0 = Japanese
    52                          ;               1 = International (QWERTY/other)
    53                          ;               2 = French (AZERTY)
    54                          ;               3 = English
    55                          ;               4 = German (DIN)
    56                          ;               5 = USSR
    57                          ;               6 = Spanish
    58                          ;               7 = Swedish ??
    59                          ;       BASVER  0 = Japanese
    60                          ;               1 = International
    61                          
    62                          
    63                          ; Japanese MSX settings
    64                                  IF      CNTRY = 0
    65                          
    66                                  DEFC    INTHZ   = 60
    67                                  DEFC    CHRGEN  = 0
    68                                  DEFC    DATFMT  = 0
    69                                  DEFC    KEYTYP  = 0
    70                                  DEFC    BASVER  = 0
    71                          
    72                                  ENDIF
    73                          
    74                          ; USA MSX settings
    75                                  IF      CNTRY = 1
    76                          
    77                                  DEFC    INTHZ   = 60
    78                                  DEFC    CHRGEN  = 1
    79                                  DEFC    DATFMT  = 1
    80                                  DEFC    KEYTYP  = 1
    81                                  DEFC    BASVER  = 1
    82                          
    83                                  ENDIF
    84                          
    85                          ; International MSX settings
    86                                  IF      CNTRY = 2
    87                          
    88                                  DEFC    INTHZ   = 50
    89                                  DEFC    CHRGEN  = 1
    90                                  DEFC    DATFMT  = 1
    91                                  DEFC    KEYTYP  = 1
    92                                  DEFC    BASVER  = 1
    93                          
    94                                  ENDIF
    95                          
    96                          ; UK MSX settings
    97                                  IF      CNTRY = 3
    98                          
    99                                  DEFC    INTHZ   = 50
   100                                  DEFC    CHRGEN  = 1
   101                                  DEFC    DATFMT  = 2
   102                                  DEFC    KEYTYP  = 3
   103                                  DEFC    BASVER  = 1
   104                          
   105                                  ENDIF
   106                          
   107                          ; French MSX settings
   108                                  IF      CNTRY = 4
   109                          
   110                                  DEFC    INTHZ   = 50
   111                                  DEFC    CHRGEN  = 1
   112                                  DEFC    DATFMT  = 2
   113                                  DEFC    KEYTYP  = 2
   114                                  DEFC    BASVER  = 1
   115                          
   116                                  ENDIF
   117                          
   118                          ; German MSX settings
   119                                  IF      CNTRY = 5
   120                          
   121                                  DEFC    INTHZ   = 50
   122                                  DEFC    CHRGEN  = 1
   123                                  DEFC    DATFMT  = 2
   124                                  DEFC    KEYTYP  = 4
   125                                  DEFC    BASVER  = 1
   126                          
   127                                  ENDIF
   128                          
   129                          ; Italian MSX settings
   130                          ; Dateformat is not sure
   131                                  IF      CNTRY = 6
   132                          
   133                                  DEFC    INTHZ   = 50
   134                                  DEFC    CHRGEN  = 1
   135                                  DEFC    DATFMT  = 2
   136                                  DEFC    KEYTYP  = 1
   137                                  DEFC    BASVER  = 1
   138                          
   139                                  ENDIF
   140                          
   141                          ; Spanish MSX settings
   142                                  IF      CNTRY = 7
   143                          
   144                                  DEFC    INTHZ   = 50
   145                                  DEFC    CHRGEN  = 1
   146                                  DEFC    DATFMT  = 1
   147                                  DEFC    KEYTYP  = 6
   148                                  DEFC    BASVER  = 1
   149                          
   150                                  ENDIF
   151                          
   152                          ; Arabic MSX settings
   153                          ; Unknown
   154                                  IF      CNTRY = 8
   155                          
   156                                  DEFC    INTHZ   = 60
   157                                  DEFC    CHRGEN  = 0
   158                                  DEFC    DATFMT  = 0
   159                                  DEFC    KEYTYP  = 0
   160                                  DEFC    BASVER  = 0
   161                          
   162                                  ENDIF
   163                          
   164                          ; Korean MSX settings
   165                                  IF      CNTRY = 9
   166                          
   167                                  DEFC    INTHZ   = 60
   168                                  DEFC    CHRGEN  = 0
   169                                  DEFC    DATFMT  = 0
   170                                  DEFC    KEYTYP  = 0
   171                                  DEFC    BASVER  = 0
   172                          
   173                                  ENDIF
   174                          
   175                          ; Russian MSX settings
   176                                  IF      CNTRY = 10
   177                          
   178                                  DEFC    INTHZ   = 60
   179                                  DEFC    CHRGEN  = 2
   180                                  DEFC    DATFMT  = 1
   181                                  DEFC    KEYTYP  = 5
   182                                  DEFC    BASVER  = 1
   183                          
   184                                  ENDIF
   185                          
   186                                  IF      BASVER = 0
   187                                  DEFC    CHRCUR  = $5C            ; yen sign
   188                                  DEFC    CHRFLN  = '&'
   189                                  DEFC    CHRVLN  = '@'
   190                                  ENDIF
   191                          
   192                                  IF      (BASVER = 1) && (CNTRY <> 3)
   193                                  DEFC    CHRCUR  = '$'
   194                                  DEFC    CHRFLN  = '\\'
   195                                  DEFC    CHRVLN  = '&'
   196                                  ENDIF
   197                          
   198                                  IF      (BASVER = 1) && (CNTRY = 3)
   199                                  DEFC    CHRCUR  = $AC            ; pound sign
   200                                  DEFC    CHRFLN  = '\\'
   201                                  DEFC    CHRVLN  = '&'
   202                                  ENDIF
   203                          
   204                          
bios.asm:
    16                          
    17                          	DEFC	RS232 = 0
    18                          	DEFC	PLATFORM = 0	; 0=MSX, 1=H8, 2=NABU
    19                          ; Define VDP/PSG ports
    20                                  IF      PLATFORM = 0
    21                                  DEFC    VDPDAT = $98
    22                                  DEFC    VDPCTL = $99
    23                                  DEFC    PSGCTL = $A0
    24                          	DEFC	PSGDAT = $A1
    25                          	DEFC	PSGRIN = $A2
    26                          	DEFC	CONPORT = $80
    27                          	ENDIF
    28                                  IF      PLATFORM = 1
    29                                  DEFC    VDPDAT = $B8	; 270Q
    30                                  DEFC    VDPCTL = $B9	; 271Q
    31                                  DEFC    PSGCTL = $BB	; 273Q
    32                          	DEFC	PSGDAT = $BA	; 272Q
    33                          	DEFC	PSGRIN = $BA	; 272Q
    34                          	DEFC	CONPORT = $E8
    35                          	ENDIF
    36                          	IF	PLATFORM = 2
    37                                  DEFC    VDPDAT = $A0
    38                                  DEFC    VDPCTL = $A1
    39                                  DEFC    PSGCTL = $41
    40                          	DEFC	PSGDAT = $40
    41                          	DEFC	PSGRIN = $40
    42                          	DEFC	CONPORT = $48
    43                          	ENDIF
    44                          ; Declare some external symbols defined in MSX-BASIC.
    45                                  EXTERN  ASPCT1
    46                                  EXTERN  ASPCT2
    47                                  EXTERN  ATRBYT
    48                                  EXTERN  BAKCLR
    49                                  EXTERN  BDRCLR
    50                                  EXTERN  C4666
    51                                  EXTERN  C558C
    52                                  EXTERN  C5597
    53                                  EXTERN  C63E6
    54                                  EXTERN  C6C48
    55                                  EXTERN  C7C76
    56                                  EXTERN  CLPRIM
    57                                  EXTERN  CNSDFG
    58                                  EXTERN  CRTCNT
    59                                  EXTERN  CSRX
    60                                  EXTERN  CSRY
    61                                  EXTERN  FORCLR
    62                                  EXTERN  GETPNT
    63                                  EXTERN  GRPATR
    64                                  EXTERN  GRPCGP
    65                                  EXTERN  GRPCOL
    66                                  EXTERN  GRPNAM
    67                                  EXTERN  GRPPAT
    68                                  EXTERN  J409B
    69                                  EXTERN  J73B2
    70                                  EXTERN  LINL32
    71                                  EXTERN  LINL40
    72                                  EXTERN  LINLEN
    73                                  EXTERN  MLTATR
    74                                  EXTERN  MLTCGP
    75                                  EXTERN  MLTNAM
    76                                  EXTERN  MLTPAT
    77                                  EXTERN  PUTPNT
    78                                  EXTERN  QUEUES
    79                                  EXTERN  RDPRIM
    80                                  EXTERN  REPCNT
    81                                  EXTERN  RG0SAV
    82                                  EXTERN  RG1SAV
    83                                  EXTERN  SCNCNT
    84                                  EXTERN  STATFL
    85                                  EXTERN  T32ATR
    86                                  EXTERN  T32CGP
    87                                  EXTERN  T32COL
    88                                  EXTERN  T32NAM
    89                                  EXTERN  T32PAT
    90                                  EXTERN  TRGFLG
    91                                  EXTERN  TXTCGP
    92                                  EXTERN  TXTNAM
    93                                  EXTERN  WRPRIM
    94                          
    95                          ; Declare symbols exported by this module
    96                                  PUBLIC  BEEP
    97                                  PUBLIC  CALATR
    98                                  PUBLIC  CALLF
    99                                  PUBLIC  CALPAT
   100                                  PUBLIC  CALSLT
   101                                  PUBLIC  CGTABL
   102                                  PUBLIC  CHGCLR
   103                                  PUBLIC  CHGET
   104                                  PUBLIC  CHGMOD
   105                                  PUBLIC  CHKRAM
   106                                  PUBLIC  CHPUT
   107                                  PUBLIC  CHRGTR
   108                                  PUBLIC  CHSNS
   109                                  PUBLIC  CKCNTC
   110                                  PUBLIC  CLRSPR
   111                                  PUBLIC  CLS
   112                                  PUBLIC  CNVCHR
   113                                  PUBLIC  D0034
   114                                  PUBLIC  DCOMPR
   115                                  PUBLIC  DISSCR
   116                                  PUBLIC  DOWNC
   117                                  PUBLIC  DSPFNK
   118                                  PUBLIC  ENASCR
   119                                  PUBLIC  ENASLT
   120                                  PUBLIC  ERAFNK
   121                                  PUBLIC  FETCHC
   122                                  PUBLIC  FILVRM
   123                                  PUBLIC  FNKSB
   124                                  PUBLIC  GETVC2
   125                                  PUBLIC  GETVCP
   126                                  PUBLIC  GETYPR
   127                                  PUBLIC  GICINI
   128                                  PUBLIC  GRPPRT
   129                                  PUBLIC  GSPSIZ
   130                                  PUBLIC  GTASPC
   131                                  PUBLIC  GTPAD
   132                                  PUBLIC  GTPDL
   133                                  PUBLIC  GTSTCK
   134                                  PUBLIC  GTTRIG
   135                                  PUBLIC  IDBYT0
   136                                  PUBLIC  IDBYT1
   137                                  PUBLIC  IDBYT2
   138                                  PUBLIC  INIFNK
   139                                  PUBLIC  INIT32
   140                                  PUBLIC  INITIO
   141                                  PUBLIC  INITXT
   142                                  PUBLIC  INLIN
   143                                  PUBLIC  ISCNTC
   144                                  PUBLIC  ISFLIO
   145                                  PUBLIC  KEYINT
   146                                  PUBLIC  LDIRMV
   147                                  PUBLIC  LDIRVM
   148                                  PUBLIC  LEFTC
   149                                  PUBLIC  LFTQ
   150                                  PUBLIC  LPTOUT
   151                                  PUBLIC  MAPXYC
   152                                  PUBLIC  NMIHND
   153                                  PUBLIC  NSETCX
   154                                  PUBLIC  OUTDLP
   155                                  PUBLIC  OUTDO
   156                                  PUBLIC  PINLIN
   157                                  PUBLIC  PNTINI
   158                                  PUBLIC  POSIT
   159                                  PUBLIC  PUTQ
   160                                  PUBLIC  QINLIN
   161                                  PUBLIC  RDSLT
   162                                  PUBLIC  RDVRM
   163                                  PUBLIC  READC
   164                                  PUBLIC  SCALXY
   165                                  PUBLIC  SCANL
   166                                  PUBLIC  SCANR
   167                                  PUBLIC  SETATR
   168                                  PUBLIC  SETC
   169                                  PUBLIC  SETGRP
   170                                  PUBLIC  SETMLT
   171                                  PUBLIC  SETRD
   172                                  PUBLIC  SETTXT
   173                                  PUBLIC  SETWRT
   174                                  PUBLIC  STMOTR
   175                                  PUBLIC  STOREC
   176                                  PUBLIC  STRTMS
   177                                  PUBLIC  SYNCHR
   178                                  PUBLIC  TAPIN
   179                                  PUBLIC  TAPIOF
   180                                  PUBLIC  TAPION
   181                                  PUBLIC  TAPOOF
   182                                  PUBLIC  TAPOON
   183                                  PUBLIC  TAPOUT
   184                                  PUBLIC  TDOWNC
   185                                  PUBLIC  TOTEXT
   186                                  PUBLIC  TUPC
   187                                  PUBLIC  WRSLT
   188                                  PUBLIC  WRTPSG
   189                                  PUBLIC  WRTVDP
   190                                  PUBLIC  WRTVRM
   191                          
   192                          ; Program start
   193                                  ORG     $0000
   194                          
   195  0000  f3                CHKRAM: di                              ; $0000
   196  0001  c3d702                    jp      A02D7
   197                          
   198                          
   199  0004  bf1b              CGTABL: dw      T1BBF                   ; $0004
   200  0006  98                        db      VDPDAT
   201  0007  98                        db      VDPDAT
   202                          
   203  0008  c38326            SYNCHR:	jp      A2683                   ; $0008
   204                          
   205  000b  00                        defs    $000C-$,0
   206                          
   207  000c  c3b601            RDSLT: 	jp      A01B6                   ; $000C
   208                          
   209  000f  00                        defs    $0010-$,0
   210                          
   211  0010  c3762d            CHRGTR: jp	KBD10
   212                          ;	jp      A2686                   ; $0010
   213                          
   214  0013  00                        defs    $0014-$,0
   215                          
   216  0014  c3d101            WRSLT:  jp      A01D1                   ; $0014
   217                          
   218  0017  00                        defs    $0018-$,0
   219                          
   220  0018  c33127            OUTDO:  jp	JSTK18
   221                          	;jp      A1B45                   ; $0018
   222                          
   223  001b  00                        defs    $001C-$,0
   224                          
   225  001c  c31702            CALSLT: jp      A0217                   ; $001C
   226                          
   227  001f  00                        defs    $0020-$,0
   228                          
   229  0020  c36a14            DCOMPR: jp      A146A                   ; $0020
   230                          
   231  0023  00                        defs    $0024-$,0
   232                          
   233  0024  c35e02            ENASLT: jp      A025E                   ; $0024
   234                          
   235  0027  00                        defs    $0028-$,0
   236                          
   237  0028  c3a82a            GETYPR: jp	OUT0A0
   238                          ;	jp      A2689                   ; $0028
   239                          ;
   240                          IDBYT0:                                 ; $002B
   241                                  IF      INTHZ = 60
   242  002b  11                        DEFB    CHRGEN+16*DATFMT
   243                                  ELSE
   244                                  DEFB    CHRGEN+16*DATFMT+128
   245                                  ENDIF
   246  002c  11                IDBYT1: DEFB    KEYTYP+16*BASVER        ; $002C
   247  002d  00                IDBYT2: DEFB    MSXVER                  ; $002D, MSX version 0 = MSX1
   248  002e  00                        DEFB    0
   249                          
   250  002f  00                        DEFS    $0030-$
   251                          
   252  0030  c3af2a            CALLF: 	jp	OUT0A1
   253                          ;	jp      A0205                   ; $0030
   254                          ;
   255  0033  00                        DEFS    $0034-$
   256                          
   257                          ;       The next bytes are used by the diskrom, to initialize the double byte header char
   258                          ;       table ($F30F). I have not seen a MSX with anything other than four zero's, meaning
   259                          ;       no double byte chars.
   260                          
   261  0034  0000              D0034:  db      0,0
   262  0036  0000                      db      0,0
   263                          
   264  0038  c33c0c            KEYINT: jp      A0C3C                   ; $0038
   265  003b  c39d04            INITIO: jp      A049D                   ; $003B
   266  003e  c39d13            INIFNK: jp      A139D                   ; $003E
   267  0041  c37705            DISSCR: jp      A0577                   ; $0041
   268  0044  c37005            ENASCR: jp      A0570                   ; $0044
   269  0047  c37f05            WRTVDP: jp      A057F                   ; $0047
   270  004a  c3d707            RDVRM:  jp      A07D7                   ; $004A
   271  004d  c3cd07            WRTVRM: jp      A07CD                   ; $004D
   272  0050  c3ec07            SETRD:  jp      A07EC                   ; $0050
   273  0053  c3df07            SETWRT: jp      A07DF                   ; $0053
   274  0056  c31508            FILVRM: jp      A0815                   ; $0056
   275  0059  c30f07            LDIRMV: jp      A070F                   ; $0059
   276  005c  c34407            LDIRVM: jp      A0744                   ; $005C
   277  005f  c34f08            CHGMOD: jp      A084F                   ; $005F
   278  0062  c3f707            CHGCLR: jp      A07F7                   ; $0062
   279                          
   280  0065  00                        defs    $0066-$,0              ; align to Z80 NMI entry at $0066
   281                          
   282  0066  c39813            NMIHND: jp      A1398                   ; $0066
   283  0069  c3a806            CLRSPR: jp      A06A8                   ; $0069
   284  006c  c30e05            INITXT: jp      A050E                   ; $006C
   285  006f  c33805            INIT32: jp      A0538                   ; $006F
   286  0072  c3d205                    jp      A05D2                   ; $0072
   287  0075  c31f06                    jp      A061F                   ; $0075
   288  0078  c39405            SETTXT: jp      A0594                   ; $0078
   289  007b  c3b405                    jp      A05B4                   ; $007B
   290  007e  c30206            SETGRP: jp      A0602                   ; $007E
   291  0081  c35906            SETMLT: jp      A0659                   ; $0081
   292  0084  c3e406            CALPAT: jp      A06E4                   ; $0084
   293  0087  c3f906            CALATR: jp      A06F9                   ; $0087
   294  008a  c30407            GSPSIZ: jp      A0704                   ; $008A
   295  008d  c31015            GRPPRT: jp      A1510                   ; $008D
   296  0090  c3bd04            GICINI: jp      A04BD                   ; $0090
   297  0093  c30211            WRTPSG: jp      A1102                   ; $0093
   298  0096  c30e11                    jp      A110E                   ; $0096
   299  0099  c3c411            STRTMS: jp      A11C4                   ; $0099
   300  009c  c3690d            CHSNS:  jp      A0D6A                   ; $009C
   301  009f  c3cb10            CHGET:  jp      A10CB                   ; $009F
   302  00a2  c3bc08            CHPUT:  jp      A08BC                   ; $00A2
   303  00a5  c35d08            LPTOUT: jp      A085D                   ; $00A5
   304  00a8  c38408                    jp      A0884                   ; $00A8
   305  00ab  c39d08            CNVCHR: jp      A089D                   ; $00AB
   306  00ae  c3bf23            PINLIN: jp      A23BF                   ; $00AE
   307  00b1  c3d523            INLIN:  jp      A23D5                   ; $00B1
   308  00b4  c3cc23            QINLIN: jp      A23CC                   ; $00B4
   309  00b7  c36f04                    jp      A046F                   ; $00B7
   310  00ba  c3fb03            ISCNTC: jp      A03FB                   ; $00BA
   311  00bd  c3f910            CKCNTC: jp      A10F9                   ; $00BD
   312  00c0  c31311            BEEP:   jp      A1113                   ; $00C0
   313  00c3  c34808            CLS:    jp      A0848                   ; $00C3
   314  00c6  c38e08            POSIT:  jp      A088E                   ; $00C6
   315  00c9  c3260b            FNKSB:  jp      A0B26                   ; $00C9
   316  00cc  c3150b            ERAFNK: jp      A0B15                   ; $00CC
   317  00cf  c32b0b            DSPFNK: jp      A0B2B                   ; $00CF
   318  00d2  c33b08            TOTEXT: jp      A083B                   ; $00D2
   319  00d5  c3ee11            GTSTCK: jp      A11EE                   ; $00D5
   320  00d8  c35312            GTTRIG: jp      A1253                   ; $00D8
   321  00db  c3ac12            GTPAD:  jp      A12AC                   ; $00DB
   322  00de  c37312            GTPDL:  jp      A1273                   ; $00DE
   323  00e1  c3631a            TAPION: jp      A1A63                   ; $00E1
   324  00e4  c3bc1a            TAPIN:  jp      A1ABC                   ; $00E4
   325  00e7  c3e919            TAPIOF: jp      A19E9                   ; $00E7
   326  00ea  c3f119            TAPOON: jp      A19F1                   ; $00EA
   327  00ed  c3191a            TAPOUT: jp      A1A19                   ; $00ED
   328  00f0  c3dd19            TAPOOF: jp      A19DD                   ; $00F0
   329  00f3  c38413            STMOTR: jp      A1384                   ; $00F3
   330  00f6  c3eb14            LFTQ:   jp      A14EB                   ; $00F6
   331  00f9  c39214            PUTQ:   jp      A1492                   ; $00F9
   332  00fc  c3c516                    jp      A16C5                   ; $00FC
   333  00ff  c3ee16            LEFTC:  jp      A16EE                   ; $00FF
   334  0102  c35d17                    jp      A175D                   ; $0102
   335  0105  c33c17            TUPC:   jp      A173C                   ; $0105
   336  0108  c32a17            DOWNC:  jp      A172A                   ; $0108
   337  010b  c30a17            TDOWNC: jp      A170A                   ; $010B
   338  010e  c39915            SCALXY: jp      A1599                   ; $010E
   339  0111  c3df15            MAPXYC: jp      A15DF                   ; $0111
   340  0114  c33916            FETCHC: jp      A1639                   ; $0114
   341  0117  c34016            STOREC: jp      A1640                   ; $0117
   342  011a  c37616            SETATR: jp      A1676                   ; $011A
   343  011d  c34716            READC:  jp      A1647                   ; $011D
   344  0120  c37e16            SETC:   jp      A167E                   ; $0120
   345  0123  c30918            NSETCX: jp      A1809                   ; $0123
   346  0126  c3c718            GTASPC: jp      A18C7                   ; $0126
   347  0129  c3cf18            PNTINI: jp      A18CF                   ; $0129
   348  012c  c3e418            SCANR:  jp      A18E4                   ; $012C
   349  012f  c37a19            SCANL:  jp      A197A                   ; $012F
   350  0132  c33d0f                    jp      K_BCAP                  ; $0132
   351  0135  c37a0f                    jp      K_BSND                  ; $0135
   352  0138  c34c14                    jp      A144C                   ; $0138
   353  013b  c34f14                    jp      A144F                   ; $013B
   354  013e  c34914                    jp      A1449                   ; $013E
   355  0141  c35214                    jp      A1452                   ; $0141
   356  0144  c38a14                    jp      A148A                   ; $0144
   357  0147  c38e14                    jp      A148E                   ; $0147
   358  014a  c35f14            ISFLIO: jp      A145F                   ; $014A
   359  014d  c3631b            OUTDLP: jp      A1B63                   ; $014D
   360  0150  c37014            GETVCP: jp      A1470                   ; $0150
   361  0153  c37414            GETVC2: jp      A1474                   ; $0153
   362  0156  c36804                    jp      A0468                   ; $0156
   363  0159  c3ff01                    jp      A01FF                   ; $0159
   364                          
   365                                  IF      SLOTFIX = 0
   366                          
   367  015c  0000000000000000          defs    $01B6-$,0
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000              
   368                          
   369                                  ELSE
   370                          
   371                                  defs    $016F-$,0
   372                          
   373                          C016F:  CALL    C01AD
   374                                  JR      NZ,A01C6
   375                                  PUSH    HL
   376                                  CALL    C0199
   377                                  EX      (SP),HL
   378                                  CALL    M7FBE
   379                                  JR      J018D
   380                          
   381                          C017E:  CALL    C01AD
   382                                  JP      NZ,A01E1
   383                                  POP     DE
   384                                  PUSH    HL
   385                                  CALL    C0199
   386                                  EX      (SP),HL
   387                                  CALL    M7FC4
   388                          J018D:  EX      (SP),HL
   389                                  PUSH    AF
   390                                  LD      A,L
   391                          ;        OUT     ($A8),A
   392                          	NOP
   393                          	NOP
   394                                  LD      A,H
   395                                  LD      (D_FFFF),A
   396                                  POP     AF
   397                                  POP     HL
   398                                  RET
   399                          
   400                          C0199:  PUSH    AF
   401                                  LD      A,(D_FFFF)
   402                                  CPL
   403                                  LD      H,A
   404                                  AND     $F3
   405                                  LD      (D_FFFF),A
   406                                  IN      A,($A8)
   407                                  LD      L,A
   408                                  AND     $F3
   409                          ;        OUT     ($A8),A
   410                          	NOP
   411                          	NOP
   412                                  POP     AF
   413                                  RET
   414                          
   415                          C01AD:  INC     D
   416                                  DEC     D
   417                                  RET     NZ
   418                                  LD      B,A
   419                                  LD      A,E
   420                                  CP      3
   421                                  LD      A,B
   422                                  RET
   423                                  ENDIF
   424                          
   425                          A01B6:
   426                          ;	call    A027E                   ; make masks
   427  01b6  00                	nop
   428  01b7  00                	nop
   429  01b8  00                	nop
   430                          
   431                                  IF      SLOTFIX = 1
   432                          ;        jp      m,C016F
   433                          	nop
   434                          	nop
   435                          	nop
   436                                  ELSE
   437                          ;        jp      m,A01C6                 ; expanded slot, handle
   438  01b9  00                	nop
   439  01ba  00                	nop
   440  01bb  00                	nop
   441                                  ENDIF
   442                          
   443                          ;        in      a,($A8)
   444  01bc  00                	nop
   445  01bd  00                	nop
   446                          ;        ld      d,a
   447  01be  00                	nop
   448                          ;        and     c                       ; clear slot of page
   449  01bf  00                	nop
   450                          ;        or      b                       ; set new slot
   451  01c0  00                	nop
   452                          ;        call    RDPRIM                  ; read byte
   453  01c1  00                	nop
   454  01c2  00                	nop
   455  01c3  00                	nop
   456                          ;        ld      a,e
   457  01c4  af                	xor	a
   458  01c5  c9                        ret
   459                          ;
   460  01c6  e5                A01C6:  push    hl
   461  01c7  cda302                    call    A02A3                   ; change sec. slotregister
   462  01ca  e3                        ex      (sp),hl
   463  01cb  c5                        push    bc
   464  01cc  cdb601                    call    A01B6                   ; do a RDSLT for primary slot
   465  01cf  181b                      jr      A01EC
   466                          ;
   467  01d1  d5                A01D1:  push    de
   468  01d2  cd7e02                    call    A027E                   ; make masks
   469                          
   470                                  IF      SLOTFIX = 1
   471                                  jp      m,C017E
   472                                  ELSE
   473  01d5  fae101                    jp      m,A01E1                 ; expanded slot, handle
   474                                  ENDIF
   475                          
   476  01d8  d1                        pop     de
   477  01d9  dba8                      in      a,($A8)
   478  01db  57                        ld      d,a
   479  01dc  a1                        and     c                       ; clear slot of page
   480  01dd  b0                        or      b                       ; set new slot
   481  01de  c30000                    jp      WRPRIM                  ; write byte
   482                          ;
   483  01e1  e3                A01E1:  ex      (sp),hl
   484  01e2  e5                        push    hl
   485  01e3  cda302                    call    A02A3                   ; change sec. slotregister
   486  01e6  d1                        pop     de
   487  01e7  e3                        ex      (sp),hl
   488  01e8  c5                        push    bc
   489  01e9  cdd101                    call    A01D1                   ; do a WRSLT for primairy slot
   490  01ec  c1                A01EC:  pop     bc
   491  01ed  e3                        ex      (sp),hl
   492  01ee  f5                        push    af
   493  01ef  78                        ld      a,b
   494  01f0  e63f                      and     $3F
   495  01f2  b1                        or      c                       ; slot of sec. slotreg
   496                          ;        out     ($A8),a
   497  01f3  00                	nop
   498  01f4  00                	nop
   499  01f5  7d                        ld      a,l
   500  01f6  32ffff                    ld      (D_FFFF),a              ; restore register
   501  01f9  78                        ld      a,b
   502                          ;        out     ($A8),a                ; restore prim. slotreg
   503  01fa  00                	nop
   504  01fb  00                	nop
   505  01fc  f1                        pop     af
   506  01fd  e1                        pop     hl
   507  01fe  c9                        ret
   508                          ;
   509  01ff  fd2ac0fc          A01FF:  ld      iy,(EXPTBL+0-1)         ; slotid mainrom
   510  0203  1812                      jr      A0217
   511                          ;
   512  0205  e3                A0205:  ex      (sp),hl
   513  0206  f5                        push    af
   514  0207  d5                        push    de
   515  0208  7e                        ld      a,(hl)
   516  0209  f5                        push    af
   517  020a  fde1                      pop     iy                      ; slotid
   518  020c  23                        inc     hl
   519  020d  5e                        ld      e,(hl)
   520  020e  23                        inc     hl
   521  020f  56                        ld      d,(hl)
   522  0210  23                        inc     hl
   523  0211  d5                        push    de
   524  0212  dde1                      pop     ix                      ; adres
   525  0214  d1                        pop     de
   526  0215  f1                        pop     af
   527  0216  e3                        ex      (sp),hl
   528                          
   529  0217  d9                A0217:  exx
   530  0218  08                        ex      af,af'                  ; alternative set
   531  0219  fde5                      push    iy
   532  021b  f1                        pop     af
   533  021c  dde5                      push    ix
   534  021e  e1                        pop     hl
   535  021f  cd7e02                    call    A027E                   ; make masks
   536  0222  fa2e02                    jp      m,A022E                 ; expanded slot, handle
   537  0225  dba8                      in      a,($A8)
   538  0227  f5                        push    af
   539  0228  a1                        and     c
   540  0229  b0                        or      b
   541  022a  d9                        exx
   542  022b  c30000                    jp      CLPRIM
   543                          ;
   544  022e  cda302            A022E:  call    A02A3
   545  0231  f5                        push    af
   546  0232  fde1                      pop     iy
   547  0234  e5                        push    hl
   548  0235  c5                        push    bc
   549  0236  4f                        ld      c,a
   550  0237  0600                      ld      b,$00
   551  0239  7d                        ld      a,l
   552  023a  a4                        and     h
   553  023b  b2                        or      d
   554  023c  21c5fc                    ld      hl,SLTTBL
   555  023f  09                        add     hl,bc
   556  0240  77                        ld      (hl),a
   557  0241  e5                        push    hl
   558  0242  08                        ex      af,af'
   559  0243  d9                        exx
   560  0244  cd1702                    call    A0217                   ; do a CALSLT with primairy slot
   561  0247  d9                        exx
   562  0248  08                        ex      af,af'
   563  0249  e1                        pop     hl
   564  024a  c1                        pop     bc
   565  024b  d1                        pop     de
   566  024c  78                        ld      a,b
   567  024d  e63f                      and     $3F
   568  024f  b1                        or      c
   569  0250  f3                        di
   570                          ;        out     ($A8),a
   571  0251  00                	nop
   572  0252  00                	nop
   573  0253  7b                        ld      a,e
   574  0254  32ffff                    ld      (D_FFFF),a
   575  0257  78                        ld      a,b
   576                          ;        out     ($A8),a
   577  0258  00                	nop
   578  0259  00                	nop
   579  025a  73                        ld      (hl),e
   580  025b  08                        ex      af,af'
   581  025c  d9                        exx
   582  025d  c9                        ret
   583                          ;
   584  025e  cd7e02            A025E:  call    A027E                   ; get masks
   585  0261  fa6b02                    jp      m,A026B                 ; expanded slot, handle
   586  0264  dba8                      in      a,($A8)
   587  0266  a1                        and     c
   588  0267  b0                        or      b
   589                          ;        out     ($A8),a
   590  0268  00                	nop
   591  0269  00                	nop
   592  026a  c9                        ret
   593                          ;
   594  026b  e5                A026B:  push    hl
   595  026c  cda302                    call    A02A3
   596  026f  4f                        ld      c,a
   597  0270  0600                      ld      b,$00
   598  0272  7d                        ld      a,l
   599  0273  a4                        and     h
   600  0274  b2                        or      d
   601  0275  21c5fc                    ld      hl,SLTTBL
   602  0278  09                        add     hl,bc
   603  0279  77                        ld      (hl),a
   604  027a  e1                        pop     hl
   605  027b  79                        ld      a,c
   606  027c  18e0                      jr      A025E
   607                          ;
   608  027e  f3                A027E:  di
   609  027f  f5                        push    af
   610  0280  7c                        ld      a,h
   611  0281  07                        rlca
   612  0282  07                        rlca
   613  0283  e603                      and     $03                    ; page
   614  0285  5f                        ld      e,a
   615  0286  3ec0                      ld      a,$C0
   616  0288  07                A0288:  rlca
   617  0289  07                        rlca
   618  028a  1d                        dec     e
   619  028b  f28802                    jp      p,A0288
   620  028e  5f                        ld      e,a                     ; e = page select mask
   621  028f  2f                        cpl
   622  0290  4f                        ld      c,a                     ; c = page clear mask
   623  0291  f1                        pop     af
   624  0292  f5                        push    af
   625  0293  e603                      and     $03                    ; primairy slot
   626  0295  3c                        inc     a                       ; +1
   627  0296  47                        ld      b,a
   628  0297  3eab                      ld      a,0-01010101b
   629  0299  c655              A0299:  add     a,01010101b
   630  029b  10fc                      djnz    A0299
   631  029d  57                        ld      d,a                     ; d = slot set mask
   632  029e  a3                        and     e
   633  029f  47                        ld      b,a                     ; b = slot set mask
   634  02a0  f1                        pop     af
   635  02a1  a7                        and     a                       ; flag expanded slot
   636  02a2  c9                        ret
   637                          ;
   638  02a3  f5                A02A3:  push    af
   639  02a4  7a                        ld      a,d
   640  02a5  e6c0                      and     $C0
   641  02a7  4f                        ld      c,a                     ; page set mask for page 3
   642  02a8  f1                        pop     af
   643  02a9  f5                        push    af
   644  02aa  57                        ld      d,a
   645  02ab  dba8                      in      a,($A8)
   646  02ad  47                        ld      b,a
   647  02ae  e63f                      and     $3F                    ; clear slot of page 3
   648  02b0  b1                        or      c                       ; set page 3 for sec. slotreg
   649                          ;        out     ($A8),a                ; invoke
   650  02b1  00                	nop
   651  02b2  00                	nop
   652  02b3  7a                        ld      a,d
   653  02b4  0f                        rrca
   654  02b5  0f                        rrca
   655  02b6  e603                      and     $03                    ; secundairy slot
   656  02b8  57                        ld      d,a
   657  02b9  3eab                      ld      a,0-01010101b
   658  02bb  c655              A02BB:  add     a,01010101b
   659  02bd  15                        dec     d
   660  02be  f2bb02                    jp      p,A02BB                 ; slot set mask
   661  02c1  a3                        and     e
   662  02c2  57                        ld      d,a                     ; slot set (page) mask
   663  02c3  7b                        ld      a,e
   664  02c4  2f                        cpl
   665  02c5  67                        ld      h,a                     ; page clear mask
   666  02c6  3affff                    ld      a,(D_FFFF)
   667  02c9  2f                        cpl
   668  02ca  6f                        ld      l,a                     ; old sec. slotreg
   669  02cb  a4                        and     h                       ; clear page
   670  02cc  b2                        or      d                       ; set new slot
   671  02cd  32ffff                    ld      (D_FFFF),a
   672  02d0  78                        ld      a,b
   673                          ;        out     ($A8),a                ; restore primairy slot on page 3
   674  02d1  00                	nop
   675  02d2  00                	nop
   676  02d3  f1                        pop     af
   677  02d4  e603                      and     $03
   678  02d6  c9                        ret
   679                          ;
   680  02d7  3e82              A02D7:	ld      a,$82
   681                          ;        out     ($AB),a                ; initialize PPI (active, group A mode 0, group A output, upper port C output, group B mode 0, group B input, lower port C output)
   682  02d9  00                	nop
   683  02da  00                	nop
   684  02db  af                        xor     a
   685                          ;        out     ($A8),a                ; select primairy slot 0 on all pages
   686  02dc  00                	nop
   687  02dd  00                	nop
   688  02de  3e50                      ld      a,$50
   689                          ;        out     ($AA),a                ; CAPS off, motor off, keyboard row 0
   690  02e0  00                	nop
   691  02e1  00                	nop
   692  02e2  11ffff                    ld      de,$FFFF               ; initialize lowest RAM address found (page 2)
   693  02e5  af                        xor     a                       ; start with primairy slot 0
   694  02e6  4f                        ld      c,a                     ; initialize expanded slot flags
   695                          A02E7:
   696                          ;	out     ($A8),a                ; select primairy slot on page 2 and 3
   697  02e7  00                	nop
   698  02e8  00                	nop
   699  02e9  cb21                      sla     c                       ; shift expanded slot flags
   700  02eb  0600                      ld      b,0                     ; assume not expanded slot
   701  02ed  21ffff                    ld      hl,$FFFF
   702  02f0  36f0                      ld      (hl),$F0
   703  02f2  7e                        ld      a,(hl)
   704  02f3  d60f                      sub     $0F                    ; is slot expanded (writen value readback inverted) ?
   705  02f5  200b                      jr      nz,A0302                ; nope,
   706  02f7  77                        ld      (hl),a
   707  02f8  7e                        ld      a,(hl)
   708  02f9  3c                        inc     a                       ; is slot expanded (writen value readback inverted) ?
   709  02fa  2006                      jr      nz,A0302                ; nope,
   710  02fc  04                        inc     b
   711  02fd  cbc1                      set     0,c                     ; flag slot expanded
   712  02ff  32ffff            A02FF:  ld      (D_FFFF),a
   713  0302  2100bf            A0302:  ld      hl,$C000-256           ; page 2
   714  0305  7e                A0305:  ld      a,(hl)
   715  0306  2f                        cpl
   716  0307  77                        ld      (hl),a
   717  0308  be                        cp      (hl)                    ; RAM found (write inverted correctly read back) ?
   718  0309  2f                        cpl
   719  030a  77                        ld      (hl),a                  ; restore orginal value
   720  030b  2007                      jr      nz,A0314                ; no RAM
   721  030d  2c                        inc     l
   722  030e  20f5                      jr      nz,A0305
   723  0310  25                        dec     h
   724  0311  fa0503                    jp      m,A0305
   725  0314  2e00              A0314:  ld      l,$00
   726  0316  24                        inc     h                       ; round up 256 bytes boundary
   727  0317  7d                        ld      a,l
   728  0318  93                        sub     e
   729  0319  7c                        ld      a,h
   730  031a  9a                        sbc     a,d                     ; page 2 with more RAM ?
   731  031b  300a                      jr      nc,A0327                ; nope,
   732  031d  eb                        ex      de,hl                   ; new lowest RAM address found
   733  031e  3affff                    ld      a,(D_FFFF)
   734  0321  2f                        cpl
   735  0322  6f                        ld      l,a
   736  0323  dba8                      in      a,($A8)
   737  0325  67                        ld      h,a
   738  0326  f9                        ld      sp,hl                   ; save primairy and secundairy slotregister of lowest RAM address found (page 2)
   739  0327  78                A0327:  ld      a,b
   740  0328  a7                        and     a                       ; slot expanded ?
   741  0329  280a                      jr      z,A0335                 ; nope, next primary slot
   742  032b  3affff                    ld      a,(D_FFFF)
   743  032e  2f                        cpl
   744  032f  c610                      add     a,$10                  ; next secundairy slot page 2
   745  0331  fe40                      cp      $40                    ; all secundairy slots done ?
   746  0333  38ca                      jr      c,A02FF                 ; nope, next
   747  0335  dba8              A0335:  in      a,($A8)
   748  0337  c650                      add     a,$50                  ; next primary slot page 2 and 3
   749  0339  30ac                      jr      nc,A02E7                ; all primary slots done ? nope, next
   750  033b  210000                    ld      hl,0
   751  033e  39                        add     hl,sp
   752  033f  7c                        ld      a,h
   753                          ;        out     ($A8),a
   754  0340  00                	nop
   755  0341  00                	nop
   756  0342  7d                        ld      a,l
   757  0343  32ffff                    ld      (D_FFFF),a              ; select slot with lowest RAM address found (page 2)
   758  0346  79                        ld      a,c
   759  0347  07                        rlca
   760  0348  07                        rlca
   761  0349  07                        rlca
   762  034a  07                        rlca
   763  034b  4f                        ld      c,a                     ; expanded slot flags in b7-b4
   764  034c  11ffff                    ld      de,$FFFF               ; initialize lowest RAM address found (page 3)
   765  034f  dba8                      in      a,($A8)
   766  0351  e63f                      and     $3F                    ; primairy slot 0 in page 3
   767                          A0353:
   768                          ;	out     ($A8),a                ; select new primairy slot in page 3
   769  0353  00                	nop
   770  0354  00                	nop
   771  0355  0600                      ld      b,0
   772  0357  cb01                      rlc     c                       ; slot expanded ?
   773  0359  300a                      jr      nc,A0365                ; nope,
   774  035b  04                        inc     b                       ; flag slot expanded
   775  035c  3affff                    ld      a,(D_FFFF)
   776  035f  2f                        cpl
   777  0360  e63f                      and     $3F                    ; secundairy slot 0 in page 3
   778  0362  32ffff            A0362:  ld      (D_FFFF),a              ; select new secundairy slot in page 3
   779  0365  2100fe            A0365:  ld      hl,$FF00-256           ; page 3 (leave upper 256 bytes out for secundairy slot register)
   780  0368  7e                A0368:  ld      a,(hl)
   781  0369  2f                        cpl
   782  036a  77                        ld      (hl),a
   783  036b  be                        cp      (hl)                    ; RAM found (write inverted correctly read back) ?
   784  036c  2f                        cpl
   785  036d  77                        ld      (hl),a                  ; restore orginal value
   786  036e  2009                      jr      nz,A0379                ; no RAM
   787  0370  2c                        inc     l
   788  0371  20f5                      jr      nz,A0368
   789  0373  25                        dec     h
   790  0374  7c                        ld      a,h
   791  0375  fec0                      cp      $C0
   792  0377  30ef                      jr      nc,A0368
   793  0379  2e00              A0379:  ld      l,$00
   794  037b  24                        inc     h                       ; round up 256 bytes boundary
   795  037c  7d                        ld      a,l
   796  037d  93                        sub     e
   797  037e  7c                        ld      a,h
   798  037f  9a                        sbc     a,d                     ; page 3 with more RAM ?
   799  0380  300a                      jr      nc,A038C                ; nope,
   800  0382  eb                        ex      de,hl                   ; new lowest RAM address found
   801  0383  3affff                    ld      a,(D_FFFF)
   802  0386  2f                        cpl
   803  0387  6f                        ld      l,a
   804  0388  dba8                      in      a,($A8)
   805  038a  67                        ld      h,a
   806  038b  f9                        ld      sp,hl                   ; save primairy and secundairy slotregister of lowest RAM address found (page 3)
   807  038c  78                A038C:  ld      a,b
   808  038d  a7                        and     a                       ; slot expanded ?
   809  038e  2808                      jr      z,A0398                 ; nope,
   810  0390  3affff                    ld      a,(D_FFFF)
   811  0393  2f                        cpl
   812  0394  c640                      add     a,$40                  ; next secundairy slot page 3
   813  0396  30ca                      jr      nc,A0362                ; all secundairy slots done ? nope, next
   814  0398  dba8              A0398:  in      a,($A8)
   815  039a  c640                      add     a,$40                  ; next primairy slot page 3
   816  039c  30b5                      jr      nc,A0353                ; all primary slots done ? nope, next
   817  039e  210000                    ld      hl,0
   818  03a1  39                        add     hl,sp
   819  03a2  7c                        ld      a,h
   820                          ;        out     ($A8),a
   821  03a3  00                	nop
   822  03a4  00                	nop
   823  03a5  7d                        ld      a,l
   824  03a6  32ffff                    ld      (D_FFFF),a              ; select slot with lowest RAM address found (page 3)
   825  03a9  79                        ld      a,c
   826  03aa  01490c                    ld      bc,$0C49
   827  03ad  1181f3                    ld      de,VARWRK+1
   828  03b0  2180f3                    ld      hl,VARWRK
   829  03b3  3600                      ld      (hl),$00
   830  03b5  edb0                      ldir                            ; clear system variable area
   831  03b7  4f                        ld      c,a
   832  03b8  0604                      ld      b,4
   833  03ba  21c4fc                    ld      hl,EXPTBL+3
   834  03bd  cb19              A03BD:  rr      c
   835  03bf  9f                        sbc     a,a
   836  03c0  e680                      and     $80
   837  03c2  77                        ld      (hl),a                  ; initialize slot expanded flag
   838  03c3  2b                        dec     hl
   839  03c4  10f7                      djnz    A03BD
   840  03c6  dba8                      in      a,($A8)
   841  03c8  4f                        ld      c,a                     ; save current primairy slot register
   842  03c9  af                        xor     a
   843                          ;        out     ($A8),a                ; select primairy slot 0 in page 0,1,2,3
   844  03ca  00                	nop
   845  03cb  00                	nop
   846  03cc  3affff                    ld      a,(D_FFFF)
   847  03cf  2f                        cpl
   848  03d0  6f                        ld      l,a                     ; save current secundairy slot register slot 0
   849  03d1  3e40                      ld      a,$40
   850                          ;        out     ($A8),a                ; select primairy slot 0 in page 0,1,2 slot 1 in page 3
   851  03d3  00                	nop
   852  03d4  00                	nop
   853  03d5  3affff                    ld      a,(D_FFFF)
   854  03d8  2f                        cpl
   855  03d9  67                        ld      h,a                     ; save current secundairy slot register slot 1
   856  03da  3e80                      ld      a,$80
   857                          ;        out     ($A8),a                ; select primairy slot 0 in page 0,1,2 slot 2 in page 3
   858  03dc  00                	nop
   859  03dd  00                	nop
   860  03de  3affff                    ld      a,(D_FFFF)
   861  03e1  2f                        cpl
   862  03e2  5f                        ld      e,a                     ; save current secundairy slot register slot 2
   863  03e3  3ec0                      ld      a,$C0
   864                          ;        out     ($A8),a                ; select primairy slot 0 in page 0,1,2 slot 3 in page 3
   865  03e5  00                	nop
   866  03e6  00                	nop
   867  03e7  3affff                    ld      a,(D_FFFF)
   868  03ea  2f                        cpl
   869  03eb  57                        ld      d,a                     ; save current secundairy slot register slot 3
   870  03ec  79                        ld      a,c
   871                          ;        out     ($A8),a                ; restore primairy slot register
   872  03ed  00                	nop
   873  03ee  00                	nop
   874  03ef  22c5fc                    ld      (SLTTBL+0),hl
   875  03f2  eb                        ex      de,hl
   876  03f3  22c7fc                    ld      (SLTTBL+2),hl           ; current secundairy slot registers saved in SLTTBL
   877  03f6  ed56                      im      1                       ; Z80 interrupt mode 1 (RST $38 on INT)
   878  03f8  c38026                    jp      A2680                   ; part 2 of init
   879                          ;
   880  03fb  3ab1fb            A03FB:  ld      a,(BASROM)
   881  03fe  a7                        and     a                       ; executing basicrom ?
   882  03ff  c0                        ret     nz                      ; yep, quit
   883  0400  e5                        push    hl
   884  0401  219bfc                    ld      hl,INTFLG
   885  0404  f3                        di                              ; INTFLG can not change
   886  0405  7e                        ld      a,(hl)
   887  0406  3600                      ld      (hl),$00               ; reset
   888  0408  e1                        pop     hl
   889  0409  fb                        ei
   890  040a  a7                        and     a                       ; STOP or CTRL/STOP ?
   891  040b  c8                        ret     z                       ; nop, quit
   892  040c  fe03                      cp      $03
   893  040e  281c                      jr      z,A042C                 ; it is CTRL/STOP
   894  0410  e5                        push    hl
   895  0411  d5                        push    de
   896  0412  c5                        push    bc
   897  0413  cdda09                    call    A09DA                   ; cursor on
   898  0416  219bfc                    ld      hl,INTFLG
   899  0419  f3                A0419:  di                              ; INTFLG can not change
   900  041a  7e                        ld      a,(hl)
   901  041b  3600                      ld      (hl),$00               ; reset
   902  041d  fb                        ei
   903  041e  a7                        and     a                       ; STOP or CTRL/STOP ?
   904  041f  28f8                      jr      z,A0419                 ; nop, try again
   905  0421  f5                        push    af
   906  0422  cd270a                    call    A0A27                   ; cursor off
   907  0425  f1                        pop     af
   908  0426  c1                        pop     bc
   909  0427  d1                        pop     de
   910  0428  e1                        pop     hl
   911  0429  fe03                      cp      $03                    ; CTRL/STOP ?
   912  042b  c0                        ret     nz                      ; nop, just quit
   913  042c  e5                A042C:  push    hl
   914  042d  cd6804                    call    A0468                   ; clear keyboard buffer
   915  0430  cd5404                    call    A0454
   916  0433  300a                      jr      nc,A043F
   917  0435  216afc                    ld      hl,TRPTBL+10*3
   918  0438  f3                        di
   919  0439  cdf00e                    call    C0EF1
   920  043c  fb                        ei
   921  043d  e1                        pop     hl
   922  043e  c9                        ret
   923                          ;
   924  043f  cd3b08            A043F:  call    A083B
   925  0442  3ac1fc                    ld      a,(EXPTBL+0)
   926  0445  2640                      ld      h,$40
   927  0447  cd5e02                    call    A025E
   928  044a  e1                        pop     hl
   929  044b  af                        xor     a
   930  044c  ed7bb1f6                  ld      sp,(SAVSTK)
   931  0450  c5                        push    bc
   932  0451  c30000                    jp      C63E6
   933                          ;
   934  0454  3a6afc            A0454:  ld      a,(TRPTBL+10*3+0)
   935  0457  0f                        rrca
   936  0458  d0                        ret     nc
   937  0459  2a6bfc                    ld      hl,(TRPTBL+10*3+1)
   938  045c  7c                        ld      a,h
   939  045d  b5                        or      l
   940  045e  c8                        ret     z
   941  045f  2a1cf4                    ld      hl,(CURLIN)
   942  0462  23                        inc     hl
   943  0463  7c                        ld      a,h
   944  0464  b5                        or      l
   945  0465  c8                        ret     z
   946  0466  37                        scf
   947  0467  c9                        ret
   948                          ;
   949  0468  2a0000            A0468:  ld      hl,(PUTPNT)
   950  046b  220000                    ld      (GETPNT),hl
   951  046e  c9                        ret
   952                          ;
   953  046f  dbaa              A046F:  in      a,($AA)
   954  0471  e6f0                      and     $F0
   955  0473  f607                      or      $07
   956                          ;        out     ($AA),a
   957  0475  00                	nop
   958  0476  00                	nop
   959  0477  dba9                      in      a,($A9)
   960  0479  e610                      and     $10
   961  047b  c0                        ret     nz
   962  047c  dbaa                      in      a,($AA)
   963  047e  3d                        dec     a
   964                          ;        out     ($AA),a
   965  047f  00                	nop
   966  0480  00                	nop
   967  0481  dba9                      in      a,($A9)
   968  0483  e602                      and     $02
   969  0485  c0                        ret     nz
   970  0486  e5                        push    hl
   971  0487  2a0000                    ld      hl,(PUTPNT)
   972  048a  220000                    ld      (GETPNT),hl
   973  048d  e1                        pop     hl
   974  048e  3ae1fb                    ld      a,(OLDKEY+7)
   975  0491  e6ef                      and     $EF
   976  0493  32e1fb                    ld      (OLDKEY+7),a
   977  0496  3e0d                      LD      A,13
   978  0498  320000                    ld      (REPCNT),a
   979  049b  37                        scf
   980  049c  c9                        ret
   981                          ;
   982  049d  3e07              A049D:  ld      a,$07
   983  049f  1e80                      ld      e,$80
   984  04a1  cd0211                    call    A1102
   985                          ;        ld      a,$0F
   986  04a4  00                	nop
   987  04a5  00                	nop
   988                          ;        ld      e,$CF
   989  04a6  00                	nop
   990  04a7  00                	nop
   991                          ;        call    A1102
   992  04a8  00                	nop
   993  04a9  00                	nop
   994  04aa  00                	nop
   995  04ab  3e0b                      ld      a,$0B
   996  04ad  5f                        ld      e,a
   997  04ae  cd0211                    call    A1102
   998  04b1  cd0c11                    call    A110C
   999  04b4  e640                      and     $40
  1000  04b6  32adfc                    ld      (KANAMD),a
  1001  04b9  3eff                      ld      a,$FF
  1002                          ;        out     ($90),a
  1003  04bb  00                	nop
  1004  04bc  00                	nop
  1005  04bd  e5                A04BD:  push    hl
  1006  04be  d5                        push    de
  1007  04bf  c5                        push    bc
  1008  04c0  f5                        push    af
  1009  04c1  213ffb                    ld      hl,MUSICF
  1010  04c4  0671                      ld      b,$71
  1011  04c6  af                        xor     a
  1012  04c7  77                A04C7:  ld      (hl),a
  1013  04c8  23                        inc     hl
  1014  04c9  10fc                      djnz    A04C7
  1015  04cb  1175f9                    ld      de,VOICAQ
  1016  04ce  067f                      ld      b,$7F
  1017  04d0  218000                    ld      hl,128
  1018  04d3  e5                A04D3:  push    hl
  1019  04d4  d5                        push    de
  1020  04d5  c5                        push    bc
  1021  04d6  f5                        push    af
  1022  04d7  cdda14                    call    A14DA
  1023  04da  f1                        pop     af
  1024  04db  c608                      add     a,$08
  1025  04dd  1e00                      ld      e,$00
  1026  04df  cd0211                    call    A1102
  1027  04e2  d608                      sub     $08
  1028  04e4  f5                        push    af
  1029  04e5  2e0f                      ld      l,$0F
  1030  04e7  cd7714                    call    A1477
  1031  04ea  eb                        ex      de,hl
  1032  04eb  210805                    ld      hl,T0508
  1033  04ee  010600                    ld      bc,6
  1034  04f1  edb0                      ldir
  1035  04f3  f1                        pop     af
  1036  04f4  c1                        pop     bc
  1037  04f5  e1                        pop     hl
  1038  04f6  d1                        pop     de
  1039  04f7  19                        add     hl,de
  1040  04f8  eb                        ex      de,hl
  1041  04f9  3c                        inc     a
  1042  04fa  fe03                      cp      $03
  1043  04fc  38d5                      jr      c,A04D3
  1044  04fe  3e07                      ld      a,$07
  1045  0500  1eb8                      ld      e,$B8
  1046  0502  cd0211                    call    A1102
  1047  0505  c3da08                    jp      A08DA
  1048                          ;
  1049  0508  04                T0508:  db      4
  1050  0509  04                        db      4
  1051  050a  78                        db      120
  1052  050b  88                        db      8+128
  1053  050c  ff00                      dw      255
  1054                          
  1055  050e  cd7705            A050E:  call    A0577
  1056  0511  af                        xor     a
  1057  0512  32affc                    ld      (SCRMOD),a
  1058  0515  32b0fc                    ld      (OLDSCR),a
  1059  0518  3a0000                    ld      a,(LINL40)
  1060  051b  320000                    ld      (LINLEN),a
  1061  051e  2a0000                    ld      hl,(TXTNAM)
  1062  0521  2222f9                    ld      (NAMBAS),hl
  1063  0524  2a0000                    ld      hl,(TXTCGP)
  1064  0527  2224f9                    ld      (CGPBAS),hl
  1065  052a  cdf707                    call    A07F7
  1066  052d  cd7e07                    call    A077E
  1067  0530  cd1e07                    call    A071E
  1068  0533  cd9405                    call    A0594
  1069  0536  1838                      jr      A0570
  1070                          ;
  1071  0538  cd7705            A0538:  call    A0577
  1072  053b  3e01                      ld      a,$01
  1073  053d  32affc                    ld      (SCRMOD),a
  1074  0540  32b0fc                    ld      (OLDSCR),a
  1075  0543  3a0000                    ld      a,(LINL32)
  1076  0546  320000                    ld      (LINLEN),a
  1077  0549  2a0000                    ld      hl,(T32NAM)
  1078  054c  2222f9                    ld      (NAMBAS),hl
  1079  054f  2a0000                    ld      hl,(T32CGP)
  1080  0552  2224f9                    ld      (CGPBAS),hl
  1081  0555  2a0000                    ld      hl,(T32PAT)
  1082  0558  2226f9                    ld      (PATBAS),hl
  1083  055b  2a0000                    ld      hl,(T32ATR)
  1084  055e  2228f9                    ld      (ATRBAS),hl
  1085  0561  cdf707                    call    A07F7
  1086  0564  cd7e07                    call    A077E
  1087  0567  cd1e07                    call    A071E
  1088  056a  cdbb06                    call    A06BB
  1089  056d  cdb405                    call    A05B4
  1090  0570  3a0000            A0570:  ld      a,(RG1SAV)
  1091  0573  f640                      or      $40
  1092  0575  1805                      jr      A057C
  1093                          ;
  1094  0577  3a0000            A0577:  ld      a,(RG1SAV)
  1095  057a  e6bf                      and     $BF
  1096  057c  47                A057C:  ld      b,a
  1097  057d  0e01                      ld      c,$01
  1098  057f  78                A057F:  ld      a,b
  1099  0580  f3                        di
  1100  0581  d399                      out     (VDPCTL),a
  1101  0583  79                        ld      a,c
  1102  0584  f680                      or      $80
  1103  0586  d399                      out     (VDPCTL),a
  1104  0588  fb                        ei
  1105  0589  e5                        push    hl
  1106  058a  78                        ld      a,b
  1107  058b  0600                      ld      b,$00
  1108  058d  210000                    ld      hl,RG0SAV
  1109  0590  09                        add     hl,bc
  1110  0591  77                        ld      (hl),a
  1111  0592  e1                        pop     hl
  1112  0593  c9                        ret
  1113                          ;
  1114  0594  3a0000            A0594:  ld      a,(RG0SAV)
  1115  0597  e601                      and     $01
  1116  0599  47                        ld      b,a
  1117  059a  0e00                      ld      c,$00
  1118  059c  cd7f05                    call    A057F
  1119  059f  3a0000                    ld      a,(RG1SAV)
  1120  05a2  e6e7                      and     $E7
  1121  05a4  f610                      or      $10
  1122  05a6  47                        ld      b,a
  1123  05a7  0c                        inc     c
  1124  05a8  cd7f05                    call    A057F
  1125  05ab  210000                    ld      hl,TXTNAM
  1126  05ae  110000                    ld      de,$0000
  1127  05b1  c37706                    jp      A0677
  1128                          ;
  1129  05b4  3a0000            A05B4:  ld      a,(RG0SAV)
  1130  05b7  e601                      and     $01
  1131  05b9  47                        ld      b,a
  1132  05ba  0e00                      ld      c,$00
  1133  05bc  cd7f05                    call    A057F
  1134  05bf  3a0000                    ld      a,(RG1SAV)
  1135  05c2  e6e7                      and     $E7
  1136  05c4  47                        ld      b,a
  1137  05c5  0c                        inc     c
  1138  05c6  cd7f05                    call    A057F
  1139  05c9  210000                    ld      hl,T32NAM
  1140  05cc  110000                    ld      de,$0000
  1141  05cf  c37706                    jp      A0677
  1142                          ;
  1143  05d2  cd7705            A05D2:  call    A0577
  1144  05d5  3e02                      ld      a,$02
  1145  05d7  32affc                    ld      (SCRMOD),a
  1146  05da  2a0000                    ld      hl,(GRPPAT)
  1147  05dd  2226f9                    ld      (PATBAS),hl
  1148  05e0  2a0000                    ld      hl,(GRPATR)
  1149  05e3  2228f9                    ld      (ATRBAS),hl
  1150  05e6  2a0000                    ld      hl,(GRPNAM)
  1151  05e9  cddf07                    call    A07DF
  1152  05ec  af                        xor     a
  1153  05ed  0603                      ld      b,$03
  1154  05ef  d398              A05EF:  out     (VDPDAT),a
  1155  05f1  3c                        inc     a
  1156  05f2  20fb                      jr      nz,A05EF
  1157  05f4  10f9                      djnz    A05EF
  1158  05f6  cda107                    call    A07A1
  1159  05f9  cdbb06                    call    A06BB
  1160  05fc  cd0206                    call    A0602
  1161  05ff  c37005                    jp      A0570
  1162                          ;
  1163  0602  3a0000            A0602:  ld      a,(RG0SAV)
  1164  0605  f602                      or      $02
  1165  0607  47                        ld      b,a
  1166  0608  0e00                      ld      c,$00
  1167  060a  cd7f05                    call    A057F
  1168  060d  3a0000                    ld      a,(RG1SAV)
  1169  0610  e6e7                      and     $E7
  1170  0612  47                        ld      b,a
  1171  0613  0c                        inc     c
  1172  0614  cd7f05                    call    A057F
  1173  0617  210000                    ld      hl,GRPNAM
  1174  061a  11037f                    ld      de,$7F03
  1175  061d  1858                      jr      A0677
  1176                          ;
  1177  061f  cd7705            A061F:  call    A0577
  1178  0622  3e03                      ld      a,$03
  1179  0624  32affc                    ld      (SCRMOD),a
  1180  0627  2a0000                    ld      hl,(MLTPAT)
  1181  062a  2226f9                    ld      (PATBAS),hl
  1182  062d  2a0000                    ld      hl,(MLTATR)
  1183  0630  2228f9                    ld      (ATRBAS),hl
  1184  0633  2a0000                    ld      hl,(MLTNAM)
  1185  0636  cddf07                    call    A07DF
  1186  0639  110600                    ld      de,6
  1187  063c  0e04              A063C:  ld      c,$04
  1188  063e  7a                A063E:  ld      a,d
  1189  063f  0620                      ld      b,$20
  1190  0641  d398              A0641:  out     (VDPDAT),a
  1191  0643  3c                        inc     a
  1192  0644  10fb                      djnz    A0641
  1193  0646  0d                        dec     c
  1194  0647  20f5                      jr      nz,A063E
  1195  0649  57                        ld      d,a
  1196  064a  1d                        dec     e
  1197  064b  20ef                      jr      nz,A063C
  1198  064d  cdb907                    call    A07B9
  1199  0650  cdbb06                    call    A06BB
  1200  0653  cd5906                    call    A0659
  1201  0656  c37005                    jp      A0570
  1202                          ;
  1203  0659  3a0000            A0659:  ld      a,(RG0SAV)
  1204  065c  e601                      and     $01
  1205  065e  47                        ld      b,a
  1206  065f  0e00                      ld      c,$00
  1207  0661  cd7f05                    call    A057F
  1208  0664  3a0000                    ld      a,(RG1SAV)
  1209  0667  e6e7                      and     $E7
  1210  0669  f608                      or      $08
  1211  066b  47                        ld      b,a
  1212  066c  0e01                      ld      c,$01
  1213  066e  cd7f05                    call    A057F
  1214  0671  210000                    ld      hl,MLTNAM
  1215  0674  110000                    ld      de,$0000
  1216  0677  010206            A0677:  ld      bc,A0602
  1217  067a  cd9006                    call    A0690
  1218  067d  060a                      ld      b,$0A
  1219  067f  7a                        ld      a,d
  1220  0680  cd9106                    call    A0691
  1221  0683  0605                      ld      b,$05
  1222  0685  7b                        ld      a,e
  1223  0686  cd9106                    call    A0691
  1224  0689  0609                      ld      b,$09
  1225  068b  cd9006                    call    A0690
  1226  068e  0605                      ld      b,$05
  1227  0690  af                A0690:  xor     a
  1228  0691  e5                A0691:  push    hl
  1229  0692  f5                        push    af
  1230  0693  7e                        ld      a,(hl)
  1231  0694  23                        inc     hl
  1232  0695  66                        ld      h,(hl)
  1233  0696  6f                        ld      l,a
  1234  0697  af                        xor     a
  1235  0698  29                A0698:  add     hl,hl
  1236  0699  8f                        adc     a,a
  1237  069a  10fc                      djnz    A0698
  1238  069c  6f                        ld      l,a
  1239  069d  f1                        pop     af
  1240  069e  b5                        or      l
  1241  069f  47                        ld      b,a
  1242  06a0  cd7f05                    call    A057F
  1243  06a3  e1                        pop     hl
  1244  06a4  23                        inc     hl
  1245  06a5  23                        inc     hl
  1246  06a6  0c                        inc     c
  1247  06a7  c9                        ret
  1248                          ;
  1249  06a8  3a0000            A06A8:  ld      a,(RG1SAV)
  1250  06ab  47                        ld      b,a
  1251  06ac  0e01                      ld      c,$01
  1252  06ae  cd7f05                    call    A057F
  1253  06b1  2a26f9                    ld      hl,(PATBAS)
  1254  06b4  010008                    ld      bc,$0800
  1255  06b7  af                        xor     a
  1256  06b8  cd1508                    call    A0815
  1257  06bb  3a0000            A06BB:  ld      a,(FORCLR)
  1258  06be  5f                        ld      e,a
  1259  06bf  2a28f9                    ld      hl,(ATRBAS)
  1260  06c2  010020                    ld      bc,$2000
  1261  06c5  3ed1              A06C5:  ld      a,$D1
  1262  06c7  cdcd07                    call    A07CD
  1263  06ca  23                        inc     hl
  1264  06cb  23                        inc     hl
  1265  06cc  79                        ld      a,c
  1266  06cd  cdcd07                    call    A07CD
  1267  06d0  23                        inc     hl
  1268  06d1  0c                        inc     c
  1269  06d2  3a0000                    ld      a,(RG1SAV)
  1270  06d5  0f                        rrca
  1271  06d6  0f                        rrca
  1272  06d7  3003                      jr      nc,A06DC
  1273  06d9  0c                        inc     c
  1274  06da  0c                        inc     c
  1275  06db  0c                        inc     c
  1276  06dc  7b                A06DC:  ld      a,e
  1277  06dd  cdcd07                    call    A07CD
  1278  06e0  23                        inc     hl
  1279  06e1  10e2                      djnz    A06C5
  1280  06e3  c9                        ret
  1281                          ;
  1282  06e4  6f                A06E4:  ld      l,a
  1283  06e5  2600                      ld      h,$00
  1284  06e7  29                        add     hl,hl
  1285  06e8  29                        add     hl,hl
  1286  06e9  29                        add     hl,hl
  1287  06ea  cd0407                    call    A0704
  1288  06ed  fe08                      cp      $08
  1289  06ef  2802                      jr      z,A06F3
  1290  06f1  29                        add     hl,hl
  1291  06f2  29                        add     hl,hl
  1292  06f3  eb                A06F3:  ex      de,hl
  1293  06f4  2a26f9                    ld      hl,(PATBAS)
  1294  06f7  19                        add     hl,de
  1295  06f8  c9                        ret
  1296                          ;
  1297  06f9  6f                A06F9:  ld      l,a
  1298  06fa  2600                      ld      h,$00
  1299  06fc  29                        add     hl,hl
  1300  06fd  29                        add     hl,hl
  1301  06fe  eb                        ex      de,hl
  1302  06ff  2a28f9                    ld      hl,(ATRBAS)
  1303  0702  19                        add     hl,de
  1304  0703  c9                        ret
  1305                          ;
  1306  0704  3a0000            A0704:  ld      a,(RG1SAV)
  1307  0707  0f                        rrca
  1308  0708  0f                        rrca
  1309  0709  3e08                      ld      a,$08
  1310  070b  d0                        ret     nc
  1311  070c  3e20                      ld      a,$20
  1312  070e  c9                        ret
  1313                          ;
  1314  070f  cdec07            A070F:  call    A07EC
  1315  0712  e3                        ex      (sp),hl
  1316  0713  e3                        ex      (sp),hl
  1317  0714  db98              A0714:  in      a,(VDPDAT)
  1318  0716  12                        ld      (de),a
  1319  0717  13                        inc     de
  1320  0718  0b                        dec     bc
  1321  0719  79                        ld      a,c
  1322  071a  b0                        or      b
  1323  071b  20f7                      jr      nz,A0714
  1324  071d  c9                        ret
  1325                          ;
  1326  071e  cdc7fd            A071E:  call    H_INIP
  1327  0721  2a24f9                    ld      hl,(CGPBAS)
  1328  0724  cddf07                    call    A07DF
  1329  0727  3a1ff9                    ld      a,(CGPNT+0)
  1330  072a  2a20f9                    ld      hl,(CGPNT+1)
  1331  072d  010008                    ld      bc,$0800
  1332  0730  f5                        push    af
  1333  0731  f1                A0731:  pop     af
  1334  0732  f5                        push    af
  1335  0733  c5                        push    bc
  1336  0734  f3                        di
  1337  0735  cdb601                    call    A01B6
  1338  0738  fb                        ei
  1339  0739  c1                        pop     bc
  1340  073a  d398                      out     (VDPDAT),a
  1341  073c  23                        inc     hl
  1342  073d  0b                        dec     bc
  1343  073e  79                        ld      a,c
  1344  073f  b0                        or      b
  1345  0740  20ef                      jr      nz,A0731
  1346  0742  f1                        pop     af
  1347  0743  c9                        ret
  1348                          ;
  1349  0744  eb                A0744:  ex      de,hl
  1350  0745  cddf07                    call    A07DF
  1351  0748  1a                A0748:  ld      a,(de)
  1352  0749  d398                      out     (VDPDAT),a
  1353  074b  13                        inc     de
  1354  074c  0b                        dec     bc
  1355  074d  79                        ld      a,c
  1356  074e  b0                        or      b
  1357  074f  20f7                      jr      nz,A0748
  1358  0751  c9                        ret
  1359                          ;
  1360  0752  2600              A0752:  ld      h,$00
  1361  0754  6f                        ld      l,a
  1362  0755  29                        add     hl,hl
  1363  0756  29                        add     hl,hl
  1364  0757  29                        add     hl,hl
  1365  0758  eb                        ex      de,hl
  1366  0759  2a20f9                    ld      hl,(CGPNT+1)
  1367  075c  19                        add     hl,de
  1368  075d  1140fc                    ld      de,PATWRK
  1369  0760  0608                      ld      b,$08
  1370  0762  3a1ff9                    ld      a,(CGPNT+0)
  1371  0765  f5                A0765:  push    af
  1372  0766  e5                        push    hl
  1373  0767  d5                        push    de
  1374  0768  c5                        push    bc
  1375  0769  cdb601                    call    A01B6
  1376  076c  fb                        ei
  1377  076d  c1                        pop     bc
  1378  076e  d1                        pop     de
  1379  076f  e1                        pop     hl
  1380  0770  12                        ld      (de),a
  1381  0771  13                        inc     de
  1382  0772  23                        inc     hl
  1383  0773  f1                        pop     af
  1384  0774  10ef                      djnz    A0765
  1385  0776  c9                        ret
  1386                          ;
  1387  0777  cd9f0b            A0777:  call    A0B9F                   ; grafic mode ?
  1388  077a  2825                      jr      z,A07A1                 ; yep, screen 2
  1389  077c  303b                      jr      nc,A07B9                ; yep, screen 3
  1390  077e  3aaffc            A077E:  ld      a,(SCRMOD)
  1391  0781  a7                        and     a
  1392  0782  2a22f9                    ld      hl,(NAMBAS)
  1393  0785  01c003                    ld      bc,24*40
  1394  0788  2803                      jr      z,A078D
  1395  078a  010003                    ld      bc,24*32
  1396  078d  3e20              A078D:  ld      a,$20
  1397  078f  cd1508                    call    A0815
  1398  0792  cd7f0a                    call    A0A7F
  1399  0795  21b2fb                    ld      hl,LINTTB
  1400  0798  0618                      ld      b,$18
  1401  079a  70                A079A:  ld      (hl),b
  1402  079b  23                        inc     hl
  1403  079c  10fc                      djnz    A079A
  1404  079e  c3260b                    jp      A0B26
  1405                          ;
  1406  07a1  cd3208            A07A1:  call    A0832
  1407  07a4  010018                    ld      bc,256/8*192
  1408  07a7  c5                        push    bc
  1409  07a8  2a0000                    ld      hl,(GRPCOL)
  1410  07ab  3a0000                    ld      a,(BAKCLR)
  1411  07ae  cd1508                    call    A0815
  1412  07b1  2a0000                    ld      hl,(GRPCGP)
  1413  07b4  c1                        pop     bc
  1414  07b5  af                        xor     a
  1415  07b6  c31508            A07B6:  jp      A0815
  1416                          ;
  1417  07b9  cd3208            A07B9:  call    A0832
  1418  07bc  210000                    ld      hl,BAKCLR
  1419  07bf  7e                        ld      a,(hl)
  1420  07c0  87                        add     a,a
  1421  07c1  87                        add     a,a
  1422  07c2  87                        add     a,a
  1423  07c3  87                        add     a,a
  1424  07c4  b6                        or      (hl)
  1425  07c5  2a0000                    ld      hl,(MLTCGP)
  1426  07c8  010006                    ld      bc,$0600
  1427  07cb  18e9                      jr      A07B6
  1428                          ;
  1429  07cd  f5                A07CD:  push    af
  1430  07ce  cddf07                    call    A07DF
  1431  07d1  e3                        ex      (sp),hl
  1432  07d2  e3                        ex      (sp),hl
  1433  07d3  f1                        pop     af
  1434  07d4  d398                      out     (VDPDAT),a
  1435  07d6  c9                        ret
  1436                          ;
  1437  07d7  cdec07            A07D7:  call    A07EC
  1438  07da  e3                        ex      (sp),hl
  1439  07db  e3                        ex      (sp),hl
  1440  07dc  db98                      in      a,(VDPDAT)
  1441  07de  c9                        ret
  1442                          ;
  1443  07df  7d                A07DF:  ld      a,l
  1444  07e0  f3                        di
  1445  07e1  d399                      out     (VDPCTL),a
  1446  07e3  7c                        ld      a,h
  1447  07e4  e63f                      and     $3F
  1448  07e6  f640                      or      $40
  1449  07e8  d399                      out     (VDPCTL),a
  1450  07ea  fb                        ei
  1451  07eb  c9                        ret
  1452                          ;
  1453  07ec  7d                A07EC:  ld      a,l
  1454  07ed  f3                        di
  1455  07ee  d399                      out     (VDPCTL),a
  1456  07f0  7c                        ld      a,h
  1457  07f1  e63f                      and     $3F
  1458  07f3  d399                      out     (VDPCTL),a
  1459  07f5  fb                        ei
  1460  07f6  c9                        ret
  1461                          ;
  1462  07f7  3aaffc            A07F7:  ld      a,(SCRMOD)
  1463  07fa  3d                        dec     a
  1464  07fb  fa2408                    jp      m,A0824
  1465  07fe  f5                        push    af
  1466  07ff  cd3208                    call    A0832
  1467  0802  f1                        pop     af
  1468  0803  c0                        ret     nz
  1469  0804  3a0000                    ld      a,(FORCLR)
  1470  0807  87                        add     a,a
  1471  0808  87                        add     a,a
  1472  0809  87                        add     a,a
  1473  080a  87                        add     a,a
  1474  080b  210000                    ld      hl,BAKCLR
  1475  080e  b6                        or      (hl)
  1476  080f  2a0000                    ld      hl,(T32COL)
  1477  0812  012000                    ld      bc,32
  1478  0815  f5                A0815:  push    af
  1479  0816  cddf07                    call    A07DF
  1480  0819  f1                A0819:  pop     af
  1481  081a  d398                      out     (VDPDAT),a
  1482  081c  f5                        push    af
  1483  081d  0b                        dec     bc
  1484  081e  79                        ld      a,c
  1485  081f  b0                        or      b
  1486  0820  20f7                      jr      nz,A0819
  1487  0822  f1                        pop     af
  1488  0823  c9                        ret
  1489                          ;
  1490  0824  3a0000            A0824:  ld      a,(FORCLR)
  1491  0827  87                        add     a,a
  1492  0828  87                        add     a,a
  1493  0829  87                        add     a,a
  1494  082a  87                        add     a,a
  1495  082b  210000                    ld      hl,BAKCLR
  1496  082e  b6                        or      (hl)
  1497  082f  47                        ld      b,a
  1498  0830  1803                      jr      A0835
  1499                          ;
  1500  0832  3a0000            A0832:  ld      a,(BDRCLR)
  1501  0835  47                A0835:  ld      b,a
  1502  0836  0e07                      ld      c,$07
  1503  0838  c37f05                    jp      A057F
  1504                          ;
  1505  083b  cd9f0b            A083B:  call    A0B9F                   ; grafic mode ?
  1506  083e  d8                        ret     c                       ; nop, quit
  1507  083f  3ab0fc                    ld      a,(OLDSCR)
  1508  0842  cdbdfd                    call    H_TOTE
  1509  0845  c34f08                    jp      A084F
  1510                          ;
  1511  0848  c0                A0848:  ret     nz
  1512  0849  e5                        push    hl
  1513  084a  cd7707                    call    A0777
  1514  084d  e1                        pop     hl
  1515  084e  c9                        ret
  1516                          ;
  1517  084f  3d                A084F:  dec     a
  1518  0850  fa0e05                    jp      m,A050E
  1519  0853  ca3805                    jp      z,A0538
  1520  0856  3d                        dec     a
  1521  0857  cad205                    jp      z,A05D2
  1522  085a  c31f06                    jp      A061F
  1523                          ;
  1524  085d  cdb6ff            A085D:  call    H_LPTO
  1525  0860  f5                        push    af
  1526  0861  cd6f04            A0861:  call    A046F
  1527  0864  3812                      jr      c,A0878
  1528  0866  cd8408                    call    A0884
  1529  0869  28f6                      jr      z,A0861
  1530  086b  f1                        pop     af
  1531  086c  f5                A086C:  push    af
  1532                          ;        out     ($91),a
  1533  086d  00                	nop
  1534  086e  00                	nop
  1535  086f  af                        xor     a
  1536                          ;        out     ($90),a
  1537  0870  00                	nop
  1538  0871  00                	nop
  1539  0872  3d                        dec     a
  1540                          ;        out     ($90),a
  1541  0873  00                	nop
  1542  0874  00                	nop
  1543  0875  f1                        pop     af
  1544  0876  a7                        and     a
  1545  0877  c9                        ret
  1546                          ;
  1547  0878  af                A0878:  xor     a
  1548  0879  3215f4                    ld      (LPTPOS),a
  1549  087c  3e0d                      ld      a,$0D
  1550  087e  cd6c08                    call    A086C
  1551  0881  f1                        pop     af
  1552  0882  37                        scf
  1553  0883  c9                        ret
  1554                          ;
  1555  0884  cdbbff            A0884:  call    H_LPTS
  1556  0887  db90                      in      a,($90)
  1557  0889  0f                        rrca
  1558  088a  0f                        rrca
  1559  088b  3f                        ccf
  1560  088c  9f                        sbc     a,a
  1561  088d  c9                        ret
  1562                          ;
  1563  088e  3e1b              A088E:  ld      a,$1B
  1564  0890  df                        rst     OUTDO
  1565  0891  3e59                      ld      a,$59
  1566  0893  df                        rst     OUTDO
  1567  0894  7d                        ld      a,l
  1568  0895  c61f                      add     a,$1F
  1569  0897  df                        rst     OUTDO
  1570  0898  7c                        ld      a,h
  1571  0899  c61f                      add     a,$1F
  1572  089b  df                        rst     OUTDO
  1573  089c  c9                        ret
  1574                          ;
  1575  089d  e5                A089D:  push    hl
  1576  089e  f5                        push    af
  1577  089f  21a6fc                    ld      hl,GRPHED
  1578  08a2  af                        xor     a
  1579  08a3  be                        cp      (hl)
  1580  08a4  77                        ld      (hl),a
  1581  08a5  280d                      jr      z,A08B4
  1582  08a7  f1                        pop     af
  1583  08a8  d640                      sub     $40
  1584  08aa  fe20                      cp      $20
  1585  08ac  3804                      jr      c,A08B2
  1586  08ae  c640                      add     a,$40
  1587  08b0  bf                A08B0:  cp      a
  1588  08b1  37                        scf
  1589  08b2  e1                A08B2:  pop     hl
  1590  08b3  c9                        ret
  1591                          ;
  1592  08b4  f1                A08B4:  pop     af
  1593  08b5  fe01                      cp      $01
  1594  08b7  20f7                      jr      nz,A08B0
  1595  08b9  77                        ld      (hl),a
  1596  08ba  e1                        pop     hl
  1597  08bb  c9                        ret
  1598                          ;
  1599  08bc  e5                A08BC:  push    hl
  1600  08bd  d5                        push    de
  1601  08be  c5                        push    bc
  1602  08bf  f5                        push    af
  1603  08c0  cda4fd                    call    H_CHPU
  1604  08c3  cd9f0b                    call    A0B9F                   ; grafic mode ?
  1605  08c6  3012                      jr      nc,A08DA                ; yep, quit
  1606  08c8  cd2e0a                    call    A0A2E                   ; cursor off
  1607  08cb  f1                        pop     af
  1608  08cc  f5                        push    af
  1609  08cd  cddf08                    call    A08DF                   ; decode char
  1610  08d0  cde109                    call    A09E1                   ; cursor on
  1611  08d3  3a0000                    ld      a,(CSRX)
  1612  08d6  3d                        dec     a
  1613  08d7  3261f6                    ld      (TTYPOS),a              ; set TTYPOS
  1614  08da  f1                A08DA:  pop     af
  1615  08db  c1                A08DB:  pop     bc
  1616  08dc  d1                        pop     de
  1617  08dd  e1                        pop     hl
  1618  08de  c9                        ret
  1619                          ;
  1620  08df  cd9d08            A08DF:  call    A089D                   ; grafic header ?
  1621  08e2  d0                        ret     nc                      ; yep, quit
  1622  08e3  4f                        ld      c,a
  1623  08e4  200d                      jr      nz,A08F3                ; grafic char
  1624  08e6  21a7fc                    ld      hl,ESCCNT
  1625  08e9  7e                        ld      a,(hl)
  1626  08ea  a7                        and     a                       ; in ESC sequence ?
  1627  08eb  c28f09                    jp      nz,A098F                ; yep, handle
  1628  08ee  79                        ld      a,c
  1629  08ef  fe20                      cp      $20                    ; control char ?
  1630  08f1  3821                      jr      c,A0914                 ; yep, handle
  1631  08f3  2a0000            A08F3:  ld      hl,(CSRY)               ; cursor position
  1632  08f6  fe7f                      cp      $7F
  1633  08f8  cae30a                    jp      z,A0AE3                 ; DEL, handle
  1634  08fb  cde60b                    call    A0BE6                   ; 'print' char
  1635  08fe  cd440a                    call    A0A44                   ; increase col
  1636  0901  c0                        ret     nz                      ; not at end, quit
  1637  0902  af                        xor     a
  1638  0903  cd2b0c                    call    A0C2B                   ; expand logical line
  1639  0906  2601                      ld      h,$01                  ; at begin of line
  1640  0908  cd610a            A0908:  call    A0A61                   ; down
  1641  090b  c0                        ret     nz                      ; no scroll needed, quit
  1642  090c  cd690a                    call    A0A69                   ; scroll up
  1643  090f  2e01                      ld      l,$01
  1644  0911  c3880a                    jp      A0A88                   ; clear line
  1645                          ;
  1646  0914  212d09            A0914:  ld      hl,T092F-2
  1647  0917  0e0c                      ld      c,$0C
  1648  0919  23                A0919:  inc     hl
  1649  091a  23                        inc     hl
  1650  091b  a7                        and     a
  1651  091c  0d                        dec     c
  1652  091d  f8                        ret     m
  1653  091e  be                        cp      (hl)
  1654  091f  23                        inc     hl
  1655  0920  20f7                      jr      nz,A0919
  1656  0922  4e                        ld      c,(hl)
  1657  0923  23                        inc     hl
  1658  0924  46                        ld      b,(hl)
  1659  0925  2a0000                    ld      hl,(CSRY)               ; cursor position
  1660  0928  cd2d09                    call    A092D                   ; execute function
  1661  092b  af                        xor     a
  1662  092c  c9                        ret
  1663                          ;
  1664  092d  c5                A092D:  push    bc
  1665  092e  c9                        ret
  1666                          ;
  1667  092f  07                T092F:  db      $07
  1668  0930  1311                      dw      A1113
  1669  0932  08                        db      $08
  1670  0933  4c0a                      dw      A0A4C
  1671  0935  09                        db      $09
  1672  0936  710a                      dw      A0A71
  1673  0938  0a                        db      $0A
  1674  0939  0809                      dw      A0908
  1675  093b  0b                        db      $0B
  1676  093c  7f0a                      dw      A0A7F
  1677  093e  0c                        db      $0C
  1678  093f  7e07                      dw      A077E
  1679  0941  0d                        db      $0D
  1680  0942  810a                      dw      A0A81
  1681  0944  1b                        db      $1B
  1682  0945  8909                      dw      A0989
  1683  0947  1c                        db      $1C
  1684  0948  5b0a                      dw      A0A5B
  1685  094a  1d                        db      $1D
  1686  094b  4c0a                      dw      A0A4C
  1687  094d  1e                        db      $1E
  1688  094e  570a                      dw      A0A57
  1689  0950  1f                        db      $1F
  1690  0951  610a                      dw      A0A61
  1691                          
  1692  0953  6a                T0953:  db      'j'
  1693  0954  7e07                      dw      A077E
  1694  0956  45                        db      'E'
  1695  0957  7e07                      dw      A077E
  1696  0959  4b                        db      'K'
  1697  095a  ee0a                      dw      A0AEE
  1698  095c  4a                        db      'J'
  1699  095d  050b                      dw      A0B05
  1700  095f  6c                        db      'l'
  1701  0960  ec0a                      dw      A0AEC
  1702  0962  4c                        db      'L'
  1703  0963  b40a                      dw      A0AB4
  1704  0965  4d                        db      'M'
  1705  0966  850a                      dw      A0A85
  1706  0968  59                        db      'Y'
  1707  0969  8609                      dw      A0986
  1708  096b  41                        db      'A'
  1709  096c  570a                      dw      A0A57
  1710  096e  42                        db      'B'
  1711  096f  610a                      dw      A0A61
  1712  0971  43                        db      'C'
  1713  0972  440a                      dw      A0A44
  1714  0974  44                        db      'D'
  1715  0975  550a                      dw      A0A55
  1716  0977  48                        db      'H'
  1717  0978  7f0a                      dw      A0A7F
  1718  097a  78                        db      'x'
  1719  097b  8009                      dw      A0980
  1720  097d  79                        db      'y'
  1721  097e  8309                      dw      A0983
  1722                          
  1723  0980  3e01              A0980:  ld      a,$01
  1724  0982  01                        db      $01
  1725  0983  3e02              A0983:  ld      a,$02
  1726  0985  01                        db      $01
  1727  0986  3e04              A0986:  ld      a,$04
  1728  0988  01                        db      $01
  1729  0989  3eff              A0989:  ld      a,$FF
  1730  098b  32a7fc                    ld      (ESCCNT),a
  1731  098e  c9                        ret
  1732                          ;
  1733  098f  f29d09            A098F:  jp      p,A099D                 ; handle long ESC sequences
  1734  0992  3600                      ld      (hl),0                  ; next is no ESC anymore
  1735  0994  79                        ld      a,c
  1736  0995  215109                    ld      hl,T0953-2
  1737  0998  0e0f                      ld      c,$0F
  1738  099a  c31909                    jp      A0919                   ; handle function
  1739                          ;
  1740  099d  3d                A099D:  dec     a
  1741  099e  281e                      jr      z,A09BE                 ; ESC "x"
  1742  09a0  3d                        dec     a
  1743  09a1  2825                      jr      z,A09C8                 ; ESC "y"
  1744  09a3  3d                        dec     a
  1745  09a4  77                        ld      (hl),a                  ; ESC "Y" ends ?
  1746  09a5  3a0000                    ld      a,(LINLEN)              ; max kol
  1747  09a8  110000                    ld      de,CSRX
  1748  09ab  2806                      jr      z,A09B3
  1749  09ad  3603                      ld      (hl),$03
  1750  09af  cd320c                    call    A0C32                   ; max row
  1751  09b2  1b                        dec     de
  1752  09b3  47                A09B3:  ld      b,a
  1753  09b4  79                        ld      a,c
  1754  09b5  d620                      sub     32
  1755  09b7  b8                        cp      b
  1756  09b8  3c                        inc     a
  1757  09b9  12                        ld      (de),a
  1758  09ba  d8                        ret     c
  1759  09bb  78                        ld      a,b
  1760  09bc  12                        ld      (de),a
  1761  09bd  c9                        ret
  1762                          ;
  1763  09be  77                A09BE:  ld      (hl),a
  1764  09bf  79                        ld      a,c
  1765  09c0  d634                      sub     '4'
  1766  09c2  280b                      jr      z,A09CF                 ; ESC "x4", block cursor
  1767  09c4  3d                        dec     a
  1768  09c5  280f                      jr      z,A09D6                 ; ESC "x5", cursor invisable
  1769  09c7  c9                        ret
  1770                          ;
  1771  09c8  77                A09C8:  ld      (hl),a
  1772  09c9  79                        ld      a,c
  1773  09ca  d634                      sub     '4'
  1774  09cc  2005                      jr      nz,A09D3
  1775  09ce  3c                        inc     a                       ; ESC "y4", stripe cursor
  1776  09cf  32aafc            A09CF:  ld      (CSTYLE),a
  1777  09d2  c9                        ret
  1778                          ;
  1779  09d3  3d                A09D3:  dec     a
  1780  09d4  c0                        ret     nz
  1781  09d5  3c                        inc     a                       ; ESC "y5", cursor visable
  1782  09d6  32a9fc            A09D6:  ld      (CSRSR),a
  1783  09d9  c9                        ret
  1784                          ;
  1785  09da  3aa9fc            A09DA:  ld      a,(CSRSR)
  1786  09dd  a7                        and     a                       ; cursor visable ?
  1787  09de  c0                        ret     nz                      ; yep, quit
  1788  09df  1805                      jr      A09E6
  1789                          ;
  1790  09e1  3aa9fc            A09E1:  ld      a,(CSRSR)
  1791  09e4  a7                        and     a                       ; cursor visable ?
  1792  09e5  c8                        ret     z                       ; nop, quit
  1793  09e6  cda9fd            A09E6:  call    H_DSPC
  1794  09e9  cd9f0b                    call    A0B9F                   ; grafic mode ?
  1795  09ec  d0                        ret     nc                      ; yep, quit
  1796  09ed  2a0000                    ld      hl,(CSRY)
  1797  09f0  e5                        push    hl
  1798  09f1  cdd80b                    call    A0BD8                   ; get char at cursorposition
  1799  09f4  32ccfb                    ld      (CURSAV),a              ; save
  1800  09f7  6f                        ld      l,a
  1801  09f8  2600                      ld      h,$00
  1802  09fa  29                        add     hl,hl
  1803  09fb  29                        add     hl,hl
  1804  09fc  29                        add     hl,hl
  1805  09fd  eb                        ex      de,hl
  1806  09fe  2a24f9                    ld      hl,(CGPBAS)
  1807  0a01  e5                        push    hl
  1808  0a02  19                        add     hl,de
  1809  0a03  cda50b                    call    A0BA5                   ; copy char patern to LINWRK
  1810  0a06  211ffc                    ld      hl,LINWRK+7
  1811  0a09  0608                      ld      b,8
  1812  0a0b  3aaafc                    ld      a,(CSTYLE)
  1813  0a0e  a7                        and     a                       ; block cursor ?
  1814  0a0f  2802                      jr      z,A0A13                 ; yep,
  1815  0a11  0603                      ld      b,3
  1816  0a13  7e                A0A13:  ld      a,(hl)
  1817  0a14  2f                        cpl
  1818  0a15  77                        ld      (hl),a
  1819  0a16  2b                        dec     hl
  1820  0a17  10fa                      djnz    A0A13
  1821  0a19  e1                        pop     hl
  1822  0a1a  01f807                    ld      bc,255*8
  1823  0a1d  09                        add     hl,bc                   ; vramadres cursor patern
  1824  0a1e  cdbe0b                    call    A0BBE                   ; copy LINWRK to vram
  1825  0a21  e1                        pop     hl
  1826  0a22  0eff                      ld      c,$FF
  1827  0a24  c3e60b                    jp      A0BE6                   ; put cursor on screen
  1828                          ;
  1829  0a27  3aa9fc            A0A27:  ld      a,(CSRSR)
  1830  0a2a  a7                        and     a                       ; cursor visable ?
  1831  0a2b  c0                        ret     nz                      ; yep, quit
  1832  0a2c  1805                      jr      A0A33
  1833                          ;
  1834  0a2e  3aa9fc            A0A2E:  ld      a,(CSRSR)
  1835  0a31  a7                        and     a                       ; cursor visable ?
  1836  0a32  c8                        ret     z                       ; nop, quit
  1837  0a33  cdaefd            A0A33:  call    H_ERAC
  1838  0a36  cd9f0b                    call    A0B9F                   ; grafic mode ?
  1839  0a39  d0                        ret     nc                      ; yep, quit
  1840  0a3a  2a0000                    ld      hl,(CSRY)
  1841  0a3d  3accfb                    ld      a,(CURSAV)
  1842  0a40  4f                        ld      c,a
  1843  0a41  c3e60b                    jp      A0BE6                   ; put orginal char on screen
  1844                          ;
  1845  0a44  3a0000            A0A44:  ld      a,(LINLEN)
  1846  0a47  bc                        cp      h
  1847  0a48  c8                        ret     z
  1848  0a49  24                        inc     h
  1849  0a4a  181d                      jr      A0A69
  1850                          ;
  1851  0a4c  cd550a            A0A4C:  call    A0A55
  1852  0a4f  c0                        ret     nz
  1853  0a50  3a0000                    ld      a,(LINLEN)
  1854  0a53  67                        ld      h,a
  1855  0a54  11                        defb    $11
  1856  0a55  25                A0A55:  dec     h
  1857  0a56  3e                        defb    $3E
  1858  0a57  2d                A0A57:  dec     l
  1859  0a58  c8                        ret     z
  1860  0a59  180e                      jr      A0A69
  1861                          
  1862  0a5b  cd440a            A0A5B:  call    A0A44
  1863  0a5e  c0                        ret     nz
  1864  0a5f  2601                      ld      h,$01
  1865  0a61  cd320c            A0A61:  call    A0C32
  1866  0a64  bd                        cp      l
  1867  0a65  c8                        ret     z
  1868  0a66  3805                      jr      c,A0A6D
  1869  0a68  2c                        inc     l
  1870  0a69  220000            A0A69:  ld      (CSRY),hl
  1871  0a6c  c9                        ret
  1872                          ;
  1873  0a6d  2d                A0A6D:  dec     l
  1874  0a6e  af                        xor     a
  1875  0a6f  18f8                      jr      A0A69
  1876                          ;
  1877  0a71  3e20              A0A71:  ld      a,$20
  1878  0a73  cddf08                    call    A08DF
  1879  0a76  3a0000                    ld      a,(CSRX)
  1880  0a79  3d                        dec     a
  1881  0a7a  e607                      and     $07
  1882  0a7c  20f3                      jr      nz,A0A71
  1883  0a7e  c9                        ret
  1884                          ;
  1885  0a7f  2e01              A0A7F:  ld      l,$01
  1886  0a81  2601              A0A81:  ld      h,$01
  1887  0a83  18e4                      jr      A0A69
  1888                          
  1889  0a85  cd810a            A0A85:  call    A0A81
  1890  0a88  cd320c            A0A88:  call    A0C32
  1891  0a8b  95                        sub     l
  1892  0a8c  d8                        ret     c
  1893  0a8d  caec0a                    jp      z,A0AEC
  1894  0a90  e5                        push    hl
  1895  0a91  f5                        push    af
  1896  0a92  4f                        ld      c,a
  1897  0a93  0600                      ld      b,$00
  1898  0a95  cd1d0c                    call    A0C1D
  1899  0a98  6b                        ld      l,e
  1900  0a99  62                        ld      h,d
  1901  0a9a  23                        inc     hl
  1902  0a9b  edb0                      ldir
  1903  0a9d  21cafb                    ld      hl,FSTPOS
  1904  0aa0  35                        dec     (hl)
  1905  0aa1  f1                        pop     af
  1906  0aa2  e1                        pop     hl
  1907  0aa3  f5                A0AA3:  push    af
  1908  0aa4  2c                        inc     l
  1909  0aa5  cdaa0b                    call    A0BAA
  1910  0aa8  2d                        dec     l
  1911  0aa9  cdc30b                    call    A0BC3
  1912  0aac  2c                        inc     l
  1913  0aad  f1                        pop     af
  1914  0aae  3d                        dec     a
  1915  0aaf  20f2                      jr      nz,A0AA3
  1916  0ab1  c3ec0a                    jp      A0AEC
  1917                          
  1918  0ab4  cd810a            A0AB4:  call    A0A81
  1919  0ab7  cd320c            A0AB7:  call    A0C32
  1920  0aba  67                        ld      h,a
  1921  0abb  95                        sub     l
  1922  0abc  d8                        ret     c
  1923  0abd  caec0a                    jp      z,A0AEC
  1924  0ac0  6c                        ld      l,h
  1925  0ac1  e5                        push    hl
  1926  0ac2  f5                        push    af
  1927  0ac3  4f                        ld      c,a
  1928  0ac4  0600                      ld      b,$00
  1929  0ac6  cd1d0c                    call    A0C1D
  1930  0ac9  6b                        ld      l,e
  1931  0aca  62                        ld      h,d
  1932  0acb  e5                        push    hl
  1933  0acc  2b                        dec     hl
  1934  0acd  edb8                      lddr
  1935  0acf  e1                        pop     hl
  1936  0ad0  74                        ld      (hl),h
  1937  0ad1  f1                        pop     af
  1938  0ad2  e1                        pop     hl
  1939  0ad3  f5                A0AD3:  push    af
  1940  0ad4  2d                        dec     l
  1941  0ad5  cdaa0b                    call    A0BAA
  1942  0ad8  2c                        inc     l
  1943  0ad9  cdc30b                    call    A0BC3
  1944  0adc  2d                        dec     l
  1945  0add  f1                        pop     af
  1946  0ade  3d                        dec     a
  1947  0adf  20f2                      jr      nz,A0AD3
  1948  0ae1  1809                      jr      A0AEC
  1949                          ;
  1950  0ae3  cd4c0a            A0AE3:  call    A0A4C
  1951  0ae6  c8                        ret     z
  1952  0ae7  0e20                      ld      c,$20
  1953  0ae9  c3e60b                    jp      A0BE6
  1954                          ;
  1955  0aec  2601              A0AEC:  ld      h,$01
  1956  0aee  cd290c            A0AEE:  call    A0C29
  1957  0af1  e5                        push    hl
  1958  0af2  cdf20b                    call    A0BF2
  1959  0af5  cddf07                    call    A07DF
  1960  0af8  e1                        pop     hl
  1961  0af9  3e20              A0AF9:  ld      a,$20
  1962  0afb  d398                      out     (VDPDAT),a
  1963  0afd  24                        inc     h
  1964  0afe  3a0000                    ld      a,(LINLEN)
  1965  0b01  bc                        cp      h
  1966  0b02  30f5                      jr      nc,A0AF9
  1967  0b04  c9                        ret
  1968                          ;
  1969  0b05  e5                A0B05:  push    hl
  1970  0b06  cdee0a                    call    A0AEE
  1971  0b09  e1                        pop     hl
  1972  0b0a  cd320c                    call    A0C32
  1973  0b0d  bd                        cp      l
  1974  0b0e  d8                        ret     c
  1975  0b0f  c8                        ret     z
  1976  0b10  2601                      ld      h,$01
  1977  0b12  2c                        inc     l
  1978  0b13  18f0                      jr      A0B05
  1979                          ;
  1980  0b15  cdb8fd            A0B15:  call    H_ERAF
  1981  0b18  af                        xor     a
  1982  0b19  cd9c0b                    call    A0B9C
  1983  0b1c  d0                        ret     nc
  1984  0b1d  e5                        push    hl
  1985  0b1e  2a0000                    ld      hl,(CRTCNT)
  1986  0b21  cdec0a                    call    A0AEC
  1987  0b24  e1                        pop     hl
  1988  0b25  c9                        ret
  1989                          ;
  1990  0b26  3a0000            A0B26:  ld      a,(CNSDFG)
  1991  0b29  a7                        and     a
  1992  0b2a  c8                        ret     z
  1993  0b2b  cdb3fd            A0B2B:  call    H_DSPF
  1994  0b2e  3eff                      ld      a,$FF
  1995  0b30  cd9c0b                    call    A0B9C
  1996  0b33  d0                        ret     nc
  1997  0b34  e5                        push    hl
  1998  0b35  3a0000                    ld      a,(CSRY)
  1999  0b38  210000                    ld      hl,CRTCNT
  2000  0b3b  be                        cp      (hl)
  2001  0b3c  3e0a                      ld      a,$0A
  2002  0b3e  2001                      jr      nz,A0B41
  2003  0b40  df                        rst     OUTDO
  2004  0b41  3aebfb            A0B41:  ld      a,(NEWKEY+6)
  2005  0b44  0f                        rrca
  2006  0b45  217ff8                    ld      hl,FNKSTR+0*16
  2007  0b48  3e01                      ld      a,$01
  2008  0b4a  3804                      jr      c,A0B50
  2009  0b4c  21cff8                    ld      hl,FNKSTR+5*16
  2010  0b4f  af                        xor     a
  2011  0b50  32cdfb            A0B50:  ld      (FNKSWI),a
  2012  0b53  1118fc                    ld      de,LINWRK
  2013  0b56  d5                        push    de
  2014  0b57  0628                      ld      b,$28
  2015  0b59  3e20                      ld      a,$20
  2016  0b5b  12                A0B5B:  ld      (de),a
  2017  0b5c  13                        inc     de
  2018  0b5d  10fc                      djnz    A0B5B
  2019  0b5f  d1                        pop     de
  2020  0b60  0e05                      ld      c,$05
  2021  0b62  3a0000                    ld      a,(LINLEN)
  2022  0b65  d604                      sub     $04
  2023  0b67  382b                      jr      c,A0B94
  2024  0b69  06ff                      ld      b,$FF
  2025  0b6b  04                A0B6B:  inc     b
  2026  0b6c  d605                      sub     $05
  2027  0b6e  30fb                      jr      nc,A0B6B
  2028  0b70  78                        ld      a,b
  2029  0b71  a7                        and     a
  2030  0b72  2820                      jr      z,A0B94
  2031  0b74  3e                        defb    $3E
  2032  0b75  13                A0B75:  inc     de
  2033  0b76  c5                        push    bc
  2034  0b77  0e00                      ld      c,$00
  2035  0b79  7e                A0B79:  ld      a,(hl)
  2036  0b7a  23                        inc     hl
  2037  0b7b  0c                        inc     c
  2038  0b7c  cd9d08                    call    A089D
  2039  0b7f  30f8                      jr      nc,A0B79
  2040  0b81  2004                      jr      nz,A0B87
  2041  0b83  fe20                      cp      $20
  2042  0b85  3801                      jr      c,A0B88
  2043  0b87  12                A0B87:  ld      (de),a
  2044  0b88  13                A0B88:  inc     de
  2045  0b89  10ee                      djnz    A0B79
  2046  0b8b  3e10                      ld      a,$10
  2047  0b8d  91                        sub     c
  2048  0b8e  4f                        ld      c,a
  2049  0b8f  09                        add     hl,bc
  2050  0b90  c1                        pop     bc
  2051  0b91  0d                        dec     c
  2052  0b92  20e1                      jr      nz,A0B75
  2053  0b94  2a0000            A0B94:  ld      hl,(CRTCNT)
  2054  0b97  cdc30b                    call    A0BC3
  2055  0b9a  e1                        pop     hl
  2056  0b9b  c9                        ret
  2057                          ;
  2058  0b9c  320000            A0B9C:  ld      (CNSDFG),a
  2059  0b9f  3aaffc            A0B9F:  ld      a,(SCRMOD)
  2060  0ba2  fe02                      cp      $02
  2061  0ba4  c9                        ret
  2062                          ;
  2063  0ba5  e5                A0BA5:  push    hl
  2064  0ba6  0e08                      ld      c,$08
  2065  0ba8  180a                      jr      A0BB4
  2066                          ;
  2067  0baa  e5                A0BAA:  push    hl
  2068  0bab  2601                      ld      h,$01
  2069  0bad  cdf20b                    call    A0BF2
  2070  0bb0  3a0000                    ld      a,(LINLEN)
  2071  0bb3  4f                        ld      c,a
  2072  0bb4  0600              A0BB4:  ld      b,$00
  2073  0bb6  1118fc                    ld      de,LINWRK
  2074  0bb9  cd0f07                    call    A070F
  2075  0bbc  e1                        pop     hl
  2076  0bbd  c9                        ret
  2077                          ;
  2078  0bbe  e5                A0BBE:  push    hl
  2079  0bbf  0e08                      ld      c,$08
  2080  0bc1  180a                      jr      A0BCD
  2081                          ;
  2082  0bc3  e5                A0BC3:  push    hl
  2083  0bc4  2601                      ld      h,$01
  2084  0bc6  cdf20b                    call    A0BF2
  2085  0bc9  3a0000                    ld      a,(LINLEN)
  2086  0bcc  4f                        ld      c,a
  2087  0bcd  0600              A0BCD:  ld      b,$00
  2088  0bcf  eb                        ex      de,hl
  2089  0bd0  2118fc                    ld      hl,LINWRK
  2090  0bd3  cd4407                    call    A0744
  2091  0bd6  e1                        pop     hl
  2092  0bd7  c9                        ret
  2093                          ;
  2094  0bd8  e5                A0BD8:  push    hl
  2095  0bd9  cdf20b                    call    A0BF2
  2096  0bdc  cdec07                    call    A07EC
  2097  0bdf  e3                        ex      (sp),hl
  2098  0be0  e3                        ex      (sp),hl
  2099  0be1  db98                      in      a,(VDPDAT)
  2100  0be3  4f                        ld      c,a
  2101  0be4  e1                        pop     hl
  2102  0be5  c9                        ret
  2103                          ;
  2104  0be6  e5                A0BE6:  push    hl
  2105  0be7  cdf20b                    call    A0BF2
  2106  0bea  cddf07                    call    A07DF
  2107  0bed  79                        ld      a,c
  2108  0bee  d398                      out     (VDPDAT),a
  2109  0bf0  e1                        pop     hl
  2110  0bf1  c9                        ret
  2111                          ;
  2112  0bf2  c5                A0BF2:  push    bc
  2113  0bf3  5c                        ld      e,h
  2114  0bf4  2600                      ld      h,$00
  2115  0bf6  54                        ld      d,h
  2116  0bf7  2d                        dec     l
  2117  0bf8  29                        add     hl,hl
  2118  0bf9  29                        add     hl,hl
  2119  0bfa  29                        add     hl,hl
  2120  0bfb  4d                        ld      c,l
  2121  0bfc  44                        ld      b,h
  2122  0bfd  29                        add     hl,hl
  2123  0bfe  29                        add     hl,hl
  2124  0bff  19                        add     hl,de
  2125  0c00  3aaffc                    ld      a,(SCRMOD)
  2126  0c03  a7                        and     a
  2127  0c04  3a0000                    ld      a,(LINLEN)
  2128  0c07  2804                      jr      z,A0C0D
  2129  0c09  d622                      sub     $22
  2130  0c0b  1803                      jr      A0C10
  2131                          ;
  2132  0c0d  09                A0C0D:  add     hl,bc
  2133  0c0e  d62a                      sub     $2A
  2134  0c10  2f                A0C10:  cpl
  2135  0c11  a7                        and     a
  2136  0c12  1f                        rra
  2137  0c13  5f                        ld      e,a
  2138  0c14  19                        add     hl,de
  2139  0c15  eb                        ex      de,hl
  2140  0c16  2a22f9                    ld      hl,(NAMBAS)
  2141  0c19  19                        add     hl,de
  2142  0c1a  2b                        dec     hl
  2143  0c1b  c1                        pop     bc
  2144  0c1c  c9                        ret
  2145                          ;
  2146  0c1d  e5                A0C1D:  push    hl
  2147  0c1e  11b1fb                    ld      de,LINTTB-1
  2148  0c21  2600                      ld      h,$00
  2149  0c23  19                        add     hl,de
  2150  0c24  7e                        ld      a,(hl)
  2151  0c25  eb                        ex      de,hl
  2152  0c26  e1                        pop     hl
  2153  0c27  a7                        and     a
  2154  0c28  c9                        ret
  2155                          ;
  2156  0c29  3e                A0C29:  defb    $3E
  2157  0c2a  af                A0C2A:  xor     a
  2158  0c2b  f5                A0C2B:  push    af
  2159  0c2c  cd1d0c                    call    A0C1D
  2160  0c2f  f1                        pop     af
  2161  0c30  12                        ld      (de),a
  2162  0c31  c9                        ret
  2163                          ;
  2164  0c32  3a0000            A0C32:  ld      a,(CNSDFG)
  2165  0c35  e5                        push    hl
  2166  0c36  210000                    ld      hl,CRTCNT
  2167  0c39  86                        add     a,(hl)
  2168  0c3a  e1                        pop     hl
  2169  0c3b  c9                        ret
  2170                          ;
  2171  0c3c  e5                A0C3C:  push    hl
  2172  0c3d  d5                        push    de
  2173  0c3e  c5                        push    bc
  2174  0c3f  f5                        push    af
  2175  0c40  d9                        exx
  2176  0c41  08                        ex      af,af'
  2177  0c42  e5                        push    hl
  2178  0c43  d5                        push    de
  2179  0c44  c5                        push    bc
  2180  0c45  f5                        push    af
  2181  0c46  fde5                      push    iy
  2182  0c48  dde5                      push    ix
  2183  0c4a  cd9afd                    call    H_KEYI
  2184  0c4d  db99                      in      a,(VDPCTL)
  2185  0c4f  a7                        and     a                       ; vdp interrupt ?
  2186  0c50  f2020d                    jp      p,A0D02                 ; nop, quit KEYINT
  2187  0c53  cd9ffd                    call    H_TIMI
  2188  0c56  fb                        ei
  2189  0c57  320000                    ld      (STATFL),a              ; save statusregister
  2190  0c5a  e620                      and     $20                    ; sprite collisionflag set ?
  2191  0c5c  216dfc                    ld      hl,TRPTBL+11*3
  2192  0c5f  c4f00e                    call    nz,C0EF1                ; yep, set sprite event
  2193  0c62  2aa2fc                    ld      hl,(INTCNT)
  2194  0c65  2b                        dec     hl
  2195  0c66  7c                        ld      a,h
  2196  0c67  b5                        or      l                       ; intervaltime passed ?
  2197  0c68  2009                      jr      nz,A0C73                ; nop, skip
  2198  0c6a  217ffc                    ld      hl,TRPTBL+17*3
  2199  0c6d  cdf00e                    call    C0EF1                   ; set interval event
  2200  0c70  2aa0fc                    ld      hl,(INTVAL)             ; reload INTCNT
  2201  0c73  22a2fc            A0C73:  ld      (INTCNT),hl
  2202  0c76  2a9efc                    ld      hl,(JIFFY)
  2203  0c79  23                        inc     hl
  2204  0c7a  229efc                    ld      (JIFFY),hl              ; timecounter
  2205  0c7d  3a3ffb                    ld      a,(MUSICF)
  2206  0c80  4f                        ld      c,a
  2207  0c81  af                        xor     a                       ; playchannel
  2208  0c82  cb19              A0C82:  rr      c                       ; handle this channel ?
  2209  0c84  f5                        push    af
  2210  0c85  c5                        push    bc
  2211  0c86  dc3b11                    call    c,A113B                 ; yep, do it
  2212  0c89  c1                        pop     bc
  2213  0c8a  f1                        pop     af
  2214  0c8b  3c                        inc     a
  2215  0c8c  fe03                      cp      $03
  2216  0c8e  38f2                      jr      c,A0C82                 ; all 3 channels
  2217  0c90  210000                    ld      hl,SCNCNT
  2218  0c93  35                        dec     (hl)                    ; do i have to scan ?
  2219  0c94  206c                      jr      nz,A0D02                ; nop, quit KEYINT
  2220  0c96  3603                      ld      (hl),$03               ; next scan after 3 ints
  2221  0c98  af                        xor     a
  2222  0c99  cd0c12                    call    A120C                   ; read joystick 0
  2223  0c9c  e630                      and     $30                    ; only firebuttons
  2224  0c9e  f5                        push    af
  2225  0c9f  3e01                      ld      a,$01
  2226  0ca1  cd0c12                    call    A120C                   ; read joystick 1
  2227  0ca4  e630                      and     $30                    ; only firebuttons
  2228  0ca6  07                        rlca
  2229  0ca7  07                        rlca
  2230  0ca8  c1                        pop     bc
  2231  0ca9  b0                        or      b
  2232  0caa  f5                        push    af
  2233  0cab  cd2612                    call    A1226                   ; read keyboard row 8
  2234  0cae  e601                      and     $01                    ; only spacebar
  2235  0cb0  c1                        pop     bc
  2236  0cb1  b0                        or      b
  2237  0cb2  4f                        ld      c,a
  2238  0cb3  210000                    ld      hl,TRGFLG
  2239  0cb6  ae                        xor     (hl)
  2240  0cb7  a6                        and     (hl)
  2241  0cb8  71                        ld      (hl),c                  ; save triggerflag
  2242  0cb9  4f                        ld      c,a
  2243  0cba  0f                        rrca                            ; spacebar being pressed ?
  2244  0cbb  2170fc                    ld      hl,TRPTBL+12*3
  2245  0cbe  dcf00e                    call    c,C0EF1                 ; yep, set STRIG0 event
  2246  0cc1  cb11                      rl      c                       ; firebutton 2 B being pressed ?
  2247  0cc3  217cfc                    ld      hl,TRPTBL+16*3
  2248  0cc6  dcf00e                    call    c,C0EF1                 ; yep, set STRIG4 event
  2249  0cc9  cb11                      rl      c
  2250  0ccb  2176fc                    ld      hl,TRPTBL+14*3
  2251  0cce  dcf00e                    call    c,C0EF1                 ; yep, set STRIG2 event
  2252  0cd1  cb11                      rl      c
  2253  0cd3  2179fc                    ld      hl,TRPTBL+15*3
  2254  0cd6  dcf00e                    call    c,C0EF1                 ; yep, set STRIG3 event
  2255  0cd9  cb11                      rl      c
  2256  0cdb  2173fc                    ld      hl,TRPTBL+13*3
  2257  0cde  dcf00e                    call    c,C0EF1                 ; yep, set STRIG1 event
  2258  0ce1  af                        xor     a
  2259  0ce2  32d9fb                    ld      (CLIKFL),a
  2260  0ce5  cd120d                    call    A0D12                   ; scan keyboard
  2261  0ce8  2018                      jr      nz,A0D02                ; buffer not empty, quit KEYINT
  2262  0cea  210000                    ld      hl,REPCNT
  2263  0ced  35                        dec     (hl)
  2264  0cee  2012                      jr      nz,A0D02
  2265  0cf0  3601                      ld      (hl),$01
  2266  0cf2  21dafb                    ld      hl,OLDKEY
  2267  0cf5  11dbfb                    ld      de,OLDKEY+1
  2268  0cf8  010a00                    ld      bc,11-1
  2269  0cfb  36ff                      ld      (hl),$FF
  2270  0cfd  edb0                      ldir                            ; create a being pressed
  2271  0cff  cd4d0d            	call    A0D4E
  2272  0d02  dde1              A0D02:  pop     ix
  2273  0d04  fde1                      pop     iy
  2274  0d06  f1                        pop     af
  2275  0d07  c1                        pop     bc
  2276  0d08  d1                        pop     de
  2277  0d09  e1                        pop     hl
  2278  0d0a  08                        ex      af,af'
  2279  0d0b  d9                        exx
  2280  0d0c  f1                        pop     af
  2281  0d0d  c1                        pop     bc
  2282  0d0e  d1                        pop     de
  2283  0d0f  e1                        pop     hl
  2284  0d10  fb                        ei
  2285  0d11  c9                        ret
  2286                          ;
  2287                          A0D12:
  2288                          ;	in      a,($AA)
  2289  0d12  00                	nop
  2290  0d13  00                	nop
  2291                          ;        and     $F0
  2292  0d14  00                	nop
  2293                          ;	nop
  2294  0d15  af                	xor	a
  2295  0d16  4f                        ld      c,a
  2296  0d17  060b                      ld      b,11
  2297  0d19  21e5fb                    ld      hl,NEWKEY
  2298                          A0D1C:
  2299                          ;	ld      a,c
  2300  0d1c  00                	nop
  2301                          ;        out     ($AA),a
  2302  0d1d  00                	nop
  2303                          ;	nop
  2304                          ;        in      a,($A9)
  2305                          ;	nop
  2306                          ;	nop
  2307  0d1e  cd7a2d            	call	KBD
  2308  0d21  77                        ld      (hl),a
  2309  0d22  0c                        inc     c
  2310  0d23  23                        inc     hl
  2311  0d24  10f6                      djnz    A0D1C                   ; scan keyboard & put in NEWKEY
  2312                          ;        ld      a,(ENSTOP)
  2313  0d26  00                	nop
  2314  0d27  00                	nop
  2315  0d28  00                	nop
  2316                          ;        and     a                       ; Hot break possible ?
  2317  0d29  00                	nop
  2318                          ;        jr      z,A0D3A                 ; nop, quit
  2319  0d2a  00                	nop
  2320  0d2b  00                	nop
  2321                          ;        ld      a,(NEWKEY+6)
  2322  0d2c  00                	nop
  2323  0d2d  00                	nop
  2324  0d2e  00                	nop
  2325                          ;        cp      11101000b               ; CODE+GRAPH+CTRL+SHIFT pressed ?
  2326  0d2f  00                	nop
  2327  0d30  00                	nop
  2328                          ;        jr      nz,A0D3A                ; nop, quit
  2329  0d31  00                	nop
  2330  0d32  00                	nop
  2331                          ;        ld      ix,J409B                ; start headloop
  2332  0d33  00                	nop
  2333  0d34  00                	nop
  2334  0d35  00                	nop
  2335                          ;        jp      A01FF                   ; with CALBAS
  2336  0d36  00                	nop
  2337  0d37  00                	nop
  2338  0d38  00                	nop
  2339                          ;
  2340  0d39  11e5fb            A0D3A:  ld      de,OLDKEY+11
  2341  0d3c  060b                      ld      b,11
  2342  0d3e  1b                A0D3F:  dec     de
  2343  0d3f  2b                        dec     hl
  2344  0d40  1a                        ld      a,(de)
  2345  0d41  be                        cp      (hl)                    ; changed ?
  2346  0d42  2004                      jr      nz,A0D49                ; yep, reload REPCNT
  2347  0d44  10f8                      djnz    A0D3F
  2348  0d46  1805                      jr      A0D4E
  2349                          ;
  2350  0d48  3e0d              A0D49:  ld      a,13
  2351  0d4a  320000                    ld      (REPCNT),a
  2352  0d4d  060b              A0D4E:  ld      b,11
  2353  0d4f  21dafb                    ld      hl,OLDKEY
  2354  0d52  11e5fb                    ld      de,NEWKEY
  2355  0d55  1a                A0D56:  ld      a,(de)
  2356  0d56  4f                        ld      c,a
  2357  0d57  ae                        xor     (hl)
  2358  0d58  a6                        and     (hl)                    ; key being pressed ?
  2359  0d59  71                        ld      (hl),c                  ; OLDKEY renewed
  2360  0d5a  c4880d                    call    nz,A0D89                ; yep, handle
  2361  0d5d  13                        inc     de
  2362  0d5e  23                        inc     hl
  2363  0d5f  10f4                      djnz    A0D56                   ; next row
  2364  0d61  2a0000            A0D62:  ld      hl,(GETPNT)
  2365  0d64  3a0000                    ld      a,(PUTPNT)
  2366  0d67  95                        sub     l                       ; flag buffer empty
  2367  0d68  c9                        ret
  2368                          ;
  2369  0d69  fb                A0D6A:  ei
  2370  0d6a  e5                        push    hl
  2371  0d6b  d5                        push    de
  2372  0d6c  c5                        push    bc
  2373  0d6d  cd9f0b                    call    A0B9F                   ; graphic mode ?
  2374  0d70  300f                      jr      nc,A0D82                ; yep, skip functionkeys
  2375  0d72  3acdfb                    ld      a,(FNKSWI)
  2376  0d75  21ebfb                    ld      hl,NEWKEY+6
  2377  0d78  ae                        xor     (hl)                    ; SHIFT changed ?
  2378  0d79  210000                    ld      hl,CNSDFG
  2379  0d7c  a6                        and     (hl)                    ; display functionkeys ?
  2380  0d7d  0f                        rrca
  2381  0d7e  dc2b0b                    call    c,A0B2B                 ; yep, DSPFNK
  2382  0d81  cd610d            A0D82:  call    A0D62                   ; flag KEYBUF is empty
  2383  0d84  c1                        pop     bc
  2384  0d85  d1                        pop     de
  2385  0d86  e1                        pop     hl
  2386  0d87  c9                        ret
  2387                          ;
  2388  0d88  e5                A0D89:  push    hl
  2389  0d89  d5                        push    de
  2390  0d8a  c5                        push    bc
  2391  0d8b  f5                        push    af
  2392  0d8c  3e0b                      ld      a,11
  2393  0d8e  90                        sub     b                       ; row
  2394  0d8f  87                        add     a,a
  2395  0d90  87                        add     a,a
  2396  0d91  87                        add     a,a                     ; *8
  2397  0d92  4f                        ld      c,a
  2398  0d93  0608                      ld      b,8
  2399  0d95  f1                        pop     af
  2400  0d96  1f                A0D97:  rra                             ; this key being pressed ?
  2401  0d97  c5                        push    bc
  2402  0d98  f5                        push    af
  2403  0d99  dc2110                    call    c,K_HAND                ; yep, handle key
  2404  0d9c  f1                        pop     af
  2405  0d9d  c1                        pop     bc
  2406  0d9e  0c                        inc     c
  2407  0d9f  10f5                      djnz    A0D97                   ; next key in row
  2408  0da1  c3db08                    jp      A08DB                   ; Reuse code in $08DB that pops BC, DE and HL and returns
  2409                          
  2410                          
  2411                                  IF      KEYTYP = 0
  2412                          
  2413                                  INCLUDE "keyjap.asm"
  2414                          
  2415                                  ENDIF
  2416                          
  2417                          
  2418                                  IF      KEYTYP = 1
  2419                          
  2420                                  INCLUDE "keyint.asm"
../basekey/keyint.asm:
     1                          ; *************************************
     2                          ; BEGIN OF INTERNATIONAL KEYBOARD HANDLER
     3                          ; *************************************
     4                          
     5                                  EXTERN  CLIKSW
     6                          
     7                          D0DA5:
     8                          
     9                          ;       Table   keycodes for scancode $00-$2F Normal layout
    10                          
    11  0da4  3031323334353637          DEFB    '0' ,'1' ,'2' ,'3' ,'4' ,'5' ,'6' ,'7'
    12  0dac  38392d3d5c5b5d3b          DEFB    '8' ,'9' ,'-' ,'=' ,'\\' ,'[' ,']' ,';'
    13  0db4  27602c2e2fff6162          DEFB    '\'' ,'`' ,',' ,'.' ,'/' ,$FF,'a' ,'b'
    14  0dbc  636465666768696a          DEFB    'c' ,'d' ,'e' ,'f' ,'g' ,'h' ,'i' ,'j'
    15  0dc4  6b6c6d6e6f707172          DEFB    'k' ,'l' ,'m' ,'n' ,'o' ,'p' ,'q' ,'r'
    16  0dcc  737475767778797a          DEFB    's' ,'t' ,'u' ,'v' ,'w' ,'x' ,'y' ,'z'
    17                          
    18                          ;       Table   keycodes for scancode $00-$2F Shift layout
    19                          
    20  0dd4  2921402324255e26          DEFB    ')' ,'!' ,'@' ,'#' ,'$' ,'%' ,'^' ,'&'
    21  0ddc  2a285f2b7c7b7d3a          DEFB    '*' ,'(' ,'_' ,'+' ,'|' ,'{' ,'}' ,':'
    22  0de4  227e3c3e3fff4142          DEFB    $22,'~' ,'<' ,'>' ,'?' ,$FF,'A' ,'B'
    23  0dec  434445464748494a          DEFB    'C' ,'D' ,'E' ,'F' ,'G' ,'H' ,'I' ,'J'
    24  0df4  4b4c4d4e4f505152          DEFB    'K' ,'L' ,'M' ,'N' ,'O' ,'P' ,'Q' ,'R'
    25  0dfc  535455565758595a          DEFB    'S' ,'T' ,'U' ,'V' ,'W' ,'X' ,'Y' ,'Z'
    26                          
    27                          ;       Table   keycodes for scancode $00-$2F Graph layout
    28                          
    29  0e04  09acabbaefbdf4fb          DEFB    $09,$AC,$AB,$BA,$EF,$BD,$F4,$FB
    30  0e0c  ec0717f11e010d06          DEFB    $EC,$07,$17,$F1,$1E,$01,$0D,$06
    31  0e14  05bbf3f21dffc411          DEFB    $05,$BB,$F3,$F2,$1D,$FF,$C4,$11
    32  0e1c  bcc7cd141513dcc6          DEFB    $BC,$C7,$CD,$14,$15,$13,$DC,$C6
    33  0e24  ddc80b1bc2dbcc18          DEFB    $DD,$C8,$0B,$1B,$C2,$DB,$CC,$18
    34  0e2c  d212c01acf1c190f          DEFB    $D2,$12,$C0,$1A,$CF,$1C,$19,$0F
    35                          
    36                          ;       Table   keycodes for scancode $00-$2F Shift+Graph layout
    37                          
    38                          
    39  0e34  0a00fdfc0000f500          DEFB    $0A,$00,$FD,$FC,$00,$00,$F5,$00
    40  0e3c  00081ff016020e04          DEFB    $00,$08,$1F,$F0,$16,$02,$0E,$04
    41  0e44  03f7aeaff6fffe00          DEFB    $03,$F7,$AE,$AF,$F6,$FF,$FE,$00
    42  0e4c  fac1ced410d6dfca          DEFB    $FA,$C1,$CE,$D4,$10,$D6,$DF,$CA
    43  0e54  dec90cd3c3d7cba9          DEFB    $DE,$C9,$0C,$D3,$C3,$D7,$CB,$A9
    44  0e5c  d100c5d5d0f9aaf8          DEFB    $D1,$00,$C5,$D5,$D0,$F9,$AA,$F8
    45                          
    46                          
    47                          ;       Table   keycodes for scancode $00-$2F Code layout
    48                          
    49  0e64  eb9fd9bf9b98e0e1          DEFB    $EB,$9F,$D9,$BF,$9B,$98,$E0,$E1
    50  0e6c  e787eee900eddab7          DEFB    $E7,$87,$EE,$E9,$00,$ED,$DA,$B7
    51  0e74  b9e586a6a7ff8497          DEFB    $B9,$E5,$86,$A6,$A7,$FF,$84,$97
    52  0e7c  8d8b8c9481b1a191          DEFB    $8D,$8B,$8C,$94,$81,$B1,$A1,$91
    53  0e84  b3b5e6a4a2a38393          DEFB    $B3,$B5,$E6,$A4,$A2,$A3,$83,$93
    54  0e8c  89968295888aa085          DEFB    $89,$96,$82,$95,$88,$8A,$A0,$85
    55                          
    56                          ;       Table   keycodes for scancode $00-$2F Shift+Code layout
    57                          
    58  0e94  d8ad9ebe9c9d0000          DEFB    $D8,$AD,$9E,$BE,$9C,$9D,$00,$00
    59  0e9c  e280000000e8eab6          DEFB    $E2,$80,$00,$00,$00,$E8,$EA,$B6
    60  0ea4  b8e48f00a8ff8e00          DEFB    $B8,$E4,$8F,$00,$A8,$FF,$8E,$00
    61  0eac  000000999ab00092          DEFB    $00,$00,$00,$99,$9A,$B0,$00,$92
    62  0eb4  b2b400a500e30000          DEFB    $B2,$B4,$00,$A5,$00,$E3,$00,$00
    63  0ebc  0000900000000000          DEFB    $00,$00,$90,$00,$00,$00,$00,$00
    64                          
    65                          ;       Subroutine      rest of the functionkey handler
    66                          ;       Inputs          C = code ($35-$3E)
    67                          ;       Outputs         ________________________
    68                          ;       Remark          code identical among keyboard layout versions from this point
    69                          
    70  0ec4  59                J0EC5:  LD      E,C
    71  0ec5  1600                      LD      D,$0
    72  0ec7  2199fb                    LD      HL,FNKFLG-$35
    73  0eca  19                        ADD     HL,DE
    74  0ecb  7e                        LD      A,(HL)
    75  0ecc  a7                        AND     A                       ; functionkey used for trap ?
    76  0ecd  2013                      JR      NZ,J0EE3                ; yep, handle trap
    77  0ecf  eb                J0ED0:  EX      DE,HL
    78  0ed0  29                        ADD     HL,HL
    79  0ed1  29                        ADD     HL,HL
    80  0ed2  29                        ADD     HL,HL
    81  0ed3  29                        ADD     HL,HL
    82  0ed4  112ff5                    LD      DE,FNKSTR-$35*16
    83  0ed7  19                        ADD     HL,DE
    84  0ed8  eb                        EX      DE,HL                   ; pointer to functionkey definition string
    85  0ed9  1a                J0EDA:  LD      A,(DE)
    86  0eda  a7                        AND     A                       ; end of string ?
    87  0edb  c8                        RET     Z                       ; yep, quit
    88  0edc  cd550f                    CALL    C0F55                   ; put keycode in keyboardbuffer
    89  0edf  13                        INC     DE
    90  0ee0  18f7                      JR      J0EDA                   ; next
    91                          
    92  0ee2  2a1cf4            J0EE3:  LD      HL,(CURLIN)
    93  0ee5  23                        INC     HL
    94  0ee6  7c                        LD      A,H
    95  0ee7  b5                        OR      L                       ; interpreter in direct mode ?
    96  0ee8  28e5                      JR      Z,J0ED0                 ; yep, normal $beavior
    97  0eea  21adfb                    LD      HL,TRPTBL-$35*3
    98  0eed  19                        ADD     HL,DE
    99  0eee  19                        ADD     HL,DE
   100  0eef  19                        ADD     HL,DE
   101                          
   102                          ;       Subroutine      raise trap
   103                          ;       Inputs          ________________________
   104                          ;       Outputs         ________________________
   105                          ;       Remark          code identical among keyboard layout versions
   106                          
   107  0ef0  7e                C0EF1:  LD      A,(HL)
   108  0ef1  e601                      AND     $1                      ; trap enabled ?
   109  0ef3  c8                        RET     Z                       ; nope, quit
   110  0ef4  7e                        LD      A,(HL)
   111  0ef5  f604                      OR      $4
   112  0ef7  be                        CP      (HL)                    ; trap occured flag set ?
   113  0ef8  c8                        RET     Z                       ; yep, quit
   114  0ef9  77                        LD      (HL),A                  ; flag trap occured
   115  0efa  ee05                      XOR     $5                      ; trap paused ?
   116  0efc  c0                        RET     NZ                      ; yep, quit
   117  0efd  3ad8fb                    LD      A,(ONGSBF)
   118  0f00  3c                        INC     A
   119  0f01  32d8fb                    LD      (ONGSBF),A              ; increase trap counter
   120  0f04  c9                        RET
   121                          
   122                          ;       Subroutine      handler HOME key
   123                          ;       Inputs          -
   124                          ;       Outputs         ________________________
   125                          ;       Remark          code identical among keyboard layout versions
   126                          
   127  0f05  3aebfb            C0F06:  LD      A,(NEWKEY+6)
   128  0f08  0f                        RRCA                            ; SHIFT key status
   129  0f09  3e0c                      LD      A,$C                    ; assume SHIFT-HOME -> CLS keycode
   130  0f0b  de00                      SBC     A,0                     ; no SHIFT pressed -> HOME keycode
   131  0f0d  1846                      JR      C0F55                   ; put keycode in keyboardbuffer
   132                          
   133                          ;       Subroutine      handler easily converted keys
   134                          ;       Inputs          A = scancode ($30-$57)
   135                          ;       Outputs         ________________________
   136                          ;       Remark          code identical among keyboard layout versions
   137                          
   138  0f0f  cdd1fd            C0F10:  CALL    H_KEYA
   139  0f12  5f                        LD      E,A
   140  0f13  1600                      LD      D,0
   141  0f15  210310                    LD      HL,D1033-$30
   142  0f18  19                        ADD     HL,DE
   143  0f19  7e                        LD      A,(HL)
   144  0f1a  a7                        AND     A                       ; keycode for key ?
   145  0f1b  c8                        RET     Z                       ; nope, quit
   146  0f1c  1837                      JR      C0F55                   ; put keycode in keyboardbuffer
   147                          
   148                          ;       Subroutine      handler DEAD key
   149                          ;       Inputs          -
   150                          ;       Outputs         ________________________
   151                          
   152  0f1e  3aebfb            J0F1F:  LD      A,(NEWKEY+6)
   153  0f21  5f                        LD      E,A
   154  0f22  f6fe                      OR      $FE             ; SHIFT key status (rest of bits 1)
   155  0f24  cb63                      BIT     4,E
   156  0f26  2002                      JR      NZ,J0F2B        ; CODE not pressed, use SHIFT
   157  0f28  e6fd              J0F29:  AND     $FD             ; reset b1
   158  0f2a  2f                J0F2B:  CPL
   159  0f2b  3c                        INC     A
   160  0f2c  32acfc                    LD      (KANAST),A      ; set DEAD status ($01-$04)
   161  0f2f  1833                      JR      J0F64           ; make keyclick
   162                          
   163                          ;
   164                          ;       leftover from KANA keyhandler, not used
   165                          ;
   166                          
   167  0f31  00000000                  DEFS    $0F35 - $, 0
   168  0f35  c9                L0F35:  RET
   169                          
   170                          ;       Subroutine      handler CAPS key
   171                          ;       Inputs          -
   172                          ;       Outputs         ________________________
   173                          ;       Remark          code identical among keyboard layout versions
   174                          
   175  0f36  21abfc            C0F36:  LD      HL,CAPST
   176  0f39  7e                        LD      A,(HL)
   177  0f3a  2f                        CPL
   178  0f3b  77                        LD      (HL),A                  ; toggle CAPS status
   179  0f3c  2f                        CPL                             ; adjust for CHGCAP and change CAPS led
   180                          
   181                          ;       Subroutine      CHGCAP
   182                          ;       Inputs          ________________________
   183                          ;       Outputs         ________________________
   184                          ;       Remark          code identical among keyboard layout versions
   185                          
   186  0f3d  a7                K_BCAP: AND     A
   187  0f3e  3e0c                      LD      A,$C
   188  0f40  2801                      JR      Z,J0F43
   189  0f42  3c                        INC     A
   190  0f43  d3ab              J0F43:  OUT     ($AB),A
   191  0f45  c9                        RET
   192                          
   193                          ;       Subroutine      handler STOP key
   194                          ;       Inputs          -
   195                          ;       Outputs         ________________________
   196                          ;       Remark          code identical among keyboard layout versions
   197                          
   198  0f46  3aebfb            C0F46:  LD      A,(NEWKEY+6)
   199  0f49  0f                        RRCA
   200  0f4a  0f                        RRCA                            ; CTRL key status
   201  0f4b  3e03                      LD      A,3                     ; CTRL-STOP
   202  0f4d  3001                      JR      NC,J0F50                ; CTRL pressed, flag CTRL-STOP
   203  0f4f  3c                        INC     A                       ; STOP
   204  0f50  329bfc            J0F50:  LD      (INTFLG),A
   205  0f53  380f                      JR      C,J0F64                 ; STOP, continue in keyclick
   206                          
   207                          ;       Subroutine      put keycode in keyboardbuffer
   208                          ;       Inputs          A = keycode
   209                          ;       Outputs         ________________________
   210                          ;       Remark          entrypoint compatible among keyboard layout versions
   211                          
   212  0f55  2a0000            C0F55:  LD      HL,(PUTPNT)
   213  0f58  77                        LD      (HL),A                  ; put in keyboardbuffer
   214  0f59  cd5b10                    CALL    C105B                   ; reset DEAD status, next postition in keyboardbuffer with roundtrip
   215  0f5c  3a0000                    LD      A,(GETPNT)
   216  0f5f  bd                        CP      L                       ; keyboard buffer full ?
   217  0f60  c8                        RET     Z                       ; yep, quit
   218  0f61  220000                    LD      (PUTPNT),HL             ; update put pointer
   219                          
   220                          ;       Subroutine      make keyclick
   221                          ;       Inputs          -
   222                          ;       Outputs         ________________________
   223                          ;       Remark          code identical among keyboard layout versions
   224                          
   225  0f64  3a0000            J0F64:  LD      A,(CLIKSW)
   226  0f67  a7                        AND     A                       ; keyclicks enabled ?
   227  0f68  c8                        RET     Z                       ; nope, quit
   228  0f69  3ad9fb                    LD      A,(CLIKFL)
   229  0f6c  a7                        AND     A                       ; keyclick already done (only one click for multiple keys) ?
   230  0f6d  c0                        RET     NZ                      ; yep, quit
   231  0f6e  3e0f                      LD      A,$F
   232  0f70  32d9fb                    LD      (CLIKFL),A              ; no keyclick until the next scan
   233  0f73  d3ab                      OUT     ($AB),A                 ; set click bit
   234  0f75  3e0a                      LD      A,10
   235  0f77  3d                J0F77:  DEC     A
   236  0f78  20fd                      JR      NZ,J0F77                ; wait
   237                                                                  ; reset click bit
   238                          
   239                          ;       Subroutine      change click bit
   240                          ;       Inputs          A = 0, A <> 0
   241                          ;       Outputs         ________________________
   242                          ;       Remark          code identical among keyboard layout versions
   243                          
   244  0f7a  a7                K_BSND: AND     A
   245  0f7b  3e0e                      LD      A,$E
   246  0f7d  2801                      JR      Z,J0F80
   247  0f7f  3c                        INC     A
   248  0f80  d3ab              J0F80:  OUT     ($AB),A
   249  0f82  c9                        RET
   250                          
   251                          ;       Subroutine      handler scancodes $00-$2F
   252                          ;       Inputs          C = scancode ($00-$2F)
   253                          ;       Outputs         ________________________
   254                          
   255  0f83  3aebfb            C0F83:  LD      A,(NEWKEY+6)
   256  0f86  5f                        LD      E,A
   257  0f87  1f                        RRA
   258  0f88  1f                        RRA                             ; CTRL status in Cx
   259  0f89  f5                        PUSH    AF
   260  0f8a  7b                        LD      A,E
   261  0f8b  2f                        CPL
   262  0f8c  3010                      JR      NC,J0F9E                ; CTRL pressed, ignore GRAPH and CODE key, use only SHIFT
   263  0f8e  1f                        RRA
   264  0f8f  1f                        RRA
   265  0f90  07                        RLCA
   266  0f91  e603                      AND     $3                      ; GRAPH and SHIFT status
   267  0f93  cb4f                      BIT     1,A
   268  0f95  2009                      JR      NZ,J0FA0                ; GRAPH pressed, ignore CODE key, use GRAPH and SHIFT
   269  0f97  cb63                      BIT     4,E                     ; CODE pressed ?
   270  0f99  2005                      JR      NZ,J0FA0                ; nope, no GRAPH, no CODE, use only SHIFT
   271  0f9b  f604                      OR      $4                      ; flag CODE pressed
   272  0f9d  11                        DEFB    $11                     ; LD DE,xxxx
   273  0f9e  e601              J0F9E:  AND     $01                     ; use only SHIFT
   274  0fa0  5f                J0FA0:  LD      E,A
   275  0fa1  87                        ADD     A,A
   276  0fa2  83                        ADD     A,E
   277  0fa3  87                        ADD     A,A
   278  0fa4  87                        ADD     A,A
   279  0fa5  87                        ADD     A,A
   280  0fa6  87                        ADD     A,A
   281  0fa7  5f                        LD      E,A                     ; *48 (6*8)
   282  0fa8  1600                      LD      D,0
   283  0faa  21a40d                    LD      HL,D0DA5
   284  0fad  19                        ADD     HL,DE                   ; keycode table
   285  0fae  42                        LD      B,D
   286  0faf  09                        ADD     HL,BC                   ; + scancode
   287  0fb0  f1                        POP     AF
   288  0fb1  7e                        LD      A,(HL)
   289  0fb2  3c                        INC     A                       ; DEAD key ?
   290  0fb3  ca1e0f                    JP      Z,J0F1F                 ; yep, handle dead key
   291  0fb6  3d                        DEC     A                       ; keycode for this combination ?
   292  0fb7  c8                        RET     Z                       ; nope, quit
   293  0fb8  3816                      JR      C,J0FD0                 ; no CTRL pressed, non CTRL handler
   294  0fba  e6df                      AND     $DF                     ; make upcase
   295  0fbc  d640                      SUB     $40                     ; convert '@','A'-'Z' to keycode (controlcode)
   296  0fbe  fe20                      CP      $20                     ; was '@' or 'A'-'Z' ?
   297  0fc0  d0                        RET     NC                      ; nope, quit (ignore)
   298  0fc1  1892              J0FC1:  JR      C0F55                   ; put keycode in keyboardbuffer
   299                          
   300                          ;       Subroutine      handler functionkeys
   301                          ;       Inputs          C = scancode ($35-$39)
   302                          ;       Outputs         ________________________
   303                          
   304  0fc3  3aebfb            C0FC3:  LD      A,(NEWKEY+6)
   305  0fc6  0f                        RRCA                            ; SHIFT key pressed ?
   306  0fc7  3804                      JR      C,J0FCD                 ; nope, F1-F5
   307  0fc9  79                        LD      A,C
   308  0fca  c605                      ADD     A,5
   309  0fcc  4f                        LD      C,A                     ; yep, F6-F10
   310  0fcd  c3c40e            J0FCD:  JP      J0EC5                   ; rest of the functionkey handler
   311                          
   312                          ;       Subroutine      handler keycodes scancodes $00-$2F
   313                          ;       Inputs          A = keycode
   314                          ;       Outputs         ________________________
   315                          
   316  0fd0  fe20              J0FD0:  CP      $20                     ; keycode with graphic header ?
   317  0fd2  300b                      JR      NC,J0FDF                ; nope,
   318  0fd4  f5                        PUSH    AF
   319  0fd5  3e01                      LD      A,1                     ; put MSX header keycode in keyboard buffer
   320  0fd7  cd550f                    CALL    C0F55                   ; put keycode in keyboardbuffer
   321  0fda  f1                        POP     AF
   322  0fdb  c640                      ADD     A,$40                   ; to $40-$5F keycode
   323  0fdd  18e2                      JR      J0FC1                   ; put keycode in keyboardbuffer
   324                          
   325  0fdf  21abfc            J0FDF:  LD      HL,CAPST
   326  0fe2  34                        INC     (HL)
   327  0fe3  35                        DEC     (HL)                    ; in CAPS mode ?
   328  0fe4  280a                      JR      Z,J0FF0                 ; nope, unchanged
   329  0fe6  fe61                      CP      'a'
   330  0fe8  3827                      JR      C,J1011                 ; not a lowercase letter,
   331  0fea  fe7b                      CP      'z'+1
   332  0fec  3023                      JR      NC,J1011                ; not a lowercase letter,
   333  0fee  e6df                      AND     $DF                     ; upcase
   334  0ff0  ed5bacfc          J0FF0:  LD      DE,(KANAST)
   335  0ff4  1c                        INC     E
   336  0ff5  1d                        DEC     E                       ; DEAD key was pressed ?
   337  0ff6  28c9                      JR      Z,J0FC1                 ; nope, no DEAD + letter sequence, put keycode in keyboardbuffer and quit
   338  0ff8  57                        LD      D,A
   339  0ff9  f620                      OR      $20                     ; lowercase
   340  0ffb  216610                    LD      HL,D1061+6-1
   341  0ffe  0e06                      LD      C,6
   342  1000  edb9                      CPDR                            ; valid DEAD letter ?
   343  1002  7a                        LD      A,D
   344  1003  20bc                      JR      NZ,J0FC1                ; nope, put keycode in keyboardbuffer and quit
   345  1005  23                        INC     HL
   346  1006  0e06                      LD      C,6
   347  1008  09                J1008:  ADD     HL,BC
   348  1009  1d                        DEC     E
   349  100a  20fc                      JR      NZ,J1008                ; to correct DEAD table
   350  100c  7e                        LD      A,(HL)
   351  100d  cb6a                      BIT     5,D                     ; upcase letter ?
   352  100f  20b0                      JR      NZ,J0FC1                ; nope, put keycode in keyboardbuffer and quit
   353  1011  0e1f              J1011:  LD      C,31
   354  1013  219d10                    LD      HL,D107F+$1F-1
   355  1016  edb9                      CPDR                            ; character with upcase variant ?
   356  1018  20a7                      JR      NZ,J0FC1                ; nope, put keycode in keyboardbuffer and quit
   357  101a  0e1f                      LD      C,31
   358  101c  23                        INC     HL
   359  101d  09                        ADD     HL,BC
   360  101e  7e                        LD      A,(HL)                  ; upcase variant
   361  101f  18a0                      JR      J0FC1                   ; put keycode in keyboardbuffer and quit
   362                          
   363                          ;       Subroutine      K_HAND (not offical name)
   364                          ;       Inputs          C = scancode
   365                          ;       Outputs         ________________________
   366                          
   367  1021  79                K_HAND: LD      A,C
   368  1022  21961b                    LD      HL,I1B96
   369  1025  cdccfd                    CALL    H_KEYC
   370  1028  160f                      LD      D,C0F06 >> 8            ; it is assumed that all handlers are in the $0F00-$0FFF area!
   371  102a  be                J102A:  CP      (HL)                    ; scancode handled by this entry ?
   372  102b  23                        INC     HL
   373  102c  5e                        LD      E,(HL)                  ; handler (low byte)
   374  102d  23                        INC     HL
   375  102e  d5                        PUSH    DE
   376  102f  d8                        RET     C                       ; yep, continue in handler
   377  1030  d1                        POP     DE
   378  1031  18f7                      JR      J102A                   ; next
   379                          
   380                          ;       Table           keycodes for easily converted keys
   381                          ;       Remark          scancodes $30-$57
   382                          
   383  1033  0000000000000000  D1033:  DEFB    $00,$00,$00,$00,$00,$00,$00,$00
   384  103b  00001b090008180d          DEFB    $00,$00,$1B,$09,$00,$08,$18,$0D
   385  1043  200c127f1d1e1f1c          DEFB    ' ' ,$0C,$12,$7F,$1D,$1E,$1F,$1C
   386  104b  2a2b2f3031323334          DEFB    '*' ,'+' ,'/' ,'0' ,'1' ,'2' ,'3' ,'4'
   387  1053  35363738392d2c2e          DEFB    '5' ,'6' ,'7' ,'8' ,'9' ,'-' ,',' ,'.'
   388                          
   389                          
   390                          ;       Subroutine      reset DEAD status, next postition in keyboardbuffer with roundtrip
   391                          ;       Inputs          -
   392                          ;       Outputs         ________________________
   393                          
   394  105b  af                C105B:  XOR     A
   395  105c  32acfc                    LD      (KANAST),A              ; reset DEAD status
   396  105f  1861                      JR      C10C2                   ; next postition in keyboardbuffer with roundtrip
   397                          
   398                          ;       Table   valid DEAD letters
   399                          
   400  1061  6165696f7579      D1061:  DEFB    'a' ,'e', 'i' ,'o' ,'u' ,'y'
   401                          
   402                          ;       Table   translation DEAD
   403                          
   404  1067  858a8d959779              DEFB    $85,$8A,$8D,$95,$97,'y'
   405                          
   406                          ;       Table   translation DEAD+SHIFT
   407                          
   408  106d  a082a1a2a379              DEFB    $A0,$82,$A1,$A2,$A3,'y'
   409                          
   410                          ;       Table   translation DEAD+CODE
   411                          
   412  1073  83888c939679              DEFB    $83,$88,$8C,$93,$96,'y'
   413                          
   414                          ;       Table   translation DEAD+CODE+SHIFT
   415                          
   416  1079  84898b948198              DEFB    $84,$89,$8B,$94,$81,$98
   417                          
   418                          ;       Table   accent characters with upcase
   419                          
   420  107f  83888c939684898b  D107F:  DEFB    $83,$88,$8C,$93,$96,$84,$89,$8B
   421  1087  948198a082a1a2a3          DEFB    $94,$81,$98,$A0,$82,$A1,$A2,$A3
   422  108f  858a8d9597b1b3b5          DEFB    $85,$8A,$8D,$95,$97,$B1,$B3,$B5
   423  1097  b7a4868791b979            DEFB    $B7,$A4,$86,$87,$91,$B9,'y'
   424                          
   425                          ;       Table   translation accent characters with upcase
   426                          
   427  109e  4145494f558e4549  D109E:  DEFB    'A' ,'E' ,'I' ,'O' ,'U' ,$8E ,'E' ,'I'
   428  10a6  999a594190494f55          DEFB    $99 ,$9A ,'Y' ,'A' ,$90 ,'I' ,'O' ,'U'
   429  10ae  4145494f55b0b2b4          DEFB    'A' ,'E' ,'I' ,'O' ,'U' ,$B0 ,$B2 ,$B4
   430  10b6  b6a58f8092b859            DEFB    $B6 ,$A5 ,$8F ,$80 ,$92 ,$B8 ,'Y'
   431                          
   432                          ; *************************************
   433                          ; END OF INTERNATIONAL KEYBOARD HANDLER
   434                          ; *************************************
   435                          
bios.asm:
  2421                          
  2422                                  ENDIF
  2423                          
  2424                          
  2425                                  IF      KEYTYP = 2
  2426                          
  2427                                  INCLUDE "keyfr.asm"
  2428                          
  2429                                  ENDIF
  2430                          
  2431                          
  2432                                  IF      KEYTYP = 3
  2433                          
  2434                                  INCLUDE "keyuk.asm"
  2435                          
  2436                                  ENDIF
  2437                          
  2438                          
  2439                                  IF      KEYTYP = 4
  2440                          
  2441                                  INCLUDE "keyger.asm"
  2442                          
  2443                                  ENDIF
  2444                          
  2445                          
  2446                                  IF      KEYTYP = 5
  2447                          
  2448                                  INCLUDE "keyrus.asm"
  2449                          
  2450                                  ENDIF
  2451                          
  2452                          
  2453                                  IF      KEYTYP = 6
  2454                          
  2455                                  INCLUDE "keyspa.asm"
  2456                          
  2457                                  ENDIF
  2458                          
  2459                          
  2460  10bd  0000000000                DEFS    $10C2 - $
  2461                          
  2462  10c2  23                C10C2:  inc     hl
  2463  10c3  7d                        ld      a,l
  2464  10c4  fe18                      cp      $00FF & (KEYBUF+40)
  2465  10c6  c0                        ret     nz
  2466  10c7  21f0fb                    ld      hl,KEYBUF
  2467  10ca  c9                        ret
  2468                          ;
  2469  10cb  e5                A10CB:  push    hl
  2470  10cc  d5                        push    de
  2471  10cd  c5                        push    bc
  2472  10ce  cdc2fd                    call    H_CHGE
  2473  10d1  cd690d                    call    A0D6A
  2474  10d4  200b                      jr      nz,A10E1
  2475  10d6  cdda09                    call    A09DA
  2476  10d9  cd690d            A10D9:  call    A0D6A
  2477  10dc  28fb                      jr      z,A10D9
  2478  10de  cd270a                    call    A0A27
  2479  10e1  219bfc            A10E1:  ld      hl,INTFLG
  2480  10e4  7e                        ld      a,(hl)
  2481  10e5  fe04                      cp      $04
  2482  10e7  2002                      jr      nz,A10EB
  2483  10e9  3600                      ld      (hl),$00
  2484  10eb  2a0000            A10EB:  ld      hl,(GETPNT)
  2485  10ee  4e                        ld      c,(hl)
  2486  10ef  cdc210                    call    C10C2
  2487  10f2  220000                    ld      (GETPNT),hl
  2488  10f5  79                        ld      a,c
  2489  10f6  c3db08                    jp      A08DB                   ; Reuse code in $08DB that pops BC, DE and HL and returns
  2490                          ;
  2491  10f9  e5                A10F9:  push    hl
  2492  10fa  210000                    ld      hl,0
  2493  10fd  cdfb03                    call    A03FB
  2494  1100  e1                        pop     hl
  2495  1101  c9                        ret
  2496                          ;
  2497  1102  f3                A1102:  di
  2498  1103  f5                	push	af
  2499  1104  cd1d27            	call	OUTPSG
  2500                          ;        out     (PSGCTL),a
  2501                          ;	push    af
  2502                          ;        ld      a,e
  2503                          ;        out     (PSGDAT),a
  2504  1107  00                	nop
  2505  1108  00                	nop
  2506  1109  fb                        ei
  2507  110a  f1                        pop     af
  2508  110b  c9                        ret
  2509                          ;
  2510                          ;A110C:  ld      a,$0E
  2511  110c  00                A110C:	nop
  2512  110d  00                	nop
  2513                          ;A110E:  out     (PSGCTL),a
  2514                          ;        in      a,(PSGRIN)
  2515  110e  cd3527            A110E:	call	JSTK
  2516  1111  00                	nop
  2517  1112  c9                        ret
  2518                          ;
  2519  1113  af                A1113:  xor     a
  2520  1114  1e55                      ld      e,$55
  2521  1116  cd0211                    call    A1102
  2522  1119  5f                        ld      e,a
  2523  111a  3c                        inc     a
  2524  111b  cd0211                    call    A1102
  2525  111e  1ebe                      ld      e,$BE
  2526  1120  3e07                      ld      a,$07
  2527  1122  cd0211                    call    A1102
  2528  1125  5f                        ld      e,a
  2529  1126  3c                        inc     a
  2530  1127  cd0211                    call    A1102
  2531  112a  01d007                    ld      bc,2000
  2532  112d  cd3311                    call    A1133
  2533  1130  c3bd04                    jp      A04BD
  2534                          ;
  2535  1133  0b                A1133:  dec     bc
  2536  1134  e3                        ex      (sp),hl
  2537  1135  e3                        ex      (sp),hl
  2538  1136  78                        ld      a,b
  2539  1137  b1                        or      c
  2540  1138  20f9                      jr      nz,A1133
  2541  113a  c9                        ret
  2542                          ;
  2543  113b  47                A113B:  ld      b,a                     ; channel
  2544  113c  cd7014                    call    A1470                   ; get voice pointer
  2545  113f  2b                        dec     hl
  2546  1140  56                        ld      d,(hl)
  2547  1141  2b                        dec     hl
  2548  1142  5e                        ld      e,(hl)
  2549  1143  1b                        dec     de
  2550  1144  73                        ld      (hl),e
  2551  1145  23                        inc     hl
  2552  1146  72                        ld      (hl),d                  ; decrease voice counter
  2553  1147  7a                        ld      a,d
  2554  1148  b3                        or      e                       ; counter expires ?
  2555  1149  c0                        ret     nz                      ; nop, quit
  2556  114a  78                        ld      a,b
  2557  114b  323efb                    ld      (QUEUEN),a
  2558  114e  cde211                    call    A11E2                   ; get byte
  2559  1151  feff                      cp      $FF
  2560  1153  285b                      jr      z,A11B0                 ; end byte,
  2561  1155  57                        ld      d,a
  2562  1156  e6e0                      and     $E0
  2563  1158  07                        rlca
  2564  1159  07                        rlca
  2565  115a  07                        rlca
  2566  115b  4f                        ld      c,a                     ; length of packet
  2567  115c  7a                        ld      a,d
  2568  115d  e61f                      and     $1F
  2569  115f  77                        ld      (hl),a                  ; MSB of counter
  2570  1160  cde211                    call    A11E2                   ; get byte
  2571  1163  2b                        dec     hl
  2572  1164  77                        ld      (hl),a                  ; LSB of counter
  2573  1165  0c                        inc     c
  2574  1166  0d                A1166:  dec     c                       ; packet ends ?
  2575  1167  c8                        ret     z                       ; yep, quit
  2576  1168  cde211                    call    A11E2                   ; get byte
  2577  116b  57                        ld      d,a
  2578  116c  e6c0                      and     $C0
  2579  116e  2011                      jr      nz,A1181                ; not a freqency packet
  2580  1170  cde211                    call    A11E2                   ; get byte
  2581  1173  5f                        ld      e,a
  2582  1174  78                        ld      a,b
  2583  1175  07                        rlca                            ; freqency register
  2584  1176  cd0211                    call    A1102                   ; write PSG register
  2585  1179  3c                        inc     a
  2586  117a  5a                        ld      e,d
  2587  117b  cd0211                    call    A1102                   ; write PSG register
  2588  117e  0d                        dec     c
  2589  117f  18e5                      jr      A1166                   ; next
  2590                          ;
  2591  1181  67                A1181:  ld      h,a
  2592  1182  e680                      and     $80
  2593  1184  280f                      jr      z,A1195                 ; not a amplitude packet
  2594  1186  5a                        ld      e,d
  2595  1187  78                        ld      a,b
  2596  1188  c608                      add     a,$08                  ; amplitude register
  2597  118a  cd0211                    call    A1102                   ; write PSG register
  2598  118d  7b                        ld      a,e
  2599  118e  e610                      and     $10                    ; modulate ?
  2600  1190  3e0d                      ld      a,$0D
  2601  1192  c40211                    call    nz,A1102                ; yep, write PSG register 13
  2602  1195  7c                A1195:  ld      a,h
  2603  1196  e640                      and     $40
  2604  1198  28cc                      jr      z,A1166                 ; there is no envelope packet, next
  2605  119a  cde211                    call    A11E2                   ; get byte
  2606  119d  57                        ld      d,a
  2607  119e  cde211                    call    A11E2                   ; get byte
  2608  11a1  5f                        ld      e,a
  2609  11a2  3e0b                      ld      a,$0B
  2610  11a4  cd0211                    call    A1102                   ; write PSG register 11
  2611  11a7  3c                        inc     a
  2612  11a8  5a                        ld      e,d
  2613  11a9  cd0211                    call    A1102                   ; write PSG register 12
  2614  11ac  0d                        dec     c
  2615  11ad  0d                        dec     c
  2616  11ae  18b6                      jr      A1166                   ; next
  2617                          ;
  2618  11b0  78                A11B0:  ld      a,b
  2619  11b1  c608                      add     a,$08                  ; amplitude register
  2620  11b3  1e00                      ld      e,$00
  2621  11b5  cd0211                    call    A1102                   ; write PSG register
  2622  11b8  04                        inc     b
  2623  11b9  213ffb                    ld      hl,MUSICF
  2624  11bc  af                        xor     a
  2625  11bd  37                        scf
  2626  11be  17                A11BE:  rla
  2627  11bf  10fd                      djnz    A11BE
  2628  11c1  a6                        and     (hl)
  2629  11c2  ae                        xor     (hl)
  2630  11c3  77                        ld      (hl),a                  ; channel not active
  2631  11c4  3a3ffb            A11C4:  ld      a,(MUSICF)
  2632  11c7  b7                        or      a                       ; no channel active ?
  2633  11c8  c0                        ret     nz                      ; nop, quit
  2634  11c9  2140fb                    ld      hl,PLYCNT
  2635  11cc  7e                        ld      a,(hl)
  2636  11cd  b7                        or      a                       ; strings left ?
  2637  11ce  c8                        ret     z                       ; nop, quit
  2638  11cf  35                        dec     (hl)
  2639  11d0  210100                    ld      hl,1
  2640  11d3  2241fb                    ld      (VCBA+0),hl
  2641  11d6  2266fb                    ld      (VCBB+0),hl
  2642  11d9  228bfb                    ld      (VCBC+0),hl
  2643  11dc  3e07                      ld      a,$07
  2644  11de  323ffb                    ld      (MUSICF),a
  2645  11e1  c9                        ret
  2646                          ;
  2647  11e2  3a3efb            A11E2:  ld      a,(QUEUEN)
  2648  11e5  e5                        push    hl
  2649  11e6  d5                        push    de
  2650  11e7  c5                        push    bc
  2651  11e8  cdad14                    call    A14AD
  2652  11eb  c3db08                    jp      A08DB                   ; Reuse code in $08DB that pops BC, DE and HL and returns
  2653                          ;
  2654  11ee  3d                A11EE:  dec     a
  2655  11ef  fa0012                    jp      m,A1200
  2656  11f2  cd0c12                    call    A120C
  2657  11f5  213312                    ld      hl,T1233
  2658  11f8  e60f              A11F8:  and     $0F
  2659  11fa  5f                        ld      e,a
  2660  11fb  1600                      ld      d,$00
  2661  11fd  19                        add     hl,de
  2662  11fe  7e                        ld      a,(hl)
  2663  11ff  c9                        ret
  2664                          ;
  2665  1200  cd2612            A1200:  call    A1226
  2666  1203  0f                        rrca
  2667  1204  0f                        rrca
  2668  1205  0f                        rrca
  2669  1206  0f                        rrca
  2670  1207  214312                    ld      hl,T1243
  2671  120a  18ec                      jr      A11F8
  2672                          ;
  2673  120c  47                A120C:  ld      b,a
  2674  120d  3e0f                      ld      a,$0F
  2675  120f  f3                        di
  2676  1210  cd0e11                    call    A110E
  2677  1213  1006                      djnz    A121B
  2678  1215  e6df                      and     $DF
  2679  1217  f64c                      or      $4C
  2680  1219  1804                      jr      A121F
  2681                          ;
  2682  121b  e6af              A121B:  and     $AF
  2683  121d  f603                      or      $03
  2684                          A121F:
  2685                          ;	out     (PSGDAT),a
  2686  121f  00                	nop
  2687  1220  00                	nop
  2688  1221  cd0c11                    call    A110C
  2689  1224  fb                        ei
  2690  1225  c9                        ret
  2691                          ;
  2692  1226  f3                A1226:  di
  2693                          ;        in      a,($AA)
  2694  1227  00                	nop
  2695  1228  00                	nop
  2696                          ;        and     $F0
  2697  1229  00                	nop
  2698  122a  00                	nop
  2699                          ;        add     a,$08
  2700                          ;	nop
  2701                          ;	nop
  2702  122b  0e08              	ld	c,$08
  2703                          ;        out     ($AA),a
  2704  122d  00                	nop
  2705                          ;	nop
  2706                          ;        in      a,($A9)
  2707                          ;	nop
  2708                          ;	nop
  2709  122e  cd7a2d            	call	KBD
  2710  1231  fb                        ei
  2711  1232  c9                        ret
  2712                          ;
  2713  1233  0005010003040203  T1233:  db      0,5,1,0,3,4,2,3,7,6,8,7,0,5,1,0
              0706080700050100  
  2714                          
  2715  1243  0003050401020003  T1243:  db      0,3,5,4,1,2,0,3,7,0,6,5,8,1,7,0
              0700060508010700  
  2716                          
  2717  1253  3d                A1253:  dec     a
  2718  1254  fa6c12                    jp      m,A126C
  2719  1257  f5                        push    af
  2720  1258  e601                      and     $01
  2721  125a  cd0c12                    call    A120C
  2722  125d  c1                        pop     bc
  2723  125e  05                        dec     b
  2724  125f  05                        dec     b
  2725  1260  0610                      ld      b,$10
  2726  1262  fa6712                    jp      m,A1267
  2727  1265  0620                      ld      b,$20
  2728  1267  a0                A1267:  and     b
  2729  1268  d601              A1268:  sub     $01
  2730  126a  9f                        sbc     a,a
  2731  126b  c9                        ret
  2732                          ;
  2733  126c  cd2612            A126C:  call    A1226
  2734  126f  e601                      and     $01
  2735  1271  18f5                      jr      A1268
  2736                          ;
  2737  1273  3c                A1273:  inc     a
  2738  1274  a7                        and     a
  2739  1275  1f                        rra
  2740  1276  f5                        push    af
  2741  1277  47                        ld      b,a
  2742  1278  af                        xor     a
  2743  1279  37                        scf
  2744  127a  17                A127A:  rla
  2745  127b  10fd                      djnz    A127A
  2746  127d  47                        ld      b,a
  2747  127e  f1                        pop     af
  2748  127f  0e10                      ld      c,$10
  2749  1281  11af03                    ld      de,$03AF
  2750  1284  3005                      jr      nc,A128B
  2751  1286  0e20                      ld      c,$20
  2752  1288  119f4c                    ld      de,$4C9F
  2753  128b  3e0f              A128B:  ld      a,$0F
  2754  128d  f3                        di
  2755  128e  cd0e11                    call    A110E
  2756  1291  a3                        and     e
  2757  1292  b2                        or      d
  2758  1293  b1                        or      c
  2759  1294  d3a1                      out     (PSGDAT),a
  2760  1296  a9                        xor     c
  2761  1297  d3a1                      out     (PSGDAT),a
  2762  1299  3e0e                      ld      a,$0E
  2763  129b  d3a0                      out     (PSGCTL),a
  2764  129d  0e00                      ld      c,$00
  2765  129f  dba2              A129F:  in      a,(PSGRIN)
  2766  12a1  a0                        and     b
  2767  12a2  2805                      jr      z,A12A9
  2768  12a4  0c                        inc     c
  2769  12a5  c29f12                    jp      nz,A129F
  2770  12a8  0d                        dec     c
  2771  12a9  fb                A12A9:  ei
  2772  12aa  79                        ld      a,c
  2773  12ab  c9                        ret
  2774                          ;
  2775  12ac  fe04              A12AC:  cp      $04
  2776  12ae  11ec0c                    ld      de,$0CEC
  2777  12b1  3805                      jr      c,A12B8
  2778  12b3  11d303                    ld      de,$03D3
  2779  12b6  d604                      sub     $04
  2780  12b8  3d                A12B8:  dec     a
  2781  12b9  fac512                    jp      m,A12C5
  2782  12bc  3d                        dec     a
  2783  12bd  3a9dfc                    ld      a,(PADX)
  2784  12c0  f8                        ret     m
  2785  12c1  3a9cfc                    ld      a,(PADY)
  2786  12c4  c8                        ret     z
  2787  12c5  f5                A12C5:  push    af
  2788  12c6  eb                        ex      de,hl
  2789  12c7  2266f8                    ld      (FILNAM+0),hl
  2790  12ca  9f                        sbc     a,a
  2791  12cb  2f                        cpl
  2792  12cc  e640                      and     $40
  2793  12ce  4f                        ld      c,a
  2794  12cf  3e0f                      ld      a,$0F
  2795  12d1  f3                        di
  2796  12d2  cd0e11                    call    A110E
  2797  12d5  e6bf                      and     $BF
  2798  12d7  b1                        or      c
  2799  12d8  d3a1                      out     (PSGDAT),a
  2800  12da  f1                        pop     af
  2801  12db  fae812                    jp      m,A12E8
  2802  12de  cd0c11                    call    A110C
  2803  12e1  fb                        ei
  2804  12e2  e608                      and     $08
  2805  12e4  d601                      sub     $01
  2806  12e6  9f                        sbc     a,a
  2807  12e7  c9                        ret
  2808                          ;
  2809  12e8  0e00              A12E8:  ld      c,$00
  2810  12ea  cd3213                    call    A1332
  2811  12ed  cd3213                    call    A1332
  2812  12f0  3828                      jr      c,A131A
  2813  12f2  cd2013                    call    A1320
  2814  12f5  3823                      jr      c,A131A
  2815  12f7  d5                        push    de
  2816  12f8  cd2013                    call    A1320
  2817  12fb  c1                        pop     bc
  2818  12fc  381c                      jr      c,A131A
  2819  12fe  78                        ld      a,b
  2820  12ff  92                        sub     d
  2821  1300  3002                      jr      nc,A1304
  2822  1302  2f                        cpl
  2823  1303  3c                        inc     a
  2824  1304  fe05              A1304:  cp      $05
  2825  1306  30e0                      jr      nc,A12E8
  2826  1308  79                        ld      a,c
  2827  1309  93                        sub     e
  2828  130a  3002                      jr      nc,A130E
  2829  130c  2f                        cpl
  2830  130d  3c                        inc     a
  2831  130e  fe05              A130E:  cp      $05
  2832  1310  30d6                      jr      nc,A12E8
  2833  1312  7a                        ld      a,d
  2834  1313  329dfc                    ld      (PADX),a
  2835  1316  7b                        ld      a,e
  2836  1317  329cfc                    ld      (PADY),a
  2837  131a  fb                A131A:  ei
  2838  131b  7c                        ld      a,h
  2839  131c  d601                      sub     $01
  2840  131e  9f                        sbc     a,a
  2841  131f  c9                        ret
  2842                          ;
  2843  1320  0e0a              A1320:  ld      c,$0A
  2844  1322  cd3213                    call    A1332
  2845  1325  d8                        ret     c
  2846  1326  55                        ld      d,l
  2847  1327  d5                        push    de
  2848  1328  0e00                      ld      c,$00
  2849  132a  cd3213                    call    A1332
  2850  132d  d1                        pop     de
  2851  132e  5d                        ld      e,l
  2852  132f  af                        xor     a
  2853  1330  67                        ld      h,a
  2854  1331  c9                        ret
  2855                          ;
  2856  1332  cd5b13            A1332:  call    A135B
  2857  1335  0608                      ld      b,$08
  2858  1337  51                        ld      d,c
  2859  1338  cb82              A1338:  res     0,d
  2860  133a  cb92                      res     2,d
  2861  133c  cd6d13                    call    A136D
  2862  133f  cd0c11                    call    A110C
  2863  1342  67                        ld      h,a
  2864  1343  1f                        rra
  2865  1344  1f                        rra
  2866  1345  1f                        rra
  2867  1346  cb15                      rl      l
  2868  1348  cbc2                      set     0,d
  2869  134a  cbd2                      set     2,d
  2870  134c  cd6d13                    call    A136D
  2871  134f  10e7                      djnz    A1338
  2872  1351  cbe2                      set     4,d
  2873  1353  cbea                      set     5,d
  2874  1355  cd6d13                    call    A136D
  2875  1358  7c                        ld      a,h
  2876  1359  1f                        rra
  2877  135a  c9                        ret
  2878                          ;
  2879  135b  3e35              A135B:  ld      a,$35
  2880  135d  b1                        or      c
  2881  135e  57                        ld      d,a
  2882  135f  cd6d13                    call    A136D
  2883  1362  cd0c11            A1362:  call    A110C
  2884  1365  e602                      and     $02
  2885  1367  28f9                      jr      z,A1362
  2886  1369  cba2                      res     4,d
  2887  136b  cbaa                      res     5,d
  2888  136d  e5                A136D:  push    hl
  2889  136e  d5                        push    de
  2890  136f  2a66f8                    ld      hl,(FILNAM+0)
  2891  1372  7d                        ld      a,l
  2892  1373  2f                        cpl
  2893  1374  a2                        and     d
  2894  1375  57                        ld      d,a
  2895  1376  3e0f                      ld      a,$0F
  2896  1378  d3a0                      out     (PSGCTL),a
  2897  137a  dba2                      in      a,(PSGRIN)
  2898  137c  a5                        and     l
  2899  137d  b2                        or      d
  2900  137e  b4                        or      h
  2901  137f  d3a1                      out     (PSGDAT),a
  2902  1381  d1                        pop     de
  2903  1382  e1                        pop     hl
  2904  1383  c9                        ret
  2905                          ;
  2906  1384  a7                A1384:  and     a
  2907  1385  fa9213                    jp      m,A1392
  2908  1388  2003              A1388:  jr      nz,A138D
  2909  138a  3e09                      ld      a,$09
  2910  138c  c2                        defb    $C2
  2911  138d  3e08              A138D:  ld      a,$08
  2912                          ;        out     ($AB),a
  2913  138f  00                	nop
  2914  1390  00                	nop
  2915  1391  c9                        ret
  2916                          ;
  2917  1392  00                A1392:  nop
  2918  1393  00                	nop
  2919                          ;	in      a,($AA)
  2920  1394  00                	nop
  2921  1395  00                	nop
  2922                          ;        and     $10
  2923  1396  18f0                      jr      A1388
  2924                          ;
  2925  1398  cdd6fd            A1398:  call    H_NMI
  2926  139b  ed45                      retn
  2927                          
  2928  139d  01a000            A139D:  ld      bc,10*16
  2929  13a0  117ff8                    ld      de,FNKSTR
  2930  13a3  21a913                    ld      hl,T13A9
  2931  13a6  edb0                      ldir
  2932  13a8  c9                        ret
  2933                          ;
  2934  13a9  636f6c6f722000    T13A9:  db      "color ",0
  2935  13b0  0000000000000000          ds      16-7,0
              00                
  2936  13b9  6175746f2000              db      "auto ",0
  2937  13bf  0000000000000000          ds      16-6,0
              0000              
  2938  13c9  676f746f2000              db      "goto ",0
  2939  13cf  0000000000000000          ds      16-6,0
              0000              
  2940  13d9  6c6973742000              db      "list ",0
  2941  13df  0000000000000000          ds      16-6,0
              0000              
  2942  13e9  72756e0d00                db      "run",13,0
  2943  13ee  0000000000000000          ds      16-5,0
              000000            
  2944                          
  2945                                  IF BASVER = 0
  2946                                  DEFM    "color 15,4,7",13,0
  2947                                  ds      16-14,0
  2948                                  ELSE
  2949  13f9  636f6c6f72203135          DEFM    "color 15,4,4",13,0
              2c342c340d00      
  2950  1407  0000                      ds      16-14,0
  2951                                  ENDIF
  2952  1409  636c6f61642200            db      "cload", 34, 0
  2953  1410  0000000000000000          ds      16-7,0
              00                
  2954  1419  636f6e740d00              db      "cont",13,0
  2955  141f  0000000000000000          ds      16-6,0
              0000              
  2956  1429  6c6973742e0d1e1e          db      "list.",13,30,30,0
              00                
  2957  1432  00000000000000            ds      16-9,0
  2958  1439  0c72756e0d00              db      12,"run",13,0
  2959  143f  0000000000000000          ds      16-6,0
              0000              
  2960                          
  2961  1449  db99              A1449:  in      a,(VDPCTL)
  2962  144b  c9                        ret
  2963                          ;
  2964  144c  00                A144C:  nop
  2965  144d  af                	xor	a
  2966                          ;	in      a,($A8)
  2967  144e  c9                        ret
  2968                          ;
  2969  144f  00                A144F:  nop
  2970  1450  00                	nop
  2971                          ;	out     ($A8),a
  2972  1451  c9                        ret
  2973                          ;
  2974  1452  4f                A1452:  ld      c,a
  2975  1453  f3                        di
  2976                          ;        in      a,($AA)
  2977  1454  00                	nop
  2978  1455  00                	nop
  2979                          ;        and     $F0
  2980  1456  00                	nop
  2981  1457  00                	nop
  2982                          ;        add     a,c
  2983  1458  00                	nop
  2984                          ;        out     ($AA),a
  2985  1459  00                	nop
  2986                          ;	nop
  2987                          ;        in      a,($A9)
  2988                          ;	nop
  2989                          ;	nop
  2990  145a  cd7a2d            	call	KBD
  2991  145d  fb                        ei
  2992  145e  c9                        ret
  2993                          ;
  2994  145f  cddffe            A145F:  call    H_ISFL
  2995  1462  e5                        push    hl
  2996  1463  2a64f8                    ld      hl,(PTRFIL)
  2997  1466  7d                        ld      a,l
  2998  1467  b4                        or      h
  2999  1468  e1                        pop     hl
  3000  1469  c9                        ret
  3001                          ;
  3002  146a  7c                A146A:  ld      a,h
  3003  146b  92                        sub     d
  3004  146c  c0                        ret     nz
  3005  146d  7d                        ld      a,l
  3006  146e  93                        sub     e
  3007  146f  c9                        ret
  3008                          ;
  3009  1470  2e02              A1470:  ld      l,$02
  3010  1472  1803                      jr      A1477
  3011                          ;
  3012  1474  3a38fb            A1474:  ld      a,(VOICEN)
  3013  1477  d5                A1477:  push    de
  3014  1478  1141fb                    ld      de,VCBA
  3015  147b  2600                      ld      h,$00
  3016  147d  19                        add     hl,de
  3017  147e  b7                        or      a
  3018  147f  2807                      jr      z,A1488
  3019  1481  112500                    ld      de,37
  3020  1484  19                A1484:  add     hl,de
  3021  1485  3d                        dec     a
  3022  1486  20fc                      jr      nz,A1484
  3023  1488  d1                A1488:  pop     de
  3024  1489  c9                        ret
  3025                          ;
  3026  148a  cda7ff            A148A:  call    H_PHYD
  3027  148d  c9                        ret
  3028                          ;
  3029  148e  cdacff            A148E:  call    H_FORM
  3030  1491  c9                        ret
  3031                          ;
  3032  1492  cdfa14            A1492:  call    A14FA
  3033  1495  78                        ld      a,b
  3034  1496  3c                        inc     a
  3035  1497  23                        inc     hl
  3036  1498  a6                        and     (hl)
  3037  1499  b9                        cp      c
  3038  149a  c8                        ret     z
  3039  149b  e5                        push    hl
  3040  149c  2b                        dec     hl
  3041  149d  2b                        dec     hl
  3042  149e  2b                        dec     hl
  3043  149f  e3                        ex      (sp),hl
  3044  14a0  23                        inc     hl
  3045  14a1  4f                        ld      c,a
  3046  14a2  7e                        ld      a,(hl)
  3047  14a3  23                        inc     hl
  3048  14a4  66                        ld      h,(hl)
  3049  14a5  6f                        ld      l,a
  3050  14a6  0600                      ld      b,$00
  3051  14a8  09                        add     hl,bc
  3052  14a9  73                        ld      (hl),e
  3053  14aa  e1                        pop     hl
  3054  14ab  71                        ld      (hl),c
  3055  14ac  c9                        ret
  3056                          ;
  3057  14ad  cdfa14            A14AD:  call    A14FA
  3058  14b0  3600                      ld      (hl),$00
  3059  14b2  201d                      jr      nz,A14D1
  3060  14b4  79                        ld      a,c
  3061  14b5  b8                        cp      b
  3062  14b6  c8                        ret     z
  3063  14b7  23                        inc     hl
  3064  14b8  3c                        inc     a
  3065  14b9  a6                        and     (hl)
  3066  14ba  2b                        dec     hl
  3067  14bb  2b                        dec     hl
  3068  14bc  e5                        push    hl
  3069  14bd  23                        inc     hl
  3070  14be  23                        inc     hl
  3071  14bf  23                        inc     hl
  3072  14c0  4f                        ld      c,a
  3073  14c1  7e                        ld      a,(hl)
  3074  14c2  23                        inc     hl
  3075  14c3  66                        ld      h,(hl)
  3076  14c4  6f                        ld      l,a
  3077  14c5  0600                      ld      b,$00
  3078  14c7  09                        add     hl,bc
  3079  14c8  7e                        ld      a,(hl)
  3080  14c9  e1                        pop     hl
  3081  14ca  71                        ld      (hl),c
  3082  14cb  b7                        or      a
  3083  14cc  c0                        ret     nz
  3084  14cd  3c                        inc     a
  3085  14ce  3e00                      ld      a,$00
  3086  14d0  c9                        ret
  3087                          ;
  3088  14d1  4f                A14D1:  ld      c,a
  3089  14d2  0600                      ld      b,$00
  3090  14d4  2170f9                    ld      hl,QUEBAK-1
  3091  14d7  09                        add     hl,bc
  3092  14d8  7e                        ld      a,(hl)
  3093  14d9  c9                        ret
  3094                          ;
  3095  14da  c5                A14DA:  push    bc
  3096  14db  cd0415                    call    A1504
  3097  14de  70                        ld      (hl),b
  3098  14df  23                        inc     hl
  3099  14e0  70                        ld      (hl),b
  3100  14e1  23                        inc     hl
  3101  14e2  70                        ld      (hl),b
  3102  14e3  23                        inc     hl
  3103  14e4  f1                        pop     af
  3104  14e5  77                        ld      (hl),a
  3105  14e6  23                        inc     hl
  3106  14e7  73                        ld      (hl),e
  3107  14e8  23                        inc     hl
  3108  14e9  72                        ld      (hl),d
  3109  14ea  c9                        ret
  3110                          ;
  3111  14eb  cdfa14            A14EB:  call    A14FA
  3112  14ee  78                        ld      a,b
  3113  14ef  3c                        inc     a
  3114  14f0  23                        inc     hl
  3115  14f1  a6                        and     (hl)
  3116  14f2  47                        ld      b,a
  3117  14f3  79                        ld      a,c
  3118  14f4  90                        sub     b
  3119  14f5  a6                        and     (hl)
  3120  14f6  6f                        ld      l,a
  3121  14f7  2600                      ld      h,$00
  3122  14f9  c9                        ret
  3123                          ;
  3124  14fa  cd0415            A14FA:  call    A1504
  3125  14fd  46                        ld      b,(hl)
  3126  14fe  23                        inc     hl
  3127  14ff  4e                        ld      c,(hl)
  3128  1500  23                        inc     hl
  3129  1501  7e                        ld      a,(hl)
  3130  1502  b7                        or      a
  3131  1503  c9                        ret
  3132                          ;
  3133  1504  07                A1504:  rlca
  3134  1505  47                        ld      b,a
  3135  1506  07                        rlca
  3136  1507  80                        add     a,b
  3137  1508  4f                        ld      c,a
  3138  1509  0600                      ld      b,$00
  3139  150b  2a0000                    ld      hl,(QUEUES)
  3140  150e  09                        add     hl,bc
  3141  150f  c9                        ret
  3142                          ;
  3143  1510  e5                A1510:  push    hl
  3144  1511  d5                        push    de
  3145  1512  c5                        push    bc
  3146  1513  f5                        push    af
  3147  1514  cd9d08                    call    A089D
  3148  1517  3062                      jr      nc,A157B
  3149  1519  2008                      jr      nz,A1523
  3150  151b  fe0d                      cp      $0D
  3151  151d  285f                      jr      z,A157E
  3152  151f  fe20                      cp      $20
  3153  1521  3858                      jr      c,A157B
  3154  1523  cd5207            A1523:  call    A0752
  3155  1526  3a0000                    ld      a,(FORCLR)
  3156  1529  320000                    ld      (ATRBYT),a
  3157  152c  2ab9fc                    ld      hl,(GRPACY)
  3158  152f  eb                        ex      de,hl
  3159  1530  ed4bb7fc                  ld      bc,(GRPACX)
  3160  1534  cd9915                    call    A1599
  3161  1537  3042                      jr      nc,A157B
  3162  1539  cddf15                    call    A15DF
  3163  153c  1140fc                    ld      de,PATWRK
  3164  153f  0e08                      ld      c,$08
  3165  1541  0608              A1541:  ld      b,$08
  3166  1543  cd3916                    call    A1639
  3167  1546  e5                        push    hl
  3168  1547  f5                        push    af
  3169  1548  1a                        ld      a,(de)
  3170  1549  87                A1549:  add     a,a
  3171  154a  f5                        push    af
  3172  154b  dc7e16                    call    c,A167E
  3173  154e  cdac16                    call    A16AC
  3174  1551  e1                        pop     hl
  3175  1552  3804                      jr      c,A1558
  3176  1554  e5                        push    hl
  3177  1555  f1                        pop     af
  3178  1556  10f1                      djnz    A1549
  3179  1558  f1                A1558:  pop     af
  3180  1559  e1                        pop     hl
  3181  155a  cd4016                    call    A1640
  3182  155d  cd0a17                    call    A170A
  3183  1560  3804                      jr      c,A1566
  3184  1562  13                        inc     de
  3185  1563  0d                        dec     c
  3186  1564  20db                      jr      nz,A1541
  3187  1566  cdd915            A1566:  call    A15D9
  3188  1569  3ab7fc                    ld      a,(GRPACX)
  3189  156c  2806                      jr      z,A1574
  3190  156e  c620                      add     a,$20
  3191  1570  380c                      jr      c,A157E
  3192  1572  1804                      jr      A1578
  3193                          ;
  3194  1574  c608              A1574:  add     a,$08
  3195  1576  3806                      jr      c,A157E
  3196  1578  32b7fc            A1578:  ld      (GRPACX),a
  3197  157b  c3da08            A157B:  jp      A08DA
  3198                          ;
  3199  157e  af                A157E:  xor     a
  3200  157f  32b7fc                    ld      (GRPACX),a
  3201  1582  cdd915                    call    A15D9
  3202  1585  3ab9fc                    ld      a,(GRPACY)
  3203  1588  2803                      jr      z,A158D
  3204  158a  c620                      add     a,$20
  3205  158c  01                        db      $01
  3206  158d  c608              A158D:  add     a,$08
  3207  158f  fec0                      cp      $C0
  3208  1591  3801                      jr      c,A1594
  3209  1593  af                        xor     a
  3210  1594  32b9fc            A1594:  ld      (GRPACY),a
  3211  1597  18e2                      jr      A157B
  3212                          ;
  3213  1599  e5                A1599:  push    hl
  3214  159a  c5                        push    bc
  3215  159b  0601                      ld      b,$01
  3216  159d  eb                        ex      de,hl
  3217  159e  7c                        ld      a,h
  3218  159f  87                        add     a,a
  3219  15a0  3005                      jr      nc,A15A7
  3220  15a2  210000                    ld      hl,0
  3221  15a5  1808                      jr      A15AF
  3222                          ;
  3223  15a7  11c000            A15A7:  ld      de,192
  3224  15aa  e7                        rst     DCOMPR
  3225  15ab  3804                      jr      c,A15B1
  3226  15ad  eb                        ex      de,hl
  3227  15ae  2b                        dec     hl
  3228  15af  0600              A15AF:  ld      b,$00
  3229  15b1  e3                A15B1:  ex      (sp),hl
  3230  15b2  7c                        ld      a,h
  3231  15b3  87                        add     a,a
  3232  15b4  3005                      jr      nc,A15BB
  3233  15b6  210000                    ld      hl,0
  3234  15b9  1808                      jr      A15C3
  3235                          ;
  3236  15bb  110001            A15BB:  ld      de,256
  3237  15be  e7                        rst     DCOMPR
  3238  15bf  3804                      jr      c,A15C5
  3239  15c1  eb                        ex      de,hl
  3240  15c2  2b                        dec     hl
  3241  15c3  0600              A15C3:  ld      b,$00
  3242  15c5  d1                A15C5:  pop     de
  3243  15c6  cdd915                    call    A15D9
  3244  15c9  2808                      jr      z,A15D3
  3245  15cb  cb3d                      srl     l
  3246  15cd  cb3d                      srl     l
  3247  15cf  cb3b                      srl     e
  3248  15d1  cb3b                      srl     e
  3249  15d3  78                A15D3:  ld      a,b
  3250  15d4  0f                        rrca
  3251  15d5  44                        ld      b,h
  3252  15d6  4d                        ld      c,l
  3253  15d7  e1                        pop     hl
  3254  15d8  c9                        ret
  3255                          ;
  3256  15d9  3aaffc            A15D9:  ld      a,(SCRMOD)
  3257  15dc  d602                      sub     $02
  3258  15de  c9                        ret
  3259                          ;
  3260  15df  c5                A15DF:  push    bc
  3261  15e0  cdd915                    call    A15D9
  3262  15e3  202e                      jr      nz,A1613
  3263  15e5  51                        ld      d,c
  3264  15e6  79                        ld      a,c
  3265  15e7  e607                      and     $07
  3266  15e9  4f                        ld      c,a
  3267  15ea  210b16                    ld      hl,T160B
  3268  15ed  09                        add     hl,bc
  3269  15ee  7e                        ld      a,(hl)
  3270  15ef  322cf9                    ld      (CMASK),a
  3271  15f2  7b                        ld      a,e
  3272  15f3  0f                        rrca
  3273  15f4  0f                        rrca
  3274  15f5  0f                        rrca
  3275  15f6  e61f                      and     $1F
  3276  15f8  47                        ld      b,a
  3277  15f9  7a                        ld      a,d
  3278  15fa  e6f8                      and     $F8
  3279  15fc  4f                        ld      c,a
  3280  15fd  7b                        ld      a,e
  3281  15fe  e607                      and     $07
  3282  1600  b1                        or      c
  3283  1601  4f                        ld      c,a
  3284  1602  2a0000                    ld      hl,(GRPCGP)
  3285  1605  09                        add     hl,bc
  3286  1606  222af9                    ld      (CLOC),hl
  3287  1609  c1                        pop     bc
  3288  160a  c9                        ret
  3289                          ;
  3290  160b  80                T160B:  db      10000000b
  3291  160c  40                        db      01000000b
  3292  160d  20                        db      00100000b
  3293  160e  10                        db      00010000b
  3294  160f  08                        db      00001000b
  3295  1610  04                        db      00000100b
  3296  1611  02                        db      00000010b
  3297  1612  01                        db      00000001b
  3298                          
  3299  1613  79                A1613:  ld      a,c
  3300  1614  0f                        rrca
  3301  1615  3ef0                      ld      a,$F0
  3302  1617  3002                      jr      nc,A161B
  3303  1619  3e0f                      ld      a,$0F
  3304  161b  322cf9            A161B:  ld      (CMASK),a
  3305  161e  79                        ld      a,c
  3306  161f  87                        add     a,a
  3307  1620  87                        add     a,a
  3308  1621  e6f8                      and     $F8
  3309  1623  4f                        ld      c,a
  3310  1624  7b                        ld      a,e
  3311  1625  e607                      and     $07
  3312  1627  b1                        or      c
  3313  1628  4f                        ld      c,a
  3314  1629  7b                        ld      a,e
  3315  162a  0f                        rrca
  3316  162b  0f                        rrca
  3317  162c  0f                        rrca
  3318  162d  e607                      and     $07
  3319  162f  47                        ld      b,a
  3320  1630  2a0000                    ld      hl,(MLTCGP)
  3321  1633  09                        add     hl,bc
  3322  1634  222af9                    ld      (CLOC),hl
  3323  1637  c1                        pop     bc
  3324  1638  c9                        ret
  3325                          ;
  3326  1639  3a2cf9            A1639:  ld      a,(CMASK)
  3327  163c  2a2af9                    ld      hl,(CLOC)
  3328  163f  c9                        ret
  3329                          ;
  3330  1640  322cf9            A1640:  ld      (CMASK),a
  3331  1643  222af9                    ld      (CLOC),hl
  3332  1646  c9                        ret
  3333                          ;
  3334  1647  c5                A1647:  push    bc
  3335  1648  e5                        push    hl
  3336  1649  cd3916                    call    A1639
  3337  164c  47                        ld      b,a
  3338  164d  cdd915                    call    A15D9
  3339  1650  201a                      jr      nz,A166C
  3340  1652  cdd707                    call    A07D7
  3341  1655  a0                        and     b
  3342  1656  f5                        push    af
  3343  1657  010020                    ld      bc,$2000
  3344  165a  09                        add     hl,bc
  3345  165b  cdd707                    call    A07D7
  3346  165e  47                        ld      b,a
  3347  165f  f1                        pop     af
  3348  1660  78                        ld      a,b
  3349  1661  2804                      jr      z,A1667
  3350  1663  0f                A1663:  rrca
  3351  1664  0f                        rrca
  3352  1665  0f                        rrca
  3353  1666  0f                        rrca
  3354  1667  e60f              A1667:  and     $0F
  3355  1669  e1                        pop     hl
  3356  166a  c1                        pop     bc
  3357  166b  c9                        ret
  3358                          ;
  3359  166c  cdd707            A166C:  call    A07D7
  3360  166f  04                        inc     b
  3361  1670  05                        dec     b
  3362  1671  f26716                    jp      p,A1667
  3363  1674  18ed                      jr      A1663
  3364                          ;
  3365  1676  fe10              A1676:  cp      $10
  3366  1678  3f                        ccf
  3367  1679  d8                        ret     c
  3368  167a  320000                    ld      (ATRBYT),a
  3369  167d  c9                        ret
  3370                          ;
  3371  167e  e5                A167E:  push    hl
  3372  167f  c5                        push    bc
  3373  1680  cdd915                    call    A15D9
  3374  1683  cd3916                    call    A1639
  3375  1686  2008                      jr      nz,A1690
  3376  1688  d5                        push    de
  3377  1689  cd6c18                    call    A186C
  3378  168c  d1                        pop     de
  3379  168d  c1                        pop     bc
  3380  168e  e1                        pop     hl
  3381  168f  c9                        ret
  3382                          ;
  3383  1690  47                A1690:  ld      b,a
  3384  1691  cdd707                    call    A07D7
  3385  1694  4f                        ld      c,a
  3386  1695  78                        ld      a,b
  3387  1696  2f                        cpl
  3388  1697  a1                        and     c
  3389  1698  4f                        ld      c,a
  3390  1699  3a0000                    ld      a,(ATRBYT)
  3391  169c  04                        inc     b
  3392  169d  05                        dec     b
  3393  169e  f2a516                    jp      p,A16A5
  3394  16a1  87                        add     a,a
  3395  16a2  87                        add     a,a
  3396  16a3  87                        add     a,a
  3397  16a4  87                        add     a,a
  3398  16a5  b1                A16A5:  or      c
  3399  16a6  cdcd07                    call    A07CD
  3400  16a9  c1                        pop     bc
  3401  16aa  e1                        pop     hl
  3402  16ab  c9                        ret
  3403                          ;
  3404  16ac  e5                A16AC:  push    hl
  3405  16ad  cdd915                    call    A15D9
  3406  16b0  c27917                    jp      nz,A1779
  3407  16b3  cd3916                    call    A1639
  3408  16b6  0f                        rrca
  3409  16b7  304b                      jr      nc,A1704
  3410  16b9  7d                        ld      a,l
  3411  16ba  e6f8                      and     $F8
  3412  16bc  fef8                      cp      $F8
  3413  16be  3e80                      ld      a,$80
  3414  16c0  2010                      jr      nz,A16D2
  3415  16c2  c35a17                    jp      A175A
  3416                          ;
  3417  16c5  e5                A16C5:  push    hl
  3418  16c6  cdd915                    call    A15D9
  3419  16c9  c28b17                    jp      nz,A178B
  3420  16cc  cd3916                    call    A1639
  3421  16cf  0f                        rrca
  3422  16d0  3032                      jr      nc,A1704
  3423  16d2  d5                A16D2:  push    de
  3424  16d3  110800                    ld      de,8
  3425  16d6  1827                      jr      A16FF
  3426                          ;
  3427  16d8  e5                A16D8:  push    hl
  3428  16d9  cdd915                    call    A15D9
  3429  16dc  c29c17                    jp      nz,A179C
  3430  16df  cd3916                    call    A1639
  3431  16e2  07                        rlca
  3432  16e3  301f                      jr      nc,A1704
  3433  16e5  7d                        ld      a,l
  3434  16e6  e6f8                      and     $F8
  3435  16e8  3e01                      ld      a,$01
  3436  16ea  200f                      jr      nz,A16FB
  3437  16ec  186c                      jr      A175A
  3438                          ;
  3439  16ee  e5                A16EE:  push    hl
  3440  16ef  cdd915                    call    A15D9
  3441  16f2  c2ac17                    jp      nz,A17AC
  3442  16f5  cd3916                    call    A1639
  3443  16f8  07                        rlca
  3444  16f9  3009                      jr      nc,A1704
  3445  16fb  d5                A16FB:  push    de
  3446  16fc  11f8ff                    ld      de,-8
  3447  16ff  19                A16FF:  add     hl,de
  3448  1700  222af9                    ld      (CLOC),hl
  3449  1703  d1                        pop     de
  3450  1704  322cf9            A1704:  ld      (CMASK),a
  3451  1707  a7                        and     a
  3452  1708  e1                        pop     hl
  3453  1709  c9                        ret
  3454                          ;
  3455  170a  e5                A170A:  push    hl
  3456  170b  d5                        push    de
  3457  170c  2a2af9                    ld      hl,(CLOC)
  3458  170f  cdd915                    call    A15D9
  3459  1712  c2c617                    jp      nz,A17C6
  3460  1715  e5                        push    hl
  3461  1716  2a0000                    ld      hl,(GRPCGP)
  3462  1719  110017                    ld      de,256*24-256
  3463  171c  19                        add     hl,de
  3464  171d  eb                        ex      de,hl
  3465  171e  e1                        pop     hl
  3466  171f  e7                        rst     DCOMPR
  3467  1720  3813                      jr      c,A1735
  3468  1722  7d                        ld      a,l
  3469  1723  3c                        inc     a
  3470  1724  e607                      and     $07
  3471  1726  200d                      jr      nz,A1735
  3472  1728  182f                      jr      A1759
  3473                          ;
  3474  172a  e5                A172A:  push    hl
  3475  172b  d5                        push    de
  3476  172c  2a2af9                    ld      hl,(CLOC)
  3477  172f  cdd915                    call    A15D9
  3478  1732  c2dc17                    jp      nz,A17DC
  3479  1735  23                A1735:  inc     hl
  3480  1736  7d                        ld      a,l
  3481  1737  11f800                    ld      de,248
  3482  173a  1831                      jr      A176D
  3483                          ;
  3484  173c  e5                A173C:  push    hl
  3485  173d  d5                        push    de
  3486  173e  2a2af9                    ld      hl,(CLOC)
  3487  1741  cdd915                    call    A15D9
  3488  1744  c2e317                    jp      nz,A17E3
  3489  1747  e5                        push    hl
  3490  1748  2a0000                    ld      hl,(GRPCGP)
  3491  174b  110001                    ld      de,256
  3492  174e  19                        add     hl,de
  3493  174f  eb                        ex      de,hl
  3494  1750  e1                        pop     hl
  3495  1751  e7                        rst     DCOMPR
  3496  1752  3014                      jr      nc,A1768
  3497  1754  7d                        ld      a,l
  3498  1755  e607                      and     $07
  3499  1757  200f                      jr      nz,A1768
  3500  1759  d1                A1759:  pop     de
  3501  175a  37                A175A:  scf
  3502  175b  e1                        pop     hl
  3503  175c  c9                        ret
  3504                          ;
  3505  175d  e5                A175D:  push    hl
  3506  175e  d5                        push    de
  3507  175f  2a2af9                    ld      hl,(CLOC)
  3508  1762  cdd915                    call    A15D9
  3509  1765  c2f817                    jp      nz,A17F8
  3510  1768  7d                A1768:  ld      a,l
  3511  1769  2b                        dec     hl
  3512  176a  1108ff                    ld      de,-248
  3513  176d  e607              A176D:  and     $07
  3514  176f  2001                      jr      nz,A1772
  3515  1771  19                        add     hl,de
  3516  1772  222af9            A1772:  ld      (CLOC),hl
  3517  1775  a7                        and     a
  3518  1776  d1                        pop     de
  3519  1777  e1                        pop     hl
  3520  1778  c9                        ret
  3521                          ;
  3522  1779  cd3916            A1779:  call    A1639
  3523  177c  a7                        and     a
  3524  177d  3e0f                      ld      a,$0F
  3525  177f  fac017                    jp      m,A17C0
  3526  1782  7d                        ld      a,l
  3527  1783  e6f8                      and     $F8
  3528  1785  fef8                      cp      $F8
  3529  1787  200b                      jr      nz,A1794
  3530  1789  18cf                      jr      A175A
  3531                          ;
  3532  178b  cd3916            A178B:  call    A1639
  3533  178e  a7                        and     a
  3534  178f  3e0f                      ld      a,$0F
  3535  1791  fac017                    jp      m,A17C0
  3536  1794  d5                A1794:  push    de
  3537  1795  110800                    ld      de,8
  3538  1798  3ef0                      ld      a,$F0
  3539  179a  181f                      jr      A17BB
  3540                          ;
  3541  179c  cd3916            A179C:  call    A1639
  3542  179f  a7                        and     a
  3543  17a0  3ef0                      ld      a,$F0
  3544  17a2  f2c017                    jp      p,A17C0
  3545  17a5  7d                        ld      a,l
  3546  17a6  e6f8                      and     $F8
  3547  17a8  200b                      jr      nz,A17B5
  3548  17aa  18ae                      jr      A175A
  3549                          ;
  3550  17ac  cd3916            A17AC:  call    A1639
  3551  17af  a7                        and     a
  3552  17b0  3ef0                      ld      a,$F0
  3553  17b2  f2c017                    jp      p,A17C0
  3554  17b5  d5                A17B5:  push    de
  3555  17b6  11f8ff                    ld      de,-8
  3556  17b9  3e0f                      ld      a,$0F
  3557  17bb  19                A17BB:  add     hl,de
  3558  17bc  222af9                    ld      (CLOC),hl
  3559  17bf  d1                        pop     de
  3560  17c0  322cf9            A17C0:  ld      (CMASK),a
  3561  17c3  a7                        and     a
  3562  17c4  e1                        pop     hl
  3563  17c5  c9                        ret
  3564                          ;
  3565  17c6  e5                A17C6:  push    hl
  3566  17c7  2a0000                    ld      hl,(MLTCGP)
  3567  17ca  110005                    ld      de,64*24-256
  3568  17cd  19                        add     hl,de
  3569  17ce  e1                        pop     hl
  3570  17cf  e7                        rst     DCOMPR
  3571  17d0  380a                      jr      c,A17DC
  3572  17d2  7d                        ld      a,l
  3573  17d3  3c                        inc     a
  3574  17d4  e607                      and     $07
  3575  17d6  2004                      jr      nz,A17DC
  3576  17d8  37                        scf
  3577  17d9  d1                        pop     de
  3578  17da  e1                        pop     hl
  3579  17db  c9                        ret
  3580                          ;
  3581  17dc  23                A17DC:  inc     hl
  3582  17dd  7d                        ld      a,l
  3583  17de  11f800                    ld      de,248
  3584  17e1  181a                      jr      A17FD
  3585                          ;
  3586  17e3  e5                A17E3:  push    hl
  3587  17e4  2a0000                    ld      hl,(MLTCGP)
  3588  17e7  110001                    ld      de,256
  3589  17ea  19                        add     hl,de
  3590  17eb  e1                        pop     hl
  3591  17ec  e7                        rst     DCOMPR
  3592  17ed  3009                      jr      nc,A17F8
  3593  17ef  7d                        ld      a,l
  3594  17f0  e607                      and     $07
  3595  17f2  2004                      jr      nz,A17F8
  3596  17f4  37                        scf
  3597  17f5  d1                        pop     de
  3598  17f6  e1                        pop     hl
  3599  17f7  c9                        ret
  3600                          ;
  3601  17f8  7d                A17F8:  ld      a,l
  3602  17f9  2b                        dec     hl
  3603  17fa  1108ff                    ld      de,-248
  3604  17fd  e607              A17FD:  and     $07
  3605  17ff  2001                      jr      nz,A1802
  3606  1801  19                        add     hl,de
  3607  1802  222af9            A1802:  ld      (CLOC),hl
  3608  1805  a7                        and     a
  3609  1806  d1                        pop     de
  3610  1807  e1                        pop     hl
  3611  1808  c9                        ret
  3612                          ;
  3613  1809  cdd915            A1809:  call    A15D9
  3614  180c  c2bb18                    jp      nz,A18BB
  3615  180f  e5                        push    hl
  3616  1810  cd3916                    call    A1639
  3617  1813  e3                        ex      (sp),hl
  3618  1814  87                        add     a,a
  3619  1815  3818                      jr      c,A182F
  3620  1817  f5                        push    af
  3621  1818  01ffff                    ld      bc,-1
  3622  181b  0f                        rrca
  3623  181c  09                A181C:  add     hl,bc
  3624  181d  3045                      jr      nc,A1864
  3625  181f  0f                        rrca
  3626  1820  30fa                      jr      nc,A181C
  3627  1822  f1                        pop     af
  3628  1823  3d                        dec     a
  3629  1824  e3                        ex      (sp),hl
  3630  1825  e5                        push    hl
  3631  1826  cd6c18                    call    A186C
  3632  1829  e1                        pop     hl
  3633  182a  110800                    ld      de,8
  3634  182d  19                        add     hl,de
  3635  182e  e3                        ex      (sp),hl
  3636  182f  7d                A182F:  ld      a,l
  3637  1830  e607                      and     $07
  3638  1832  4f                        ld      c,a
  3639  1833  7c                        ld      a,h
  3640  1834  0f                        rrca
  3641  1835  7d                        ld      a,l
  3642  1836  1f                        rra
  3643  1837  0f                        rrca
  3644  1838  0f                        rrca
  3645  1839  e63f                      and     $3F
  3646  183b  e1                        pop     hl
  3647  183c  47                        ld      b,a
  3648  183d  2814                      jr      z,A1853
  3649  183f  af                A183F:  xor     a
  3650  1840  cdcd07                    call    A07CD
  3651  1843  110020                    ld      de,$2000
  3652  1846  19                        add     hl,de
  3653  1847  3a0000                    ld      a,(ATRBYT)
  3654  184a  cdcd07                    call    A07CD
  3655  184d  110820                    ld      de,$2008
  3656  1850  19                        add     hl,de
  3657  1851  10ec                      djnz    A183F
  3658  1853  0d                A1853:  dec     c
  3659  1854  f8                        ret     m
  3660  1855  e5                        push    hl
  3661  1856  215d18                    ld      hl,T185D
  3662  1859  09                        add     hl,bc
  3663  185a  7e                        ld      a,(hl)
  3664  185b  180e                      jr      A186B
  3665                          ;
  3666  185d  80                T185D:  db      10000000b
  3667  185e  c0                        db      11000000b
  3668  185f  e0                        db      11100000b
  3669  1860  f0                        db      11110000b
  3670  1861  f8                        db      11111000b
  3671  1862  fc                        db      11111100b
  3672  1863  fe                        db      11111110b
  3673                          
  3674  1864  87                A1864:  add     a,a
  3675  1865  3d                        dec     a
  3676  1866  2f                        cpl
  3677  1867  47                        ld      b,a
  3678  1868  f1                        pop     af
  3679  1869  3d                        dec     a
  3680  186a  a0                        and     b
  3681  186b  e1                A186B:  pop     hl
  3682  186c  47                A186C:  ld      b,a
  3683  186d  cdd707                    call    A07D7
  3684  1870  4f                        ld      c,a
  3685  1871  110020                    ld      de,$2000
  3686  1874  19                        add     hl,de
  3687  1875  cdd707                    call    A07D7
  3688  1878  f5                        push    af
  3689  1879  e60f                      and     $0F
  3690  187b  5f                        ld      e,a
  3691  187c  f1                        pop     af
  3692  187d  93                        sub     e
  3693  187e  57                        ld      d,a
  3694  187f  3a0000                    ld      a,(ATRBYT)
  3695  1882  bb                        cp      e
  3696  1883  2819                      jr      z,A189E
  3697  1885  87                        add     a,a
  3698  1886  87                        add     a,a
  3699  1887  87                        add     a,a
  3700  1888  87                        add     a,a
  3701  1889  ba                        cp      d
  3702  188a  2816                      jr      z,A18A2
  3703  188c  f5                        push    af
  3704  188d  78                        ld      a,b
  3705  188e  b1                        or      c
  3706  188f  feff                      cp      $FF
  3707  1891  2817                      jr      z,A18AA
  3708  1893  e5                        push    hl
  3709  1894  d5                        push    de
  3710  1895  cda218                    call    A18A2
  3711  1898  d1                        pop     de
  3712  1899  e1                        pop     hl
  3713  189a  f1                        pop     af
  3714  189b  b3                        or      e
  3715  189c  181a                      jr      A18B8
  3716                          ;
  3717  189e  78                A189E:  ld      a,b
  3718  189f  2f                        cpl
  3719  18a0  a1                        and     c
  3720  18a1  11                        db      $11
  3721  18a2  78                A18A2:  ld      a,b
  3722  18a3  b1                        or      c
  3723  18a4  110020            A18A4:  ld      de,$2000
  3724  18a7  19                        add     hl,de
  3725  18a8  180e                      jr      A18B8
  3726                          ;
  3727  18aa  f1                A18AA:  pop     af
  3728  18ab  78                        ld      a,b
  3729  18ac  2f                        cpl
  3730  18ad  e5                        push    hl
  3731  18ae  d5                        push    de
  3732  18af  cda418                    call    A18A4
  3733  18b2  d1                        pop     de
  3734  18b3  e1                        pop     hl
  3735  18b4  3a0000                    ld      a,(ATRBYT)
  3736  18b7  b2                        or      d
  3737  18b8  c3cd07            A18B8:  jp      A07CD
  3738                          ;
  3739  18bb  e5                A18BB:  push    hl
  3740  18bc  cd7e16                    call    A167E
  3741  18bf  cdc516                    call    A16C5
  3742  18c2  e1                        pop     hl
  3743  18c3  2d                        dec     l
  3744  18c4  20f5                      jr      nz,A18BB
  3745  18c6  c9                        ret
  3746                          ;
  3747  18c7  2a0000            A18C7:  ld      hl,(ASPCT1)
  3748  18ca  eb                        ex      de,hl
  3749  18cb  2a0000                    ld      hl,(ASPCT2)
  3750  18ce  c9                        ret
  3751                          ;
  3752  18cf  f5                A18CF:  push    af
  3753  18d0  cdd915                    call    A15D9
  3754  18d3  2806                      jr      z,A18DB
  3755  18d5  f1                        pop     af
  3756  18d6  fe10                      cp      $10
  3757  18d8  3f                        ccf
  3758  18d9  1805                      jr      A18E0
  3759                          ;
  3760  18db  f1                A18DB:  pop     af
  3761  18dc  3a0000                    ld      a,(ATRBYT)
  3762  18df  a7                        and     a
  3763  18e0  32b2fc            A18E0:  ld      (BRDATR),a
  3764  18e3  c9                        ret
  3765                          ;
  3766  18e4  210000            A18E4:  ld      hl,0
  3767  18e7  4d                        ld      c,l
  3768  18e8  cdd915                    call    A15D9                   ; grafic mode ?
  3769  18eb  2064                      jr      nz,A1951                ; nop
  3770  18ed  78                        ld      a,b
  3771  18ee  3266f8                    ld      (FILNAM+0),a
  3772  18f1  af                        xor     a
  3773  18f2  3269f8                    ld      (FILNAM+3),a
  3774  18f5  3ab2fc                    ld      a,(BRDATR)
  3775  18f8  47                        ld      b,a
  3776  18f9  cd4716            A18F9:  call    A1647                   ; get color of pixel
  3777  18fc  b8                        cp      b                       ; is border color ?
  3778  18fd  200d                      jr      nz,A190C                ; nop,
  3779  18ff  1b                        dec     de
  3780  1900  7a                        ld      a,d
  3781  1901  b3                        or      e                       ; skipped all ?
  3782  1902  c8                        ret     z                       ; yep, quit
  3783  1903  cdac16                    call    A16AC                   ; move right
  3784  1906  30f1                      jr      nc,A18F9                ; not out of screen, cont
  3785  1908  110000                    ld      de,0
  3786  190b  c9                        ret
  3787                          ;
  3788  190c  cdae19            A190C:  call    A19AE
  3789  190f  d5                        push    de
  3790  1910  cd3916                    call    A1639                   ; get pixel adres & mask
  3791  1913  2242f9                    ld      (CSAVEA),hl
  3792  1916  3244f9                    ld      (CSAVEM),a              ; save it
  3793  1919  110000                    ld      de,0
  3794  191c  13                A191C:  inc     de
  3795  191d  cdac16                    call    A16AC                   ; move right
  3796  1920  380b                      jr      c,A192D                 ; out of screen,
  3797  1922  cd4716                    call    A1647                   ; get pixel color
  3798  1925  b8                        cp      b                       ; is border color ?
  3799  1926  2805                      jr      z,A192D                 ; yep,
  3800  1928  cdae19                    call    A19AE
  3801  192b  18ef                      jr      A191C
  3802                          ;
  3803  192d  d5                A192D:  push    de
  3804  192e  cd3916                    call    A1639                   ; get pixel adres & mask
  3805  1931  e5                        push    hl
  3806  1932  f5                        push    af                      ; save
  3807  1933  2a42f9                    ld      hl,(CSAVEA)
  3808  1936  3a44f9                    ld      a,(CSAVEM)
  3809  1939  cd4016                    call    A1640                   ; set pixel adres & mask
  3810  193c  eb                        ex      de,hl
  3811  193d  2267f8                    ld      (FILNAM+1),hl
  3812  1940  3a66f8                    ld      a,(FILNAM+0)
  3813  1943  a7                        and     a
  3814  1944  c40918                    call    nz,A1809
  3815  1947  f1                        pop     af
  3816  1948  e1                        pop     hl
  3817  1949  cd4016                    call    A1640
  3818  194c  e1                        pop     hl
  3819  194d  d1                        pop     de
  3820  194e  c3a919                    jp      A19A9
  3821                          ;
  3822  1951  cdc719            A1951:  call    A19C7
  3823  1954  300d                      jr      nc,A1963
  3824  1956  1b                        dec     de
  3825  1957  7a                        ld      a,d
  3826  1958  b3                        or      e
  3827  1959  c8                        ret     z
  3828  195a  cdac16                    call    A16AC
  3829  195d  30f2                      jr      nc,A1951
  3830  195f  110000                    ld      de,0
  3831  1962  c9                        ret
  3832                          ;
  3833  1963  cd3916            A1963:  call    A1639
  3834  1966  2242f9                    ld      (CSAVEA),hl
  3835  1969  3244f9                    ld      (CSAVEM),a
  3836  196c  210000                    ld      hl,0
  3837  196f  23                A196F:  inc     hl
  3838  1970  cdac16                    call    A16AC
  3839  1973  d8                        ret     c
  3840  1974  cdc719                    call    A19C7
  3841  1977  30f6                      jr      nc,A196F
  3842  1979  c9                        ret
  3843                          ;
  3844  197a  210000            A197A:  ld      hl,0
  3845  197d  4d                        ld      c,l
  3846  197e  cdd915                    call    A15D9
  3847  1981  2037                      jr      nz,A19BA
  3848  1983  af                        xor     a
  3849  1984  3269f8                    ld      (FILNAM+3),a
  3850  1987  3ab2fc                    ld      a,(BRDATR)
  3851  198a  47                        ld      b,a
  3852  198b  cdd816            A198B:  call    A16D8
  3853  198e  380f                      jr      c,A199F
  3854  1990  cd4716                    call    A1647
  3855  1993  b8                        cp      b
  3856  1994  2806                      jr      z,A199C
  3857  1996  cdae19                    call    A19AE
  3858  1999  23                        inc     hl
  3859  199a  18ef                      jr      A198B
  3860                          ;
  3861  199c  cdc516            A199C:  call    A16C5
  3862  199f  e5                A199F:  push    hl
  3863  19a0  ed5b67f8                  ld      de,(FILNAM+1)
  3864  19a4  19                        add     hl,de
  3865  19a5  cd0918                    call    A1809
  3866  19a8  e1                        pop     hl
  3867  19a9  3a69f8            A19A9:  ld      a,(FILNAM+3)
  3868  19ac  4f                        ld      c,a
  3869  19ad  c9                        ret
  3870                          ;
  3871  19ae  e5                A19AE:  push    hl
  3872  19af  210000                    ld      hl,ATRBYT
  3873  19b2  be                        cp      (hl)
  3874  19b3  e1                        pop     hl
  3875  19b4  c8                        ret     z
  3876  19b5  3c                        inc     a
  3877  19b6  3269f8                    ld      (FILNAM+3),a
  3878  19b9  c9                        ret
  3879                          ;
  3880  19ba  cdd816            A19BA:  call    A16D8
  3881  19bd  d8                        ret     c
  3882  19be  cdc719                    call    A19C7
  3883  19c1  dac516                    jp      c,A16C5
  3884  19c4  23                        inc     hl
  3885  19c5  18f3                      jr      A19BA
  3886                          ;
  3887  19c7  cd4716            A19C7:  call    A1647
  3888  19ca  47                        ld      b,a
  3889  19cb  3ab2fc                    ld      a,(BRDATR)
  3890  19ce  90                        sub     b
  3891  19cf  37                        scf
  3892  19d0  c8                        ret     z
  3893  19d1  3a0000                    ld      a,(ATRBYT)
  3894  19d4  b8                        cp      b
  3895  19d5  c8                        ret     z
  3896  19d6  cd7e16                    call    A167E
  3897  19d9  0e01                      ld      c,$01
  3898  19db  a7                        and     a
  3899  19dc  c9                        ret
  3900                          ;
  3901  19dd  c5                A19DD:  push    bc
  3902  19de  f5                        push    af
  3903  19df  010000                    ld      bc,0
  3904  19e2  0b                A19E2:  dec     bc
  3905  19e3  78                        ld      a,b
  3906  19e4  b1                        or      c
  3907  19e5  20fb                      jr      nz,A19E2                ; wait 550 msec
  3908  19e7  f1                        pop     af
  3909  19e8  c1                        pop     bc                      ; cassettemotor off
  3910                          
  3911  19e9  f5                A19E9:  push    af
  3912  19ea  3e09                      ld      a,$09
  3913                          ;        out     ($AB),a
  3914  19ec  00                	nop
  3915  19ed  00                	nop
  3916  19ee  f1                        pop     af
  3917  19ef  fb                        ei
  3918  19f0  c9                        ret
  3919                          ;
  3920  19f1  b7                A19F1:  or      a
  3921  19f2  f5                        push    af                      ; flag for headerlength
  3922  19f3  3e08                      ld      a,$08
  3923                          ;        out     ($AB),a                ; cassettemotor on
  3924  19f5  00                	nop
  3925  19f6  00                	nop
  3926  19f7  210000                    ld      hl,0
  3927  19fa  2b                A19FA:  dec     hl
  3928  19fb  7c                        ld      a,h
  3929  19fc  b5                        or      l
  3930  19fd  20fb                      jr      nz,A19FA                ; wait 550 msec
  3931  19ff  f1                        pop     af
  3932  1a00  3a0af4                    ld      a,(HEADER)              ; headerlength
  3933  1a03  2802                      jr      z,A1A07                 ; short header
  3934  1a05  87                        add     a,a
  3935  1a06  87                        add     a,a                     ; *4 for long header
  3936  1a07  47                A1A07:  ld      b,a
  3937  1a08  0e00                      ld      c,$00                  ; *256 = # of cycli
  3938  1a0a  f3                        di
  3939  1a0b  cd4d1a            A1A0B:  call    A1A4D                   ; high cycle
  3940  1a0e  cd3f1a                    call    A1A3F                   ; wait
  3941  1a11  0b                        dec     bc
  3942  1a12  78                        ld      a,b
  3943  1a13  b1                        or      c
  3944  1a14  20f5                      jr      nz,A1A0B                ; next cyclus
  3945  1a16  c36f04                    jp      A046F                   ; quit with BREAKX
  3946                          ;
  3947  1a19  2a06f4            A1A19:  ld      hl,(LOW_)               ; size of low cycle
  3948  1a1c  f5                        push    af
  3949  1a1d  7d                        ld      a,l
  3950  1a1e  d60e                      sub     $0E
  3951  1a20  6f                        ld      l,a                     ; 14 units shorter
  3952  1a21  cd501a                    call    A1A50                   ; low cycle (start bit)
  3953  1a24  f1                        pop     af
  3954  1a25  0608                      ld      b,8                     ; 8 bits data
  3955  1a27  0f                A1A27:  rrca
  3956  1a28  dc401a                    call    c,A1A40                 ; 1, write mark
  3957  1a2b  d4391a                    call    nc,A1A39                ; 0, write space
  3958  1a2e  10f7                      djnz    A1A27                   ; next bit
  3959  1a30  cd401a                    call    A1A40
  3960  1a33  cd401a                    call    A1A40                   ; write 2 marks (stopbits)
  3961  1a36  c36f04                    jp      A046F                   ; quit with BREAKX
  3962                          ;
  3963  1a39  2a06f4            A1A39:  ld      hl,(LOW_)               ; low cycle size
  3964  1a3c  cd501a                    call    A1A50                   ; write low cycle
  3965  1a3f  c9                A1A3F:  ret
  3966                          ;
  3967  1a40  cd4d1a            A1A40:  call    A1A4D                   ; write high cycle
  3968  1a43  e3                        ex      (sp),hl
  3969  1a44  e3                        ex      (sp),hl
  3970  1a45  00                        nop
  3971  1a46  00                        nop
  3972  1a47  00                        nop
  3973  1a48  00                        nop                             ; wait
  3974  1a49  cd4d1a                    call    A1A4D                   ; write high cycle
  3975  1a4c  c9                        ret
  3976                          ;
  3977  1a4d  2a08f4            A1A4D:  ld      hl,(HIGH_)              ; length of high cycle
  3978  1a50  f5                A1A50:  push    af
  3979  1a51  2d                A1A51:  dec     l
  3980  1a52  c2511a                    jp      nz,A1A51                ; wait low part
  3981  1a55  3e0b                      ld      a,$0B
  3982                          ;        out     ($AB),a                ; high
  3983  1a57  00                	nop
  3984  1a58  00                	nop
  3985  1a59  25                A1A59:  dec     h
  3986  1a5a  c2591a                    jp      nz,A1A59                ; wait high part
  3987  1a5d  3e0a                      ld      a,$0A
  3988                          ;        out     ($AB),a                ; low
  3989  1a5f  00                	nop
  3990  1a60  00                	nop
  3991  1a61  f1                        pop     af
  3992  1a62  c9                        ret
  3993                          ;
  3994  1a63  3e08              A1A63:  ld      a,$08
  3995                          ;        out     ($AB),a                ; cassettemotor on
  3996  1a65  00                	nop
  3997  1a66  00                	nop
  3998  1a67  f3                        di
  3999  1a68  3e0e                      ld      a,$0E
  4000  1a6a  d3a0                      out     (PSGCTL),a                ; select register 14 of PSG
  4001  1a6c  215704            A1A6C:  ld      hl,1111
  4002  1a6f  51                A1A6F:  ld      d,c
  4003  1a70  cd341b                    call    A1B34                   ; count length of cycle
  4004  1a73  d8                        ret     c                       ; break, quit
  4005  1a74  79                        ld      a,c
  4006  1a75  fede                      cp      222
  4007  1a77  30f3                      jr      nc,A1A6C                ; illegal, start again
  4008  1a79  fe05                      cp      4+1
  4009  1a7b  38ef                      jr      c,A1A6C                 ; illegal, start again
  4010  1a7d  92                        sub     d                       ; compare with previous cycle
  4011  1a7e  3002                      jr      nc,A1A82
  4012  1a80  2f                        cpl
  4013  1a81  3c                        inc     a
  4014  1a82  fe04              A1A82:  cp      4                       ; difer less then 35 sec ?
  4015  1a84  30e6                      jr      nc,A1A6C                ; nop, start again
  4016  1a86  2b                        dec     hl
  4017  1a87  7c                        ld      a,h
  4018  1a88  b5                        or      l                       ; all 1111 cycles tollerant ?
  4019  1a89  20e4                      jr      nz,A1A6F                ; nop, cont
  4020  1a8b  210000                    ld      hl,0
  4021  1a8e  45                        ld      b,l
  4022  1a8f  55                        ld      d,l                     ; 256
  4023  1a90  cd341b            A1A90:  call    A1B34                   ; count length of cycle
  4024  1a93  d8                        ret     c                       ; break, quit
  4025  1a94  09                        add     hl,bc                   ; add to total
  4026  1a95  15                        dec     d
  4027  1a96  c2901a                    jp      nz,A1A90                ; next cycle
  4028  1a99  01ae06                    ld      bc,1710
  4029  1a9c  09                        add     hl,bc                   ; add extra for calc
  4030  1a9d  7c                        ld      a,h
  4031  1a9e  1f                        rra
  4032  1a9f  e67f                      and     $7F
  4033  1aa1  57                        ld      d,a                     ; /2
  4034  1aa2  29                        add     hl,hl                   ; *2
  4035  1aa3  7c                        ld      a,h
  4036  1aa4  92                        sub     d                       ; = 1.5*
  4037  1aa5  57                        ld      d,a
  4038  1aa6  d606                      sub     6                       ; - extra
  4039  1aa8  32a4fc                    ld      (LOWLIM),a              ; min. size of startbit
  4040  1aab  7a                        ld      a,d
  4041  1aac  87                        add     a,a
  4042  1aad  0600                      ld      b,$00
  4043  1aaf  d603              A1AAF:  sub     3
  4044  1ab1  04                        inc     b
  4045  1ab2  30fb                      jr      nc,A1AAF
  4046  1ab4  78                        ld      a,b
  4047  1ab5  d603                      sub     3
  4048  1ab7  32a5fc                    ld      (WINWID),a
  4049  1aba  b7                        or      a
  4050  1abb  c9                        ret
  4051                          ;
  4052  1abc  3aa4fc            A1ABC:  ld      a,(LOWLIM)
  4053  1abf  57                        ld      d,a                     ; min. size of startbit
  4054  1ac0  cd6f04            A1AC0:  call    A046F                   ; BREAKX
  4055  1ac3  d8                        ret     c                       ; break, quit
  4056  1ac4  dba2                      in      a,(PSGRIN)
  4057  1ac6  07                        rlca
  4058  1ac7  30f7                      jr      nc,A1AC0                ; wait for high
  4059  1ac9  cd6f04            A1AC9:  call    A046F                   ; BREAKX
  4060  1acc  d8                        ret     c                       ; break, quit
  4061  1acd  dba2                      in      a,(PSGRIN)
  4062  1acf  07                        rlca
  4063  1ad0  38f7                      jr      c,A1AC9                 ; wait for low
  4064  1ad2  1e00                      ld      e,$00
  4065  1ad4  cd1f1b                    call    A1B1F                   ; count length of cycle
  4066  1ad7  41                A1AD7:  ld      b,c
  4067  1ad8  cd1f1b                    call    A1B1F                   ; count length of cycle
  4068  1adb  d8                        ret     c                       ; break, quit
  4069  1adc  78                        ld      a,b
  4070  1add  81                        add     a,c                     ; size of two cycles
  4071  1ade  dad71a                    jp      c,A1AD7                 ; illegal, try again
  4072  1ae1  ba                        cp      d                       ; > as LOWLIM ?
  4073  1ae2  38f3                      jr      c,A1AD7                 ; nop, try again
  4074  1ae4  2e08                      ld      l,8                     ; 8 bits
  4075  1ae6  cd031b            A1AE6:  call    A1B03                   ; count transitions
  4076  1ae9  fe04                      cp      4
  4077  1aeb  3f                        ccf
  4078  1aec  d8                        ret     c                       ; illegal, quit
  4079  1aed  fe02                      cp      2
  4080  1aef  3f                        ccf                             ; databit
  4081  1af0  cb1a                      rr      d
  4082  1af2  79                        ld      a,c
  4083  1af3  0f                        rrca                            ; even transitions ?
  4084  1af4  d4231b                    call    nc,A1B23                ; yep, skip 1 transitions
  4085  1af7  cd1f1b                    call    A1B1F                   ; skip 1 transitions
  4086  1afa  2d                        dec     l
  4087  1afb  c2e61a                    jp      nz,A1AE6                ; next bit
  4088  1afe  cd6f04                    call    A046F                   ; BREAKX
  4089  1b01  7a                        ld      a,d
  4090  1b02  c9                        ret
  4091                          ;
  4092  1b03  3aa5fc            A1B03:  ld      a,(WINWID)
  4093  1b06  47                        ld      b,a
  4094  1b07  0e00                      ld      c,$00
  4095  1b09  dba2              A1B09:  in      a,(PSGRIN)
  4096  1b0b  ab                        xor     e
  4097  1b0c  f2171b                    jp      p,A1B17
  4098  1b0f  7b                        ld      a,e
  4099  1b10  2f                        cpl
  4100  1b11  5f                        ld      e,a
  4101  1b12  0c                        inc     c
  4102  1b13  10f4                      djnz    A1B09
  4103  1b15  79                        ld      a,c
  4104  1b16  c9                        ret
  4105                          ;
  4106  1b17  00                A1B17:  nop
  4107  1b18  00                        nop
  4108  1b19  00                        nop
  4109  1b1a  00                        nop
  4110  1b1b  10ec              A1B1B:  djnz    A1B09
  4111  1b1d  79                        ld      a,c
  4112  1b1e  c9                        ret
  4113                          ;
  4114  1b1f  cd6f04            A1B1F:  call    A046F
  4115  1b22  d8                        ret     c
  4116  1b23  0e00              A1B23:  ld      c,$00
  4117  1b25  0c                A1B25:  inc     c
  4118  1b26  280a                      jr      z,A1B32
  4119  1b28  dba2                      in      a,(PSGRIN)
  4120  1b2a  ab                        xor     e
  4121  1b2b  f2251b                    jp      p,A1B25
  4122  1b2e  7b                        ld      a,e
  4123  1b2f  2f                        cpl
  4124  1b30  5f                        ld      e,a
  4125  1b31  c9                        ret
  4126                          ;
  4127  1b32  0d                A1B32:  dec     c
  4128  1b33  c9                        ret
  4129                          ;
  4130  1b34  cd6f04            A1B34:  call    A046F                   ; BREAKX
  4131  1b37  d8                        ret     c                       ; break, quit
  4132  1b38  dba2                      in      a,(PSGRIN)
  4133  1b3a  07                        rlca
  4134  1b3b  38f7                      jr      c,A1B34                 ; wait until casinput = 0
  4135  1b3d  1e00                      ld      e,$00
  4136  1b3f  cd231b                    call    A1B23                   ; count to high input
  4137  1b42  c3251b                    jp      A1B25                   ; add count to low input
  4138                          ;
  4139  1b45  f5                A1B45:  push    af
  4140  1b46  cde4fe                    call    H_OUTD
  4141  1b49  cd5f14                    call    A145F                   ; is file output ?
  4142  1b4c  2808                      jr      z,A1B56                 ; nop,
  4143  1b4e  f1                        pop     af
  4144  1b4f  dd210000                  ld      ix,C6C48                ; seq. output
  4145  1b53  c3ff01                    jp      A01FF                   ; with CALBAS
  4146                          ;
  4147  1b56  3a16f4            A1B56:  ld      a,(PRTFLG)
  4148  1b59  b7                        or      a                       ; output to printer ?
  4149  1b5a  285f                      jr      z,A1BBB                 ; nop
  4150  1b5c  3a18f4                    ld      a,(RAWPRT)
  4151  1b5f  a7                        and     a                       ; data raw to printer ?
  4152  1b60  2049                      jr      nz,A1BAB                ; yep, to printer
  4153  1b62  f1                        pop     af
  4154  1b63  f5                A1B63:  push    af
  4155  1b64  fe09                      cp      $09                    ; tab ?
  4156  1b66  200e                      jr      nz,A1B76                ; nop
  4157  1b68  3e20              A1B68:  ld      a,$20
  4158  1b6a  cd631b                    call    A1B63
  4159  1b6d  3a15f4                    ld      a,(LPTPOS)
  4160  1b70  e607                      and     $07
  4161  1b72  20f4                      jr      nz,A1B68                ; print spaces
  4162  1b74  f1                        pop     af
  4163  1b75  c9                        ret
  4164                          ;
  4165  1b76  d60d              A1B76:  sub     $0D
  4166  1b78  280a                      jr      z,A1B84                 ; cr, LPTPOS = 0
  4167  1b7a  380b                      jr      c,A1B87
  4168  1b7c  fe13                      cp      $13
  4169  1b7e  3807                      jr      c,A1B87                 ; control char, don't increase
  4170  1b80  3a15f4                    ld      a,(LPTPOS)
  4171  1b83  3c                        inc     a                       ; increase LPTPOS
  4172  1b84  3215f4            A1B84:  ld      (LPTPOS),a
  4173                          
  4174                          ;
  4175                          LPTCH0:
  4176  1b87  3a17f4            A1B87:  ld      a,(NTMSXP)
  4177  1b8a  a7                        and     a                       ; MSX printer ?
  4178  1b8b  281e                      jr      z,A1BAB                 ; yep, to printer
  4179  1b8d  f1                        pop     af
  4180  1b8e  cd9d08                    call    A089D                   ; is grafic header ?
  4181  1b91  d0                        ret     nc                      ; header, quit
  4182  1b92  2023                      jr      nz,J1BB7                ; grafic char, print space
  4183                          
  4184                          ; At this point, in address $1B94, you can find different code depending on the language version.
  4185                          ; In some versions, LPTCH0 continues with language-custom code. In others, it is terminated by
  4186                          ; jumping to LPTCHR below and the remaining space is used to allocate tables and code from basekey
  4187                          ; modules.
  4188                          ;
  4189                          ; This language-specific section is placed in basekey extension files accordingly.
  4190                          
  4191                                  IF      KEYTYP = 0
  4192                                  INCLUDE "keyjap_ext.asm"
  4193                                  ENDIF
  4194                          
  4195                                  ; International or Spanish
  4196                                  IF      KEYTYP = 1 || KEYTYP = 6
  4197                                  INCLUDE "keyint_ext.asm"
../basekey/keyint_ext.asm:
     1                          ; This code is assembled at address $1B94. It is the continuation of the LPTCH0 subroutine.
     2                          ; This continuation varies depending on the language. In some cases, after this continuation
     3                          ; ends, another language-specific code fragment is added.
     4                          
     5                          ; The code of LPTCH0 is interrupted here.
     6                          ; This ignores the katakama to hiragana mapping code from JAP version, directly jumping to LPTCHR below.
     7  1b94  1816                      JR      LPTCHR
     8                          
     9                          ;       Table           scancode table
    10                          ;       Remark          last scancode+1,low byte execution address
    11                          
    12                          KYJTAB:
    13  1b96  3083              I1B96:  DEFB    $30, $00FF & C0F83 ; scancodes $00-$2F
    14  1b98  330f                      DEFB    $33, $00FF & C0F10 ; SHIFT,CTRL,GRAPH
    15  1b9a  3436                      DEFB    $34, $00FF & C0F36 ; CAPS
    16  1b9c  350f                      DEFB    $35, $00FF & C0F10 ; CODE
    17  1b9e  3ac3                      DEFB    $3A, $00FF & C0FC3 ; F1,F2,F3,F4,F5
    18  1ba0  3c0f                      DEFB    $3C, $00FF & C0F10 ; ESC,TAB
    19  1ba2  3d46                      DEFB    $3D, $00FF & C0F46 ; STOP
    20  1ba4  410f                      DEFB    $41, $00FF & C0F10 ; BS,SELECT,RETURN,SPACE
    21  1ba6  4205                      DEFB    $42, $00FF & C0F06 ; HOME
    22  1ba8  ff0f                      DEFB    $FF, $00FF & C0F10 ; ins,del,left,up,down,right, numeric pad
    23                          
    24                          
bios.asm:
  4198                                  ENDIF
  4199                          
  4200                                  ; French
  4201                                  IF      KEYTYP = 2
  4202                                  INCLUDE "keyfr_ext.asm"
  4203                                  ENDIF
  4204                          
  4205                                  ; British
  4206                                  IF      KEYTYP = 3
  4207                                  INCLUDE "keyuk_ext.asm"
  4208                                  ENDIF
  4209                          
  4210                                  ; German
  4211                                  IF      KEYTYP = 4
  4212                                  INCLUDE "keyger_ext.asm"
  4213                                  ENDIF
  4214                          
  4215                                  ; German
  4216                                  IF      KEYTYP = 5
  4217                                  INCLUDE "keyrus_ext.asm"
  4218                                  ENDIF
  4219                          
  4220                          ; Pad to $1BAB
  4221  1baa  00                        DEFS    $1BAB - ASMPC
  4222                          
  4223  1bab  f1                A1BAB:  pop     af
  4224                          
  4225                          ;
  4226                          LPTCHR:
  4227  1bac  cd5d08            J1BAC:  call    A085D                   ; to printer
  4228  1baf  d0                        ret     nc                      ; no break, quit
  4229  1bb0  dd210000                  ld      ix,J73B2                ; Device I/O error
  4230  1bb4  c3ff01                    jp      A01FF                   ; via CALBAS
  4231                          ;
  4232  1bb7  3e20              J1BB7:  ld      a,$20
  4233  1bb9  18f1                      jr      J1BAC
  4234                          ;
  4235  1bbb  f1                A1BBB:  pop     af
  4236  1bbc  c3bc08                    jp      A08BC
  4237                          
  4238                          T1BBF:
  4239                          
  4240                          
  4241                                  IF      CNTRY = 9
  4242                          
  4243                                  INCLUDE "chrkor.asm"
  4244                          
  4245                                  ENDIF
  4246                          
  4247                          
  4248                                  IF      CNTRY = 0
  4249                          
  4250                                  INCLUDE "chrjapv2.asm"
  4251                          
  4252                                  ENDIF
  4253                          
  4254                          
  4255                                  IF      CNTRY = 10
  4256                          
  4257                                  INCLUDE "chrrus.asm"
  4258                          
  4259                                  ENDIF
  4260                          
  4261                          
  4262                                  IF      CNTRY = 5
  4263                          
  4264                                  INCLUDE "chrger.asm"
  4265                          
  4266                                  ENDIF
  4267                          
  4268                          
  4269                                  IF      (CNTRY <> 9) & (CNTRY <> 0) & (CNTRY <> 10) & (CNTRY <> 5)
  4270                          
  4271                                  INCLUDE "chrint.asm"
../basechr/chrint.asm:
     1  1bbf  0000000000000000          DEFB    $00,$00,$00,$00,$00,$00,$00,$00
     2  1bc7  3c42a581a599423c          DEFB    $3C,$42,$A5,$81,$A5,$99,$42,$3C
     3  1bcf  3c7edbffffdb663c          DEFB    $3C,$7E,$DB,$FF,$FF,$DB,$66,$3C
     4  1bd7  6cfefefe7c381000          DEFB    $6C,$FE,$FE,$FE,$7C,$38,$10,$00
     5  1bdf  10387cfe7c381000          DEFB    $10,$38,$7C,$FE,$7C,$38,$10,$00
     6  1be7  103854fe54103800          DEFB    $10,$38,$54,$FE,$54,$10,$38,$00
     7  1bef  10387cfefe103800          DEFB    $10,$38,$7C,$FE,$FE,$10,$38,$00
     8  1bf7  0000003030000000          DEFB    $00,$00,$00,$30,$30,$00,$00,$00
     9  1bff  ffffffe7e7ffffff          DEFB    $FF,$FF,$FF,$E7,$E7,$FF,$FF,$FF
    10  1c07  3844828282443800          DEFB    $38,$44,$82,$82,$82,$44,$38,$00
    11  1c0f  c7bb7d7d7dbbc7ff          DEFB    $C7,$BB,$7D,$7D,$7D,$BB,$C7,$FF
    12  1c17  0f03057988888870          DEFB    $0F,$03,$05,$79,$88,$88,$88,$70
    13  1c1f  3844444438107c10          DEFB    $38,$44,$44,$44,$38,$10,$7C,$10
    14  1c27  302824242820e0c0          DEFB    $30,$28,$24,$24,$28,$20,$E0,$C0
    15  1c2f  3c243c2424e4dc18          DEFB    $3C,$24,$3C,$24,$24,$E4,$DC,$18
    16  1c37  105438ee38541000          DEFB    $10,$54,$38,$EE,$38,$54,$10,$00
    17  1c3f  1010107c10101010          DEFB    $10,$10,$10,$7C,$10,$10,$10,$10
    18  1c47  101010ff00000000          DEFB    $10,$10,$10,$FF,$00,$00,$00,$00
    19  1c4f  000000ff10101010          DEFB    $00,$00,$00,$FF,$10,$10,$10,$10
    20  1c57  101010f010101010          DEFB    $10,$10,$10,$F0,$10,$10,$10,$10
    21  1c5f  1010101f10101010          DEFB    $10,$10,$10,$1F,$10,$10,$10,$10
    22  1c67  101010ff10101010          DEFB    $10,$10,$10,$FF,$10,$10,$10,$10
    23  1c6f  1010101010101010          DEFB    $10,$10,$10,$10,$10,$10,$10,$10
    24  1c77  000000ff00000000          DEFB    $00,$00,$00,$FF,$00,$00,$00,$00
    25  1c7f  0000001f10101010          DEFB    $00,$00,$00,$1F,$10,$10,$10,$10
    26  1c87  000000f010101010          DEFB    $00,$00,$00,$F0,$10,$10,$10,$10
    27  1c8f  1010101f00000000          DEFB    $10,$10,$10,$1F,$00,$00,$00,$00
    28  1c97  101010f000000000          DEFB    $10,$10,$10,$F0,$00,$00,$00,$00
    29  1c9f  8142241818244281          DEFB    $81,$42,$24,$18,$18,$24,$42,$81
    30  1ca7  0102040810204080          DEFB    $01,$02,$04,$08,$10,$20,$40,$80
    31  1caf  8040201008040201          DEFB    $80,$40,$20,$10,$08,$04,$02,$01
    32  1cb7  001010ff10100000          DEFB    $00,$10,$10,$FF,$10,$10,$00,$00
    33  1cbf  0000000000000000          DEFB    $00,$00,$00,$00,$00,$00,$00,$00
    34  1cc7  2020202000002000          DEFB    $20,$20,$20,$20,$00,$00,$20,$00
    35  1ccf  5050500000000000          DEFB    $50,$50,$50,$00,$00,$00,$00,$00
    36  1cd7  5050f850f8505000          DEFB    $50,$50,$F8,$50,$F8,$50,$50,$00
    37  1cdf  2078a07028f02000          DEFB    $20,$78,$A0,$70,$28,$F0,$20,$00
    38  1ce7  c0c8102040981800          DEFB    $C0,$C8,$10,$20,$40,$98,$18,$00
    39  1cef  40a040a890986000          DEFB    $40,$A0,$40,$A8,$90,$98,$60,$00
    40  1cf7  1020400000000000          DEFB    $10,$20,$40,$00,$00,$00,$00,$00
    41  1cff  1020404040201000          DEFB    $10,$20,$40,$40,$40,$20,$10,$00
    42  1d07  4020101010204000          DEFB    $40,$20,$10,$10,$10,$20,$40,$00
    43  1d0f  20a8702070a82000          DEFB    $20,$A8,$70,$20,$70,$A8,$20,$00
    44  1d17  002020f820200000          DEFB    $00,$20,$20,$F8,$20,$20,$00,$00
    45  1d1f  0000000000202040          DEFB    $00,$00,$00,$00,$00,$20,$20,$40
    46  1d27  0000007800000000          DEFB    $00,$00,$00,$78,$00,$00,$00,$00
    47  1d2f  0000000000606000          DEFB    $00,$00,$00,$00,$00,$60,$60,$00
    48  1d37  0000081020408000          DEFB    $00,$00,$08,$10,$20,$40,$80,$00
    49  1d3f  708898a8c8887000          DEFB    $70,$88,$98,$A8,$C8,$88,$70,$00
    50  1d47  2060a0202020f800          DEFB    $20,$60,$A0,$20,$20,$20,$F8,$00
    51  1d4f  708808106080f800          DEFB    $70,$88,$08,$10,$60,$80,$F8,$00
    52  1d57  7088083008887000          DEFB    $70,$88,$08,$30,$08,$88,$70,$00
    53  1d5f  10305090f8101000          DEFB    $10,$30,$50,$90,$F8,$10,$10,$00
    54  1d67  f880e0100810e000          DEFB    $F8,$80,$E0,$10,$08,$10,$E0,$00
    55  1d6f  304080f088887000          DEFB    $30,$40,$80,$F0,$88,$88,$70,$00
    56  1d77  f888102020202000          DEFB    $F8,$88,$10,$20,$20,$20,$20,$00
    57  1d7f  7088887088887000          DEFB    $70,$88,$88,$70,$88,$88,$70,$00
    58  1d87  7088887808106000          DEFB    $70,$88,$88,$78,$08,$10,$60,$00
    59  1d8f  0000200000200000          DEFB    $00,$00,$20,$00,$00,$20,$00,$00
    60  1d97  0000200000202040          DEFB    $00,$00,$20,$00,$00,$20,$20,$40
    61  1d9f  183060c060301800          DEFB    $18,$30,$60,$C0,$60,$30,$18,$00
    62  1da7  0000f800f8000000          DEFB    $00,$00,$F8,$00,$F8,$00,$00,$00
    63  1daf  c06030183060c000          DEFB    $C0,$60,$30,$18,$30,$60,$C0,$00
    64  1db7  7088081020002000          DEFB    $70,$88,$08,$10,$20,$00,$20,$00
    65  1dbf  70880868a8a87000          DEFB    $70,$88,$08,$68,$A8,$A8,$70,$00
    66  1dc7  20508888f8888800          DEFB    $20,$50,$88,$88,$F8,$88,$88,$00
    67  1dcf  f04848704848f000          DEFB    $F0,$48,$48,$70,$48,$48,$F0,$00
    68  1dd7  3048808080483000          DEFB    $30,$48,$80,$80,$80,$48,$30,$00
    69  1ddf  e05048484850e000          DEFB    $E0,$50,$48,$48,$48,$50,$E0,$00
    70  1de7  f88080f08080f800          DEFB    $F8,$80,$80,$F0,$80,$80,$F8,$00
    71  1def  f88080f080808000          DEFB    $F8,$80,$80,$F0,$80,$80,$80,$00
    72  1df7  708880b888887000          DEFB    $70,$88,$80,$B8,$88,$88,$70,$00
    73  1dff  888888f888888800          DEFB    $88,$88,$88,$F8,$88,$88,$88,$00
    74  1e07  7020202020207000          DEFB    $70,$20,$20,$20,$20,$20,$70,$00
    75  1e0f  3810101090906000          DEFB    $38,$10,$10,$10,$90,$90,$60,$00
    76  1e17  8890a0c0a0908800          DEFB    $88,$90,$A0,$C0,$A0,$90,$88,$00
    77  1e1f  808080808080f800          DEFB    $80,$80,$80,$80,$80,$80,$F8,$00
    78  1e27  88d8a8a888888800          DEFB    $88,$D8,$A8,$A8,$88,$88,$88,$00
    79  1e2f  88c8c8a898988800          DEFB    $88,$C8,$C8,$A8,$98,$98,$88,$00
    80  1e37  7088888888887000          DEFB    $70,$88,$88,$88,$88,$88,$70,$00
    81  1e3f  f08888f080808000          DEFB    $F0,$88,$88,$F0,$80,$80,$80,$00
    82  1e47  70888888a8906800          DEFB    $70,$88,$88,$88,$A8,$90,$68,$00
    83  1e4f  f08888f0a0908800          DEFB    $F0,$88,$88,$F0,$A0,$90,$88,$00
    84  1e57  7088807008887000          DEFB    $70,$88,$80,$70,$08,$88,$70,$00
    85  1e5f  f820202020202000          DEFB    $F8,$20,$20,$20,$20,$20,$20,$00
    86  1e67  8888888888887000          DEFB    $88,$88,$88,$88,$88,$88,$70,$00
    87  1e6f  8888888850502000          DEFB    $88,$88,$88,$88,$50,$50,$20,$00
    88  1e77  888888a8a8d88800          DEFB    $88,$88,$88,$A8,$A8,$D8,$88,$00
    89  1e7f  8888502050888800          DEFB    $88,$88,$50,$20,$50,$88,$88,$00
    90  1e87  8888887020202000          DEFB    $88,$88,$88,$70,$20,$20,$20,$00
    91  1e8f  f80810204080f800          DEFB    $F8,$08,$10,$20,$40,$80,$F8,$00
    92  1e97  7040404040407000          DEFB    $70,$40,$40,$40,$40,$40,$70,$00
    93  1e9f  0000804020100800          DEFB    $00,$00,$80,$40,$20,$10,$08,$00
    94  1ea7  7010101010107000          DEFB    $70,$10,$10,$10,$10,$10,$70,$00
    95  1eaf  2050880000000000          DEFB    $20,$50,$88,$00,$00,$00,$00,$00
    96  1eb7  000000000000f800          DEFB    $00,$00,$00,$00,$00,$00,$F8,$00
    97  1ebf  4020100000000000          DEFB    $40,$20,$10,$00,$00,$00,$00,$00
    98  1ec7  0000700878887800          DEFB    $00,$00,$70,$08,$78,$88,$78,$00
    99  1ecf  8080b0c888c8b000          DEFB    $80,$80,$B0,$C8,$88,$C8,$B0,$00
   100  1ed7  0000708880887000          DEFB    $00,$00,$70,$88,$80,$88,$70,$00
   101  1edf  0808689888986800          DEFB    $08,$08,$68,$98,$88,$98,$68,$00
   102  1ee7  00007088f8807000          DEFB    $00,$00,$70,$88,$F8,$80,$70,$00
   103  1eef  102820f820202000          DEFB    $10,$28,$20,$F8,$20,$20,$20,$00
   104  1ef7  0000689898680870          DEFB    $00,$00,$68,$98,$98,$68,$08,$70
   105  1eff  8080f08888888800          DEFB    $80,$80,$F0,$88,$88,$88,$88,$00
   106  1f07  2000602020207000          DEFB    $20,$00,$60,$20,$20,$20,$70,$00
   107  1f0f  1000301010109060          DEFB    $10,$00,$30,$10,$10,$10,$90,$60
   108  1f17  4040485060504800          DEFB    $40,$40,$48,$50,$60,$50,$48,$00
   109  1f1f  6020202020207000          DEFB    $60,$20,$20,$20,$20,$20,$70,$00
   110  1f27  0000d0a8a8a8a800          DEFB    $00,$00,$D0,$A8,$A8,$A8,$A8,$00
   111  1f2f  0000b0c888888800          DEFB    $00,$00,$B0,$C8,$88,$88,$88,$00
   112  1f37  0000708888887000          DEFB    $00,$00,$70,$88,$88,$88,$70,$00
   113  1f3f  0000b0c8c8b08080          DEFB    $00,$00,$B0,$C8,$C8,$B0,$80,$80
   114  1f47  0000689898680808          DEFB    $00,$00,$68,$98,$98,$68,$08,$08
   115  1f4f  0000b0c880808000          DEFB    $00,$00,$B0,$C8,$80,$80,$80,$00
   116  1f57  00007880f008f000          DEFB    $00,$00,$78,$80,$F0,$08,$F0,$00
   117  1f5f  4040f04040483000          DEFB    $40,$40,$F0,$40,$40,$48,$30,$00
   118  1f67  0000909090906800          DEFB    $00,$00,$90,$90,$90,$90,$68,$00
   119  1f6f  0000888888502000          DEFB    $00,$00,$88,$88,$88,$50,$20,$00
   120  1f77  000088a8a8a85000          DEFB    $00,$00,$88,$A8,$A8,$A8,$50,$00
   121  1f7f  0000885020508800          DEFB    $00,$00,$88,$50,$20,$50,$88,$00
   122  1f87  0000888898680870          DEFB    $00,$00,$88,$88,$98,$68,$08,$70
   123  1f8f  0000f8102040f800          DEFB    $00,$00,$F8,$10,$20,$40,$F8,$00
   124  1f97  1820204020201800          DEFB    $18,$20,$20,$40,$20,$20,$18,$00
   125  1f9f  2020200020202000          DEFB    $20,$20,$20,$00,$20,$20,$20,$00
   126  1fa7  c02020102020c000          DEFB    $C0,$20,$20,$10,$20,$20,$C0,$00
   127  1faf  40a8100000000000          DEFB    $40,$A8,$10,$00,$00,$00,$00,$00
   128  1fb7  00002050f8000000          DEFB    $00,$00,$20,$50,$F8,$00,$00,$00
   129  1fbf  7088808088702060          DEFB    $70,$88,$80,$80,$88,$70,$20,$60
   130  1fc7  9000009090906800          DEFB    $90,$00,$00,$90,$90,$90,$68,$00
   131  1fcf  10207088f8807000          DEFB    $10,$20,$70,$88,$F8,$80,$70,$00
   132  1fd7  2050700878887800          DEFB    $20,$50,$70,$08,$78,$88,$78,$00
   133  1fdf  4800700878887800          DEFB    $48,$00,$70,$08,$78,$88,$78,$00
   134  1fe7  2010700878887800          DEFB    $20,$10,$70,$08,$78,$88,$78,$00
   135  1fef  2000700878887800          DEFB    $20,$00,$70,$08,$78,$88,$78,$00
   136  1ff7  0070808080701060          DEFB    $00,$70,$80,$80,$80,$70,$10,$60
   137  1fff  20507088f8807000          DEFB    $20,$50,$70,$88,$F8,$80,$70,$00
   138  2007  50007088f8807000          DEFB    $50,$00,$70,$88,$F8,$80,$70,$00
   139  200f  20107088f8807000          DEFB    $20,$10,$70,$88,$F8,$80,$70,$00
   140  2017  5000006020207000          DEFB    $50,$00,$00,$60,$20,$20,$70,$00
   141  201f  2050006020207000          DEFB    $20,$50,$00,$60,$20,$20,$70,$00
   142  2027  4020006020207000          DEFB    $40,$20,$00,$60,$20,$20,$70,$00
   143  202f  5000205088f88800          DEFB    $50,$00,$20,$50,$88,$F8,$88,$00
   144  2037  2000205088f88800          DEFB    $20,$00,$20,$50,$88,$F8,$88,$00
   145  203f  1020f880f080f800          DEFB    $10,$20,$F8,$80,$F0,$80,$F8,$00
   146  2047  00006c127e906e00          DEFB    $00,$00,$6C,$12,$7E,$90,$6E,$00
   147  204f  3e50909cf0909e00          DEFB    $3E,$50,$90,$9C,$F0,$90,$9E,$00
   148  2057  6090006090906000          DEFB    $60,$90,$00,$60,$90,$90,$60,$00
   149  205f  9000006090906000          DEFB    $90,$00,$00,$60,$90,$90,$60,$00
   150  2067  4020006090906000          DEFB    $40,$20,$00,$60,$90,$90,$60,$00
   151  206f  40a000a0a0a05000          DEFB    $40,$A0,$00,$A0,$A0,$A0,$50,$00
   152  2077  402000a0a0a05000          DEFB    $40,$20,$00,$A0,$A0,$A0,$50,$00
   153  207f  90009090b05010e0          DEFB    $90,$00,$90,$90,$B0,$50,$10,$E0
   154  2087  5000708888887000          DEFB    $50,$00,$70,$88,$88,$88,$70,$00
   155  208f  5000888888887000          DEFB    $50,$00,$88,$88,$88,$88,$70,$00
   156  2097  2020788080782020          DEFB    $20,$20,$78,$80,$80,$78,$20,$20
   157  209f  182420f820e25c00          DEFB    $18,$24,$20,$F8,$20,$E2,$5C,$00
   158  20a7  885020f820f82000          DEFB    $88,$50,$20,$F8,$20,$F8,$20,$00
   159  20af  c0a0a0c89c88888c          DEFB    $C0,$A0,$A0,$C8,$9C,$88,$88,$8C
   160  20b7  182020f820202040          DEFB    $18,$20,$20,$F8,$20,$20,$20,$40
   161  20bf  1020700878887800          DEFB    $10,$20,$70,$08,$78,$88,$78,$00
   162  20c7  1020006020207000          DEFB    $10,$20,$00,$60,$20,$20,$70,$00
   163  20cf  2040006090906000          DEFB    $20,$40,$00,$60,$90,$90,$60,$00
   164  20d7  2040009090906800          DEFB    $20,$40,$00,$90,$90,$90,$68,$00
   165  20df  50a000a0d0909000          DEFB    $50,$A0,$00,$A0,$D0,$90,$90,$00
   166  20e7  285000c8a8988800          DEFB    $28,$50,$00,$C8,$A8,$98,$88,$00
   167  20ef  00700878887800f8          DEFB    $00,$70,$08,$78,$88,$78,$00,$F8
   168  20f7  00609090906000f0          DEFB    $00,$60,$90,$90,$90,$60,$00,$F0
   169  20ff  2000204080887000          DEFB    $20,$00,$20,$40,$80,$88,$70,$00
   170  2107  000000f880800000          DEFB    $00,$00,$00,$F8,$80,$80,$00,$00
   171  210f  000000f808080000          DEFB    $00,$00,$00,$F8,$08,$08,$00,$00
   172  2117  848890a85484081c          DEFB    $84,$88,$90,$A8,$54,$84,$08,$1C
   173  211f  848890a858a83c08          DEFB    $84,$88,$90,$A8,$58,$A8,$3C,$08
   174  2127  2000002020202000          DEFB    $20,$00,$00,$20,$20,$20,$20,$00
   175  212f  0000244890482400          DEFB    $00,$00,$24,$48,$90,$48,$24,$00
   176  2137  0000904824489000          DEFB    $00,$00,$90,$48,$24,$48,$90,$00
   177  213f  2850205088f88800          DEFB    $28,$50,$20,$50,$88,$F8,$88,$00
   178  2147  2850700878887800          DEFB    $28,$50,$70,$08,$78,$88,$78,$00
   179  214f  2850007020207000          DEFB    $28,$50,$00,$70,$20,$20,$70,$00
   180  2157  2850002020207000          DEFB    $28,$50,$00,$20,$20,$20,$70,$00
   181  215f  2850007088887000          DEFB    $28,$50,$00,$70,$88,$88,$70,$00
   182  2167  50a0006090906000          DEFB    $50,$A0,$00,$60,$90,$90,$60,$00
   183  216f  2850008888887000          DEFB    $28,$50,$00,$88,$88,$88,$70,$00
   184  2177  50a000a0a0a05000          DEFB    $50,$A0,$00,$A0,$A0,$A0,$50,$00
   185  217f  fc484848e8085020          DEFB    $FC,$48,$48,$48,$E8,$08,$50,$20
   186  2187  0050005050501020          DEFB    $00,$50,$00,$50,$50,$50,$10,$20
   187  218f  c044c854ec549e04          DEFB    $C0,$44,$C8,$54,$EC,$54,$9E,$04
   188  2197  10a8400000000000          DEFB    $10,$A8,$40,$00,$00,$00,$00,$00
   189  219f  0020508850200000          DEFB    $00,$20,$50,$88,$50,$20,$00,$00
   190  21a7  8810204080280000          DEFB    $88,$10,$20,$40,$80,$28,$00,$00
   191  21af  7ca8a86828282800          DEFB    $7C,$A8,$A8,$68,$28,$28,$28,$00
   192  21b7  3840304848300870          DEFB    $38,$40,$30,$48,$48,$30,$08,$70
   193  21bf  000000000000ffff          DEFB    $00,$00,$00,$00,$00,$00,$FF,$FF
   194  21c7  f0f0f0f00f0f0f0f          DEFB    $F0,$F0,$F0,$F0,$0F,$0F,$0F,$0F
   195  21cf  0000ffffffffffff          DEFB    $00,$00,$FF,$FF,$FF,$FF,$FF,$FF
   196  21d7  ffff000000000000          DEFB    $FF,$FF,$00,$00,$00,$00,$00,$00
   197  21df  0000003c3c000000          DEFB    $00,$00,$00,$3C,$3C,$00,$00,$00
   198  21e7  ffffffffffff0000          DEFB    $FF,$FF,$FF,$FF,$FF,$FF,$00,$00
   199  21ef  c0c0c0c0c0c0c0c0          DEFB    $C0,$C0,$C0,$C0,$C0,$C0,$C0,$C0
   200  21f7  0f0f0f0ff0f0f0f0          DEFB    $0F,$0F,$0F,$0F,$F0,$F0,$F0,$F0
   201  21ff  fcfcfcfcfcfcfcfc          DEFB    $FC,$FC,$FC,$FC,$FC,$FC,$FC,$FC
   202  2207  0303030303030303          DEFB    $03,$03,$03,$03,$03,$03,$03,$03
   203  220f  3f3f3f3f3f3f3f3f          DEFB    $3F,$3F,$3F,$3F,$3F,$3F,$3F,$3F
   204  2217  1122448811224488          DEFB    $11,$22,$44,$88,$11,$22,$44,$88
   205  221f  8844221188442211          DEFB    $88,$44,$22,$11,$88,$44,$22,$11
   206  2227  fe7c381000000000          DEFB    $FE,$7C,$38,$10,$00,$00,$00,$00
   207  222f  0000000010387cfe          DEFB    $00,$00,$00,$00,$10,$38,$7C,$FE
   208  2237  80c0e0f0e0c08000          DEFB    $80,$C0,$E0,$F0,$E0,$C0,$80,$00
   209  223f  0103070f07030100          DEFB    $01,$03,$07,$0F,$07,$03,$01,$00
   210  2247  ff7e3c18183c7eff          DEFB    $FF,$7E,$3C,$18,$18,$3C,$7E,$FF
   211  224f  81c3e7ffffe7c381          DEFB    $81,$C3,$E7,$FF,$FF,$E7,$C3,$81
   212  2257  f0f0f0f000000000          DEFB    $F0,$F0,$F0,$F0,$00,$00,$00,$00
   213  225f  000000000f0f0f0f          DEFB    $00,$00,$00,$00,$0F,$0F,$0F,$0F
   214  2267  0f0f0f0f00000000          DEFB    $0F,$0F,$0F,$0F,$00,$00,$00,$00
   215  226f  00000000f0f0f0f0          DEFB    $00,$00,$00,$00,$F0,$F0,$F0,$F0
   216  2277  3333cccc3333cccc          DEFB    $33,$33,$CC,$CC,$33,$33,$CC,$CC
   217  227f  002020505088f800          DEFB    $00,$20,$20,$50,$50,$88,$F8,$00
   218  2287  2020702070202000          DEFB    $20,$20,$70,$20,$70,$20,$20,$00
   219  228f  0000005088a85000          DEFB    $00,$00,$00,$50,$88,$A8,$50,$00
   220  2297  ffffffffffffffff          DEFB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
   221  229f  00000000ffffffff          DEFB    $00,$00,$00,$00,$FF,$FF,$FF,$FF
   222  22a7  f0f0f0f0f0f0f0f0          DEFB    $F0,$F0,$F0,$F0,$F0,$F0,$F0,$F0
   223  22af  0f0f0f0f0f0f0f0f          DEFB    $0F,$0F,$0F,$0F,$0F,$0F,$0F,$0F
   224  22b7  ffffffff00000000          DEFB    $FF,$FF,$FF,$FF,$00,$00,$00,$00
   225  22bf  0000689090906800          DEFB    $00,$00,$68,$90,$90,$90,$68,$00
   226  22c7  30484870484870c0          DEFB    $30,$48,$48,$70,$48,$48,$70,$C0
   227  22cf  f888808080808000          DEFB    $F8,$88,$80,$80,$80,$80,$80,$00
   228  22d7  f850505050509800          DEFB    $F8,$50,$50,$50,$50,$50,$98,$00
   229  22df  f88840204088f800          DEFB    $F8,$88,$40,$20,$40,$88,$F8,$00
   230  22e7  0000789090906000          DEFB    $00,$00,$78,$90,$90,$90,$60,$00
   231  22ef  0050505050688080          DEFB    $00,$50,$50,$50,$50,$68,$80,$80
   232  22f7  0050a02020202000          DEFB    $00,$50,$A0,$20,$20,$20,$20,$00
   233  22ff  f82070a8a87020f8          DEFB    $F8,$20,$70,$A8,$A8,$70,$20,$F8
   234  2307  205088f888502000          DEFB    $20,$50,$88,$F8,$88,$50,$20,$00
   235  230f  708888885050d800          DEFB    $70,$88,$88,$88,$50,$50,$D8,$00
   236  2317  3040402050505020          DEFB    $30,$40,$40,$20,$50,$50,$50,$20
   237  231f  00000050a8a85000          DEFB    $00,$00,$00,$50,$A8,$A8,$50,$00
   238  2327  0870a8a8a8708000          DEFB    $08,$70,$A8,$A8,$A8,$70,$80,$00
   239  232f  384080f880403800          DEFB    $38,$40,$80,$F8,$80,$40,$38,$00
   240  2337  7088888888888800          DEFB    $70,$88,$88,$88,$88,$88,$88,$00
   241  233f  00f800f800f80000          DEFB    $00,$F8,$00,$F8,$00,$F8,$00,$00
   242  2347  2020f8202000f800          DEFB    $20,$20,$F8,$20,$20,$00,$F8,$00
   243  234f  c0300830c000f800          DEFB    $C0,$30,$08,$30,$C0,$00,$F8,$00
   244  2357  186080601800f800          DEFB    $18,$60,$80,$60,$18,$00,$F8,$00
   245  235f  1028202020202020          DEFB    $10,$28,$20,$20,$20,$20,$20,$20
   246  2367  202020202020a040          DEFB    $20,$20,$20,$20,$20,$20,$A0,$40
   247  236f  002000f800200000          DEFB    $00,$20,$00,$F8,$00,$20,$00,$00
   248  2377  0050a00050a00000          DEFB    $00,$50,$A0,$00,$50,$A0,$00,$00
   249  237f  0018242418000000          DEFB    $00,$18,$24,$24,$18,$00,$00,$00
   250  2387  0030787830000000          DEFB    $00,$30,$78,$78,$30,$00,$00,$00
   251  238f  0000000030000000          DEFB    $00,$00,$00,$00,$30,$00,$00,$00
   252  2397  3e202020a0602000          DEFB    $3E,$20,$20,$20,$A0,$60,$20,$00
   253  239f  a050505000000000          DEFB    $A0,$50,$50,$50,$00,$00,$00,$00
   254  23a7  40a02040e0000000          DEFB    $40,$A0,$20,$40,$E0,$00,$00,$00
   255  23af  0038383838383800          DEFB    $00,$38,$38,$38,$38,$38,$38,$00
   256  23b7  0000000000000000          DEFB    $00,$00,$00,$00,$00,$00,$00,$00
   257                          
bios.asm:
  4272                          
  4273                                  ENDIF
  4274                          
  4275                          
  4276  23bf  cddbfd            A23BF:  call    H_PINL
  4277  23c2  3aaaf6                    ld      a,(AUTFLG)
  4278  23c5  a7                        and     a
  4279  23c6  200d                      jr      nz,A23D5
  4280  23c8  2e00                      ld      l,$00
  4281  23ca  1814                      jr      A23E0
  4282                          ;
  4283  23cc  cde0fd            A23CC:  call    H_QINL
  4284  23cf  3e3f                      ld      a,'?'
  4285  23d1  df                        rst     OUTDO
  4286  23d2  3e20                      ld      a,' '
  4287  23d4  df                        rst     OUTDO
  4288                          ;
  4289  23d5  cde5fd            A23D5:  call    H_INLI
  4290  23d8  2a0000                    ld      hl,(CSRY)
  4291  23db  2d                        dec     l
  4292  23dc  c4290c                    call    nz,A0C29                ; no extend on next line
  4293  23df  2c                        inc     l
  4294  23e0  22cafb            A23E0:  ld      (FSTPOS),hl
  4295  23e3  af                        xor     a
  4296  23e4  329bfc                    ld      (INTFLG),a
  4297  23e7  cdcb10            A23E7:  call    A10CB                   ; get char
  4298  23ea  213724                    ld      hl,T2439-2
  4299  23ed  0e0b                      ld      c,$0B
  4300  23ef  cd1909                    call    A0919
  4301  23f2  f5                        push    af
  4302  23f3  c4ff23                    call    nz,A23FF
  4303  23f6  f1                        pop     af
  4304  23f7  30ee                      jr      nc,A23E7
  4305  23f9  215df5                    ld      hl,BUFMIN
  4306  23fc  c8                        ret     z
  4307  23fd  3f                        ccf
  4308  23fe  c9                A23FE:  ret
  4309                          ;
  4310  23ff  f5                A23FF:  push    af
  4311  2400  fe09                      cp      $09
  4312  2402  200f                      jr      nz,A2413
  4313  2404  f1                        pop     af
  4314  2405  3e20              A2405:  ld      a,$20
  4315  2407  cdff23                    call    A23FF
  4316  240a  3a0000                    ld      a,(CSRX)
  4317  240d  3d                        dec     a
  4318  240e  e607                      and     $07
  4319  2410  20f3                      jr      nz,A2405
  4320  2412  c9                        ret
  4321                          ;
  4322  2413  f1                A2413:  pop     af
  4323  2414  21a8fc                    ld      hl,INSFLG
  4324  2417  fe01                      cp      $01
  4325  2419  280b                      jr      z,A2426
  4326  241b  fe20                      cp      $20
  4327  241d  3809                      jr      c,A2428
  4328  241f  f5                        push    af
  4329  2420  7e                        ld      a,(hl)
  4330  2421  a7                        and     a
  4331  2422  c4f224                    call    nz,A24F2
  4332  2425  f1                        pop     af
  4333  2426  df                A2426:  rst     OUTDO
  4334  2427  c9                        ret
  4335                          ;
  4336  2428  3600              A2428:  ld      (hl),$00
  4337  242a  df                        rst     OUTDO
  4338  242b  3e                        defb    $3E
  4339  242c  3e                A242C:  defb    $3E
  4340  242d  af                A242D:  xor     a
  4341  242e  f5                        push    af
  4342  242f  cd2e0a                    call    A0A2E                   ; cursor off
  4343  2432  f1                        pop     af
  4344  2433  32aafc                    ld      (CSTYLE),a
  4345  2436  c3e109                    jp      A09E1                   ; cursor on
  4346                          ;
  4347  2439  08                T2439:  db      $08
  4348  243a  6125                      dw      A2561
  4349  243c  12                        db      $12
  4350  243d  e524                      dw      A24E5
  4351  243f  1b                        db      $1B
  4352  2440  fe23                      dw      A23FE
  4353  2442  02                        db      $02
  4354  2443  0e26                      dw      A260E
  4355  2445  06                        db      $06
  4356  2446  f825                      dw      A25F8
  4357  2448  0e                        db      $0E
  4358  2449  d725                      dw      A25D7
  4359  244b  05                        db      $05
  4360  244c  b925                      dw      A25B9
  4361  244e  03                        db      $03
  4362  244f  c524                      dw      A24C5
  4363  2451  0d                        db      $0D
  4364  2452  5a24                      dw      A245A
  4365  2454  15                        db      $15
  4366  2455  ae25                      dw      A25AE
  4367  2457  7f                        db      $7F
  4368  2458  5025                      dw      A2550
  4369                          
  4370  245a  cd6c26            A245A:  call    A266C
  4371  245d  3aaaf6                    ld      a,(AUTFLG)
  4372  2460  a7                        and     a
  4373  2461  2802                      jr      z,A2465
  4374  2463  2601                      ld      h,$01
  4375  2465  e5                A2465:  push    hl
  4376  2466  cd2e0a                    call    A0A2E                   ; cursor off
  4377  2469  e1                        pop     hl
  4378  246a  115ef5                    ld      de,BUF
  4379  246d  06fe                      ld      b,$FE
  4380  246f  2d                        dec     l
  4381  2470  2c                A2470:  inc     l
  4382  2471  d5                A2471:  push    de
  4383  2472  c5                        push    bc
  4384  2473  cdd80b                    call    A0BD8                   ; read char from VRAM
  4385  2476  c1                        pop     bc
  4386  2477  d1                        pop     de
  4387  2478  a7                        and     a
  4388  2479  2814                      jr      z,A248F
  4389  247b  fe20                      cp      $20
  4390  247d  300b                      jr      nc,A248A
  4391  247f  05                        dec     b
  4392  2480  281d                      jr      z,A249F
  4393  2482  4f                        ld      c,a
  4394  2483  3e01                      ld      a,$01
  4395  2485  12                        ld      (de),a
  4396  2486  13                        inc     de
  4397  2487  79                        ld      a,c
  4398  2488  c640                      add     a,$40
  4399  248a  12                A248A:  ld      (de),a
  4400  248b  13                        inc     de
  4401  248c  05                        dec     b
  4402  248d  2810                      jr      z,A249F
  4403  248f  24                A248F:  inc     h
  4404  2490  3a0000                    ld      a,(LINLEN)
  4405  2493  bc                        cp      h
  4406  2494  30db                      jr      nc,A2471
  4407  2496  d5                        push    de
  4408  2497  cd1d0c                    call    A0C1D                   ; extend at next line ?
  4409  249a  d1                        pop     de
  4410  249b  2601                      ld      h,$01
  4411  249d  28d1                      jr      z,A2470
  4412  249f  1b                A249F:  dec     de
  4413  24a0  1a                        ld      a,(de)
  4414  24a1  fe20                      cp      $20
  4415  24a3  28fa                      jr      z,A249F
  4416  24a5  e5                        push    hl
  4417  24a6  d5                        push    de
  4418  24a7  cde109                    call    A09E1                   ; cursor on
  4419  24aa  d1                        pop     de
  4420  24ab  e1                        pop     hl
  4421  24ac  13                        inc     de
  4422  24ad  af                        xor     a
  4423  24ae  12                        ld      (de),a
  4424  24af  3e0d              A24AF:  ld      a,$0D
  4425  24b1  a7                        and     a
  4426  24b2  f5                A24B2:  push    af
  4427  24b3  cd290c                    call    A0C29                   ; no extend on next line
  4428  24b6  cd8e08                    call    A088E                   ; put cursor
  4429  24b9  3e0a                      ld      a,$0A
  4430  24bb  df                        rst     OUTDO
  4431  24bc  af                        xor     a
  4432  24bd  32a8fc                    ld      (INSFLG),a
  4433  24c0  f1                        pop     af
  4434  24c1  37                        scf
  4435  24c2  e1                        pop     hl
  4436  24c3  c9                        ret
  4437                          ;
  4438  24c4  2c                A24C4:  inc     l
  4439  24c5  cd1d0c            A24C5:  call    A0C1D                   ; extends in next line ?
  4440  24c8  28fa                      jr      z,A24C4
  4441  24ca  cd2d24                    call    A242D
  4442  24cd  af                        xor     a
  4443  24ce  325ef5                    ld      (BUF),a
  4444  24d1  2601                      ld      h,$01
  4445  24d3  e5                        push    hl
  4446  24d4  cdbd04                    call    A04BD
  4447  24d7  cd5404                    call    A0454
  4448  24da  e1                        pop     hl
  4449  24db  38d2                      jr      c,A24AF
  4450  24dd  3ab1fb                    ld      a,(BASROM)
  4451  24e0  a7                        and     a
  4452  24e1  20cc                      jr      nz,A24AF
  4453  24e3  18cd                      jr      A24B2
  4454                          
  4455  24e5  21a8fc            A24E5:  ld      hl,INSFLG
  4456  24e8  7e                        ld      a,(hl)
  4457  24e9  eeff                      xor     $FF
  4458  24eb  77                        ld      (hl),a
  4459  24ec  ca2d24                    jp      z,A242D
  4460  24ef  c32c24                    jp      A242C
  4461                          ;
  4462  24f2  cd2e0a            A24F2:  call    A0A2E                   ; cursor off
  4463  24f5  2a0000                    ld      hl,(CSRY)
  4464  24f8  0e20                      ld      c,$20
  4465  24fa  e5                A24FA:  push    hl
  4466  24fb  c5                A24FB:  push    bc
  4467  24fc  cdd80b                    call    A0BD8                   ; read char from VRAM
  4468  24ff  d1                        pop     de
  4469  2500  c5                        push    bc
  4470  2501  4b                        ld      c,e
  4471  2502  cde60b                    call    A0BE6                   ; calc VRAM adres
  4472  2505  c1                        pop     bc
  4473  2506  3a0000                    ld      a,(LINLEN)
  4474  2509  24                        inc     h
  4475  250a  bc                        cp      h
  4476  250b  7a                        ld      a,d
  4477  250c  30ed                      jr      nc,A24FB
  4478  250e  e1                        pop     hl
  4479  250f  cd1d0c                    call    A0C1D                   ; extend in next line ?
  4480  2512  2837                      jr      z,A254B
  4481  2514  79                        ld      a,c
  4482  2515  fe20                      cp      $20
  4483  2517  f5                        push    af
  4484  2518  200a                      jr      nz,A2524
  4485  251a  3a0000                    ld      a,(LINLEN)
  4486  251d  bc                        cp      h
  4487  251e  2804                      jr      z,A2524
  4488  2520  f1                        pop     af
  4489  2521  c3e109                    jp      A09E1                   ; cursor on
  4490                          ;
  4491  2524  cd2a0c            A2524:  call    A0C2A                   ; extend on next line
  4492  2527  2c                        inc     l
  4493  2528  c5                        push    bc
  4494  2529  e5                        push    hl
  4495  252a  cd320c                    call    A0C32                   ; max linenumber
  4496  252d  bd                        cp      l
  4497  252e  3805                      jr      c,A2535
  4498  2530  cdb70a                    call    A0AB7
  4499  2533  180f                      jr      A2544
  4500                          ;
  4501  2535  210000            A2535:  ld      hl,CSRY
  4502  2538  35                        dec     (hl)
  4503  2539  2001                      jr      nz,A253C
  4504  253b  34                        inc     (hl)
  4505  253c  2e01              A253C:  ld      l,$01
  4506  253e  cd880a                    call    A0A88
  4507  2541  e1                        pop     hl
  4508  2542  2d                        dec     l
  4509  2543  e5                        push    hl
  4510  2544  e1                A2544:  pop     hl
  4511  2545  c1                        pop     bc
  4512  2546  f1                        pop     af
  4513  2547  cae109                    jp      z,A09E1                 ; cursor on
  4514  254a  2d                        dec     l
  4515  254b  2c                A254B:  inc     l
  4516  254c  2601                      ld      h,$01
  4517  254e  18aa                      jr      A24FA
  4518                          
  4519  2550  3a0000            A2550:  ld      a,(LINLEN)
  4520  2553  bc                        cp      h
  4521  2554  2005                      jr      nz,A255B
  4522  2556  cd1d0c                    call    A0C1D                   ; extend in next line ?
  4523  2559  203a                      jr      nz,A2595
  4524  255b  3e1c              A255B:  ld      a,$1C
  4525  255d  df                        rst     OUTDO
  4526  255e  2a0000                    ld      hl,(CSRY)
  4527  2561  e5                A2561:  push    hl
  4528  2562  cd2e0a                    call    A0A2E                   ; cursor off
  4529  2565  e1                        pop     hl
  4530  2566  25                        dec     h
  4531  2567  c27a25                    jp      nz,A257A
  4532  256a  24                        inc     h
  4533  256b  e5                        push    hl
  4534  256c  2d                        dec     l
  4535  256d  280a                      jr      z,A2579
  4536  256f  3a0000                    ld      a,(LINLEN)
  4537  2572  67                        ld      h,a
  4538  2573  cd1d0c                    call    A0C1D                   ; extend on next line ?
  4539  2576  2001                      jr      nz,A2579
  4540  2578  e3                        ex      (sp),hl
  4541  2579  e1                A2579:  pop     hl
  4542  257a  220000            A257A:  ld      (CSRY),hl
  4543  257d  3a0000            A257D:  ld      a,(LINLEN)
  4544  2580  bc                        cp      h
  4545  2581  2812                      jr      z,A2595
  4546  2583  24                        inc     h
  4547  2584  cdd80b            A2584:  call    A0BD8                   ; read char from VRAM
  4548  2587  25                        dec     h
  4549  2588  cde60b                    call    A0BE6                   ; calc VRAM adres
  4550  258b  24                        inc     h
  4551  258c  24                        inc     h
  4552  258d  3a0000                    ld      a,(LINLEN)
  4553  2590  3c                        inc     a
  4554  2591  bc                        cp      h
  4555  2592  20f0                      jr      nz,A2584
  4556  2594  25                        dec     h
  4557  2595  0e20              A2595:  ld      c,$20
  4558  2597  cde60b                    call    A0BE6                   ; calc VRAM adres
  4559  259a  cd1d0c                    call    A0C1D                   ; extend on next line ?
  4560  259d  c2e109                    jp      nz,A09E1                ; cursor on
  4561  25a0  e5                        push    hl
  4562  25a1  2c                        inc     l
  4563  25a2  2601                      ld      h,$01
  4564  25a4  cdd80b                    call    A0BD8                   ; read char from VRAM
  4565  25a7  e3                        ex      (sp),hl
  4566  25a8  cde60b                    call    A0BE6                   ; calc VRAM adres
  4567  25ab  e1                        pop     hl
  4568  25ac  18cf                      jr      A257D
  4569                          
  4570  25ae  cd2e0a            A25AE:  call    A0A2E                   ; cursor off
  4571  25b1  cd6c26                    call    A266C
  4572  25b4  220000                    ld      (CSRY),hl
  4573  25b7  1805                      jr      A25BE
  4574                          
  4575  25b9  e5                A25B9:  push    hl
  4576  25ba  cd2e0a                    call    A0A2E                   ; cursor off
  4577  25bd  e1                        pop     hl
  4578  25be  cd1d0c            A25BE:  call    A0C1D                   ; extend on next line ?
  4579  25c1  f5                        push    af
  4580  25c2  cdee0a                    call    A0AEE                   ; clear to end of line
  4581  25c5  f1                        pop     af
  4582  25c6  2005                      jr      nz,A25CD
  4583  25c8  2601                      ld      h,$01
  4584  25ca  2c                        inc     l
  4585  25cb  18f1                      jr      A25BE
  4586                          ;
  4587  25cd  cde109            A25CD:  call    A09E1                   ; cursor on
  4588  25d0  af                        xor     a
  4589  25d1  32a8fc                    ld      (INSFLG),a
  4590  25d4  c32d24                    jp      A242D
  4591                          
  4592  25d7  cd2e0a            A25D7:  call    A0A2E                   ; cursor off
  4593  25da  2a0000                    ld      hl,(CSRY)
  4594  25dd  2d                        dec     l
  4595  25de  2c                A25DE:  inc     l
  4596  25df  cd1d0c                    call    A0C1D                   ; extend on next line ?
  4597  25e2  28fa                      jr      z,A25DE
  4598  25e4  3a0000                    ld      a,(LINLEN)
  4599  25e7  67                        ld      h,a
  4600  25e8  24                        inc     h
  4601  25e9  25                A25E9:  dec     h
  4602  25ea  2807                      jr      z,A25F3
  4603  25ec  cdd80b                    call    A0BD8                   ; read char from VRAM
  4604  25ef  fe20                      cp      $20
  4605  25f1  28f6                      jr      z,A25E9
  4606  25f3  cd5b0a            A25F3:  call    A0A5B                   ; cursor right
  4607  25f6  18d5                      jr      A25CD
  4608                          
  4609  25f8  cd2e0a            A25F8:  call    A0A2E                   ; cursor off
  4610  25fb  cd3426                    call    A2634
  4611  25fe  cd2426            A25FE:  call    A2624
  4612  2601  28ca                      jr      z,A25CD
  4613  2603  38f9                      jr      c,A25FE
  4614  2605  cd2426            A2605:  call    A2624
  4615  2608  28c3                      jr      z,A25CD
  4616  260a  30f9                      jr      nc,A2605
  4617  260c  18bf                      jr      A25CD
  4618                          
  4619  260e  cd2e0a            A260E:  call    A0A2E                   ; cursor off
  4620  2611  cd3426            A2611:  call    A2634
  4621  2614  28b7                      jr      z,A25CD
  4622  2616  30f9                      jr      nc,A2611
  4623  2618  cd3426            A2618:  call    A2634
  4624  261b  28b0                      jr      z,A25CD
  4625  261d  38f9                      jr      c,A2618
  4626  261f  cd5b0a                    call    A0A5B                   ; cursor right
  4627  2622  18a9                      jr      A25CD
  4628                          ;
  4629  2624  2a0000            A2624:  ld      hl,(CSRY)
  4630  2627  cd5b0a                    call    A0A5B                   ; cursor right
  4631  262a  cd320c                    call    A0C32                   ; max linenumber
  4632  262d  5f                        ld      e,a
  4633  262e  3a0000                    ld      a,(LINLEN)
  4634  2631  57                        ld      d,a
  4635  2632  1809                      jr      A263D
  4636                          ;
  4637  2634  2a0000            A2634:  ld      hl,(CSRY)
  4638  2637  cd4c0a                    call    A0A4C                   ; cursor left
  4639  263a  110101                    ld      de,$0101
  4640  263d  2a0000            A263D:  ld      hl,(CSRY)
  4641  2640  e7                        rst     DCOMPR
  4642  2641  c8                        ret     z
  4643  2642  116826                    ld      de,A2668
  4644  2645  d5                        push    de
  4645  2646  cdd80b                    call    A0BD8                   ; read char from VRAM
  4646  2649  fe30                      cp      $30
  4647  264b  3f                        ccf
  4648  264c  d0                        ret     nc
  4649  264d  fe3a                      cp      $3A
  4650  264f  d8                        ret     c
  4651  2650  fe41                      cp      $41
  4652  2652  3f                        ccf
  4653  2653  d0                        ret     nc
  4654  2654  fe5b                      cp      $5B
  4655  2656  d8                        ret     c
  4656  2657  fe61                      cp      $61
  4657  2659  3f                        ccf
  4658  265a  d0                        ret     nc
  4659  265b  fe7b                      cp      $7B
  4660  265d  d8                        ret     c
  4661  265e  fe86                      cp      $86
  4662  2660  3f                        ccf
  4663  2661  d0                        ret     nc
  4664  2662  fea0                      cp      $A0
  4665  2664  d8                        ret     c
  4666  2665  fea6                      cp      $A6
  4667  2667  3f                        ccf
  4668  2668  3e00              A2668:  ld      a,$00
  4669  266a  3c                        inc     a
  4670  266b  c9                        ret
  4671                          ;
  4672  266c  2d                A266C:  dec     l
  4673  266d  2805                      jr      z,A2674
  4674  266f  cd1d0c                    call    A0C1D                   ; extend on next line ?
  4675  2672  28f8                      jr      z,A266C
  4676  2674  2c                A2674:  inc     l
  4677  2675  3acafb                    ld      a,(FSTPOS)
  4678  2678  bd                        cp      l
  4679  2679  2601                      ld      h,$01
  4680  267b  c0                        ret     nz
  4681  267c  2acafb                    ld      hl,(FSTPOS)
  4682  267f  c9                        ret
  4683                          ;
  4684  2680  c30000            A2680:  jp      C7C76
  4685                          ;
  4686  2683  c30000            A2683:  jp      C558C
  4687                          ;
  4688  2686  c30000            A2686:  jp      C4666
  4689                          ;
  4690  2689  c30000            A2689:  jp      C5597
  4691                          ;
  4692                          ; DEFAULT VALUES FOR WORKSPACE AREA
  4693                          TOF380:
  4694                          ;	OUT     ($A8),A
  4695  268c  af                	XOR	A
  4696  268d  c9                	RET
  4697  268e  5e                        LD      E,(HL)
  4698                          ;       JR      J7F2F
  4699  268f  00                	NOP
  4700  2690  00                	NOP
  4701                          
  4702                          ;	OUT     ($A8),A
  4703  2691  c9                	RET
  4704  2692  00                	NOP
  4705  2693  73                        LD      (HL),E
  4706  2694  7a                	LD      A,D
  4707                          ;       OUT     ($A8),A
  4708  2695  00                	NOP
  4709  2696  00                	NOP
  4710  2697  c9                        RET
  4711                          
  4712                          ;	OUT     ($A8),A
  4713  2698  c9                	RET
  4714  2699  00                	NOP
  4715  269a  08                        EX      AF,AF'
  4716                          ;       CALL    CLPRM1
  4717  269b  00                	NOP
  4718  269c  00                	NOP
  4719  269d  00                	NOP
  4720  269e  08                        EX      AF,AF'
  4721  269f  f1                        POP     AF
  4722                          ;       OUT     ($A8),A
  4723  26a0  00                	NOP
  4724  26a1  00                	NOP
  4725  26a2  08                        EX      AF,AF'
  4726  26a3  c9                        RET
  4727                          
  4728  26a4  dde9                      JP      (IX)
  4729                          
  4730  26a6  2c0e              	defw    $0E2C                   ; illegal function call
  4731  26a8  2c0e                      defw    $0E2C                   ; illegal function call
  4732  26aa  2c0e                      defw    $0E2C                   ; illegal function call
  4733  26ac  2c0e                      defw    $0E2C                   ; illegal function call
  4734  26ae  2c0e                      defw    $0E2C                   ; illegal function call
  4735  26b0  2c0e                      defw    $0E2C                   ; illegal function call
  4736  26b2  2c0e                      defw    $0E2C                   ; illegal function call
  4737  26b4  2c0e                      defw    $0E2C                   ; illegal function call
  4738  26b6  2c0e                      defw    $0E2C                   ; illegal function call
  4739  26b8  2c0e                      defw    $0E2C                   ; illegal function call
  4740                          
  4741  26ba  25                	defb    37
  4742                          
  4743  26bb  1d                	defb    29
  4744                          
  4745  26bc  1d                	defb    29
  4746                          
  4747  26bd  18                	defb    24
  4748                          
  4749  26be  0e                	defb    14
  4750                          
  4751  26bf  0000              	defw    0
  4752  26c1  0000              	defw    0
  4753  26c3  0008              	defw    $0800
  4754  26c5  0000              	defw    0
  4755  26c7  0000              	defw    0
  4756                          
  4757  26c9  0018              	defw    $1800
  4758  26cb  0020              	defw    $2000
  4759  26cd  0000              	defw    0
  4760  26cf  001b              	defw    $1B00
  4761  26d1  0038              	defw    $3800
  4762                          
  4763  26d3  0018              	defw    $1800
  4764  26d5  0020              	defw    $2000
  4765  26d7  0000              	defw    0
  4766  26d9  001b              	defw    $1B00
  4767  26db  0038              	defw    $3800
  4768                          
  4769  26dd  0008              	defw    $0800
  4770  26df  0000              	defw    0
  4771  26e1  0000              	defw    0
  4772  26e3  001b              	defw    $1B00
  4773  26e5  0038              	defw    $3800
  4774                          
  4775  26e7  01                	defb    1
  4776  26e8  01                	defb    1
  4777  26e9  01                	defb    1
  4778  26ea  00                	defb    0
  4779                          
  4780  26eb  00                	defb    $00
  4781  26ec  e0                	defb    $E0
  4782  26ed  00                	defb    $00
  4783  26ee  00                	defb    $00
  4784  26ef  00                	defb    $00
  4785  26f0  00                	defb    $00
  4786  26f1  00                	defb    $00
  4787  26f2  00                	defb    $00
  4788  26f3  00                	defb    $00
  4789  26f4  ff                	defb    $FF
  4790  26f5  0f                	defb    15
  4791  26f6  04                	defb    4
  4792                          
  4793  26f7  04                	defb    4
  4794                          
  4795  26f8  c30000            	jp      0
  4796  26fb  c30000            	jp      0
  4797  26fe  0f                	defb    15
  4798  26ff  59f9              	defw    QUETAB
  4799  2701  ff                	defb    $FF
  4800  2702  01                	defb    1
  4801  2703  32                	defb    50
  4802  2704  f0fb              	defw    KEYBUF
  4803  2706  f0fb              	defw    KEYBUF
  4804  2708  535c262d0f        	defb    $53,$5C,$26,$2D,$0F
  4805  270d  252d0e161f        	defb    $25,$2D,$0E,$16,$1F
  4806  2712  535c                      defb    $53,$5C
  4807  2714  262d                      defb    $26,$2D
  4808  2716  0f                        defb    $0F
  4809  2717  0001              	defw    $0100
  4810  2719  0001              	defw    $0100
  4811  271b  3a                	defb    ':'
  4812  271c  00                ENF380: defb	0
  4813                          ;
  4814  271d  d3a0              OUTPSG:	out     (PSGCTL),a
  4815  271f  fe0e              	cp	$0E			; no writes to reg 14
  4816  2721  c8                	ret	z
  4817  2722  fe0f              	cp	$0F			; no writes to reg 15
  4818  2724  c8                	ret	z
  4819  2725  fe07              	cp	$07
  4820  2727  2004              	jr	nz,OUTPS1
  4821  2729  7b                	ld	a,e
  4822  272a  e63f              	and	$3F			; I/O port config bits (A,B=input)
  4823  272c  5f                	ld	e,a
  4824  272d  7b                OUTPS1:	ld      a,e
  4825  272e  d3a1              	out     (PSGDAT),a
  4826  2730  c9                	ret
  4827                          ;
  4828                          JSTK18:
  4829  2731  cd3527            	call	JSTK
  4830  2734  c9                	ret
  4831                          ;
  4832                          ; JOYSTICK CODE
  4833                          ; MSX FORMAT: CAS,KBD,TRGB,TRGA,RGT,LFT,DWN,UP
  4834                          ; RC VALUES:               FE FD FB F7    DF BF 7F
  4835                          ; RC FORMAT: 14 - PLAYER 1 UP,DN,LF,RT,XX,B1,B2,B3
  4836                          ; RC FORMAT: 15 - PLAYER 2 UP,DN,LF,RT,XX,B1,B2,B3
  4837  2735  c5                JSTK:	push	bc
  4838                          ;	ld	a,'J'
  4839                          ;	call	CONOUT
  4840  2736  cd8627            	call	H8KPAD
  4841  2739  4f                	ld	c,a
  4842                          ;	ld	c,$FF			; everything off (1=off, 0=on)
  4843  273a  3e0e              	ld	a,$0E
  4844  273c  d3a0              	out	(PSGCTL),a		; select player 1 joystick
  4845  273e  dba0              	in	a,(PSGCTL)
  4846  2740  47                	ld	b,a
  4847  2741  e620              	and	$20			; button 1
  4848  2743  2004              	jr	nz,JST2
  4849  2745  79                	ld	a,c
  4850  2746  e6ef              	and	$EF			; TRGA on
  4851  2748  4f                	ld	c,a
  4852  2749  78                JST2:	ld	a,b
  4853  274a  e601              	and	$01			; check up
  4854  274c  2004              	jr	nz,JST3
  4855  274e  79                	ld	a,c
  4856  274f  e6fe              	and	$FE			; UP on
  4857  2751  4f                	ld	c,a
  4858  2752  78                JST3:	ld	a,b
  4859  2753  e602              	and	$02			; check down
  4860  2755  2004              	jr	nz,JST4
  4861  2757  79                	ld	a,c
  4862  2758  e6fd              	and	$FD			; DWN on
  4863  275a  4f                	ld	c,a
  4864  275b  78                JST4:	ld	a,b
  4865  275c  e604              	and	$04			; check left
  4866  275e  2004              	jr	nz,JST5
  4867  2760  79                	ld	a,c
  4868  2761  e6fb              	and	$FB			; LFT on
  4869  2763  4f                	ld	c,a
  4870  2764  78                JST5:	ld	a,b
  4871  2765  e608              	and	$08			; check right
  4872  2767  2004              	jr	nz,JST6
  4873  2769  79                	ld	a,c
  4874  276a  e6f7              	and	$F7
  4875  276c  4f                	ld	c,a
  4876  276d  78                JST6:	ld	a,b
  4877  276e  e640              	and	$40			; button 2
  4878  2770  2004              	jr	nz,JST7
  4879  2772  79                	ld	a,c
  4880  2773  e6df              	and	$DF
  4881  2775  4f                	ld	c,a
  4882  2776  78                JST7:	ld	a,b
  4883  2777  e680              	and	$80			; button 3
  4884  2779  2004              	jr	nz,JSTX
  4885  277b  79                	ld	a,c
  4886  277c  e6bf              	and	$BF
  4887  277e  4f                	ld	c,a
  4888  277f  79                JSTX:	ld	a,c
  4889  2780  328527            	ld	(JSTKST),a
  4890  2783  c1                	pop	bc
  4891  2784  c9                	ret
  4892                          ;
  4893  2785  ff                JSTKST:	db	$FF
  4894                          ;
  4895                          ; READ H8 KEYPAD
  4896                          ; MSX FORMAT: CAS,KBD,TRGB,TRGA,RGT,LFT,DWN,UP
  4897                          ; 0=FE,1=FC,2=FA,3=F8,4=F6,5=F4,6=F2,7=F0,8=EF,9=CF
  4898                          ; .=0F,#=2F,/=4F,*=6F,-=8F,+=AF
  4899                          H8KPAD:
  4900                          ;	ld	a,'P'
  4901                          ;	call	CONOUT
  4902                          ;	in	a,($F0)
  4903                          ;	cp	$FA			; 2 DOWN
  4904                          ;	jr	z,H8KPAD2
  4905                          ;	cp	$F6			; 4 LEFT
  4906                          ;	jr	z,H8KPAD4
  4907                          ;	cp	$F2			; 6 RIGHT
  4908                          ;	jr	z,H8KPAD6
  4909                          ;	cp	$EF			; 8 UP
  4910                          ;	jr	z,H8KPAD8
  4911                          ;	cp	$F4			; 5 SPACE
  4912                          ;	jr	z,H8KPAD5
  4913  2786  3eff              	ld	a,$FF
  4914  2788  c9                	ret
  4915                          H8KPAD2:
  4916  2789  3efd              	ld	a,$FD
  4917  278b  c9                	ret
  4918                          H8KPAD4:
  4919  278c  3efb              	ld	a,$FB
  4920  278e  c9                	ret
  4921                          H8KPAD6:
  4922  278f  3ef7              	ld	a,$F7
  4923  2791  c9                	ret
  4924                          H8KPAD8:
  4925  2792  3efe              	ld	a,$FE
  4926  2794  c9                	ret
  4927                          H8KPAD5:
  4928  2795  3eef              	ld	a,$EF
  4929  2797  c9                	ret
  4930                          ;
  4931                          CONOUT:
  4932                          IF RS232 = 1
  4933                          CONPRT:	push	af
  4934                          CONOUL:	in	a,(CONPORT+5)
  4935                          	and	$20
  4936                          	jr	z,CONOUL
  4937                          	pop	af
  4938                          	out	(CONPORT),a
  4939                          	ret
  4940                          ELSE
  4941  2798  f5                CONPRT:	push	af
  4942  2799  af                	xor	a
  4943  279a  d380              	out	(CONPORT),a
  4944  279c  db80              CONOUL:	in	a,(CONPORT)
  4945  279e  e604              	and	$04
  4946  27a0  28fa              	jr	z,CONOUL
  4947  27a2  f1                	pop	af
  4948  27a3  d381              	out	(CONPORT+1),a
  4949  27a5  c9                	ret
  4950                          ENDIF
  4951                          ;
  4952                          CONPRTS:
  4953  27a6  7e                	ld	a,(HL)
  4954  27a7  b7                	or	a
  4955  27a8  c8                	ret	z
  4956  27a9  cd9827            	call	CONPRT
  4957  27ac  23                	inc	HL
  4958  27ad  18f7              	jr	CONPRTS
  4959                          ;
  4960  27af  f5                OUTHEX:	push	af
  4961  27b0  e5                	push	hl
  4962  27b1  d5                	push	de
  4963  27b2  f5                	push	af
  4964  27b3  e6f0              	and	$F0
  4965  27b5  1f                	rra
  4966  27b6  1f                	rra
  4967  27b7  1f                	rra
  4968  27b8  1f                	rra
  4969  27b9  21f427            	ld	hl,HEXTBL
  4970  27bc  5f                	ld	e,a
  4971  27bd  1600              	ld	d,0
  4972  27bf  19                	add	hl,de
  4973  27c0  7e                	ld	a,(hl)
  4974  27c1  cd9827            	call	CONOUT
  4975  27c4  f1                	pop	af
  4976  27c5  e60f              	and	$0F
  4977  27c7  21f427            	ld	hl,HEXTBL
  4978  27ca  5f                	ld	e,a
  4979  27cb  19                	add	hl,de
  4980  27cc  7e                	ld	a,(hl)
  4981  27cd  cd9827            	call	CONOUT
  4982  27d0  d1                	pop	de
  4983  27d1  e1                	pop	hl
  4984  27d2  f1                	pop	af
  4985  27d3  c9                	ret
  4986                          ;
  4987  27d4  f5                CRLF:	push	af
  4988  27d5  3e0d              	ld	a,0DH
  4989  27d7  cd9827            	call	CONOUT
  4990  27da  3e0a              	ld	a,0AH
  4991  27dc  cd9827            	call	CONOUT
  4992  27df  f1                	pop	af
  4993  27e0  c9                	ret
  4994  27e1  f5                SPACE:	push	af
  4995  27e2  3e20              	ld	a,' '
  4996  27e4  cd9827            	call	CONOUT
  4997  27e7  f1                	pop	af
  4998  27e8  c9                	ret
  4999                          ;
  5000                          IF RS232 = 1
  5001                          CONIN:
  5002                          	in	a,(CONPORT+5)
  5003                          	and	$01
  5004                          	ret	z
  5005                          	in	a,(CONPORT)
  5006                          	ret
  5007                          ELSE
  5008                          CONIN:
  5009  27e9  af                	xor	a
  5010  27ea  d380              	out	(CONPORT),a
  5011  27ec  db80              	in	a,(CONPORT)
  5012  27ee  e601              	and	$01
  5013  27f0  c8                	ret	z
  5014  27f1  db81              	in	a,(CONPORT+1)
  5015  27f3  c9                	ret
  5016                          ENDIF
  5017                          ;
  5018  27f4  3031323334353637  HEXTBL:	db	$30,$31,$32,$33,$34,$35,$36,$37,$38,$39,$41,$42,$43,$44,$45,$46
              3839414243444546  
  5019                          ;
  5020                          ; Pad to $2900
  5021  2804  0000000000000000          DEFS    $2900 - ASMPC
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              00000000          
  5022                          ; PATCH DIRECT PSG/VDP I/O
  5023                          ; ENTER HL=START ADR, DE=NUM BYTES
  5024                          ; RETURN A=NUM PATCHES
  5025                          PATCOM:
  5026  2900  7e                	LD	A,(HL)
  5027  2901  23                	INC	HL
  5028  2902  fedb              	CP	$DB	; IN OPCODE
  5029  2904  cc1529            	CALL	Z,PATCOM1
  5030  2907  fed3              	CP	$D3	; OUT OPCODE
  5031  2909  cc1529            	CALL	Z,PATCOM1
  5032                          ;	CP	$ED	; OUTI OPCODE
  5033                          ;	CALL	Z,PATCOME
  5034  290c  1b                	DEC	DE
  5035  290d  7a                	LD	A,D
  5036  290e  b3                	OR	E
  5037  290f  20ef              	JR	NZ,PATCOM
  5038  2911  3ab229            	LD	A,(PATCNT)
  5039  2914  c9                	RET
  5040                          PATCOM1:
  5041  2915  7e                	LD	A,(HL)
  5042  2916  e5                	PUSH	HL
  5043  2917  fea0              	CP	$A0
  5044  2919  cc3729            	CALL	Z,PATCA0
  5045  291c  fea1              	CP	$A1
  5046  291e  cc4729            	CALL	Z,PATCA1
  5047  2921  fea2              	CP	$A2	; JOYSTICK
  5048  2923  cc5729            	CALL	Z,PATCA2
  5049  2926  fea8              	CP	$A8
  5050  2928  cc5f29            	CALL	Z,PATCA8
  5051  292b  fea9              	CP	$A9	; KEYBOARD
  5052  292d  cc6729            	CALL	Z,PATCA9
  5053  2930  feaa              	CP	$AA
  5054  2932  cc5f29            	CALL	Z,PATCA8
  5055                          ;	CP	$98
  5056                          ;	CALL	Z,PATC98
  5057                          ;	CP	$99
  5058                          ;	CALL	Z,PATC99
  5059  2935  e1                	POP	HL
  5060  2936  c9                	RET
  5061                          ;
  5062  2937  2b                PATCA0:	DEC	HL
  5063  2938  7e                	LD	A,(HL)
  5064  2939  fed3              	CP	$D3	; OUT
  5065  293b  2802              	JR	Z,PATCA0O
  5066                          ;	INC	HL
  5067                          ;	LD	A,PSGCTL
  5068                          ;	LD	(HL),A
  5069                          ;	JP	PATCHED
  5070  293d  af                	XOR	A
  5071  293e  c9                	RET
  5072                          ; RST 28
  5073                          PATCA0O:
  5074  293f  36ef              	LD	(HL),$EF ; RST 28
  5075  2941  23                	INC	HL
  5076  2942  3600              	LD	(HL),0	; NOP
  5077  2944  c3a929            	JP	PATCHED
  5078                          ;
  5079  2947  2b                PATCA1:	DEC	HL
  5080  2948  7e                	LD	A,(HL)
  5081  2949  fed3              	CP	$D3	; OUT
  5082  294b  2802              	JR	Z,PATCA1O
  5083                          ;	INC	HL
  5084                          ;	LD	A,PSGDAT
  5085                          ;	LD	(HL),A
  5086                          ;	JP	PATCHED
  5087  294d  af                	XOR	A
  5088  294e  c9                	RET
  5089                          ; RST 30
  5090                          PATCA1O:
  5091  294f  36f7              	LD	(HL),$F7 ; RST 30
  5092  2951  23                	INC	HL
  5093  2952  3600              	LD	(HL),0	; NOP
  5094  2954  c3a929            	JP	PATCHED
  5095                          ; LOOK FOR AND PATCH JOYSTICK FUNCTION
  5096                          ; OUT 0A0H,A
  5097                          ; IN A,0A2H
  5098                          ; CHANGES TO
  5099                          ; RST 18
  5100                          PATCA2:
  5101  2957  3600              	LD	(HL),0	; NOP
  5102  2959  2b                	DEC	HL
  5103  295a  36df              	LD	(HL),$DF ; RST 18
  5104  295c  c3a929            	JP	PATCHED
  5105                          PATCA8:
  5106  295f  2b                	DEC	HL
  5107  2960  af                	XOR	A
  5108  2961  77                	LD	(HL),A	; NOP
  5109  2962  23                	INC	HL
  5110  2963  77                	LD	(HL),A	; NOP
  5111  2964  c3a929            	JP	PATCHED
  5112                          ; KEYBOARD INPUT PATCH - IN A,(0A9H)
  5113                          PATCA9:
  5114  2967  2b                	DEC	HL
  5115                          ;	LD	(HL),$4F ; LD C,A
  5116  2968  3600              	LD	(HL),0	; NOP
  5117  296a  23                	INC	HL
  5118  296b  36df              	LD	(HL),$DF ; RST 10
  5119  296d  c3a929            	JP	PATCHED
  5120                          PATC98:
  5121  2970  3e98              	LD	A,VDPDAT
  5122  2972  77                	LD	(HL),A
  5123  2973  c3a929            	JP	PATCHED
  5124                          PATC99:
  5125  2976  3e99              	LD	A,VDPCTL
  5126  2978  77                	LD	(HL),A
  5127  2979  c3a929            	JP	PATCHED
  5128                          PATCOME:
  5129  297c  e5                	PUSH	HL
  5130  297d  d5                	PUSH	DE
  5131  297e  1e20              	LD	E,$20	; CHECK ONLY 32 BYTES BACK
  5132                          PATCOME1:
  5133  2980  7e                	LD	A,(HL)
  5134  2981  fea3              	CP	$A3	; OUTI OPCODE
  5135  2983  2021              	JR	NZ,PATCOMEX
  5136                          PATCOME1A:
  5137  2985  2b                	DEC	HL
  5138  2986  7e                	LD	A,(HL)
  5139  2987  fe0e              	CP	$0E	; LOOKING FOR LD C,<N>
  5140  2989  2805              	JR	Z,PATCOME2
  5141  298b  1d                	DEC	E
  5142  298c  20f7              	JR	NZ,PATCOME1A
  5143  298e  1816              	JR	PATCOMEX
  5144                          PATCOME2:
  5145  2990  23                	INC	HL
  5146  2991  7e                	LD	A,(HL)
  5147  2992  fea0              	CP	$A0
  5148  2994  cc3729            	CALL	Z,PATCA0
  5149  2997  fea1              	CP	$A1
  5150  2999  cc4729            	CALL	Z,PATCA1
  5151                          ;	CP	$A2
  5152                          ;	CALL	Z,PATCA2
  5153  299c  fe98              	CP	$98
  5154  299e  cc7029            	CALL	Z,PATC98
  5155  29a1  fe99              	CP	$99
  5156  29a3  cc7629            	CALL	Z,PATC99
  5157                          PATCOMEX:
  5158  29a6  d1                	POP	DE
  5159  29a7  e1                	POP	HL
  5160  29a8  c9                	RET
  5161                          PATCHED:
  5162  29a9  3ab229            	LD	A,(PATCNT)
  5163  29ac  3c                	INC	A
  5164  29ad  32b229            	LD	(PATCNT),A
  5165  29b0  af                	XOR	A
  5166  29b1  c9                	RET
  5167                          ;
  5168  29b2  00                PATCNT:	DB	0
  5169                          ;
  5170                          ; Pad to $2A00
  5171  29b3  0000000000000000          DEFS    $2A00 - ASMPC
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000        
  5172                          ; FILL IN DEFAULT VALUES FOR WORKSPACE AREA
  5173                          ; SETUP UPPER MEMORY HOOKS WITH RET OPCODES
  5174  2a00  219afd            	LD	HL,$FD9A
  5175  2a03  013002            	LD	BC,$0230
  5176                          FILLC9:
  5177  2a06  3ec9              	LD	A,$C9
  5178  2a08  77                	LD	(HL),A
  5179  2a09  23                	INC	HL
  5180  2a0a  0b                	DEC	BC
  5181  2a0b  79                	LD	A,C
  5182  2a0c  b0                	OR	B
  5183  2a0d  20f7              	JR	NZ,FILLC9
  5184                          COPYF3:
  5185  2a0f  218c26            	LD	HL,TOF380
  5186  2a12  1180f3            	LD	DE,$F380
  5187  2a15  019000            	LD	BC,$0090
  5188                          COPYF3L:
  5189  2a18  7e                	LD	A,(HL)
  5190  2a19  23                	INC	HL
  5191  2a1a  12                	LD	(DE),A
  5192  2a1b  13                	INC	DE
  5193  2a1c  0b                	DEC	BC
  5194  2a1d  79                	LD	A,C
  5195  2a1e  b0                	OR	B
  5196  2a1f  20f7              	JR	NZ,COPYF3L
  5197                          ; NOW PATCH HIGH MEMORY AREAS WITH DEFAULT VALUES
  5198                          ; THESE VALUES WERE TAKEN FROM MSX REDBOOK
  5199  2a21  2168f1            	LD	HL,$F168
  5200  2a24  2272f6            	LD	(MEMSIZ),HL
  5201  2a27  21a0f0            	LD	HL,$F0A0
  5202  2a2a  2274f6            	LD	(STKTOP),HL
  5203  2a2d  210180            	LD	HL,$8001
  5204  2a30  2276f6            	LD	(TXTTAB),HL
  5205  2a33  217af6            	LD	HL,$F67A
  5206  2a36  2278f6            	LD	(TEMPPT),HL
  5207  2a39  2168f1            	LD	HL,$F168
  5208  2a3c  229bf6            	LD	(FRETOP),HL
  5209  2a3f  219ef0            	LD	HL,$F09E
  5210  2a42  22b1f6            	LD	(SAVSTK),HL
  5211  2a45  210380            	LD	HL,$8003
  5212  2a48  22c2f6            	LD	(VARTAB),HL
  5213  2a4b  22c4f6            	LD	(ARYTAB),HL
  5214  2a4e  22c6f6            	LD	(STREND),HL
  5215  2a51  210080            	LD	HL,$8000
  5216  2a54  22c8f6            	LD	(DATPTR),HL
  5217  2a57  011a00            	LD	BC,26
  5218  2a5a  21caf6            	LD	HL,DEFTBL
  5219                          DEFTBL0:
  5220  2a5d  3608              	LD	(HL),08H
  5221  2a5f  23                	INC	HL
  5222  2a60  0d                	DEC	C
  5223  2a61  20fa              	JR	NZ,DEFTBL0
  5224  2a63  21e4f6            	LD	HL,$F6E4
  5225  2a66  224cf7            	LD	(PRMPRV),HL
  5226  2a69  3e01              	LD	A,1
  5227  2a6b  325ff8            	LD	(MAXFIL),A
  5228  2a6e  216af1            	LD	HL,$F16A
  5229  2a71  2260f8            	LD	(FILTAB),HL
  5230  2a74  2177f1            	LD	HL,$F177
  5231  2a77  2262f8            	LD	(NULBUF),HL
  5232  2a7a  af                	XOR	A
  5233  2a7b  321ff9            	LD	(CGPNT),A
  5234  2a7e  21bf1b            	LD	HL,$1BBF
  5235  2a81  2220f9            	LD	(CGPNT+1),HL
  5236  2a84  210008            	LD	HL,$0800
  5237  2a87  2224f9            	LD	(CGPBAS),HL
  5238  2a8a  210038            	LD	HL,$3800
  5239  2a8d  2226f9            	LD	(PATBAS),HL
  5240  2a90  21001b            	LD	HL,$1B00
  5241  2a93  2228f9            	LD	(ATRBAS),HL
  5242  2a96  3e80              	LD	A,$80
  5243  2a98  322cf9            	LD	(CMASK),A
  5244  2a9b  210080            	LD	HL,$8000
  5245  2a9e  2248fc            	LD	(BOTTOM),HL
  5246  2aa1  2180f3            	LD	HL,$F380
  5247  2aa4  224afc            	LD	(HIMEM),HL
  5248  2aa7  c9                	RET
  5249                          ;
  5250                          OUT0A0:
  5251  2aa8  d3a0              	OUT	(PSGCTL),A
  5252  2aaa  32ae2a            	LD	(PSGREG),A
  5253                          ;	PUSH	AF
  5254                          ;	LD	A,'2'
  5255                          ;	CALL	CONOUT
  5256                          ;	POP	AF
  5257  2aad  c9                	RET
  5258                          ;
  5259  2aae  00                PSGREG:	DB	0
  5260                          ;
  5261  2aaf  f5                OUT0A1:	PUSH	AF
  5262                          ;	LD	A,'3'
  5263                          ;	CALL	CONOUT
  5264  2ab0  3aae2a            	LD	A,(PSGREG)
  5265  2ab3  fe07              	CP	$07
  5266  2ab5  280e              	JR	Z,OUT0A17
  5267  2ab7  fe0e              	CP	$0E
  5268  2ab9  2808              	JR	Z,OUT0A1X
  5269  2abb  fe0f              	CP	$0F
  5270  2abd  2804              	JR	Z,OUT0A1X
  5271  2abf  f1                	POP	AF
  5272  2ac0  d3a1              	OUT	(PSGDAT),A
  5273  2ac2  c9                	RET
  5274                          OUT0A1X:
  5275  2ac3  f1                	POP	AF
  5276  2ac4  c9                	RET
  5277                          OUT0A17:
  5278  2ac5  f1                	POP	AF
  5279  2ac6  e63f              	AND	$3F
  5280  2ac8  d3a1              	OUT	(PSGDAT),A
  5281  2aca  c9                	RET
  5282                          ;
  5283                          ; Pad to $2B00
  5284  2acb  0000000000000000          DEFS    $2B00 - ASMPC
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000        
  5285                          ;
  5286                          GAMECRACKS:
  5287                          ; PATCH ELEVATOR ACTION (HACK)
  5288  2b00  3a1640            	LD	A,($4016)
  5289  2b03  fecd              	CP	$CD
  5290  2b05  2033              	JR	NZ,GAMECR2
  5291  2b07  3a1740            	LD	A,($4017)
  5292  2b0a  fe59              	CP	$59
  5293  2b0c  202c              	JR	NZ,GAMECR2
  5294  2b0e  3a1840            	LD	A,($4018)
  5295  2b11  fe4d              	CP	$4D
  5296  2b13  2025              	JR	NZ,GAMECR2
  5297  2b15  21262b            	LD	HL,ELEVMSG
  5298  2b18  cda627            	CALL	CONPRTS
  5299  2b1b  af                	XOR	A
  5300  2b1c  321640            	LD	($4016),A
  5301  2b1f  321740            	LD	($4017),A
  5302  2b22  321840            	LD	($4018),A
  5303  2b25  c9                	RET
  5304                          ELEVMSG:
  5305  2b26  0d0a454c45564154  	DB	$0D,$0A,"ELEVATOR ACTION",$0D,$0A,0
              4f5220414354494f  
              4e0d0a00          
  5306                          GAMECR2:
  5307                          ; THEXDER PATCH (HACK)
  5308  2b3a  3aaf48            	LD	A,($48AF)
  5309  2b3d  fe36              	CP	$36
  5310  2b3f  201a              	JR	NZ,GAMECR3
  5311  2b41  214f2b            	LD	HL,THEXMSG
  5312  2b44  cda627            	CALL	CONPRTS
  5313  2b47  af                	XOR	A
  5314  2b48  32af48            	LD	($48AF),A
  5315  2b4b  32b048            	LD	($48B0),A
  5316  2b4e  c9                	RET
  5317                          THEXMSG:
  5318  2b4f  0d0a544845584445  	DB	$0D,$0A,"THEXDER",$0D,$0A,0
              520d0a00          
  5319                          GAMECR3:
  5320                          ; KINGS VALLEY PATCH (HACK)
  5321  2b5b  3a3f40            	LD	A,($403F)
  5322  2b5e  fee4              	CP	$E4
  5323  2b60  202c              	JR	NZ,GAMECR4
  5324  2b62  3a4040            	LD	A,($4040)
  5325  2b65  fe40              	CP	$40
  5326  2b67  2025              	JR	NZ,GAMECR4
  5327  2b69  217d2b            	LD	HL,KINGMSG
  5328  2b6c  cda627            	CALL	CONPRTS
  5329  2b6f  af                	XOR	A
  5330  2b70  323f40            	LD	($403F),A
  5331  2b73  324040            	LD	($4040),A
  5332  2b76  329e40            	LD	($409E),A
  5333  2b79  329f40            	LD	($409F),A
  5334  2b7c  c9                	RET
  5335                          KINGMSG:
  5336  2b7d  0d0a4b494e475320  	DB	$0D,$0A,"KINGS VALLEY",$0D,$0A,0
              56414c4c45590d0a  
              00                
  5337                          GAMECR4:
  5338                          ; ARKANOID PATCH (HACK)
  5339  2b8e  3afc42            	LD	A,($42FC)
  5340  2b91  fe3e              	CP	$3E
  5341  2b93  2027              	JR	NZ,GAMECR5
  5342  2b95  3afd42            	LD	A,($42FD)
  5343  2b98  fe0e              	CP	$0E
  5344  2b9a  2020              	JR	NZ,GAMECR5
  5345  2b9c  3afe42            	LD	A,($42FE)
  5346  2b9f  fed3              	CP	$D3
  5347  2ba1  2019              	JR	NZ,GAMECR5
  5348  2ba3  21af2b            	LD	HL,ARKAMSG
  5349  2ba6  cda627            	CALL	CONPRTS
  5350  2ba9  3ec9              	LD	A,$C9
  5351  2bab  32fc42            	LD	($42FC),A
  5352  2bae  c9                	RET
  5353                          ARKAMSG:
  5354  2baf  0d0a41524b414e4f  	DB	$0D,$0A,"ARKANOID",$0D,$0A,0
              49440d0a00        
  5355                          GAMECR5:
  5356                          ; GOONIES PATCH (22,1C,41) (22,29,41) (CB,B6)
  5357  2bbc  3a2240            	LD	A,($4022)
  5358  2bbf  fe22              	CP	$22
  5359  2bc1  203a              	JR	NZ,GAMECR6
  5360  2bc3  3a2340            	LD	A,($4023)
  5361  2bc6  fe1c              	CP	$1C
  5362  2bc8  2033              	JR	NZ,GAMECR6
  5363  2bca  3a2440            	LD	A,($4024)
  5364  2bcd  fe41              	CP	$41
  5365  2bcf  202c              	JR	NZ,GAMECR6
  5366  2bd1  21f12b            	LD	HL,GOONMSG
  5367  2bd4  cda627            	CALL	CONPRTS
  5368  2bd7  af                	XOR	A
  5369  2bd8  322240            	LD	($4022),A
  5370  2bdb  322340            	LD	($4023),A
  5371  2bde  322440            	LD	($4024),A
  5372  2be1  325040            	LD	($4050),A
  5373  2be4  325140            	LD	($4051),A
  5374  2be7  325240            	LD	($4052),A
  5375  2bea  32b840            	LD	($40B8),A
  5376  2bed  32b940            	LD	($40B9),A
  5377  2bf0  c9                	RET
  5378                          GOONMSG:
  5379  2bf1  0d0a474f4f4e4945  	DB	$0D,$0A,"GOONIES",$0D,$0A,0
              530d0a00          
  5380                          GAMECR6:
  5381                          ; GUARDIC PATCH (EA,6B) (90,6F) (24,5F) (7A,40) (6B,6A)
  5382  2bfd  3a3a44            	LD	A,($443A)
  5383  2c00  feea              	CP	$EA
  5384  2c02  203a              	JR	NZ,GAMECR7
  5385  2c04  3a3b44            	LD	A,($443B)
  5386  2c07  fe6b              	CP	$6B
  5387  2c09  2033              	JR	NZ,GAMECR7
  5388  2c0b  21322c            	LD	HL,GUARMSG
  5389  2c0e  cda627            	CALL	CONPRTS
  5390  2c11  3e33              	LD	A,$33
  5391  2c13  323a44            	LD	($443A),A
  5392  2c16  323b44            	LD	($443B),A
  5393  2c19  32375f            	LD	($5F37),A
  5394  2c1c  32385f            	LD	($5F38),A
  5395  2c1f  327560            	LD	($6075),A
  5396  2c22  327660            	LD	($6076),A
  5397  2c25  32ef60            	LD	($60EF),A
  5398  2c28  32f060            	LD	($60F0),A
  5399  2c2b  326f6a            	LD	($6A6F),A
  5400  2c2e  32706a            	LD	($6A70),A
  5401  2c31  c9                	RET
  5402                          GUARMSG:
  5403  2c32  0d0a475541524449  	DB	$0D,$0A,"GUARDIC",$0D,$0A,0
              430d0a00          
  5404                          GAMECR7:
  5405                          ; KNIGHTMARE (22,12,41)
  5406  2c3e  3a2840            	LD	A,($4028)
  5407  2c41  fe22              	CP	$22
  5408  2c43  2043              	JR	NZ,GAMECR8
  5409  2c45  3a2940            	LD	A,($4029)
  5410  2c48  fe12              	CP	$12
  5411  2c4a  203c              	JR	NZ,GAMECR8
  5412  2c4c  3a2a40            	LD	A,($402A)
  5413  2c4f  fe41              	CP	$41
  5414  2c51  2035              	JR	NZ,GAMECR8
  5415  2c53  21792c            	LD	HL,KNIGMSG
  5416  2c56  cda627            	CALL	CONPRTS
  5417  2c59  af                	XOR	A
  5418  2c5a  322840            	LD	($4028),A
  5419  2c5d  322940            	LD	($4029),A
  5420  2c60  322a40            	LD	($402A),A
  5421  2c63  325540            	LD	($4055),A
  5422  2c66  325640            	LD	($4056),A
  5423  2c69  325740            	LD	($4057),A
  5424  2c6c  32cc40            	LD	($40CC),A
  5425  2c6f  32cd40            	LD	($40CD),A
  5426  2c72  32ce40            	LD	($40CE),A
  5427  2c75  32cf40            	LD	($40CF),A
  5428  2c78  c9                	RET
  5429                          KNIGMSG:
  5430  2c79  0d0a4b4e49474854  	DB	$0D,$0A,"KNIGHTMARE",$0D,$0A,0
              4d4152450d0a00    
  5431                          GAMECR8:
  5432                          ; PIPPOLS (22,C5,40)
  5433  2c88  3a3340            	LD	A,($4033)
  5434  2c8b  fe22              	CP	$22
  5435  2c8d  2031              	JR	NZ,GAMECR9
  5436  2c8f  3a3440            	LD	A,($4034)
  5437  2c92  fec5              	CP	$C5
  5438  2c94  202a              	JR	NZ,GAMECR9
  5439  2c96  3a3540            	LD	A,($4035)
  5440  2c99  fe40              	CP	$40
  5441  2c9b  2023              	JR	NZ,GAMECR9
  5442  2c9d  21b42c            	LD	HL,PIPPMSG
  5443  2ca0  cda627            	CALL	CONPRTS
  5444  2ca3  af                	XOR	A
  5445  2ca4  323340            	LD	($4033),A
  5446  2ca7  323440            	LD	($4034),A
  5447  2caa  323540            	LD	($4035),A
  5448  2cad  327940            	LD	($4079),A
  5449  2cb0  327a40            	LD	($407A),A
  5450  2cb3  c9                	RET
  5451                          PIPPMSG:
  5452  2cb4  0d0a504950504f4c  	DB	$0D,$0A,"PIPPOLS",$0D,$0A,0
              530d0a00          
  5453                          ; MAGICAL KID WIZ
  5454                          GAMECR9:
  5455  2cc0  3a1440            	LD	A,($4014)
  5456  2cc3  fe32              	CP	$32
  5457  2cc5  2033              	JR	NZ,GAMECR10
  5458  2cc7  3a1540            	LD	A,($4015)
  5459  2cca  fe1c              	CP	$1C
  5460  2ccc  202c              	JR	NZ,GAMECR10
  5461  2cce  3a1640            	LD	A,($4016)
  5462  2cd1  fe40              	CP	$40
  5463  2cd3  2025              	JR	NZ,GAMECR10
  5464  2cd5  21e62c            	LD	HL,MAGIMSG
  5465  2cd8  cda627            	CALL	CONPRTS
  5466  2cdb  af                	XOR	A
  5467  2cdc  321440            	LD	($4014),A
  5468  2cdf  321540            	LD	($4015),A
  5469  2ce2  321640            	LD	($4016),A
  5470  2ce5  c9                	RET
  5471                          MAGIMSG:
  5472  2ce6  0d0a4d4147494341  	DB	$0D,$0A,"MAGICAL KID WIZ",$0D,$0A,0
              4c204b4944205749  
              5a0d0a00          
  5473                          ; TWINBEE (22,95,41)
  5474                          GAMECR10:
  5475  2cfa  3a2840            	LD	A,($4028)
  5476  2cfd  fe22              	CP	$22
  5477  2cff  2037              	JR	NZ,GAMECR11
  5478  2d01  3a2940            	LD	A,($4029)
  5479  2d04  fe95              	CP	$95
  5480  2d06  2030              	JR	NZ,GAMECR11
  5481  2d08  3a2a40            	LD	A,($402A)
  5482  2d0b  fe41              	CP	$41
  5483  2d0d  2029              	JR	NZ,GAMECR11
  5484  2d0f  212b2d            	LD	HL,TWINMSG
  5485  2d12  cda627            	CALL	CONPRTS
  5486  2d15  af                	XOR	A
  5487  2d16  322840            	LD	($4028),A
  5488  2d19  322940            	LD	($4029),A
  5489  2d1c  322a40            	LD	($402A),A
  5490  2d1f  32fe40            	LD	($40FE),A
  5491  2d22  32ff40            	LD	($40FF),A
  5492  2d25  3ec9              	LD	A,$C9
  5493  2d27  325240            	LD	($4052),A
  5494  2d2a  c9                	RET
  5495                          TWINMSG:
  5496  2d2b  0d0a5457494e2042  	DB	$0D,$0A,"TWIN BEE",$0D,$0A,0
              45450d0a00        
  5497                          ; FROGGER (06, A8)
  5498                          GAMECR11:
  5499  2d38  3a5c41            	LD	A,($415C)
  5500  2d3b  fe06              	CP	$06
  5501  2d3d  201f              	JR	NZ,GAMECR12
  5502  2d3f  3a5d41            	LD	A,($415D)
  5503  2d42  fea8              	CP	$A8
  5504  2d44  2018              	JR	NZ,GAMECR12
  5505  2d46  21522d            	LD	HL,FROGMSG
  5506  2d49  cda627            	CALL	CONPRTS
  5507  2d4c  3e28              	LD	A,$28
  5508  2d4e  325d41            	LD	($415D),A
  5509  2d51  c9                	RET
  5510                          FROGMSG:
  5511  2d52  0d0a46524f474745  	DB	$0D,$0A,"FROGGER",$0D,$0A,0
              520d0a00          
  5512                          ;
  5513                          GAMECR12:
  5514  2d5e  c9                	RET
  5515                          ;
  5516  2d5f  cde927            KBDIN:	call	CONIN
  5517  2d62  200d              	jr	nz,KBDINX
  5518  2d64  3a2230            	ld	a,(KBDCNT)
  5519  2d67  3c                	inc	a
  5520  2d68  e61f              	and	$1F
  5521  2d6a  322230            	ld	(KBDCNT),a
  5522  2d6d  3a2330            	ld	a,(KBDKEY)
  5523  2d70  c0                	ret	nz
  5524  2d71  322330            KBDINX:	ld	(KBDKEY),a
  5525  2d74  c9                	ret
  5526                          KBDRST:
  5527                          ;	xor	a
  5528                          ;	ld	(KBDKEY),a
  5529  2d75  c9                	ret
  5530                          ;
  5531                          KBD10:
  5532  2d76  cd7a2d            	call	KBD
  5533  2d79  c9                	ret
  5534                          ; READ RC KEYBOARD
  5535                          ; C=ROW NUMBER
  5536                          KBD:
  5537  2d7a  cd5f2d            	call	KBDIN
  5538                          ;	ld	a,'K'
  5539                          ;	call	CONOUT
  5540  2d7d  79                	ld	a,c
  5541                          ;	call	OUTHEX
  5542                          ;	call	SPACE
  5543  2d7e  fe00              	cp	$00			; 7,6,5,4,3,2,1,0
  5544  2d80  cab82d            	jp	z,KBD0
  5545  2d83  fe01              	cp	$01			; SEMI,],[,\,=,-,9,8
  5546  2d85  cae92d            	jp	z,KBD1
  5547  2d88  fe02              	cp	$02			; B,A, ,/,DOT,COMMA,`,'
  5548  2d8a  ca1a2e            	jp	z,KBD2
  5549  2d8d  fe03              	cp	$03			; J,I,H,G,F,E,D,C
  5550  2d8f  ca4b2e            	jp	z,KBD3
  5551  2d92  fe04              	cp	$04			; R,Q,P,O,N,M,L,K
  5552  2d94  ca7c2e            	jp	z,KBD4
  5553  2d97  fe05              	cp	$05			; Z,Y,X,W,V,U,T,S
  5554  2d99  caad2e            	jp	z,KBD5
  5555  2d9c  fe06              	cp	$06			; F3,F2,F1,CODE,CAP,GRAPH,CTRL,SHIFT
  5556  2d9e  cade2e            	jp	z,KBD6
  5557  2da1  fe07              	cp	$07			; CR,SEL,BS,STOP,TAB,ESC,F5,F4
  5558  2da3  cae42e            	jp	z,KBD7
  5559  2da6  fe08              	cp	$08			; RGT,DWN,UP,LFT,DEL,INS,HOME,SPC
  5560  2da8  ca012f            	jp	z,KBD8
  5561  2dab  fe09              	cp	$09			; 4,3,2,1,0,X,X,X
  5562  2dad  ca282f            	jp	z,KBD9
  5563  2db0  fe0a              	cp	$0A			; .,COMMA,-,9,8,7,6,5
  5564  2db2  ca4a2f            	jp	z,KBDA
  5565  2db5  3eff              	ld	a,$FF
  5566  2db7  c9                	ret
  5567                          ; 0=FE,1=FC,2=FA,3=F8,4=F6,5=F4,6=F2,7=F0,8=EF,9=CF
  5568                          KBD0:					; 7,6,5,4,3,2,1,0
  5569                          ;	in	a,($F0)
  5570                          ;	cp	$FE			; 0
  5571                          ;	jp	z,KBDBIT1
  5572                          ;	cp	$FC			; 1
  5573                          ;	jp	z,KBDBIT2
  5574                          ;	cp	$F8			; 3
  5575                          ;	jp	z,KBDBIT3
  5576  2db8  3a2330            	ld	a,(KBDKEY)
  5577  2dbb  fe37              	cp	'7'
  5578  2dbd  ca1c30            	jp	z,KBDBIT8
  5579  2dc0  fe36              	cp	'6'
  5580  2dc2  ca1530            	jp	z,KBDBIT7
  5581  2dc5  fe35              	cp	'5'
  5582  2dc7  ca0e30            	jp	z,KBDBIT6
  5583  2dca  fe34              	cp	'4'
  5584  2dcc  ca0730            	jp	z,KBDBIT5
  5585  2dcf  fe33              	cp	'3'
  5586  2dd1  ca0030            	jp	z,KBDBIT4
  5587  2dd4  fe32              	cp	'2'
  5588  2dd6  caf92f            	jp	z,KBDBIT3
  5589  2dd9  fe31              	cp	'1'
  5590  2ddb  caf22f            	jp	z,KBDBIT2
  5591  2dde  fe30              	cp	'0'
  5592  2de0  caeb2f            	jp	z,KBDBIT1
  5593  2de3  3eff              	ld	a,$FF
  5594  2de5  cd2130            	call	KBDBITX
  5595  2de8  c9                	ret
  5596                          ;
  5597                          KBD1:					; SEMI,],[,\,=,-,9,8
  5598  2de9  3a2330            	ld	a,(KBDKEY)
  5599  2dec  fe3b              	cp	';'
  5600  2dee  ca1c30            	jp	z,KBDBIT8
  5601  2df1  fe5d              	cp	']'
  5602  2df3  ca1530            	jp	z,KBDBIT7
  5603  2df6  fe5b              	cp	'['
  5604  2df8  ca0e30            	jp	z,KBDBIT6
  5605  2dfb  fe5c              	cp	$5C
  5606  2dfd  ca0730            	jp	z,KBDBIT5
  5607  2e00  fe3d              	cp	'='
  5608  2e02  ca0030            	jp	z,KBDBIT4
  5609  2e05  fe2d              	cp	'-'
  5610  2e07  caf92f            	jp	z,KBDBIT3
  5611  2e0a  fe39              	cp	'9'
  5612  2e0c  caf22f            	jp	z,KBDBIT2
  5613  2e0f  fe38              	cp	'8'
  5614  2e11  caeb2f            	jp	z,KBDBIT1
  5615  2e14  3eff              	ld	a,$FF
  5616  2e16  cd2130            	call	KBDBITX
  5617  2e19  c9                	ret
  5618                          ;
  5619                          KBD2:					; B,A,&,/,DOT,COMMA,`,'
  5620  2e1a  3a2330            	ld	a,(KBDKEY)
  5621  2e1d  fe42              	cp	'B'
  5622  2e1f  ca1c30            	jp	z,KBDBIT8
  5623  2e22  fe41              	cp	'A'
  5624  2e24  ca1530            	jp	z,KBDBIT7
  5625  2e27  fe26              	cp	'&'
  5626  2e29  ca0e30            	jp	z,KBDBIT6
  5627  2e2c  fe2f              	cp	'/'
  5628  2e2e  ca0730            	jp	z,KBDBIT5
  5629  2e31  fe2e              	cp	'.'
  5630  2e33  ca0030            	jp	z,KBDBIT4
  5631  2e36  fe2c              	cp	','
  5632  2e38  caf92f            	jp	z,KBDBIT3
  5633  2e3b  fe60              	cp	'`'
  5634  2e3d  caf22f            	jp	z,KBDBIT2
  5635  2e40  fe2c              	cp	$2C
  5636  2e42  caeb2f            	jp	z,KBDBIT1
  5637  2e45  3eff              	ld	a,$FF
  5638  2e47  cd2130            	call	KBDBITX
  5639  2e4a  c9                	ret
  5640                          ;
  5641                          KBD3:					; J,I,H,G,F,E,D,C
  5642  2e4b  3a2330            	ld	a,(KBDKEY)
  5643  2e4e  fe4a              	cp	'J'
  5644  2e50  ca1c30            	jp	z,KBDBIT8
  5645  2e53  fe49              	cp	'I'
  5646  2e55  ca1530            	jp	z,KBDBIT7
  5647  2e58  fe48              	cp	'H'
  5648  2e5a  ca0e30            	jp	z,KBDBIT6
  5649  2e5d  fe47              	cp	'G'
  5650  2e5f  ca0730            	jp	z,KBDBIT5
  5651  2e62  fe46              	cp	'F'
  5652  2e64  ca0030            	jp	z,KBDBIT4
  5653  2e67  fe45              	cp	'E'
  5654  2e69  caf92f            	jp	z,KBDBIT3
  5655  2e6c  fe44              	cp	'D'
  5656  2e6e  caf22f            	jp	z,KBDBIT2
  5657  2e71  fe43              	cp	'C'
  5658  2e73  caeb2f            	jp	z,KBDBIT1
  5659  2e76  3eff              	ld	a,$FF
  5660  2e78  cd2130            	call	KBDBITX
  5661  2e7b  c9                	ret
  5662                          ;
  5663                          KBD4:					; R,Q,P,O,N,M,L,K
  5664  2e7c  3a2330            	ld	a,(KBDKEY)
  5665  2e7f  fe52              	cp	'R'
  5666  2e81  ca1c30            	jp	z,KBDBIT8
  5667  2e84  fe51              	cp	'Q'
  5668  2e86  ca1530            	jp	z,KBDBIT7
  5669  2e89  fe50              	cp	'P'
  5670  2e8b  ca0e30            	jp	z,KBDBIT6
  5671  2e8e  fe4f              	cp	'O'
  5672  2e90  ca0730            	jp	z,KBDBIT5
  5673  2e93  fe4e              	cp	'N'
  5674  2e95  ca0030            	jp	z,KBDBIT4
  5675  2e98  fe4d              	cp	'M'
  5676  2e9a  caf92f            	jp	z,KBDBIT3
  5677  2e9d  fe4c              	cp	'L'
  5678  2e9f  caf22f            	jp	z,KBDBIT2
  5679  2ea2  fe4b              	cp	'K'
  5680  2ea4  caeb2f            	jp	z,KBDBIT1
  5681  2ea7  3eff              	ld	a,$FF
  5682  2ea9  cd2130            	call	KBDBITX
  5683  2eac  c9                	ret
  5684                          ;
  5685                          KBD5:					; Z,Y,X,W,V,U,T,S
  5686  2ead  3a2330            	ld	a,(KBDKEY)
  5687  2eb0  fe5a              	cp	'Z'
  5688  2eb2  ca1c30            	jp	z,KBDBIT8
  5689  2eb5  fe59              	cp	'Y'
  5690  2eb7  ca1530            	jp	z,KBDBIT7
  5691  2eba  fe58              	cp	'X'
  5692  2ebc  ca0e30            	jp	z,KBDBIT6
  5693  2ebf  fe57              	cp	'W'
  5694  2ec1  ca0730            	jp	z,KBDBIT5
  5695  2ec4  fe56              	cp	'V'
  5696  2ec6  ca0030            	jp	z,KBDBIT4
  5697  2ec9  fe55              	cp	'U'
  5698  2ecb  caf92f            	jp	z,KBDBIT3
  5699  2ece  fe54              	cp	'T'
  5700  2ed0  caf22f            	jp	z,KBDBIT2
  5701  2ed3  fe53              	cp	'S'
  5702  2ed5  caeb2f            	jp	z,KBDBIT1
  5703  2ed8  3eff              	ld	a,$FF
  5704  2eda  cd2130            	call	KBDBITX
  5705  2edd  c9                	ret
  5706                          ;
  5707                          KBD6:					; F3,F2,F1,CODE,CAP,GRAPH,CTRL,SHIFT
  5708  2ede  3eff              	ld	a,$FF
  5709  2ee0  cd2130            	call	KBDBITX
  5710  2ee3  c9                	ret
  5711                          ;
  5712                          KBD7:					; CR,SEL,BS,STOP,TAB,ESC,F5,F4
  5713  2ee4  3a2330            	ld	a,(KBDKEY)
  5714  2ee7  fe0d              	cp	$0D
  5715  2ee9  ca1c30            	jp	z,KBDBIT8
  5716                          ;	cp	$1B
  5717                          ;	jp	z,KBDBIT7
  5718  2eec  fe08              	cp	$08
  5719  2eee  ca0e30            	jp	z,KBDBIT6
  5720                          ;	cp	$1B
  5721                          ;	jp	z,KBDBIT5
  5722  2ef1  fe09              	cp	$09
  5723  2ef3  ca0030            	jp	z,KBDBIT4
  5724  2ef6  fe1b              	cp	$1B
  5725  2ef8  caf92f            	jp	z,KBDBIT3
  5726                          ;	cp	$1B
  5727                          ;	jp	z,KBDBIT2
  5728                          ;	cp	$1B
  5729                          ;	jp	z,KBDBIT1
  5730  2efb  3eff              	ld	a,$FF
  5731  2efd  cd2130            	call	KBDBITX
  5732  2f00  c9                	ret
  5733                          ;
  5734                          KBD8:					; RGT,DWN,UP,LFT,DEL,INS,HOME,SPC
  5735  2f01  c5                	push	bc
  5736                          ; MSX FORMAT: CAS,KBD,TRGB,TRGA,RGT,LFT,DWN,UP
  5737                          ;	ld	a,(JSTKST)
  5738  2f02  0eff              	ld	c,$FF
  5739                          ;	ld	b,a
  5740                          ;	bit	0,a
  5741                          ;	call	z,KBDSETU1
  5742                          ;	ld	a,b
  5743                          ;	bit	1,a
  5744                          ;	call	z,KBDSETD1
  5745                          ;	ld	a,b
  5746                          ;	bit	2,a
  5747                          ;	call	z,KBDSETL1
  5748                          ;	ld	a,b
  5749                          ;	bit	3,a
  5750                          ;	call	z,KBDSETR1
  5751                          ;	ld	a,b
  5752                          ;	bit	4,a
  5753                          ;	call	z,KBDSETS
  5754  2f04  3a2330            	ld	a,(KBDKEY)
  5755  2f07  fe57              	cp	'W'
  5756  2f09  cc0e30            	call	z,KBDBIT6
  5757  2f0c  fe41              	cp	'A'
  5758  2f0e  cc0730            	call	z,KBDBIT5
  5759  2f11  fe53              	cp	'S'
  5760  2f13  cc1530            	call	z,KBDBIT7
  5761  2f16  fe44              	cp	'D'
  5762  2f18  cc1c30            	call	z,KBDBIT8
  5763  2f1b  fe20              	cp	$20
  5764  2f1d  ccdf2f            	call	z,KBDSETS
  5765  2f20  fe08              	cp	$08
  5766  2f22  cce52f            	call	z,KBDSETDEL
  5767  2f25  79                	ld	a,c
  5768  2f26  c1                	pop	bc
  5769  2f27  c9                	ret
  5770                          ; 0=FE,1=FC,2=FA,3=F8,4=F6,5=F4,6=F2,7=F0,8=EF,9=CF
  5771                          KBD9:					; 4,3,2,1,0,X,X,X
  5772  2f28  3a2330            	ld	a,(KBDKEY)
  5773  2f2b  fe34              	cp	'4'
  5774  2f2d  ca1c30            	jp	z,KBDBIT8
  5775  2f30  fe33              	cp	'3'
  5776  2f32  ca1530            	jp	z,KBDBIT7
  5777  2f35  fe32              	cp	'2'
  5778  2f37  ca0e30            	jp	z,KBDBIT6
  5779  2f3a  fe31              	cp	'1'
  5780  2f3c  ca0730            	jp	z,KBDBIT5
  5781  2f3f  fe30              	cp	'0'
  5782  2f41  ca0030            	jp	z,KBDBIT4
  5783                          ;	cp	$1B
  5784                          ;	jp	z,KBDBIT3
  5785                          ;	cp	$1B
  5786                          ;	jp	z,KBDBIT2
  5787                          ;	cp	$1B
  5788                          ;	jp	z,KBDBIT1
  5789  2f44  3eff              	ld	a,$FF
  5790  2f46  cd2130            	call	KBDBITX
  5791  2f49  c9                	ret
  5792                          ;
  5793                          KBDA:					; .,COMMA,-,9,8,7,6,5
  5794  2f4a  3a2330            	ld	a,(KBDKEY)
  5795  2f4d  fe2e              	cp	'.'
  5796  2f4f  ca1c30            	jp	z,KBDBIT8
  5797  2f52  fe2c              	cp	','
  5798  2f54  ca1530            	jp	z,KBDBIT7
  5799  2f57  fe2d              	cp	'-'
  5800  2f59  ca0e30            	jp	z,KBDBIT6
  5801  2f5c  fe39              	cp	'9'
  5802  2f5e  ca0730            	jp	z,KBDBIT5
  5803  2f61  fe38              	cp	'8'
  5804  2f63  ca0030            	jp	z,KBDBIT4
  5805  2f66  fe37              	cp	'7'
  5806  2f68  caf92f            	jp	z,KBDBIT3
  5807  2f6b  fe36              	cp	'6'
  5808  2f6d  caf22f            	jp	z,KBDBIT2
  5809  2f70  fe35              	cp	'5'
  5810  2f72  caeb2f            	jp	z,KBDBIT1
  5811  2f75  3eff              	ld	a,$FF
  5812  2f77  cd2130            	call	KBDBITX
  5813  2f7a  c9                	ret
  5814                          ; RGT,DWN,UP,LFT,DEL,INS,HOME,SPC
  5815                          KBDSETU1:
  5816  2f7b  cd752d            	call	KBDRST
  5817  2f7e  cba9              	res	5,c
  5818  2f80  cbf1              	set	6,c
  5819  2f82  c9                	ret
  5820                          KBDSETU0:
  5821  2f83  cd752d            	call	KBDRST
  5822  2f86  cbe9              	set	5,c
  5823  2f88  c9                	ret
  5824                          KBDSETD1:
  5825  2f89  cd752d            	call	KBDRST
  5826  2f8c  cbb1              	res	6,c
  5827  2f8e  cbe9              	set	5,c
  5828  2f90  c9                	ret
  5829                          KBDSETD0:
  5830  2f91  cd752d            	call	KBDRST
  5831  2f94  cbf1              	set	6,c
  5832  2f96  c9                	ret
  5833                          KBDSETL1:
  5834  2f97  cd752d            	call	KBDRST
  5835  2f9a  cba1              	res	4,c
  5836  2f9c  cbf9              	set	7,c
  5837  2f9e  c9                	ret
  5838                          KBDSETL0:
  5839  2f9f  cd752d            	call	KBDRST
  5840  2fa2  cbe1              	set	4,c
  5841  2fa4  c9                	ret
  5842                          KBDSETR1:
  5843  2fa5  cd752d            	call	KBDRST
  5844  2fa8  cbb9              	res	7,c
  5845  2faa  cbe1              	set	4,c
  5846  2fac  c9                	ret
  5847                          KBDSETR0:
  5848  2fad  cd752d            	call	KBDRST
  5849  2fb0  cbf9              	set	7,c
  5850  2fb2  c9                	ret
  5851                          ; handle WASD controls
  5852                          ; JSTK BITS: CAS,KBD,TRGB,TRGA,RGT,LFT,DWN,UP
  5853                          KBDJSTK:
  5854  2fb3  cd5f2d            	call	KBDIN
  5855  2fb6  fe57              	cp	'W'
  5856  2fb8  cccb2f            	call	z,KBDJUP
  5857  2fbb  fe53              	cp	'S'
  5858  2fbd  ccd02f            	call	z,KBDJDN
  5859  2fc0  fe41              	cp	'A'
  5860  2fc2  ccd52f            	call	z,KBDJLF
  5861  2fc5  fe44              	cp	'D'
  5862  2fc7  ccda2f            	call	z,KBDJRT
  5863  2fca  c9                	ret
  5864  2fcb  79                KBDJUP:	ld	a,c
  5865  2fcc  e6fe              	and	$FE
  5866  2fce  4f                	ld	c,a
  5867  2fcf  c9                	ret
  5868  2fd0  79                KBDJDN:	ld	a,c
  5869  2fd1  e6fd              	and	$FD
  5870  2fd3  4f                	ld	c,a
  5871  2fd4  c9                	ret
  5872  2fd5  79                KBDJLF:	ld	a,c
  5873  2fd6  e6fb              	and	$FB
  5874  2fd8  4f                	ld	c,a
  5875  2fd9  c9                	ret
  5876  2fda  79                KBDJRT:	ld	a,c
  5877  2fdb  e6f7              	and	$F7
  5878  2fdd  4f                	ld	c,a
  5879  2fde  c9                	ret
  5880                          KBDSETS:
  5881  2fdf  cd752d            	call	KBDRST
  5882  2fe2  cb81              	res	0,c
  5883  2fe4  c9                	ret
  5884                          KBDSETDEL:
  5885  2fe5  cd752d            	call	KBDRST
  5886  2fe8  cb99              	res	3,c
  5887  2fea  c9                	ret
  5888                          ;
  5889                          KBDBIT1:
  5890  2feb  cd752d            	call	KBDRST
  5891  2fee  3efe              	ld	a,$FE
  5892  2ff0  182f              	jr	KBDBITX
  5893                          KBDBIT2:
  5894  2ff2  cd752d            	call	KBDRST
  5895  2ff5  3efd              	ld	a,$FD
  5896  2ff7  1828              	jr	KBDBITX
  5897                          KBDBIT3:
  5898  2ff9  cd752d            	call	KBDRST
  5899  2ffc  3efb              	ld	a,$FB
  5900  2ffe  1821              	jr	KBDBITX
  5901                          KBDBIT4:
  5902  3000  cd752d            	call	KBDRST
  5903  3003  3ef7              	ld	a,$F7
  5904  3005  181a              	jr	KBDBITX
  5905                          KBDBIT5:
  5906  3007  cd752d            	call	KBDRST
  5907  300a  3eef              	ld	a,$EF
  5908  300c  1813              	jr	KBDBITX
  5909                          KBDBIT6:
  5910  300e  cd752d            	call	KBDRST
  5911  3011  3edf              	ld	a,$DF
  5912  3013  180c              	jr	KBDBITX
  5913                          KBDBIT7:
  5914  3015  cd752d            	call	KBDRST
  5915  3018  3ebf              	ld	a,$BF
  5916  301a  1805              	jr	KBDBITX
  5917                          KBDBIT8:
  5918  301c  cd752d            	call	KBDRST
  5919  301f  3e7f              	ld	a,$7F
  5920                          KBDBITX:
  5921                          ;	call	OUTHEX
  5922                          ;	call	CRLF
  5923  3021  c9                	ret
  5924                          ;
  5925  3022  00                KBDCNT:	db	0
  5926  3023  00                KBDKEY:	db	0
  5927                          ;
  5928                          

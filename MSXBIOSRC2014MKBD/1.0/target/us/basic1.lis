basic1.asm:
     1                          ; BASIC.ASM
     2                          
     3                          ; MSX BASIC ROM, MSX 1 version (version 1.0)
     4                          
     5                          ; Source re-created by Z80DIS 2.2
     6                          ; Z80DIS was written by Kenneth Gielow, Palo Alto, CA
     7                          
     8                          ; Code Copyrighted by ASCII and maybe others
     9                          ; Source comments by Arjen Zeilemaker
    10                          
    11                          ; Sourcecode supplied for STUDY ONLY
    12                          ; Recreation NOT permitted without authorisation of the copyrightholders
    13                          
    14                                  INCLUDE "const.def"
const.def:
     1                          DEFC S_COLOR     = $0155
     2                          DEFC S_SCREEN    = $0159
     3                          DEFC S_WIDTHS    = $015D
     4                          DEFC EXTROM      = $015F
     5                          DEFC S_VDP       = $0161
     6                          DEFC CHKSLZ      = $0162
     7                          DEFC S_VDPF      = $0165
     8                          DEFC CHKNEW      = $0165
     9                          DEFC S_BASE      = $0169
    10                          DEFC BIGFIL      = $016B
    11                          DEFC S_BASEF     = $016D
    12                          DEFC S_VPOKE     = $0171
    13                          DEFC S_VPEEK     = $0175
    14                          DEFC S_SETS      = $0179
    15                          DEFC CHGCPU      = $0180
    16                          DEFC S_PROMPT    = $0181
    17                          DEFC GETCPU      = $0183
    18                          DEFC S_SDFSCR    = $0185
    19                          DEFC S_SETSCR    = $0189
    20                          DEFC S_SCOPY     = $018D
    21                          DEFC S_GETPUT    = $01B1
    22                          DEFC VARWRK      = $F380
    23                          DEFC LOW_        = $F406
    24                          DEFC HIGH_       = $F408
    25                          DEFC HEADER      = $F40A
    26                          DEFC ERRFLG      = $F414
    27                          DEFC LPTPOS      = $F415
    28                          DEFC PRTFLG      = $F416
    29                          DEFC NTMSXP      = $F417
    30                          DEFC RAWPRT      = $F418
    31                          DEFC VLZADR      = $F419
    32                          DEFC VLZDAT      = $F41B
    33                          DEFC CURLIN      = $F41C
    34                          DEFC KBFMIN      = $F41E
    35                          DEFC KBUF        = $F41F
    36                          DEFC BUFMIN      = $F55D
    37                          DEFC BUF         = $F55E
    38                          DEFC ENDBUF      = $F660
    39                          DEFC TTYPOS      = $F661
    40                          DEFC DIMFLG      = $F662
    41                          DEFC VALTYP      = $F663
    42                          DEFC DORES       = $F664
    43                          DEFC DONUM       = $F665
    44                          DEFC CONTXT      = $F666
    45                          DEFC CONSAV      = $F668
    46                          DEFC CONTYP      = $F669
    47                          DEFC CONLO       = $F66A
    48                          DEFC MEMSIZ      = $F672
    49                          DEFC STKTOP      = $F674
    50                          DEFC TXTTAB      = $F676
    51                          DEFC TEMPPT      = $F678
    52                          DEFC TEMPST      = $F67A
    53                          DEFC DSCTMP      = $F698
    54                          DEFC FRETOP      = $F69B
    55                          DEFC TEMP3       = $F69D
    56                          DEFC TEMP8       = $F69F
    57                          DEFC ENDFOR      = $F6A1
    58                          DEFC DATLIN      = $F6A3
    59                          DEFC SUBFLG      = $F6A5
    60                          DEFC FLGINP      = $F6A6
    61                          DEFC TEMP        = $F6A7
    62                          DEFC PTRFLG      = $F6A9
    63                          DEFC AUTFLG      = $F6AA
    64                          DEFC AUTLIN      = $F6AB
    65                          DEFC AUTINC      = $F6AD
    66                          DEFC SAVTXT      = $F6AF
    67                          DEFC SAVSTK      = $F6B1
    68                          DEFC ERRLIN      = $F6B3
    69                          DEFC DOT         = $F6B5
    70                          DEFC ERRTXT      = $F6B7
    71                          DEFC ONELIN      = $F6B9
    72                          DEFC ONEFLG      = $F6BB
    73                          DEFC TEMP2       = $F6BC
    74                          DEFC OLDLIN      = $F6BE
    75                          DEFC OLDTXT      = $F6C0
    76                          DEFC VARTAB      = $F6C2
    77                          DEFC ARYTAB      = $F6C4
    78                          DEFC STREND      = $F6C6
    79                          DEFC DATPTR      = $F6C8
    80                          DEFC DEFTBL      = $F6CA
    81                          DEFC PRMSTK      = $F6E4
    82                          DEFC PRMLEN      = $F6E6
    83                          DEFC PARM1       = $F6E8
    84                          DEFC PRMPRV      = $F74C
    85                          DEFC PRMLN2      = $F74E
    86                          DEFC PARM2       = $F750
    87                          DEFC PRMFLG      = $F7B4
    88                          DEFC ARYTA2      = $F7B5
    89                          DEFC NOFUNS      = $F7B7
    90                          DEFC TEMP9       = $F7B8
    91                          DEFC FUNACT      = $F7BA
    92                          DEFC SWPTMP      = $F7BC
    93                          DEFC TRCFLG      = $F7C4
    94                          DEFC FBUFFR      = $F7C5
    95                          DEFC DECTMP      = $F7F0
    96                          DEFC DECTM2      = $F7F2
    97                          DEFC DECCNT      = $F7F4
    98                          DEFC DAC         = $F7F6
    99                          DEFC HOLD8       = $F806
   100                          DEFC ARG         = $F847
   101                          DEFC RNDX        = $F857
   102                          DEFC MAXFIL      = $F85F
   103                          DEFC FILTAB      = $F860
   104                          DEFC NULBUF      = $F862
   105                          DEFC PTRFIL      = $F864
   106                          DEFC FILNAM      = $F866
   107                          DEFC FILNM2      = $F871
   108                          DEFC NLONLY      = $F87C
   109                          DEFC SAVEND      = $F87D
   110                          DEFC FNKSTR      = $F87F
   111                          DEFC CGPNT       = $F91F
   112                          DEFC NAMBAS      = $F922
   113                          DEFC CGPBAS      = $F924
   114                          DEFC PATBAS      = $F926
   115                          DEFC ATRBAS      = $F928
   116                          DEFC CLOC        = $F92A
   117                          DEFC CMASK       = $F92C
   118                          DEFC MINDEL      = $F92D
   119                          DEFC MAXDEL      = $F92F
   120                          DEFC ASPECT      = $F931
   121                          DEFC CENCNT      = $F933
   122                          DEFC CLINEF      = $F935
   123                          DEFC CNPNTS      = $F936
   124                          DEFC CPLOTF      = $F938
   125                          DEFC CPCNT       = $F939
   126                          DEFC CPCNT8      = $F93B
   127                          DEFC CRCSUM      = $F93D
   128                          DEFC CSTCNT      = $F93F
   129                          DEFC CSCLXY      = $F941
   130                          DEFC CSAVEA      = $F942
   131                          DEFC CSAVEM      = $F944
   132                          DEFC CXOFF       = $F945
   133                          DEFC CYOFF       = $F947
   134                          DEFC LOHMSK      = $F949
   135                          DEFC LOHDIR      = $F94A
   136                          DEFC LOHADR      = $F94B
   137                          DEFC LOHCNT      = $F94D
   138                          DEFC SKPCNT      = $F94F
   139                          DEFC MOVCNT      = $F951
   140                          DEFC PDIREC      = $F953
   141                          DEFC LFPROG      = $F954
   142                          DEFC RTPROG      = $F955
   143                          DEFC MCLTAB      = $F956
   144                          DEFC MCLFLG      = $F958
   145                          DEFC QUETAB      = $F959
   146                          DEFC QUEBAK      = $F971
   147                          DEFC VOICAQ      = $F975
   148                          DEFC PRSCNT      = $FB35
   149                          DEFC SAVSP       = $FB36
   150                          DEFC VOICEN      = $FB38
   151                          DEFC SAVVOL      = $FB39
   152                          DEFC MCLLEN      = $FB3B
   153                          DEFC MCLPTR      = $FB3C
   154                          DEFC QUEUEN      = $FB3E
   155                          DEFC MUSICF      = $FB3F
   156                          DEFC PLYCNT      = $FB40
   157                          DEFC VCBA        = $FB41
   158                          DEFC VCBB        = $FB66
   159                          DEFC VCBC        = $FB8B
   160                          DEFC ENSTOP      = $FBB0
   161                          DEFC BASROM      = $FBB1
   162                          DEFC LINTTB      = $FBB2
   163                          DEFC FSTPOS      = $FBCA
   164                          DEFC CURSAV      = $FBCC
   165                          DEFC FNKSWI      = $FBCD
   166                          DEFC FNKFLG      = $FBCE
   167                          DEFC ONGSBF      = $FBD8
   168                          DEFC CLIKFL      = $FBD9
   169                          DEFC OLDKEY      = $FBDA
   170                          DEFC NEWKEY      = $FBE5
   171                          DEFC KEYBUF      = $FBF0
   172                          DEFC LINWRK      = $FC18
   173                          DEFC PATWRK      = $FC40
   174                          DEFC BOTTOM      = $FC48
   175                          DEFC HIMEM       = $FC4A
   176                          DEFC TRPTBL      = $FC4C
   177                          DEFC INTFLG      = $FC9B
   178                          DEFC PADY        = $FC9C
   179                          DEFC PADX        = $FC9D
   180                          DEFC JIFFY       = $FC9E
   181                          DEFC INTVAL      = $FCA0
   182                          DEFC INTCNT      = $FCA2
   183                          DEFC LOWLIM      = $FCA4
   184                          DEFC WINWID      = $FCA5
   185                          DEFC GRPHED      = $FCA6
   186                          DEFC ESCCNT      = $FCA7
   187                          DEFC INSFLG      = $FCA8
   188                          DEFC CSRSR       = $FCA9
   189                          DEFC CSTYLE      = $FCAA
   190                          DEFC CAPST       = $FCAB
   191                          DEFC KANAST      = $FCAC
   192                          DEFC KANAMD      = $FCAD
   193                          DEFC FLBMEM      = $FCAE
   194                          DEFC SCRMOD      = $FCAF
   195                          DEFC OLDSCR      = $FCB0
   196                          DEFC CASPRV      = $FCB1
   197                          DEFC BRDATR      = $FCB2
   198                          DEFC GXPOS       = $FCB3
   199                          DEFC GYPOS       = $FCB5
   200                          DEFC GRPACX      = $FCB7
   201                          DEFC GRPACY      = $FCB9
   202                          DEFC DRWFLG      = $FCBB
   203                          DEFC DRWSCL      = $FCBC
   204                          DEFC DRWANG      = $FCBD
   205                          DEFC RUNBNF      = $FCBE
   206                          DEFC SAVENT      = $FCBF
   207                          DEFC EXPTBL      = $FCC1
   208                          DEFC SLTTBL      = $FCC5
   209                          DEFC SLTATR      = $FCC9
   210                          DEFC SLTWRK      = $FD09
   211                          DEFC PROCNM      = $FD89
   212                          DEFC DEVICE      = $FD99
   213                          DEFC H_KEYI      = $FD9A
   214                          DEFC H_TIMI      = $FD9F
   215                          DEFC H_CHPU      = $FDA4
   216                          DEFC H_DSPC      = $FDA9
   217                          DEFC H_ERAC      = $FDAE
   218                          DEFC H_DSPF      = $FDB3
   219                          DEFC H_ERAF      = $FDB8
   220                          DEFC H_TOTE      = $FDBD
   221                          DEFC H_CHGE      = $FDC2
   222                          DEFC H_INIP      = $FDC7
   223                          DEFC H_KEYC      = $FDCC
   224                          DEFC H_KEYA      = $FDD1
   225                          DEFC H_NMI       = $FDD6
   226                          DEFC H_PINL      = $FDDB
   227                          DEFC H_QINL      = $FDE0
   228                          DEFC H_INLI      = $FDE5
   229                          DEFC H_ONGO      = $FDEA
   230                          DEFC H_DSKO      = $FDEF
   231                          DEFC H_SETS      = $FDF4
   232                          DEFC H_NAME      = $FDF9
   233                          DEFC H_KILL      = $FDFE
   234                          DEFC H_IPL       = $FE03
   235                          DEFC H_COPY      = $FE08
   236                          DEFC H_CMD       = $FE0D
   237                          DEFC H_DSKF      = $FE12
   238                          DEFC H_DSKI      = $FE17
   239                          DEFC H_ATTR      = $FE1C
   240                          DEFC H_LSET      = $FE21
   241                          DEFC H_RSET      = $FE26
   242                          DEFC H_FIEL      = $FE2B
   243                          DEFC H_MKI       = $FE30
   244                          DEFC H_MKS       = $FE35
   245                          DEFC H_MKD       = $FE3A
   246                          DEFC H_CVI       = $FE3F
   247                          DEFC H_CVS       = $FE44
   248                          DEFC H_CVD       = $FE49
   249                          DEFC H_GETP      = $FE4E
   250                          DEFC H_SETF      = $FE53
   251                          DEFC H_NOFO      = $FE58
   252                          DEFC H_NULO      = $FE5D
   253                          DEFC H_NTFL      = $FE62
   254                          DEFC H_MERG      = $FE67
   255                          DEFC H_SAVE      = $FE6C
   256                          DEFC H_BINS      = $FE71
   257                          DEFC H_BINL      = $FE76
   258                          DEFC H_FILE      = $FE7B
   259                          DEFC H_DGET      = $FE80
   260                          DEFC H_FILO      = $FE85
   261                          DEFC H_INDS      = $FE8A
   262                          DEFC H_RSLF      = $FE8F
   263                          DEFC H_SAVD      = $FE94
   264                          DEFC H_LOC       = $FE99
   265                          DEFC H_LOF       = $FE9E
   266                          DEFC H_EOF       = $FEA3
   267                          DEFC H_FPOS      = $FEA8
   268                          DEFC H_BAKU      = $FEAD
   269                          DEFC H_PARD      = $FEB2
   270                          DEFC H_NODE      = $FEB7
   271                          DEFC H_POSD      = $FEBC
   272                          DEFC H_GEND      = $FEC6
   273                          DEFC H_RUNC      = $FECB
   274                          DEFC H_CLEA      = $FED0
   275                          DEFC H_LOPD      = $FED5
   276                          DEFC H_STKE      = $FEDA
   277                          DEFC H_ISFL      = $FEDF
   278                          DEFC H_OUTD      = $FEE4
   279                          DEFC H_CRDO      = $FEE9
   280                          DEFC H_DSKC      = $FEEE
   281                          DEFC H_DOGR      = $FEF3
   282                          DEFC H_PRGE      = $FEF8
   283                          DEFC H_ERRP      = $FEFD
   284                          DEFC H_ERRF      = $FF02
   285                          DEFC H_READ      = $FF07
   286                          DEFC H_MAIN      = $FF0C
   287                          DEFC H_DIRD      = $FF11
   288                          DEFC H_FINI      = $FF16
   289                          DEFC H_FINE      = $FF1B
   290                          DEFC H_CRUN      = $FF20
   291                          DEFC H_CRUS      = $FF25
   292                          DEFC H_ISRE      = $FF2A
   293                          DEFC H_NTFN      = $FF2F
   294                          DEFC H_NOTR      = $FF34
   295                          DEFC H_SNGF      = $FF39
   296                          DEFC H_NEWS      = $FF3E
   297                          DEFC H_GONE      = $FF43
   298                          DEFC H_CHRG      = $FF48
   299                          DEFC H_RETU      = $FF4D
   300                          DEFC H_PRTF      = $FF52
   301                          DEFC H_COMP      = $FF57
   302                          DEFC H_FINP      = $FF5C
   303                          DEFC H_TRMN      = $FF61
   304                          DEFC H_FRME      = $FF66
   305                          DEFC H_NTPL      = $FF6B
   306                          DEFC H_EVAL      = $FF70
   307                          DEFC H_OKNO      = $FF75
   308                          DEFC H_FING      = $FF7A
   309                          DEFC H_ISMI      = $FF7F
   310                          DEFC H_WIDT      = $FF84
   311                          DEFC H_LIST      = $FF89
   312                          DEFC H_BUFL      = $FF8E
   313                          DEFC H_FRQI      = $FF93
   314                          DEFC H_SCNE      = $FF98
   315                          DEFC H_FRET      = $FF9D
   316                          DEFC H_PTRG      = $FFA2
   317                          DEFC H_PHYD      = $FFA7
   318                          DEFC H_FORM      = $FFAC
   319                          DEFC H_ERRO      = $FFB1
   320                          DEFC H_LPTO      = $FFB6
   321                          DEFC H_LPTS      = $FFBB
   322                          DEFC H_SCRE      = $FFC0
   323                          DEFC H_PLAY      = $FFC5
   324                          DEFC EXTBIO      = $FFCA
   325                          DEFC D_FFFF      = $FFFF
   326                          
basic1.asm:
    15                                  INCLUDE "msx.def"
msx.def:
     1                          ; MSX version
     2                                  DEFC    MSXVER  = 0
     3                          
     4                          ;       OPTM    Optimized code
     5                          ;               0 = Use orginal code
     6                          ;               1 = Use optimized code
     7                          
     8                                  DEFC    OPTM    = 0
     9                          
    10                          ;       NDEVFIX
    11                          ;               0 = Use null device bug
    12                          ;               1 = Use null device bugfix
    13                          
    14                                  DEFC    NDEVFIX = 1
    15                          
    16                          ;       SLOTFIX
    17                          ;               0 = Use slot bug
    18                          ;               1 = Use slot bugfix
    19                          
    20                                  DEFC    SLOTFIX = 0
    21                          
    22                          ;       CNTRY   Country
    23                          ;               0 = Japan
    24                          ;               1 = USA
    25                          ;               2 = International
    26                          ;               3 = UK
    27                          ;               4 = France
    28                          ;               5 = Germany
    29                          ;               6 = Italy
    30                          ;               7 = Spain
    31                          ;               8 = Arabic
    32                          ;               9 = Korea
    33                          ;               10 = Russia
    34                          
    35                          ; Uncomment this to define the language
    36                          ;        DEFC    CNTRY   = 1
    37                          
    38                          
    39                          ;       symbols used to procedure alternate code
    40                          
    41                          ;       INTHZ   interrupt frequency
    42                          ;       CHRGEN  character generator
    43                          ;               0 = japanese
    44                          ;               1 = international
    45                          ;               2 = USSR ??
    46                          ;       DATFMT  date format
    47                          ;               0 = Y-M-D
    48                          ;               1 = M-D-Y
    49                          ;               2 = D-M-Y
    50                          ;       KEYTYP  keyboard layout
    51                          ;               0 = Japanese
    52                          ;               1 = International (QWERTY/other)
    53                          ;               2 = French (AZERTY)
    54                          ;               3 = English
    55                          ;               4 = German (DIN)
    56                          ;               5 = USSR
    57                          ;               6 = Spanish
    58                          ;               7 = Swedish ??
    59                          ;       BASVER  0 = Japanese
    60                          ;               1 = International
    61                          
    62                          
    63                          ; Japanese MSX settings
    64                                  IF      CNTRY = 0
    65                          
    66                                  DEFC    INTHZ   = 60
    67                                  DEFC    CHRGEN  = 0
    68                                  DEFC    DATFMT  = 0
    69                                  DEFC    KEYTYP  = 0
    70                                  DEFC    BASVER  = 0
    71                          
    72                                  ENDIF
    73                          
    74                          ; USA MSX settings
    75                                  IF      CNTRY = 1
    76                          
    77                                  DEFC    INTHZ   = 60
    78                                  DEFC    CHRGEN  = 1
    79                                  DEFC    DATFMT  = 1
    80                                  DEFC    KEYTYP  = 1
    81                                  DEFC    BASVER  = 1
    82                          
    83                                  ENDIF
    84                          
    85                          ; International MSX settings
    86                                  IF      CNTRY = 2
    87                          
    88                                  DEFC    INTHZ   = 50
    89                                  DEFC    CHRGEN  = 1
    90                                  DEFC    DATFMT  = 1
    91                                  DEFC    KEYTYP  = 1
    92                                  DEFC    BASVER  = 1
    93                          
    94                                  ENDIF
    95                          
    96                          ; UK MSX settings
    97                                  IF      CNTRY = 3
    98                          
    99                                  DEFC    INTHZ   = 50
   100                                  DEFC    CHRGEN  = 1
   101                                  DEFC    DATFMT  = 2
   102                                  DEFC    KEYTYP  = 3
   103                                  DEFC    BASVER  = 1
   104                          
   105                                  ENDIF
   106                          
   107                          ; French MSX settings
   108                                  IF      CNTRY = 4
   109                          
   110                                  DEFC    INTHZ   = 50
   111                                  DEFC    CHRGEN  = 1
   112                                  DEFC    DATFMT  = 2
   113                                  DEFC    KEYTYP  = 2
   114                                  DEFC    BASVER  = 1
   115                          
   116                                  ENDIF
   117                          
   118                          ; German MSX settings
   119                                  IF      CNTRY = 5
   120                          
   121                                  DEFC    INTHZ   = 50
   122                                  DEFC    CHRGEN  = 1
   123                                  DEFC    DATFMT  = 2
   124                                  DEFC    KEYTYP  = 4
   125                                  DEFC    BASVER  = 1
   126                          
   127                                  ENDIF
   128                          
   129                          ; Italian MSX settings
   130                          ; Dateformat is not sure
   131                                  IF      CNTRY = 6
   132                          
   133                                  DEFC    INTHZ   = 50
   134                                  DEFC    CHRGEN  = 1
   135                                  DEFC    DATFMT  = 2
   136                                  DEFC    KEYTYP  = 1
   137                                  DEFC    BASVER  = 1
   138                          
   139                                  ENDIF
   140                          
   141                          ; Spanish MSX settings
   142                                  IF      CNTRY = 7
   143                          
   144                                  DEFC    INTHZ   = 50
   145                                  DEFC    CHRGEN  = 1
   146                                  DEFC    DATFMT  = 1
   147                                  DEFC    KEYTYP  = 6
   148                                  DEFC    BASVER  = 1
   149                          
   150                                  ENDIF
   151                          
   152                          ; Arabic MSX settings
   153                          ; Unknown
   154                                  IF      CNTRY = 8
   155                          
   156                                  DEFC    INTHZ   = 60
   157                                  DEFC    CHRGEN  = 0
   158                                  DEFC    DATFMT  = 0
   159                                  DEFC    KEYTYP  = 0
   160                                  DEFC    BASVER  = 0
   161                          
   162                                  ENDIF
   163                          
   164                          ; Korean MSX settings
   165                                  IF      CNTRY = 9
   166                          
   167                                  DEFC    INTHZ   = 60
   168                                  DEFC    CHRGEN  = 0
   169                                  DEFC    DATFMT  = 0
   170                                  DEFC    KEYTYP  = 0
   171                                  DEFC    BASVER  = 0
   172                          
   173                                  ENDIF
   174                          
   175                          ; Russian MSX settings
   176                                  IF      CNTRY = 10
   177                          
   178                                  DEFC    INTHZ   = 60
   179                                  DEFC    CHRGEN  = 2
   180                                  DEFC    DATFMT  = 1
   181                                  DEFC    KEYTYP  = 5
   182                                  DEFC    BASVER  = 1
   183                          
   184                                  ENDIF
   185                          
   186                                  IF      BASVER = 0
   187                                  DEFC    CHRCUR  = $5C            ; yen sign
   188                                  DEFC    CHRFLN  = '&'
   189                                  DEFC    CHRVLN  = '@'
   190                                  ENDIF
   191                          
   192                                  IF      (BASVER = 1) && (CNTRY <> 3)
   193                                  DEFC    CHRCUR  = '$'
   194                                  DEFC    CHRFLN  = '\\'
   195                                  DEFC    CHRVLN  = '&'
   196                                  ENDIF
   197                          
   198                                  IF      (BASVER = 1) && (CNTRY = 3)
   199                                  DEFC    CHRCUR  = $AC            ; pound sign
   200                                  DEFC    CHRFLN  = '\\'
   201                                  DEFC    CHRVLN  = '&'
   202                                  ENDIF
   203                          
   204                          
basic1.asm:
    16                          
    17                          ; Define some RST vectors
    18                                  DEFC    CHRGTR = $10
    19                                  DEFC    DCOMPR = $20
    20                                  DEFC    GETYPR = $28
    21                          
    22                          ; Declare public symbols used from basic2.asm
    23                                  PUBLIC  C268C
    24                                  PUBLIC  C2697
    25                                  PUBLIC  C269A
    26                                  PUBLIC  C27E6
    27                                  PUBLIC  C289F
    28                                  PUBLIC  C2993
    29                                  PUBLIC  C29AC
    30                                  PUBLIC  C29FB
    31                                  PUBLIC  C2A14
    32                                  PUBLIC  C2A72
    33                                  PUBLIC  C2AFF
    34                                  PUBLIC  C2B4A
    35                                  PUBLIC  C2BDF
    36                                  PUBLIC  C2C24
    37                                  PUBLIC  C2E71
    38                                  PUBLIC  C2E82
    39                                  PUBLIC  C2E86
    40                                  PUBLIC  C2E97
    41                                  PUBLIC  C2E9A
    42                                  PUBLIC  C2EA1
    43                                  PUBLIC  C2EAB
    44                                  PUBLIC  C2EB1
    45                                  PUBLIC  C2EBE
    46                                  PUBLIC  C2EC1
    47                                  PUBLIC  C2ECC
    48                                  PUBLIC  C2ED6
    49                                  PUBLIC  C2EDF
    50                                  PUBLIC  C2EE1
    51                                  PUBLIC  C2EE8
    52                                  PUBLIC  C2EEF
    53                                  PUBLIC  C2EF3
    54                                  PUBLIC  C2EF7
    55                                  PUBLIC  C2F08
    56                                  PUBLIC  C2F0D
    57                                  PUBLIC  C2F10
    58                                  PUBLIC  C2F21
    59                                  PUBLIC  C2F4D
    60                                  PUBLIC  C2F5C
    61                                  PUBLIC  C2F83
    62                                  PUBLIC  C2F8A
    63                                  PUBLIC  C2F99
    64                                  PUBLIC  C2FB2
    65                                  PUBLIC  C2FCB
    66                                  PUBLIC  C303A
    67                                  PUBLIC  C3058
    68                                  PUBLIC  C30BE
    69                                  PUBLIC  C30CF
    70                                  PUBLIC  C314A
    71                                  PUBLIC  C3167
    72                                  PUBLIC  C3172
    73                                  PUBLIC  C3193
    74                                  PUBLIC  C31E6
    75                                  PUBLIC  C3236
    76                                  PUBLIC  C323A
    77                                  PUBLIC  C324E
    78                                  PUBLIC  C3257
    79                                  PUBLIC  C325C
    80                                  PUBLIC  C3267
    81                                  PUBLIC  C3299
    82                                  PUBLIC  C340A
    83                                  PUBLIC  C3412
    84                                  PUBLIC  C3425
    85                                  PUBLIC  C3426
    86                                  PUBLIC  C371A
    87                                  PUBLIC  C371E
    88                                  PUBLIC  C3722
    89                                  PUBLIC  C37C8
    90                                  PUBLIC  C37D7
    91                                  PUBLIC  C383F
    92                                  PUBLIC  I2D1B
    93                                  PUBLIC  J2E79
    94                                  PUBLIC  J3265
    95                                  PUBLIC  J3297
    96                          
    97                          ; Declared external references to the basic2.asm program
    98                                  EXTERN  C475A
    99                                  EXTERN  C4EB8
   100                                  EXTERN  C4F47
   101                                  EXTERN  C5439
   102                                  EXTERN  C6678
   103                                  EXTERN  I3FD2
   104                                  EXTERN  I6677
   105                                  EXTERN  J4058
   106                                  EXTERN  J4067
   107                                  EXTERN  J406D
   108                                  EXTERN  J601D
   109                                  EXTERN  J66A7
   110                          
   111                          ; Program start
   112                          ;       ORG     $268C
   113                          
   114                          ;       Subroutine      DECSUB (dbl subtract)
   115                          ;       Inputs          (DAC) = first operand, (ARG) = second operand
   116                          ;       Outputs         ________________________
   117                          
   118  0000  2147f8            C268C:  LD      HL,ARG
   119  0003  7e                        LD      A,(HL)
   120  0004  b7                        OR      A
   121  0005  c8                        RET     Z                       ; 2nd operand zero, quit
   122  0006  ee80                      XOR     $80
   123  0008  77                        LD      (HL),A                  ; negate 2nd operand
   124  0009  1809                      JR      J26A0                   ; and do ADD
   125                          
   126                          ;       Subroutine      double real addition
   127                          ;       Inputs          (DAC) = first operand, (HL) = second operand
   128                          ;       Outputs         ________________________
   129                          
   130  000b  cd6308            C2697:  CALL    C2EEF                   ; ARG = HL
   131                          
   132                          ;       Subroutine      DECADD (dbl addition)
   133                          ;       Inputs          (DAC) = first operand, (ARG) = second operand
   134                          ;       Outputs         ________________________
   135                          
   136  000e  2147f8            C269A:  LD      HL,ARG
   137  0011  7e                        LD      A,(HL)
   138  0012  b7                        OR      A
   139  0013  c8                        RET     Z                       ; 2nd operand zero, quit
   140  0014  e67f              J26A0:  AND     $7F
   141  0016  47                        LD      B,A
   142  0017  11f6f7                    LD      DE,DAC
   143  001a  1a                        LD      A,(DE)
   144  001b  b7                        OR      A
   145  001c  ca7908                    JP      Z,C2F05                 ; DAC = ARG and quit
   146  001f  e67f                      AND     $7F
   147  0021  90                        SUB     B
   148  0022  3011                      JR      NC,J26C1
   149  0024  2f                        CPL
   150  0025  3c                        INC     A
   151  0026  f5                        PUSH    AF
   152  0027  e5                        PUSH    HL
   153  0028  0608                      LD      B,8
   154  002a  1a                J26B6:  LD      A,(DE)
   155  002b  4e                        LD      C,(HL)
   156  002c  77                        LD      (HL),A
   157  002d  79                        LD      A,C
   158  002e  12                        LD      (DE),A
   159  002f  13                        INC     DE
   160  0030  23                        INC     HL
   161  0031  10f7                      DJNZ    J26B6
   162  0033  e1                        POP     HL
   163  0034  f1                        POP     AF
   164  0035  fe10              J26C1:  CP      16
   165  0037  d0                        RET     NC
   166  0038  f5                        PUSH    AF
   167  0039  af                        XOR     A
   168  003a  32fef7                    LD      (DAC+8),A
   169  003d  324ff8                    LD      (ARG+8),A
   170  0040  2148f8                    LD      HL,ARG+1
   171  0043  f1                        POP     AF
   172  0044  cd1701                    CALL    C27A3
   173  0047  2147f8                    LD      HL,ARG
   174  004a  3af6f7                    LD      A,(DAC)
   175  004d  ae                        XOR     (HL)
   176  004e  fa6b00                    JP      M,J26F7
   177  0051  3a4ff8                    LD      A,(ARG+8)
   178  0054  32fef7                    LD      (DAC+8),A
   179  0057  cdcd00                    CALL    C2759
   180  005a  d2b000                    JP      NC,C273C                ; round DAC and quit
   181  005d  eb                        EX      DE,HL
   182  005e  7e                        LD      A,(HL)
   183  005f  34                        INC     (HL)
   184  0060  ae                        XOR     (HL)
   185  0061  fa0000                    JP      M,J4067                 ; overflow error
   186  0064  cd4f01                    CALL    C27DB
   187  0067  cbe6                      SET     4,(HL)
   188  0069  1845                      JR      C273C                   ; round DAC and quit
   189                          
   190  006b  cddf00            J26F7:  CALL    C276B
   191                          
   192                          ;       Subroutine      DECNRM
   193                          ;       Inputs          ________________________
   194                          ;       Outputs         ________________________
   195                          
   196  006e  21f7f7            C26FA:  LD      HL,DAC+1
   197  0071  010008                    LD      BC,$0800
   198  0074  7e                J2700:  LD      A,(HL)
   199  0075  b7                        OR      A
   200  0076  2008                      JR      NZ,J270C
   201  0078  23                        INC     HL
   202  0079  0d                        DEC     C
   203  007a  0d                        DEC     C
   204  007b  10f7                      DJNZ    J2700
   205  007d  c3f107                    JP      J2E7D                   ; DAC = 0 and quit
   206                          
   207  0080  e6f0              J270C:  AND     $F0
   208  0082  2006                      JR      NZ,J2716
   209  0084  e5                        PUSH    HL
   210  0085  cd0b01                    CALL    C2797
   211  0088  e1                        POP     HL
   212  0089  0d                        DEC     C
   213  008a  3e08              J2716:  LD      A,8
   214  008c  90                        SUB     B
   215  008d  2812                      JR      Z,J272D
   216  008f  f5                        PUSH    AF
   217  0090  c5                        PUSH    BC
   218  0091  48                        LD      C,B
   219  0092  11f7f7                    LD      DE,DAC+1
   220  0095  0600                      LD      B,0
   221  0097  edb0                      LDIR
   222  0099  c1                        POP     BC
   223  009a  f1                        POP     AF
   224  009b  47                        LD      B,A
   225  009c  af                        XOR     A
   226  009d  12                J2729:  LD      (DE),A
   227  009e  13                        INC     DE
   228  009f  10fc                      DJNZ    J2729
   229  00a1  79                J272D:  LD      A,C
   230  00a2  b7                        OR      A
   231  00a3  280b                      JR      Z,C273C                 ; round DAC and quit
   232  00a5  21f6f7                    LD      HL,DAC
   233  00a8  46                        LD      B,(HL)
   234  00a9  86                        ADD     A,(HL)
   235  00aa  77                        LD      (HL),A
   236  00ab  a8                        XOR     B
   237  00ac  fa0000                    JP      M,J4067                 ; overflow error
   238  00af  c8                        RET     Z
   239                          
   240                          ;       Subroutine      DECROU
   241                          ;       Inputs          ________________________
   242                          ;       Outputs         ________________________
   243                          
   244  00b0  21fef7            C273C:  LD      HL,DAC+8
   245  00b3  0607                      LD      B,7
   246                          
   247                          ;       Subroutine      __________________________
   248                          ;       Inputs          ________________________
   249                          ;       Outputs         ________________________
   250                          
   251  00b5  7e                C2741:  LD      A,(HL)
   252  00b6  fe50                      CP      $50
   253  00b8  d8                        RET     C
   254  00b9  2b                        DEC     HL
   255  00ba  af                        XOR     A
   256  00bb  37                        SCF
   257  00bc  8e                J2748:  ADC     A,(HL)
   258  00bd  27                        DAA
   259  00be  77                        LD      (HL),A
   260  00bf  d0                        RET     NC
   261  00c0  2b                        DEC     HL
   262  00c1  10f9                      DJNZ    J2748
   263  00c3  7e                        LD      A,(HL)
   264  00c4  34                        INC     (HL)
   265  00c5  ae                        XOR     (HL)
   266  00c6  fa0000                    JP      M,J4067                 ; overflow error
   267  00c9  23                        INC     HL
   268  00ca  3610                      LD      (HL),$10
   269  00cc  c9                        RET
   270                          
   271                          ;       Subroutine      __________________________
   272                          ;       Inputs          ________________________
   273                          ;       Outputs         ________________________
   274                          
   275  00cd  214ef8            C2759:  LD      HL,ARG+7
   276  00d0  11fdf7                    LD      DE,DAC+7
   277  00d3  0607                      LD      B,7
   278                          
   279                          ;       Subroutine      __________________________
   280                          ;       Inputs          ________________________
   281                          ;       Outputs         ________________________
   282                          
   283  00d5  af                C2761:  XOR     A
   284  00d6  1a                J2762:  LD      A,(DE)
   285  00d7  8e                        ADC     A,(HL)
   286  00d8  27                        DAA
   287  00d9  12                        LD      (DE),A
   288  00da  1b                        DEC     DE
   289  00db  2b                        DEC     HL
   290  00dc  10f8                      DJNZ    J2762
   291  00de  c9                        RET
   292                          
   293                          ;       Subroutine      __________________________
   294                          ;       Inputs          ________________________
   295                          ;       Outputs         ________________________
   296                          
   297  00df  214ff8            C276B:  LD      HL,ARG+8
   298  00e2  7e                        LD      A,(HL)
   299  00e3  fe50                      CP      $50
   300  00e5  2001                      JR      NZ,J2774
   301  00e7  34                        INC     (HL)
   302  00e8  11fef7            J2774:  LD      DE,DAC+8
   303  00eb  0608                      LD      B,8
   304  00ed  af                        XOR     A
   305  00ee  1a                J277A:  LD      A,(DE)
   306  00ef  9e                        SBC     A,(HL)
   307  00f0  27                        DAA
   308  00f1  12                        LD      (DE),A
   309  00f2  1b                        DEC     DE
   310  00f3  2b                        DEC     HL
   311  00f4  10f8                      DJNZ    J277A
   312  00f6  d0                        RET     NC
   313  00f7  eb                        EX      DE,HL
   314  00f8  7e                        LD      A,(HL)
   315  00f9  ee80                      XOR     $80
   316  00fb  77                        LD      (HL),A
   317  00fc  21fef7                    LD      HL,DAC+8
   318  00ff  0608                      LD      B,8
   319  0101  af                        XOR     A
   320  0102  3e00              J278E:  LD      A,$0
   321  0104  9e                        SBC     A,(HL)
   322  0105  27                        DAA
   323  0106  77                        LD      (HL),A
   324  0107  2b                        DEC     HL
   325  0108  10f8                      DJNZ    J278E
   326  010a  c9                        RET
   327                          
   328                          ;       Subroutine      __________________________
   329                          ;       Inputs          ________________________
   330                          ;       Outputs         ________________________
   331                          
   332  010b  21fef7            C2797:  LD      HL,DAC+8
   333                          
   334                          ;       Subroutine      __________________________
   335                          ;       Inputs          ________________________
   336                          ;       Outputs         ________________________
   337                          
   338  010e  c5                C279A:  PUSH    BC
   339  010f  af                        XOR     A
   340  0110  ed6f              J279C:  RLD
   341  0112  2b                        DEC     HL
   342  0113  10fb                      DJNZ    J279C
   343  0115  c1                        POP     BC
   344  0116  c9                        RET
   345                          
   346                          ;       Subroutine      __________________________
   347                          ;       Inputs          ________________________
   348                          ;       Outputs         ________________________
   349                          
   350  0117  b7                C27A3:  OR      A
   351  0118  1f                        RRA
   352  0119  f5                        PUSH    AF
   353  011a  b7                        OR      A
   354  011b  ca5601                    JP      Z,J27E2
   355  011e  f5                        PUSH    AF
   356  011f  2f                        CPL
   357  0120  3c                        INC     A
   358  0121  4f                        LD      C,A
   359  0122  06ff                      LD      B,$FF
   360  0124  110700                    LD      DE,7
   361  0127  19                        ADD     HL,DE
   362  0128  54                        LD      D,H
   363  0129  5d                        LD      E,L
   364  012a  09                        ADD     HL,BC
   365  012b  3e08                      LD      A,8
   366  012d  81                        ADD     A,C
   367  012e  4f                        LD      C,A
   368  012f  c5                        PUSH    BC
   369  0130  0600                      LD      B,$0
   370  0132  edb8                      LDDR
   371  0134  c1                        POP     BC
   372  0135  f1                        POP     AF
   373  0136  23                        INC     HL
   374  0137  13                        INC     DE
   375  0138  d5                        PUSH    DE
   376  0139  47                        LD      B,A
   377  013a  af                        XOR     A
   378  013b  77                J27C7:  LD      (HL),A
   379  013c  23                        INC     HL
   380  013d  10fc                      DJNZ    J27C7
   381  013f  e1                        POP     HL
   382  0140  f1                        POP     AF
   383  0141  d0                        RET     NC
   384  0142  79                        LD      A,C
   385  0143  e5                J27CF:  PUSH    HL
   386  0144  c5                        PUSH    BC
   387  0145  47                        LD      B,A
   388  0146  af                        XOR     A
   389  0147  ed67              J27D3:  RRD
   390  0149  23                        INC     HL
   391  014a  10fb                      DJNZ    J27D3
   392  014c  c1                        POP     BC
   393  014d  e1                        POP     HL
   394  014e  c9                        RET
   395                          
   396                          ;       Subroutine      __________________________
   397                          ;       Inputs          ________________________
   398                          ;       Outputs         ________________________
   399                          
   400  014f  21f7f7            C27DB:  LD      HL,DAC+1
   401  0152  3e08              J27DE:  LD      A,8
   402  0154  18ed                      JR      J27CF
   403                          
   404  0156  f1                J27E2:  POP     AF
   405  0157  d0                        RET     NC
   406  0158  18f8                      JR      J27DE
   407                          
   408                          ;       Subroutine      DECMUL
   409                          ;       Inputs          ________________________
   410                          ;       Outputs         ________________________
   411                          
   412  015a  cde507            C27E6:  CALL    C2E71                   ; get sign DAC
   413  015d  c8                        RET     Z                       ; DAC is zero, quit (result is zero)
   414  015e  3a47f8                    LD      A,(ARG+0)
   415  0161  b7                        OR      A
   416  0162  caf107                    JP      Z,J2E7D                 ; DAC = 0 and quit
   417  0165  47                        LD      B,A
   418  0166  21f6f7                    LD      HL,DAC
   419  0169  ae                        XOR     (HL)
   420  016a  e680                      AND     $80
   421  016c  4f                        LD      C,A
   422  016d  cbb8                      RES     7,B
   423  016f  7e                        LD      A,(HL)
   424  0170  e67f                      AND     $7F
   425  0172  80                        ADD     A,B
   426  0173  47                        LD      B,A
   427  0174  3600                      LD      (HL),$0
   428  0176  e6c0                      AND     $C0
   429  0178  c8                        RET     Z
   430  0179  fec0                      CP      $C0
   431  017b  2003                      JR      NZ,J280C
   432  017d  c30000                    JP      J4067                   ; overflow error
   433                          
   434  0180  78                J280C:  LD      A,B
   435  0181  c640                      ADD     A,$40
   436  0183  e67f                      AND     $7F
   437  0185  c8                        RET     Z
   438  0186  b1                        OR      C
   439  0187  2b                        DEC     HL
   440  0188  77                        LD      (HL),A
   441  0189  1145f8                    LD      DE,HOLD8+63
   442  018c  010800                    LD      BC,8
   443  018f  21fdf7                    LD      HL,DAC+7
   444  0192  d5                        PUSH    DE
   445  0193  edb8                      LDDR
   446  0195  23                        INC     HL
   447  0196  af                        XOR     A
   448  0197  0608                      LD      B,8
   449  0199  77                J2825:  LD      (HL),A
   450  019a  23                        INC     HL
   451  019b  10fc                      DJNZ    J2825
   452  019d  d1                        POP     DE
   453  019e  01f701                    LD      BC,J2883
   454  01a1  c5                        PUSH    BC
   455                          
   456                          ;       Subroutine      __________________________
   457                          ;       Inputs          ________________________
   458                          ;       Outputs         ________________________
   459                          
   460  01a2  cdfe01            C282E:  CALL    C288A
   461  01a5  e5                        PUSH    HL
   462  01a6  010800                    LD      BC,8
   463  01a9  eb                        EX      DE,HL
   464  01aa  edb8                      LDDR
   465  01ac  eb                        EX      DE,HL
   466  01ad  213df8                    LD      HL,HOLD8+55
   467  01b0  0608                      LD      B,8
   468  01b2  cdd500                    CALL    C2761
   469  01b5  d1                        POP     DE
   470  01b6  cdfe01                    CALL    C288A
   471  01b9  0e07                      LD      C,7
   472  01bb  114ef8                    LD      DE,ARG+7
   473  01be  1a                J284A:  LD      A,(DE)
   474  01bf  b7                        OR      A
   475  01c0  2004                      JR      NZ,J2852
   476  01c2  1b                        DEC     DE
   477  01c3  0d                        DEC     C
   478  01c4  18f8                      JR      J284A
   479                          
   480  01c6  1a                J2852:  LD      A,(DE)
   481  01c7  1b                        DEC     DE
   482  01c8  d5                        PUSH    DE
   483  01c9  210df8                    LD      HL,HOLD8+7
   484  01cc  87                J2858:  ADD     A,A
   485  01cd  3808                      JR      C,J2863
   486  01cf  2814                      JR      Z,J2871
   487  01d1  110800            J285D:  LD      DE,8
   488  01d4  19                        ADD     HL,DE
   489  01d5  18f5                      JR      J2858
   490                          
   491  01d7  f5                J2863:  PUSH    AF
   492  01d8  0608                      LD      B,8
   493  01da  11fdf7                    LD      DE,DAC+7
   494  01dd  e5                        PUSH    HL
   495  01de  cdd500                    CALL    C2761
   496  01e1  e1                        POP     HL
   497  01e2  f1                        POP     AF
   498  01e3  18ec                      JR      J285D
   499                          
   500  01e5  060f              J2871:  LD      B,$F
   501  01e7  1104f8                    LD      DE,DAC+14
   502  01ea  2105f8                    LD      HL,DAC+15
   503  01ed  cd7208                    CALL    C2EFE
   504  01f0  3600                      LD      (HL),$0
   505  01f2  d1                        POP     DE
   506  01f3  0d                        DEC     C
   507  01f4  20d0                      JR      NZ,J2852
   508  01f6  c9                        RET
   509                          
   510  01f7  2b                J2883:  DEC     HL
   511  01f8  7e                        LD      A,(HL)
   512  01f9  23                        INC     HL
   513  01fa  77                        LD      (HL),A
   514  01fb  c36e00                    JP      C26FA                   ; normalize DAC
   515                          
   516                          ;       Subroutine      __________________________
   517                          ;       Inputs          ________________________
   518                          ;       Outputs         ________________________
   519                          
   520  01fe  21f8ff            C288A:  LD      HL,-8
   521  0201  19                        ADD     HL,DE
   522  0202  0e03                      LD      C,3
   523  0204  0608              J2890:  LD      B,8
   524  0206  b7                        OR      A
   525  0207  1a                J2893:  LD      A,(DE)
   526  0208  8f                        ADC     A,A
   527  0209  27                        DAA
   528  020a  77                        LD      (HL),A
   529  020b  2b                        DEC     HL
   530  020c  1b                        DEC     DE
   531  020d  10f8                      DJNZ    J2893
   532  020f  0d                        DEC     C
   533  0210  20f2                      JR      NZ,J2890
   534  0212  c9                        RET
   535                          
   536                          ;       Subroutine      DECDIV (dbl division)
   537                          ;       Inputs          (DAC) = first operand, (ARG) = second operand
   538                          ;       Outputs         ________________________
   539                          
   540  0213  3a47f8            C289F:  LD      A,(ARG)
   541  0216  b7                        OR      A
   542  0217  ca0000                    JP      Z,J4058
   543  021a  47                        LD      B,A
   544  021b  21f6f7                    LD      HL,DAC
   545  021e  7e                        LD      A,(HL)
   546  021f  b7                        OR      A
   547  0220  caf107                    JP      Z,J2E7D                 ; DAC = 0 and quit
   548  0223  a8                        XOR     B
   549  0224  e680                      AND     $80
   550  0226  4f                        LD      C,A
   551  0227  cbb8                      RES     7,B
   552  0229  7e                        LD      A,(HL)
   553  022a  e67f                      AND     $7F
   554  022c  90                        SUB     B
   555  022d  47                        LD      B,A
   556  022e  1f                        RRA
   557  022f  a8                        XOR     B
   558  0230  e640                      AND     $40
   559  0232  3600                      LD      (HL),$0
   560  0234  2807                      JR      Z,J28C9
   561  0236  78                        LD      A,B
   562  0237  e680                      AND     $80
   563  0239  c0                        RET     NZ
   564  023a  c30000            J28C6:  JP      J4067                   ; overflow error
   565                          
   566  023d  78                J28C9:  LD      A,B
   567  023e  c641                      ADD     A,$41
   568  0240  e67f                      AND     $7F
   569  0242  77                        LD      (HL),A
   570  0243  28f5                      JR      Z,J28C6
   571  0245  b1                        OR      C
   572  0246  3600                      LD      (HL),$0
   573  0248  2b                        DEC     HL
   574  0249  77                        LD      (HL),A
   575  024a  11fdf7                    LD      DE,DAC+7
   576  024d  214ef8                    LD      HL,ARG+7
   577  0250  0607                      LD      B,7
   578  0252  af                        XOR     A
   579  0253  be                J28DF:  CP      (HL)
   580  0254  2004                      JR      NZ,J28E6
   581  0256  1b                        DEC     DE
   582  0257  2b                        DEC     HL
   583  0258  10f9                      DJNZ    J28DF
   584  025a  22f2f7            J28E6:  LD      (DECTM2),HL
   585  025d  eb                        EX      DE,HL
   586  025e  22f0f7                    LD      (DECTMP),HL
   587  0261  78                        LD      A,B
   588  0262  32f4f7                    LD      (DECCNT),A
   589  0265  213ef8                    LD      HL,HOLD8+56
   590  0268  060f              J28F4:  LD      B,$F
   591  026a  e5                J28F6:  PUSH    HL
   592  026b  c5                        PUSH    BC
   593  026c  2af2f7                    LD      HL,(DECTM2)
   594  026f  eb                        EX      DE,HL
   595  0270  2af0f7                    LD      HL,(DECTMP)
   596  0273  3af4f7                    LD      A,(DECCNT)
   597  0276  0eff                      LD      C,$FF
   598  0278  0c                J2904:  INC     C
   599  0279  47                        LD      B,A
   600  027a  e5                        PUSH    HL
   601  027b  d5                        PUSH    DE
   602  027c  af                        XOR     A
   603  027d  eb                        EX      DE,HL
   604  027e  1a                J290A:  LD      A,(DE)
   605  027f  9e                        SBC     A,(HL)
   606  0280  27                        DAA
   607  0281  12                        LD      (DE),A
   608  0282  2b                        DEC     HL
   609  0283  1b                        DEC     DE
   610  0284  10f8                      DJNZ    J290A
   611  0286  1a                        LD      A,(DE)
   612  0287  98                        SBC     A,B
   613  0288  12                        LD      (DE),A
   614  0289  d1                        POP     DE
   615  028a  e1                        POP     HL
   616  028b  3af4f7                    LD      A,(DECCNT)
   617  028e  30e8                      JR      NC,J2904
   618  0290  47                        LD      B,A
   619  0291  eb                        EX      DE,HL
   620  0292  cdd500                    CALL    C2761
   621  0295  3002                      JR      NC,J2925
   622  0297  eb                        EX      DE,HL
   623  0298  34                        INC     (HL)
   624  0299  79                J2925:  LD      A,C
   625  029a  c1                        POP     BC
   626  029b  4f                        LD      C,A
   627  029c  c5                        PUSH    BC
   628  029d  cb38                      SRL     B
   629  029f  04                        INC     B
   630  02a0  58                        LD      E,B
   631  02a1  1600                      LD      D,$0
   632  02a3  21f5f7                    LD      HL,$F7F5
   633  02a6  19                        ADD     HL,DE
   634  02a7  cd0e01                    CALL    C279A
   635  02aa  c1                        POP     BC
   636  02ab  e1                        POP     HL
   637  02ac  78                        LD      A,B
   638  02ad  0c                        INC     C
   639  02ae  0d                        DEC     C
   640  02af  2036                      JR      NZ,J2973
   641  02b1  fe0f                      CP      $F
   642  02b3  2823                      JR      Z,J2964
   643  02b5  0f                        RRCA
   644  02b6  07                        RLCA
   645  02b7  302e                      JR      NC,J2973
   646  02b9  c5                        PUSH    BC
   647  02ba  e5                        PUSH    HL
   648  02bb  21f6f7                    LD      HL,DAC
   649  02be  0608                      LD      B,8
   650  02c0  af                        XOR     A
   651  02c1  be                J294D:  CP      (HL)
   652  02c2  200f                      JR      NZ,J295F
   653  02c4  23                        INC     HL
   654  02c5  10fa                      DJNZ    J294D
   655  02c7  e1                        POP     HL
   656  02c8  c1                        POP     BC
   657  02c9  cb38                      SRL     B
   658  02cb  04                        INC     B
   659  02cc  af                        XOR     A
   660  02cd  77                J2959:  LD      (HL),A
   661  02ce  23                        INC     HL
   662  02cf  10fc                      DJNZ    J2959
   663  02d1  1826                      JR      J2985
   664                          
   665  02d3  e1                J295F:  POP     HL
   666  02d4  c1                        POP     BC
   667  02d5  78                        LD      A,B
   668  02d6  180f                      JR      J2973
   669                          
   670  02d8  3af5f7            J2964:  LD      A,(DECCNT+1)
   671  02db  5f                        LD      E,A
   672  02dc  3d                        DEC     A
   673  02dd  32f5f7                    LD      (DECCNT+1),A
   674  02e0  ab                        XOR     E
   675  02e1  f26802                    JP      P,J28F4
   676  02e4  c3f107                    JP      J2E7D                   ; DAC = 0 and quit
   677                          
   678  02e7  1f                J2973:  RRA
   679  02e8  79                        LD      A,C
   680  02e9  3805                      JR      C,J297C
   681  02eb  b6                        OR      (HL)
   682  02ec  77                        LD      (HL),A
   683  02ed  23                        INC     HL
   684  02ee  1805                      JR      J2981
   685                          
   686  02f0  87                J297C:  ADD     A,A
   687  02f1  87                        ADD     A,A
   688  02f2  87                        ADD     A,A
   689  02f3  87                        ADD     A,A
   690  02f4  77                        LD      (HL),A
   691  02f5  05                J2981:  DEC     B
   692  02f6  c26a02                    JP      NZ,J28F6
   693  02f9  21fef7            J2985:  LD      HL,DAC+8
   694  02fc  1145f8                    LD      DE,HOLD8+63
   695  02ff  0608                      LD      B,8
   696  0301  cd7208                    CALL    C2EFE
   697  0304  c3f701                    JP      J2883
   698                          
   699                          ;       Subroutine      COS function
   700                          ;       Inputs          ________________________
   701                          ;       Outputs         ________________________
   702                          
   703  0307  21d706            C2993:  LD      HL,I2D63
   704  030a  cdaf05                    CALL    C2C3B                   ; DAC = DAC * 0.15915494309190
   705  030d  3af6f7                    LD      A,(DAC)
   706  0310  e67f                      AND     $7F
   707  0312  32f6f7                    LD      (DAC),A
   708  0315  219706                    LD      HL,I2D23
   709  0318  cda605                    CALL    C2C32                   ; DAC = DAC - 0.25
   710  031b  cd0108                    CALL    C2E8D                   ; NEG DAC
   711  031e  1806                      JR      J29B2
   712                          
   713                          ;       Subroutine      SIN function
   714                          ;       Inputs          ________________________
   715                          ;       Outputs         ________________________
   716                          
   717  0320  21d706            C29AC:  LD      HL,I2D63
   718  0323  cdaf05                    CALL    C2C3B                   ; DAC = DAC * 0.15915494309190
   719  0326  3af6f7            J29B2:  LD      A,(DAC)
   720  0329  b7                        OR      A
   721  032a  fcf405                    CALL    M,C2C80
   722  032d  cd4006                    CALL    C2CCC                   ; push DAC
   723  0330  cd430a                    CALL    C30CF
   724  0333  cdc105                    CALL    C2C4D                   ; ARG = DAC
   725  0336  cd5506                    CALL    C2CE1                   ; pop DAC
   726  0339  cd0000                    CALL    C268C                   ; DAC - ARG
   727  033c  3af6f7                    LD      A,(DAC)
   728  033f  fe40                      CP      $40
   729  0341  da6903                    JP      C,J29F5
   730  0344  3af7f7                    LD      A,(DAC+1)
   731  0347  fe25                      CP      $25
   732  0349  da6903                    JP      C,J29F5
   733  034c  fe75                      CP      $75
   734  034e  d26003                    JP      NC,J29EC
   735  0351  cdc105                    CALL    C2C4D                   ; ARG = DAC
   736  0354  218506                    LD      HL,I2D11
   737  0357  cdd005                    CALL    C2C5C                   ; DAC = 0.5
   738  035a  cd0000                    CALL    C268C                   ; DAC - ARG
   739  035d  c36903                    JP      J29F5
   740                          
   741  0360  218f06            J29EC:  LD      HL,I2D1B
   742  0363  cdc405                    CALL    C2C50                   ; ARG = 1.0
   743  0366  cd0000                    CALL    C268C                   ; DAC - ARG
   744  0369  216307            J29F5:  LD      HL,I2DEF
   745  036c  c3fc05                    JP      C2C88                   ; polynomial approximation odd series
   746                          
   747                          ;       Subroutine      TAN function
   748                          ;       Inputs          ________________________
   749                          ;       Outputs         ________________________
   750                          
   751  036f  cd4006            C29FB:  CALL    C2CCC                   ; push DAC
   752  0372  cd0703                    CALL    C2993                   ; COS DAC
   753  0375  cde305                    CALL    C2C6F                   ; exchange DAC with stack
   754  0378  cd2003                    CALL    C29AC                   ; SIN DAC
   755  037b  cd5006                    CALL    C2CDC                   ; pop ARG
   756  037e  3a47f8                    LD      A,(ARG)
   757  0381  b7                        OR      A
   758  0382  c21302                    JP      NZ,C289F                ; DAC / ARG and quit
   759  0385  c30000                    JP      J4067                   ; overflow error
   760                          
   761                          ;       Subroutine      ATN function
   762                          ;       Inputs          ________________________
   763                          ;       Outputs         ________________________
   764                          
   765  0388  3af6f7            C2A14:  LD      A,(DAC)
   766  038b  b7                        OR      A                       ; DAC zero ?
   767  038c  c8                        RET     Z                       ; yep, result zero
   768  038d  fcf405                    CALL    M,C2C80
   769  0390  fe41                      CP      $41
   770  0392  dab003                    JP      C,C2A3C
   771  0395  cdc105                    CALL    C2C4D                   ; ARG = DAC
   772  0398  218f06                    LD      HL,I2D1B
   773  039b  cdd005                    CALL    C2C5C                   ; DAC = 1.0
   774  039e  cd1302                    CALL    C289F                   ; DAC / ARG
   775  03a1  cdb003                    CALL    C2A3C
   776  03a4  cdc105                    CALL    C2C4D                   ; ARG = DAC
   777  03a7  21b706                    LD      HL,I2D43
   778  03aa  cdd005                    CALL    C2C5C                   ; DAC = 1.5707963267949
   779  03ad  c30000                    JP      C268C                   ; DAC - ARG
   780                          
   781                          ;       Subroutine      __________________________
   782                          ;       Inputs          ________________________
   783                          ;       Outputs         ________________________
   784                          
   785  03b0  21bf06            C2A3C:  LD      HL,I2D4B
   786  03b3  cdbb05                    CALL    C2C47                   ; compare DAC with 0.26794919243112
   787  03b6  fae003                    JP      M,C2A6C
   788  03b9  cd4006                    CALL    C2CCC                   ; push DAC
   789  03bc  21c706                    LD      HL,I2D53
   790  03bf  cda005                    CALL    C2C2C                   ; DAC = DAC + 1.7320508075689
   791  03c2  cde305                    CALL    C2C6F                   ; exchange DAC with stack
   792  03c5  21c706                    LD      HL,I2D53
   793  03c8  cdaf05                    CALL    C2C3B                   ; DAC = DAC * 1.7320508075689
   794  03cb  218f06                    LD      HL,I2D1B
   795  03ce  cda605                    CALL    C2C32                   ; DAC = DAC - 1.0
   796  03d1  cd5006                    CALL    C2CDC                   ; pop ARG
   797  03d4  cd1302                    CALL    C289F                   ; DAC / ARG
   798  03d7  cde003                    CALL    C2A6C
   799  03da  21cf06                    LD      HL,I2D5B
   800  03dd  c3a005                    JP      C2C2C                   ; DAC = DAC + 0.52359877559830
   801                          
   802                          ;       Subroutine      __________________________
   803                          ;       Inputs          ________________________
   804                          ;       Outputs         ________________________
   805                          
   806  03e0  21a407            C2A6C:  LD      HL,I2E30
   807  03e3  c3fc05                    JP      C2C88                   ; polynomial approximation odd series
   808                          
   809                          ;       Subroutine      LOG function
   810                          ;       Inputs          ________________________
   811                          ;       Outputs         ________________________
   812                          
   813  03e6  cde507            C2A72:  CALL    C2E71                   ; get sign DAC
   814  03e9  fa0000                    JP      M,C475A                 ; DAC is negative, illegal function call
   815  03ec  ca0000                    JP      Z,C475A                 ; DAC is zero, illegal function call
   816  03ef  21f6f7                    LD      HL,DAC
   817  03f2  7e                        LD      A,(HL)
   818  03f3  f5                        PUSH    AF
   819  03f4  3641                      LD      (HL),$41
   820  03f6  219f06                    LD      HL,I2D2B
   821  03f9  cdbb05                    CALL    C2C47                   ; compare DAC with 3.1622776601684
   822  03fc  fa0604                    JP      M,J2A92
   823  03ff  f1                        POP     AF
   824  0400  3c                        INC     A
   825  0401  f5                        PUSH    AF
   826  0402  21f6f7                    LD      HL,DAC
   827  0405  35                        DEC     (HL)
   828  0406  f1                J2A92:  POP     AF
   829  0407  329df6                    LD      (TEMP3),A
   830  040a  cd4006                    CALL    C2CCC                   ; push DAC
   831  040d  218f06                    LD      HL,I2D1B
   832  0410  cda005                    CALL    C2C2C                   ; DAC = DAC + 1.0
   833  0413  cde305                    CALL    C2C6F                   ; exchange DAC with stack
   834  0416  218f06                    LD      HL,I2D1B
   835  0419  cda605                    CALL    C2C32                   ; DAC = DAC - 1.0
   836  041c  cd5006                    CALL    C2CDC                   ; pop ARG
   837  041f  cd1302                    CALL    C289F                   ; DAC / ARG
   838  0422  cd4006                    CALL    C2CCC                   ; push DAC
   839  0425  cdac05                    CALL    C2C38                   ; DAC = DAC^2
   840  0428  cd4006                    CALL    C2CCC                   ; push DAC
   841  042b  cd4006                    CALL    C2CCC                   ; push DAC
   842  042e  213a07                    LD      HL,I2DC6
   843  0431  cd1706                    CALL    C2CA3
   844  0434  cde305                    CALL    C2C6F                   ; exchange DAC with stack
   845  0437  211907                    LD      HL,I2DA5
   846  043a  cd1706                    CALL    C2CA3
   847  043d  cd5006                    CALL    C2CDC                   ; pop ARG
   848  0440  cd1302                    CALL    C289F                   ; DAC / ARG
   849  0443  cd5006                    CALL    C2CDC                   ; pop ARG
   850  0446  cd5a01                    CALL    C27E6                   ; DAC * ARG
   851  0449  21a706                    LD      HL,I2D33
   852  044c  cda005                    CALL    C2C2C                   ; DAC = DAC + 0.86858896380650
   853  044f  cd5006                    CALL    C2CDC                   ; pop ARG
   854  0452  cd5a01                    CALL    C27E6                   ; DAC * ARG
   855  0455  cd4006                    CALL    C2CCC                   ; push DAC
   856  0458  3a9df6                    LD      A,(TEMP3)
   857  045b  d641                      SUB     $41
   858  045d  6f                        LD      L,A
   859  045e  87                        ADD     A,A
   860  045f  9f                        SBC     A,A
   861  0460  67                        LD      H,A
   862  0461  cd3f09                    CALL    C2FCB                   ; convert to single precision real
   863  0464  cdb609                    CALL    C3042
   864  0467  cd5006                    CALL    C2CDC                   ; pop ARG
   865  046a  cd0e00                    CALL    C269A                   ; DAC + ARG
   866  046d  21af06                    LD      HL,I2D3B
   867  0470  c3af05                    JP      C2C3B                   ; DAC = DAC * 2.3025850929940
   868                          
   869                          ;       Subroutine      SQR function
   870                          ;       Inputs          ________________________
   871                          ;       Outputs         ________________________
   872                          
   873  0473  cde507            C2AFF:  CALL    C2E71                   ; get sign DAC
   874  0476  c8                        RET     Z                       ; DAC is zero, quit (result is zero)
   875  0477  fa0000                    JP      M,C475A                 ; DAC is negative, illegal function call
   876  047a  cdc105                    CALL    C2C4D                   ; ARG = DAC
   877  047d  3af6f7                    LD      A,(DAC)
   878  0480  b7                        OR      A
   879  0481  1f                        RRA
   880  0482  ce20                      ADC     A,$20
   881  0484  3247f8                    LD      (ARG),A
   882  0487  3af7f7                    LD      A,(DAC+1)
   883  048a  b7                        OR      A
   884  048b  0f                        RRCA
   885  048c  b7                        OR      A
   886  048d  0f                        RRCA
   887  048e  e633                      AND     $33
   888  0490  c610                      ADD     A,$10
   889  0492  3248f8                    LD      (ARG+1),A
   890  0495  3e07                      LD      A,$7
   891  0497  329df6            J2B23:  LD      (TEMP3),A
   892  049a  cd4006                    CALL    C2CCC                   ; push DAC
   893  049d  cd3b06                    CALL    C2CC7                   ; push ARG
   894  04a0  cd1302                    CALL    C289F                   ; DAC / ARG
   895  04a3  cd5006                    CALL    C2CDC                   ; pop ARG
   896  04a6  cd0e00                    CALL    C269A                   ; DAC + ARG
   897  04a9  218506                    LD      HL,I2D11
   898  04ac  cdaf05                    CALL    C2C3B                   ; DAC = DAC * 0.5
   899  04af  cdc105                    CALL    C2C4D                   ; ARG = DAC
   900  04b2  cd5506                    CALL    C2CE1                   ; pop DAC
   901  04b5  3a9df6                    LD      A,(TEMP3)
   902  04b8  3d                        DEC     A
   903  04b9  20dc                      JR      NZ,J2B23
   904  04bb  c3cd05                    JP      C2C59                   ; DAC = ARG
   905                          
   906                          ;       Subroutine      EXP function
   907                          ;       Inputs          ________________________
   908                          ;       Outputs         ________________________
   909                          
   910  04be  217d06            C2B4A:  LD      HL,I2D09
   911  04c1  cdaf05                    CALL    C2C3B                   ; DAC = DAC * 0.43429448190324
   912  04c4  cd4006                    CALL    C2CCC                   ; push DAC
   913  04c7  cdfe08                    CALL    C2F8A                   ; convert DAC to integer
   914  04ca  7d                        LD      A,L
   915  04cb  17                        RLA
   916  04cc  9f                        SBC     A,A
   917  04cd  bc                        CP      H
   918  04ce  2814                      JR      Z,J2B70
   919  04d0  7c                        LD      A,H
   920  04d1  b7                        OR      A
   921  04d2  f2e104                    JP      P,J2B6D                 ; overflow error
   922  04d5  cdc309                    CALL    C304F
   923  04d8  cd5506                    CALL    C2CE1                   ; pop DAC
   924  04db  218706                    LD      HL,I2D13
   925  04de  c3d005                    JP      C2C5C                   ; DAC = 0
   926                          
   927  04e1  c30000            J2B6D:  JP      J4067                   ; overflow error
   928                          
   929  04e4  229df6            J2B70:  LD      (TEMP3),HL
   930  04e7  cdae09                    CALL    C303A                   ; convert DAC to double real
   931  04ea  cdc105                    CALL    C2C4D                   ; ARG = DAC
   932  04ed  cd5506                    CALL    C2CE1                   ; pop DAC
   933  04f0  cd0000                    CALL    C268C                   ; DAC - ARG
   934  04f3  218506                    LD      HL,I2D11
   935  04f6  cdbb05                    CALL    C2C47                   ; compare DAC with 0.5
   936  04f9  f5                        PUSH    AF
   937  04fa  2808                      JR      Z,J2B90
   938  04fc  3806                      JR      C,J2B90
   939  04fe  218506                    LD      HL,I2D11
   940  0501  cda605                    CALL    C2C32                   ; DAC = DAC - 0.5
   941  0504  cd4006            J2B90:  CALL    C2CCC                   ; push DAC
   942  0507  210007                    LD      HL,I2D8C
   943  050a  cdfc05                    CALL    C2C88                   ; polynomial approximation odd series
   944  050d  cde305                    CALL    C2C6F                   ; exchange DAC with stack
   945  0510  21df06                    LD      HL,I2D6B
   946  0513  cd0e06                    CALL    C2C9A                   ; polynomial approximation even series
   947  0516  cd5006                    CALL    C2CDC                   ; pop ARG
   948  0519  cd3b06                    CALL    C2CC7                   ; push ARG
   949  051c  cd4006                    CALL    C2CCC                   ; push DAC
   950  051f  cd0000                    CALL    C268C                   ; DAC - ARG
   951  0522  213ef8                    LD      HL,HOLD8+56
   952  0525  cddb05                    CALL    C2C67                   ; = DAC
   953  0528  cd5006                    CALL    C2CDC                   ; pop ARG
   954  052b  cd5506                    CALL    C2CE1                   ; pop DAC
   955  052e  cd0e00                    CALL    C269A                   ; DAC + ARG
   956  0531  213ef8                    LD      HL,HOLD8+56
   957  0534  cdc405                    CALL    C2C50                   ; ARG =
   958  0537  cd1302                    CALL    C289F                   ; DAC / ARG
   959  053a  f1                        POP     AF
   960  053b  3808                      JR      C,J2BD1
   961  053d  2806                      JR      Z,J2BD1
   962  053f  219f06                    LD      HL,I2D2B
   963  0542  cdaf05                    CALL    C2C3B                   ; DAC = DAC * 3.1622776601684
   964  0545  3a9df6            J2BD1:  LD      A,(TEMP3)
   965  0548  21f6f7                    LD      HL,DAC
   966  054b  4e                        LD      C,(HL)
   967  054c  86                        ADD     A,(HL)
   968  054d  77                        LD      (HL),A
   969  054e  a9                        XOR     C
   970  054f  f0                        RET     P
   971  0550  c30000                    JP      J4067                   ; overflow error
   972                          
   973                          ;       Subroutine      RND function
   974                          ;       Inputs          ________________________
   975                          ;       Outputs         ________________________
   976                          
   977  0553  cde507            C2BDF:  CALL    C2E71                   ; get sign DAC
   978  0556  2157f8                    LD      HL,RNDX
   979  0559  282e                      JR      Z,J2C15                 ; DAC is zero, use current RNDX value
   980  055b  fcdb05                    CALL    M,C2C67                 ; DAC is negative, RNDX = DAC
   981  055e  213ef8                    LD      HL,HOLD8+56
   982  0561  1157f8                    LD      DE,RNDX
   983  0564  cdde05                    CALL    C2C6A                   ; = RNDX
   984  0567  216d06                    LD      HL,I2CF9
   985  056a  cdc405                    CALL    C2C50                   ; ARG = 0.21132486540519
   986  056d  216506                    LD      HL,I2CF1
   987  0570  cdd005                    CALL    C2C5C                   ; DAC = 0.14389820420821
   988  0573  1145f8                    LD      DE,HOLD8+63
   989  0576  cda201                    CALL    C282E
   990  0579  11fef7                    LD      DE,DAC+8
   991  057c  2158f8                    LD      HL,RNDX+1
   992  057f  0607                      LD      B,7
   993  0581  cd6b08                    CALL    C2EF7                   ; copy mantissa to RNDX
   994  0584  2157f8                    LD      HL,RNDX+0
   995  0587  3600                      LD      (HL),0
   996  0589  cdd005            J2C15:  CALL    C2C5C                   ; DAC = RNDX
   997  058c  21f6f7                    LD      HL,DAC
   998  058f  3640                      LD      (HL),$40                ; in 0-1 range
   999  0591  af                        XOR     A
  1000  0592  32fef7                    LD      (DAC+8),A
  1001  0595  c36e00                    JP      C26FA                   ; normalize DAC
  1002                          
  1003                          ;       Subroutine      initialize RNDX
  1004                          ;       Inputs          ________________________
  1005                          ;       Outputs         ________________________
  1006                          
  1007  0598  117506            C2C24:  LD      DE,I2D01
  1008  059b  2157f8                    LD      HL,RNDX
  1009  059e  183e                      JR      C2C6A                   ; RNDX = 0.40649651372358 and quit
  1010                          
  1011                          ;       Subroutine      DAC = DAC + operand
  1012                          ;       Inputs          HL = pointer to operand
  1013                          ;       Outputs         ________________________
  1014                          
  1015  05a0  cdc405            C2C2C:  CALL    C2C50                   ; ARG =
  1016  05a3  c30e00                    JP      C269A                   ; DAC + ARG
  1017                          
  1018                          ;       Subroutine      DAC = DAC - operand
  1019                          ;       Inputs          HL = pointer to operand
  1020                          ;       Outputs         ________________________
  1021                          
  1022  05a6  cdc405            C2C32:  CALL    C2C50                   ; ARG =
  1023  05a9  c30000                    JP      C268C                   ; DAC - ARG
  1024                          
  1025                          ;       Subroutine      DAC = DAC^2
  1026                          ;       Inputs          ________________________
  1027                          ;       Outputs         ________________________
  1028                          
  1029  05ac  21f6f7            C2C38:  LD      HL,DAC
  1030                          
  1031                          ;       Subroutine      DAC = DAC * operand
  1032                          ;       Inputs          HL = pointer to operand
  1033                          ;       Outputs         ________________________
  1034                          
  1035  05af  cdc405            C2C3B:  CALL    C2C50                   ; ARG =
  1036  05b2  c35a01                    JP      C27E6                   ; DAC * ARG and quit
  1037                          
  1038                          ;       Subroutine      DAC = DAC / operand
  1039                          ;       Inputs          HL = pointer to operand
  1040                          ;       Outputs         ________________________
  1041                          ;       Remark          Unused Code
  1042                          ;                       Not called from anywhere, leftover from a early Microsoft BASIC
  1043                          
  1044  05b5  cdc405            N2C41:  CALL    C2C50                   ; ARG =
  1045  05b8  c31302                    JP      C289F                   ; DAC / ARG and quit
  1046                          
  1047                          ;       Subroutine      compare with DAC
  1048                          ;       Inputs          HL = pointer to operand
  1049                          ;       Outputs         ________________________
  1050                          
  1051                          
  1052  05bb  cdc405            C2C47:  CALL    C2C50                   ; ARG =
  1053  05be  c3d008                    JP      C2F5C                   ; compare double real
  1054                          
  1055                          ;       Subroutine      MAF (copy DAC to ARG)
  1056                          ;       Inputs          ________________________
  1057                          ;       Outputs         ________________________
  1058                          
  1059  05c1  21f6f7            C2C4D:  LD      HL,DAC
  1060                          
  1061                          ;       Subroutine      MAM (copy HL to ARG)
  1062                          ;       Inputs          ________________________
  1063                          ;       Outputs         ________________________
  1064                          
  1065  05c4  1147f8            C2C50:  LD      DE,ARG
  1066                          
  1067                          ;       Subroutine      MOV$8D (copy HL to DE)
  1068                          ;       Inputs          ________________________
  1069                          ;       Outputs         ________________________
  1070                          
  1071  05c7  eb                J2C53:  EX      DE,HL
  1072  05c8  cdde05                    CALL    C2C6A                   ; copy
  1073  05cb  eb                        EX      DE,HL
  1074  05cc  c9                        RET
  1075                          
  1076                          ;       Subroutine      MFA (copy ARG to DAC)
  1077                          ;       Inputs          ________________________
  1078                          ;       Outputs         ________________________
  1079                          
  1080  05cd  2147f8            C2C59:  LD      HL,ARG
  1081                          
  1082                          ;       Subroutine      MFM (copy HL to DAC)
  1083                          ;       Inputs          ________________________
  1084                          ;       Outputs         ________________________
  1085                          
  1086  05d0  11f6f7            C2C5C:  LD      DE,DAC
  1087  05d3  18f2                      JR      J2C53
  1088                          
  1089                          ;       Subroutine      initialize RNDX
  1090                          ;       Inputs          HL = value
  1091                          ;       Outputs         ________________________
  1092                          ;       Remark          Unused Code
  1093                          ;                       Not called from anywhere, leftover from a early Microsoft BASIC
  1094                          
  1095  05d5  cd3f09            N2C61:  CALL    C2FCB                   ; convert to single precision real
  1096  05d8  2157f8                    LD      HL,RNDX
  1097                          
  1098                          ;       Subroutine      MMF (copy DAC to HL)
  1099                          ;       Inputs          ________________________
  1100                          ;       Outputs         ________________________
  1101                          
  1102  05db  11f6f7            C2C67:  LD      DE,DAC
  1103                          
  1104                          ;       Subroutine      MOV8HD
  1105                          ;       Inputs          ________________________
  1106                          ;       Outputs         ________________________
  1107                          
  1108  05de  0608              C2C6A:  LD      B,8
  1109  05e0  c36b08                    JP      C2EF7
  1110                          
  1111                          ;       Subroutine      XTF (exchange DAC with stack)
  1112                          ;       Inputs          ________________________
  1113                          ;       Outputs         ________________________
  1114                          
  1115  05e3  e1                C2C6F:  POP     HL
  1116  05e4  22c5f7                    LD      (FBUFFR),HL
  1117  05e7  cd5006                    CALL    C2CDC                   ; pop ARG
  1118  05ea  cd4006                    CALL    C2CCC                   ; push DAC
  1119  05ed  cdcd05                    CALL    C2C59                   ; DAC = ARG
  1120  05f0  2ac5f7                    LD      HL,(FBUFFR)
  1121  05f3  e9                        JP      (HL)
  1122                          
  1123                          ;       Subroutine      __________________________
  1124                          ;       Inputs          ________________________
  1125                          ;       Outputs         ________________________
  1126                          
  1127  05f4  cd0108            C2C80:  CALL    C2E8D                   ; NEG DAC
  1128  05f7  210108                    LD      HL,C2E8D
  1129  05fa  e3                        EX      (SP),HL                 ; NEG DAC afterwards
  1130  05fb  e9                        JP      (HL)
  1131                          
  1132                          ;       Subroutine      polynomial approximation odd series
  1133                          ;       Inputs          ________________________
  1134                          ;       Outputs         ________________________
  1135                          
  1136  05fc  22c5f7            C2C88:  LD      (FBUFFR),HL
  1137  05ff  cd4006                    CALL    C2CCC                   ; push DAC
  1138  0602  2ac5f7                    LD      HL,(FBUFFR)
  1139  0605  cd0e06                    CALL    C2C9A                   ; polynomial approximation even series
  1140  0608  cd5006                    CALL    C2CDC                   ; pop ARG
  1141  060b  c35a01                    JP      C27E6                   ; DAC * ARG and quit
  1142                          
  1143                          ;       Subroutine      polynomial approximation even series
  1144                          ;       Inputs          ________________________
  1145                          ;       Outputs         ________________________
  1146                          
  1147  060e  22c5f7            C2C9A:  LD      (FBUFFR),HL
  1148  0611  cdac05                    CALL    C2C38                   ; DAC = DAC^2
  1149  0614  2ac5f7                    LD      HL,(FBUFFR)
  1150                          
  1151                          
  1152                          ;       Subroutine      __________________________
  1153                          ;       Inputs          ________________________
  1154                          ;       Outputs         ________________________
  1155                          
  1156                          
  1157  0617  7e                C2CA3:  LD      A,(HL)
  1158  0618  f5                        PUSH    AF
  1159  0619  23                        INC     HL
  1160  061a  e5                        PUSH    HL
  1161  061b  21c5f7                    LD      HL,FBUFFR
  1162  061e  cddb05                    CALL    C2C67                   ; = DAC
  1163  0621  e1                        POP     HL
  1164  0622  cdd005                    CALL    C2C5C                   ; DAC =
  1165  0625  f1                J2CB1:  POP     AF
  1166  0626  3d                        DEC     A
  1167  0627  c8                        RET     Z
  1168  0628  f5                        PUSH    AF
  1169  0629  e5                        PUSH    HL
  1170  062a  21c5f7                    LD      HL,FBUFFR
  1171  062d  cdaf05                    CALL    C2C3B                   ; DAC = DAC * .
  1172  0630  e1                        POP     HL
  1173  0631  cdc405                    CALL    C2C50                   ; ARG =
  1174  0634  e5                        PUSH    HL
  1175  0635  cd0e00                    CALL    C269A                   ; DAC + ARG
  1176  0638  e1                        POP     HL
  1177  0639  18ea                      JR      J2CB1
  1178                          
  1179                          ;       Subroutine      PHA (push ARG on stack)
  1180                          ;       Inputs          ________________________
  1181                          ;       Outputs         ________________________
  1182                          
  1183  063b  214ef8            C2CC7:  LD      HL,ARG+7
  1184  063e  1803                      JR      J2CCF
  1185                          
  1186                          ;       Subroutine      PHF (push DAC on stack)
  1187                          ;       Inputs          ________________________
  1188                          ;       Outputs         ________________________
  1189                          
  1190  0640  21fdf7            C2CCC:  LD      HL,DAC+7
  1191  0643  3e04              J2CCF:  LD      A,4
  1192  0645  d1                        POP     DE
  1193  0646  46                J2CD2:  LD      B,(HL)
  1194  0647  2b                        DEC     HL
  1195  0648  4e                        LD      C,(HL)
  1196  0649  2b                        DEC     HL
  1197  064a  c5                        PUSH    BC
  1198  064b  3d                        DEC     A
  1199  064c  20f8                      JR      NZ,J2CD2
  1200  064e  eb                        EX      DE,HL
  1201  064f  e9                        JP      (HL)
  1202                          
  1203                          ;       Subroutine      PPA (pop ARG from stack)
  1204                          ;       Inputs          ________________________
  1205                          ;       Outputs         ________________________
  1206                          
  1207  0650  2147f8            C2CDC:  LD      HL,ARG
  1208  0653  1803                      JR      J2CE4
  1209                          
  1210                          ;       Subroutine      PPF (pop DAC from stack)
  1211                          ;       Inputs          ________________________
  1212                          ;       Outputs         ________________________
  1213                          
  1214  0655  21f6f7            C2CE1:  LD      HL,DAC
  1215  0658  3e04              J2CE4:  LD      A,4
  1216  065a  d1                        POP     DE
  1217  065b  c1                J2CE7:  POP     BC
  1218  065c  71                        LD      (HL),C
  1219  065d  23                        INC     HL
  1220  065e  70                        LD      (HL),B
  1221  065f  23                        INC     HL
  1222  0660  3d                        DEC     A
  1223  0661  20f8                      JR      NZ,J2CE7
  1224  0663  eb                        EX      DE,HL
  1225  0664  e9                        JP      (HL)
  1226                          
  1227  0665  0014389820420821  I2CF1:  DEFB    $00,$14,$38,$98,$20,$42,$08,$21         ; 0.14389820420821
  1228  066d  0021132486540519  I2CF9:  DEFB    $00,$21,$13,$24,$86,$54,$05,$19         ; 0.21132486540519
  1229  0675  0040649651372358  I2D01:  DEFB    $00,$40,$64,$96,$51,$37,$23,$58         ; 0.40649651372358
  1230  067d  4043429448190324  I2D09:  DEFB    $40,$43,$42,$94,$48,$19,$03,$24         ; 0.43429448190324
  1231  0685  4050              I2D11:  DEFB    $40,$50                                       ; 0.5
  1232  0687  0000000000000000  I2D13:  DEFB    $00,$00,$00,$00,$00,$00,$00,$00         ; 0.0
  1233  068f  4110000000000000  I2D1B:  DEFB    $41,$10,$00,$00,$00,$00,$00,$00         ; 1.0
  1234  0697  4025000000000000  I2D23:  DEFB    $40,$25,$00,$00,$00,$00,$00,$00         ; 0.25
  1235  069f  4131622776601684  I2D2B:  DEFB    $41,$31,$62,$27,$76,$60,$16,$84         ; 3.1622776601684
  1236  06a7  4086858896380650  I2D33:  DEFB    $40,$86,$85,$88,$96,$38,$06,$50         ; 0.86858896380650
  1237  06af  4123025850929940  I2D3B:  DEFB    $41,$23,$02,$58,$50,$92,$99,$40         ; 2.3025850929940
  1238  06b7  4115707963267949  I2D43:  DEFB    $41,$15,$70,$79,$63,$26,$79,$49         ; 1.5707963267949
  1239  06bf  4026794919243112  I2D4B:  DEFB    $40,$26,$79,$49,$19,$24,$31,$12         ; 0.26794919243112
  1240  06c7  4117320508075689  I2D53:  DEFB    $41,$17,$32,$05,$08,$07,$56,$89         ; 1.7320508075689
  1241  06cf  4052359877559830  I2D5B:  DEFB    $40,$52,$35,$98,$77,$55,$98,$30         ; 0.52359877559830
  1242  06d7  4015915494309190  I2D63:  DEFB    $40,$15,$91,$54,$94,$30,$91,$90         ; 0.15915494309190
  1243  06df  04                I2D6B:  DEFB    4
  1244  06e0  4110000000000000          DEFB    $41,$10,$00,$00,$00,$00,$00,$00         ; 1.0
  1245  06e8  4315937415236031          DEFB    $43,$15,$93,$74,$15,$23,$60,$31         ; 159.37415236031
  1246  06f0  4427093169408516          DEFB    $44,$27,$09,$31,$69,$40,$85,$16         ; 2709.3169408516
  1247  06f8  4444976335574058          DEFB    $44,$44,$97,$63,$35,$57,$40,$58         ; 4497.6335574058
  1248  0700  03                I2D8C:  DEFB    3
  1249  0701  4218312360159275          DEFB    $42,$18,$31,$23,$60,$15,$92,$75         ; 18.312360159275
  1250  0709  4383140672129371          DEFB    $43,$83,$14,$06,$72,$12,$93,$71         ; 831.40672129371
  1251  0711  4451780919915162          DEFB    $44,$51,$78,$09,$19,$91,$51,$62         ; 5178.0919915162
  1252  0719  04                I2DA5:  DEFB    4
  1253  071a  c071433382153226          DEFB    $C0,$71,$43,$33,$82,$15,$32,$26         ; -0.71433382153226
  1254  0722  4162503651127908          DEFB    $41,$62,$50,$36,$51,$12,$79,$08         ; 6.2503651127908
  1255  072a  c213682370241503          DEFB    $C2,$13,$68,$23,$70,$24,$15,$03         ; -13.682370241503
  1256  0732  4185167319872389          DEFB    $41,$85,$16,$73,$19,$87,$23,$89         ; 8.5167319872389
  1257  073a  05                I2DC6:  DEFB    5
  1258  073b  4110000000000000          DEFB    $41,$10,$00,$00,$00,$00,$00,$00         ; 1.0
  1259  0743  c213210478350156          DEFB    $C2,$13,$21,$04,$78,$35,$01,$56         ; -13.210478350156
  1260  074b  4247925256043873          DEFB    $42,$47,$92,$52,$56,$04,$38,$73         ; 47.925256043873
  1261  0753  c264906682740943          DEFB    $C2,$64,$90,$66,$82,$74,$09,$43         ; -64.906682740943
  1262  075b  4229415750172323          DEFB    $42,$29,$41,$57,$50,$17,$23,$23         ; 29.415750172323
  1263  0763  08                I2DEF:  DEFB    8
  1264  0764  c069215692291809          DEFB    $C0,$69,$21,$56,$92,$29,$18,$09         ; -0.69215692291809
  1265  076c  4138172886385771          DEFB    $41,$38,$17,$28,$86,$38,$57,$71         ; 3.8172886385771
  1266  0774  c215094499474801          DEFB    $C2,$15,$09,$44,$99,$47,$48,$01         ; -15.094499474801
  1267  077c  4242058689667355          DEFB    $42,$42,$05,$86,$89,$66,$73,$55         ; 42.058689667355
  1268  0784  c276705859683291          DEFB    $C2,$76,$70,$58,$59,$68,$32,$91         ; -76.705859683291
  1269  078c  4281605249275513          DEFB    $42,$81,$60,$52,$49,$27,$55,$13         ; 81.605249275513
  1270  0794  c241341702240398          DEFB    $C2,$41,$34,$17,$02,$24,$03,$98         ; -41.341702240398
  1271  079c  4162831853071796          DEFB    $41,$62,$83,$18,$53,$07,$17,$96         ; 6.2831853071796
  1272  07a4  08                I2E30:  DEFB    8
  1273  07a5  bf52086939040000          DEFB    $BF,$52,$08,$69,$39,$04,$00,$00         ; -0.05208693904000
  1274  07ad  3f75307149134800          DEFB    $3F,$75,$30,$71,$49,$13,$48,$00         ; 0.07530714913480
  1275  07b5  bf90813432247050          DEFB    $BF,$90,$81,$34,$32,$24,$70,$50         ; -0.09081343224705
  1276  07bd  4011110794184029          DEFB    $40,$11,$11,$07,$94,$18,$40,$29         ; 0.11110794184029
  1277  07c5  c014285708554884          DEFB    $C0,$14,$28,$57,$08,$55,$48,$84         ; -0.14285708554884
  1278  07cd  4019999999948967          DEFB    $40,$19,$99,$99,$99,$94,$89,$67         ; 0.19999999948967
  1279  07d5  c033333333333160          DEFB    $C0,$33,$33,$33,$33,$33,$31,$60         ; -0.33333333333160
  1280  07dd  4110000000000000          DEFB    $41,$10,$00,$00,$00,$00,$00,$00         ; 1.0
  1281                          
  1282                          ;       Subroutine      SIGN
  1283                          ;       Inputs          ________________________
  1284                          ;       Outputs         Zx set and A = $00 if zero, Zx reset and Cx set and A = $FF if negative, Zx reset and Cx reset and A = $01 if postive
  1285                          
  1286  07e5  3af6f7            C2E71:  LD      A,(DAC+0)
  1287  07e8  b7                        OR      A
  1288  07e9  c8                        RET     Z
  1289  07ea  fe                        DEFB    $FE            ; CP xx, skip next instruction
  1290  07eb  2f                J2E77:  CPL
  1291  07ec  17                J2E78:  RLA
  1292  07ed  9f                J2E79:  SBC     A,A
  1293  07ee  c0                        RET     NZ
  1294  07ef  3c                        INC     A
  1295  07f0  c9                        RET
  1296                          
  1297                          ;       Subroutine      DAC zero
  1298                          ;       Inputs          ________________________
  1299                          ;       Outputs         ________________________
  1300                          
  1301  07f1  af                J2E7D:  XOR     A
  1302  07f2  32f6f7                    LD      (DAC+0),A
  1303  07f5  c9                        RET
  1304                          
  1305                          ;       Subroutine      ABS function
  1306                          ;       Inputs          ________________________
  1307                          ;       Outputs         ________________________
  1308                          
  1309  07f6  cd1508            C2E82:  CALL    C2EA1                   ; get sign DAC
  1310  07f9  f0                        RET     P                       ; already postive, quit
  1311                          
  1312                          ;       Subroutine      negate
  1313                          ;       Inputs          ________________________
  1314                          ;       Outputs         ________________________
  1315                          
  1316  07fa  ef                C2E86:  RST     GETYPR                  ; get DAC type
  1317  07fb  fa9f0b                    JP      M,J322B                 ; integer,
  1318  07fe  ca0000                    JP      Z,J406D                 ; string, type mismatch error
  1319                          
  1320                          ;       Subroutine      NEG (for single and double real)
  1321                          ;       Inputs          ________________________
  1322                          ;       Outputs         ________________________
  1323                          
  1324  0801  21f6f7            C2E8D:  LD      HL,DAC
  1325  0804  7e                        LD      A,(HL)
  1326  0805  b7                        OR      A                       ; exponent zero ?
  1327  0806  c8                        RET     Z                       ; yep, quit
  1328  0807  ee80                      XOR     $80
  1329  0809  77                        LD      (HL),A                  ; negate sign bit
  1330  080a  c9                        RET
  1331                          
  1332                          ;       Subroutine      SGN function
  1333                          ;       Inputs          ________________________
  1334                          ;       Outputs         ________________________
  1335                          
  1336  080b  cd1508            C2E97:  CALL    C2EA1                   ; get sign DAC
  1337                          
  1338                          ;       Subroutine      __________________________
  1339                          ;       Inputs          ________________________
  1340                          ;       Outputs         ________________________
  1341                          
  1342  080e  6f                C2E9A:  LD      L,A
  1343  080f  17                        RLA
  1344  0810  9f                        SBC     A,A
  1345  0811  67                        LD      H,A
  1346  0812  c30d09                    JP      C2F99                   ; put HL in DAC
  1347                          
  1348                          ;       Subroutine      get sign DAC
  1349                          ;       Inputs          ________________________
  1350                          ;       Outputs         ________________________
  1351                          
  1352  0815  ef                C2EA1:  RST     GETYPR                  ; get DAC type
  1353  0816  ca0000                    JP      Z,J406D                 ; string, type mismatch error
  1354  0819  f2e507                    JP      P,C2E71                 ; single or double real, get sign DAC and quit
  1355  081c  2af8f7                    LD      HL,(DAC+2)              ; integer value
  1356                          
  1357                          ;       Subroutine      get sign of integer
  1358                          ;       Inputs          ________________________
  1359                          ;       Outputs         ________________________
  1360                          
  1361  081f  7c                C2EAB:  LD      A,H
  1362  0820  b5                        OR      L                       ; integer 0 ?
  1363  0821  c8                        RET     Z                       ; yep, quit
  1364  0822  7c                        LD      A,H
  1365  0823  18c7                      JR      J2E78                   ; sign in A
  1366                          
  1367                          ;       Subroutine      PUSHF (push DAC on stack, single real)
  1368                          ;       Inputs          ________________________
  1369                          ;       Outputs         ________________________
  1370                          
  1371  0825  eb                C2EB1:  EX      DE,HL
  1372  0826  2af8f7                    LD      HL,(DAC+2)
  1373  0829  e3                        EX      (SP),HL
  1374  082a  e5                        PUSH    HL
  1375  082b  2af6f7                    LD      HL,(DAC+0)
  1376  082e  e3                        EX      (SP),HL
  1377  082f  e5                        PUSH    HL
  1378  0830  eb                        EX      DE,HL
  1379  0831  c9                        RET
  1380                          
  1381                          ;       Subroutine      MOVFM (DAC =)
  1382                          ;       Inputs          HL = address
  1383                          ;       Outputs         ________________________
  1384                          
  1385  0832  cd5308            C2EBE:  CALL    C2EDF                   ; load from HL (single)
  1386                          
  1387                          ;       Subroutine      MOVFR (DAC =)
  1388                          ;       Inputs          DEBC = single
  1389                          ;       Outputs         ________________________
  1390                          
  1391  0835  eb                C2EC1:  EX      DE,HL
  1392  0836  22f8f7                    LD      (DAC+2),HL
  1393  0839  60                        LD      H,B
  1394  083a  69                        LD      L,C
  1395  083b  22f6f7                    LD      (DAC+0),HL
  1396  083e  eb                        EX      DE,HL
  1397  083f  c9                        RET
  1398                          
  1399                          ;       Subroutine      MOVRF (= DAC)
  1400                          ;       Inputs          none
  1401                          ;       Outputs         DEBC = single
  1402                          
  1403  0840  2af8f7            C2ECC:  LD      HL,(DAC+2)
  1404  0843  eb                        EX      DE,HL
  1405  0844  2af6f7                    LD      HL,(DAC+0)
  1406  0847  4d                        LD      C,L
  1407  0848  44                        LD      B,H
  1408  0849  c9                        RET
  1409                          
  1410                          ;       Subroutine      MOVRMI
  1411                          ;       Inputs          HL = address
  1412                          ;       Outputs         DEBC =
  1413                          
  1414  084a  4e                C2ED6:  LD      C,(HL)
  1415  084b  23                        INC     HL
  1416  084c  46                        LD      B,(HL)
  1417  084d  23                        INC     HL
  1418  084e  5e                        LD      E,(HL)
  1419  084f  23                        INC     HL
  1420  0850  56                        LD      D,(HL)
  1421  0851  23                        INC     HL
  1422  0852  c9                        RET
  1423                          
  1424                          ;       Subroutine      MOVRM
  1425                          ;       Inputs          HL = address
  1426                          ;       Outputs         BCDE =
  1427                          
  1428  0853  5e                C2EDF:  LD      E,(HL)
  1429  0854  23                        INC     HL
  1430                          
  1431                          ;       Subroutine      get size and address of string
  1432                          ;       Inputs          HL = pointer to stringdescriptor
  1433                          ;       Outputs         D = size of string, BC = address of string
  1434                          
  1435  0855  56                C2EE1:  LD      D,(HL)
  1436  0856  23                        INC     HL
  1437  0857  4e                        LD      C,(HL)
  1438  0858  23                        INC     HL
  1439  0859  46                        LD      B,(HL)
  1440                          
  1441                          ;       Subroutine      __________________________
  1442                          ;       Inputs          ________________________
  1443                          ;       Outputs         ________________________
  1444                          
  1445  085a  23                C2EE6:  INC     HL
  1446  085b  c9                        RET
  1447                          
  1448                          ;       Subroutine      MOVMF (DAC =)
  1449                          ;       Inputs          ________________________
  1450                          ;       Outputs         ________________________
  1451                          
  1452                          
  1453  085c  11f6f7            C2EE8:  LD      DE,DAC
  1454                          
  1455                          ;       Subroutine      MOVE ( =)
  1456                          ;       Inputs          ________________________
  1457                          ;       Outputs         ________________________
  1458                          
  1459                          
  1460  085f  0604              C2EEB:  LD      B,4
  1461  0861  1808                      JR      C2EF7
  1462                          
  1463                          ;       Subroutine      VMOVAM (ARG =)
  1464                          ;       Inputs          ________________________
  1465                          ;       Outputs         ________________________
  1466                          
  1467                          
  1468  0863  1147f8            C2EEF:  LD      DE,ARG
  1469                          
  1470                          ;       Subroutine      MOVVFM (DE = HL)
  1471                          ;       Inputs          ________________________
  1472                          ;       Outputs         ________________________
  1473                          
  1474  0866  eb                C2EF2:  EX      DE,HL
  1475                          
  1476                          ;       Subroutine      VMOVE (copy variable content)
  1477                          ;       Inputs          HL = source variable pointer, DE = destination variable pointer, (VALTYP) = variabletype
  1478                          ;       Outputs         ________________________
  1479                          
  1480  0867  3a63f6            C2EF3:  LD      A,(VALTYP)
  1481  086a  47                        LD      B,A
  1482                          
  1483                          ;       Subroutine      __________________________
  1484                          ;       Inputs          ________________________
  1485                          ;       Outputs         ________________________
  1486                          
  1487  086b  1a                C2EF7:  LD      A,(DE)
  1488  086c  77                        LD      (HL),A
  1489  086d  13                        INC     DE
  1490  086e  23                        INC     HL
  1491  086f  10fa                      DJNZ    C2EF7
  1492  0871  c9                        RET
  1493                          
  1494                          
  1495                          ;       Subroutine      __________________________
  1496                          ;       Inputs          ________________________
  1497                          ;       Outputs         ________________________
  1498                          
  1499                          
  1500  0872  1a                C2EFE:  LD      A,(DE)
  1501  0873  77                        LD      (HL),A
  1502  0874  1b                        DEC     DE
  1503  0875  2b                        DEC     HL
  1504  0876  10fa                      DJNZ    C2EFE
  1505  0878  c9                        RET
  1506                          
  1507                          ;       Subroutine      VMOVFA (DAC = ARG)
  1508                          ;       Inputs          _______________________
  1509                          ;       Outputs         ________________________
  1510                          
  1511                          
  1512  0879  2147f8            C2F05:  LD      HL,ARG
  1513                          
  1514                          ;       Subroutine      VMOVFM (DAC = HL)
  1515                          ;       Inputs          _______________________
  1516                          ;       Outputs         ________________________
  1517                          
  1518  087c  116608            C2F08:  LD      DE,C2EF2                ; afterwards DE = HL
  1519  087f  1806                      JR      J2F13                   ; load DAC address
  1520                          
  1521                          ;       Subroutine      VMOVAF (ARG = DAC)
  1522                          ;       Inputs          ________________________
  1523                          ;       Outputs         ________________________
  1524                          
  1525                          
  1526  0881  2147f8            C2F0D:  LD      HL,ARG
  1527                          
  1528                          ;       Subroutine      VMOVMF (HL = DAC)
  1529                          ;       Inputs          ________________________
  1530                          ;       Outputs         ________________________
  1531                          
  1532                          
  1533  0884  116708            C2F10:  LD      DE,C2EF3                ; afterwards HL = DE
  1534  0887  d5                J2F13:  PUSH    DE
  1535  0888  11f6f7                    LD      DE,DAC+0
  1536  088b  3a63f6                    LD      A,(VALTYP)
  1537  088e  fe04                      CP      4
  1538  0890  d0                        RET     NC
  1539  0891  11f8f7                    LD      DE,DAC+2
  1540  0894  c9                        RET
  1541                          
  1542                          ;       Subroutine      FCOMP (single real compare)
  1543                          ;       Inputs          DEBC = first operand, (DAC) = second operand
  1544                          ;       Outputs         ________________________
  1545                          
  1546  0895  79                C2F21:  LD      A,C
  1547  0896  b7                        OR      A
  1548  0897  cae507                    JP      Z,C2E71                 ; get sign DAC and quit
  1549  089a  21eb07                    LD      HL,J2E77
  1550  089d  e5                        PUSH    HL
  1551  089e  cde507                    CALL    C2E71                   ; get sign DAC
  1552  08a1  79                        LD      A,C
  1553  08a2  c8                        RET     Z                       ; DAC is zero,
  1554  08a3  21f6f7                    LD      HL,DAC
  1555  08a6  ae                        XOR     (HL)
  1556  08a7  79                        LD      A,C
  1557  08a8  f8                        RET     M
  1558  08a9  cdaf08                    CALL    C2F3B
  1559  08ac  1f                        RRA
  1560  08ad  a9                        XOR     C
  1561  08ae  c9                        RET
  1562                          
  1563                          
  1564                          ;       Subroutine      __________________________
  1565                          ;       Inputs          ________________________
  1566                          ;       Outputs         ________________________
  1567                          
  1568                          
  1569  08af  79                C2F3B:  LD      A,C
  1570  08b0  be                        CP      (HL)
  1571  08b1  c0                        RET     NZ
  1572  08b2  23                        INC     HL
  1573  08b3  78                        LD      A,B
  1574  08b4  be                        CP      (HL)
  1575  08b5  c0                        RET     NZ
  1576  08b6  23                        INC     HL
  1577  08b7  7b                        LD      A,E
  1578  08b8  be                        CP      (HL)
  1579  08b9  c0                        RET     NZ
  1580  08ba  23                        INC     HL
  1581  08bb  7a                        LD      A,D
  1582  08bc  96                        SUB     (HL)
  1583  08bd  c0                        RET     NZ
  1584  08be  e1                        POP     HL
  1585  08bf  e1                        POP     HL
  1586  08c0  c9                        RET
  1587                          
  1588                          ;       Subroutine      ICOMP (compare integer)
  1589                          ;       Inputs          ________________________
  1590                          ;       Outputs         ________________________
  1591                          
  1592  08c1  7a                C2F4D:  LD      A,D
  1593  08c2  ac                        XOR     H                       ; sign equal ?
  1594  08c3  7c                        LD      A,H
  1595  08c4  faec07                    JP      M,J2E78                 ; nope, sign in A
  1596  08c7  ba                        CP      D                       ; high byte equal ?
  1597  08c8  2003                      JR      NZ,J2F59                ; nope,
  1598  08ca  7d                        LD      A,L
  1599  08cb  93                        SUB     E
  1600  08cc  c8                        RET     Z
  1601  08cd  c3ed07            J2F59:  JP      J2E79
  1602                          
  1603                          ;       Subroutine      XDCOMP (compare double real)
  1604                          ;       Inputs          ________________________
  1605                          ;       Outputs         ________________________
  1606                          
  1607  08d0  1147f8            C2F5C:  LD      DE,ARG
  1608  08d3  1a                        LD      A,(DE)
  1609  08d4  b7                        OR      A
  1610  08d5  cae507                    JP      Z,C2E71                 ; get sign DAC and quit
  1611  08d8  21eb07                    LD      HL,J2E77
  1612  08db  e5                        PUSH    HL
  1613  08dc  cde507                    CALL    C2E71                   ; get sign DAC
  1614  08df  1a                        LD      A,(DE)
  1615  08e0  4f                        LD      C,A
  1616  08e1  c8                        RET     Z                       ; DAC is zero,
  1617  08e2  21f6f7                    LD      HL,DAC
  1618  08e5  ae                        XOR     (HL)
  1619  08e6  79                        LD      A,C
  1620  08e7  f8                        RET     M
  1621  08e8  0608                      LD      B,8
  1622  08ea  1a                J2F76:  LD      A,(DE)
  1623  08eb  96                        SUB     (HL)
  1624  08ec  2006                      JR      NZ,J2F80
  1625  08ee  13                        INC     DE
  1626  08ef  23                        INC     HL
  1627  08f0  10f8              D2F7C:  DJNZ    J2F76
  1628  08f2  c1                        POP     BC
  1629  08f3  c9                        RET
  1630                          
  1631  08f4  1f                J2F80:  RRA
  1632  08f5  a9                        XOR     C
  1633  08f6  c9                        RET
  1634                          
  1635  08f7  cdd008            C2F83:  CALL    C2F5C                   ; compare double real
  1636  08fa  c2eb07                    JP      NZ,J2E77
  1637  08fd  c9                        RET
  1638                          
  1639                          ;       Subroutine      FRCINT (convert DAC to integer), also CINT function
  1640                          ;       Inputs          ________________________
  1641                          ;       Outputs         ________________________
  1642                          
  1643  08fe  ef                C2F8A:  RST     GETYPR                  ; get DAC type
  1644  08ff  2af8f7                    LD      HL,(DAC+2)
  1645  0902  f8                        RET     M                       ; already integer, quit
  1646  0903  ca0000                    JP      Z,J406D                 ; string, type mismatch error
  1647                          
  1648                          ;       Subroutine      convert single real or double real to integer
  1649                          ;       Inputs          ________________________
  1650                          ;       Outputs         ________________________
  1651                          
  1652  0906  cdd109            C2F92:  CALL    C305D
  1653  0909  da0000                    JP      C,J4067                 ; overflow error
  1654  090c  eb                        EX      DE,HL
  1655                          
  1656                          
  1657                          ;       Subroutine      __________________________
  1658                          ;       Inputs          ________________________
  1659                          ;       Outputs         ________________________
  1660                          
  1661                          
  1662  090d  22f8f7            C2F99:  LD      (DAC+2),HL
  1663                          
  1664                          
  1665                          ;       Subroutine      __________________________
  1666                          ;       Inputs          ________________________
  1667                          ;       Outputs         ________________________
  1668                          
  1669                          
  1670  0910  3e02              C2F9C:  LD      A,2
  1671  0912  3263f6            J2F9E:  LD      (VALTYP),A
  1672  0915  c9                        RET
  1673                          
  1674                          
  1675                          ;       Subroutine      __________________________
  1676                          ;       Inputs          ________________________
  1677                          ;       Outputs         ________________________
  1678                          
  1679                          
  1680  0916  01c532            C2FA2:  LD      BC,$32C5
  1681  0919  117680                    LD      DE,$8076
  1682  091c  cd9508                    CALL    C2F21                   ; single real compare
  1683  091f  c0                        RET     NZ                      ; not -32768 SGN, quit
  1684  0920  210080                    LD      HL,$8000               ; -32768 INT
  1685  0923  d1                J2FAF:  POP     DE                      ; remove return address
  1686  0924  18e7                      JR      C2F99                   ; put HL in DAC
  1687                          
  1688                          ;       Subroutine      FRCSNG (convert DAC to single real), also CSNG function
  1689                          ;       Inputs          ________________________
  1690                          ;       Outputs         ________________________
  1691                          
  1692  0926  ef                C2FB2:  RST     GETYPR                  ; get DAC type
  1693  0927  e0                        RET     PO                      ; already single real, quit
  1694  0928  fa3c09                    JP      M,C2FC8                 ; integer, convert integer to single real
  1695  092b  ca0000                    JP      Z,J406D                 ; string, type mismatch
  1696  092e  cdc709                    CALL    C3053
  1697  0931  cdc610                    CALL    C3752
  1698  0934  23                        INC     HL
  1699  0935  78                        LD      A,B
  1700  0936  b7                        OR      A
  1701  0937  1f                        RRA
  1702  0938  47                        LD      B,A
  1703  0939  c3b500                    JP      C2741
  1704                          
  1705                          ;       Subroutine      __________________________
  1706                          ;       Inputs          ________________________
  1707                          ;       Outputs         ________________________
  1708                          
  1709  093c  2af8f7            C2FC8:  LD      HL,(DAC+2)
  1710                          
  1711                          ;       Subroutine      convert to single precision real
  1712                          ;       Inputs          HL = integer value
  1713                          ;       Outputs         ________________________
  1714                          
  1715  093f  7c                C2FCB:  LD      A,H
  1716  0940  b7                J2FCC:  OR      A
  1717  0941  f5                        PUSH    AF
  1718  0942  fc950b                    CALL    M,C3221
  1719  0945  cdc709                    CALL    C3053
  1720  0948  eb                        EX      DE,HL
  1721  0949  210000                    LD      HL,0
  1722  094c  22f6f7                    LD      (DAC+0),HL
  1723  094f  22f8f7                    LD      (DAC+2),HL
  1724  0952  7a                        LD      A,D
  1725  0953  b3                        OR      E
  1726  0954  ca0000                    JP      Z,J66A7
  1727  0957  010005                    LD      BC,$0500
  1728  095a  21f7f7                    LD      HL,DAC+1
  1729  095d  e5                        PUSH    HL
  1730  095e  21a409                    LD      HL,J3030
  1731  0961  3eff              J2FED:  LD      A,$FF
  1732  0963  d5                        PUSH    DE
  1733  0964  5e                        LD      E,(HL)
  1734  0965  23                        INC     HL
  1735  0966  56                        LD      D,(HL)
  1736  0967  23                        INC     HL
  1737  0968  e3                        EX      (SP),HL
  1738  0969  c5                        PUSH    BC
  1739  096a  44                J2FF6:  LD      B,H
  1740  096b  4d                        LD      C,L
  1741  096c  19                        ADD     HL,DE
  1742  096d  3c                        INC     A
  1743  096e  38fa                      JR      C,J2FF6
  1744  0970  60                        LD      H,B
  1745  0971  69                        LD      L,C
  1746  0972  c1                        POP     BC
  1747  0973  d1                        POP     DE
  1748  0974  eb                        EX      DE,HL
  1749  0975  0c                        INC     C
  1750  0976  0d                        DEC     C
  1751  0977  200b                      JR      NZ,J3010
  1752  0979  b7                        OR      A
  1753  097a  281c                      JR      Z,J3024
  1754  097c  f5                        PUSH    AF
  1755  097d  3e40                      LD      A,$40
  1756  097f  80                        ADD     A,B
  1757  0980  32f6f7                    LD      (DAC),A
  1758  0983  f1                        POP     AF
  1759  0984  0c                J3010:  INC     C
  1760  0985  e3                        EX      (SP),HL
  1761  0986  f5                        PUSH    AF
  1762  0987  79                        LD      A,C
  1763  0988  1f                        RRA
  1764  0989  3008                      JR      NC,J301F
  1765  098b  f1                        POP     AF
  1766  098c  87                        ADD     A,A
  1767  098d  87                        ADD     A,A
  1768  098e  87                        ADD     A,A
  1769  098f  87                        ADD     A,A
  1770  0990  77                        LD      (HL),A
  1771  0991  1804                      JR      J3023
  1772                          
  1773  0993  f1                J301F:  POP     AF
  1774  0994  b6                        OR      (HL)
  1775  0995  77                        LD      (HL),A
  1776  0996  23                        INC     HL
  1777  0997  e3                J3023:  EX      (SP),HL
  1778  0998  7a                J3024:  LD      A,D
  1779  0999  b3                        OR      E
  1780  099a  2802                      JR      Z,J302A
  1781  099c  10c3                      DJNZ    J2FED
  1782  099e  e1                J302A:  POP     HL
  1783  099f  f1                        POP     AF
  1784  09a0  f0                        RET     P
  1785  09a1  c30108                    JP      C2E8D                   ; NEG DAC
  1786                          
  1787  09a4  f0d8              J3030:  DEFW    -10000
  1788  09a6  18fc                      DEFW    -1000
  1789  09a8  9cff                      DEFW    -100
  1790  09aa  f6ff                      DEFW    -10
  1791  09ac  ffff                      DEFW    -1
  1792                          
  1793                          ;       Subroutine      FRCDBL (convert DAC to double real), also CDBL function
  1794                          ;       Inputs          ________________________
  1795                          ;       Outputs         ________________________
  1796                          
  1797  09ae  ef                C303A:  RST     GETYPR                  ; get DAC type
  1798  09af  d0                        RET     NC                      ; already double real, quit
  1799  09b0  ca0000                    JP      Z,J406D                 ; string, type mismatch error
  1800  09b3  fc3c09                    CALL    M,C2FC8                 ; integer, convert to single real
  1801                          
  1802                          ;       Subroutine      __________________________
  1803                          ;       Inputs          ________________________
  1804                          ;       Outputs         ________________________
  1805                          
  1806  09b6  210000            C3042:  LD      HL,0
  1807  09b9  22faf7                    LD      (DAC+4),HL
  1808  09bc  22fcf7                    LD      (DAC+6),HL
  1809  09bf  7c                        LD      A,H
  1810  09c0  32fef7                    LD      (DAC+8),A
  1811                          
  1812                          ;       Subroutine      __________________________
  1813                          ;       Inputs          ________________________
  1814                          ;       Outputs         ________________________
  1815                          
  1816  09c3  3e08              C304F:  LD      A,8
  1817  09c5  1802                      JR      J3055
  1818                          
  1819                          ;       Subroutine      __________________________
  1820                          ;       Inputs          ________________________
  1821                          ;       Outputs         ________________________
  1822                          
  1823                          
  1824  09c7  3e04              C3053:  LD      A,4
  1825  09c9  c31209            J3055:  JP      J2F9E
  1826                          
  1827                          
  1828                          ;       Subroutine      check if string
  1829                          ;       Inputs          ________________________
  1830                          ;       Outputs         ________________________
  1831                          
  1832  09cc  ef                C3058:  RST     GETYPR                  ; get DAC type
  1833  09cd  c8                        RET     Z                       ; already string, quit
  1834  09ce  c30000                    JP      J406D                   ; not a string, type mismatch error
  1835                          
  1836                          ;       Subroutine      convert SGN/DBL to signed integer
  1837                          ;       Inputs          ________________________
  1838                          ;       Outputs         ________________________
  1839                          
  1840  09d1  212e0a            C305D:  LD      HL,I30BA
  1841  09d4  e5                        PUSH    HL
  1842  09d5  21f6f7                    LD      HL,DAC
  1843  09d8  7e                        LD      A,(HL)
  1844  09d9  e67f                      AND     $7F
  1845  09db  fe46                      CP      $46
  1846  09dd  d0                        RET     NC
  1847  09de  d641                      SUB     $41
  1848  09e0  3006                      JR      NC,J3074
  1849  09e2  b7                        OR      A
  1850  09e3  d1                        POP     DE
  1851  09e4  110000                    LD      DE,0
  1852  09e7  c9                        RET
  1853                          
  1854  09e8  3c                J3074:  INC     A
  1855  09e9  47                        LD      B,A
  1856  09ea  110000                    LD      DE,0
  1857  09ed  4a                        LD      C,D
  1858  09ee  23                        INC     HL
  1859  09ef  79                J307B:  LD      A,C
  1860  09f0  0c                        INC     C
  1861  09f1  1f                        RRA
  1862  09f2  7e                        LD      A,(HL)
  1863  09f3  3806                      JR      C,J3087
  1864  09f5  1f                        RRA
  1865  09f6  1f                        RRA
  1866  09f7  1f                        RRA
  1867  09f8  1f                        RRA
  1868  09f9  1801                      JR      J3088
  1869                          
  1870  09fb  23                J3087:  INC     HL
  1871  09fc  e60f              J3088:  AND     $F
  1872  09fe  22f0f7                    LD      (DECTMP),HL
  1873  0a01  62                        LD      H,D
  1874  0a02  6b                        LD      L,E
  1875  0a03  29                        ADD     HL,HL
  1876  0a04  d8                        RET     C
  1877  0a05  29                        ADD     HL,HL
  1878  0a06  d8                        RET     C
  1879  0a07  19                        ADD     HL,DE
  1880  0a08  d8                        RET     C
  1881  0a09  29                        ADD     HL,HL
  1882  0a0a  d8                        RET     C
  1883  0a0b  5f                        LD      E,A
  1884  0a0c  1600                      LD      D,$0
  1885  0a0e  19                        ADD     HL,DE
  1886  0a0f  d8                        RET     C
  1887  0a10  eb                        EX      DE,HL
  1888  0a11  2af0f7                    LD      HL,(DECTMP)
  1889  0a14  10d9                      DJNZ    J307B
  1890  0a16  210080                    LD      HL,$8000
  1891  0a19  e7                        RST     DCOMPR
  1892  0a1a  3af6f7                    LD      A,(DAC)
  1893  0a1d  d8                        RET     C
  1894  0a1e  280a                      JR      Z,J30B6
  1895  0a20  e1                        POP     HL
  1896  0a21  b7                        OR      A
  1897  0a22  f0                        RET     P
  1898  0a23  eb                        EX      DE,HL
  1899  0a24  cd950b                    CALL    C3221
  1900  0a27  eb                        EX      DE,HL
  1901  0a28  b7                        OR      A
  1902  0a29  c9                        RET
  1903                          
  1904  0a2a  b7                J30B6:  OR      A
  1905  0a2b  f0                        RET     P
  1906  0a2c  e1                        POP     HL
  1907  0a2d  c9                        RET
  1908                          
  1909  0a2e  37                I30BA:  SCF
  1910  0a2f  c9                        RET
  1911                          
  1912                          ;       Unused Code
  1913                          ;       Not called from anywhere, leftover from a early Microsoft BASIC
  1914                          
  1915  0a30  0b                N30BC:  DEC     BC
  1916  0a31  c9                        RET
  1917                          
  1918                          ;       Subroutine      FIXER (round DAC), also FIX function
  1919                          ;       Inputs          ________________________
  1920                          ;       Outputs         ________________________
  1921                          
  1922  0a32  ef                C30BE:  RST     GETYPR                  ; get DAC type
  1923  0a33  f8                        RET     M                       ; integer, quit doing nothing
  1924  0a34  cde507                    CALL    C2E71                   ; get sign DAC
  1925  0a37  f2430a                    JP      P,C30CF                 ; DAC is postive, just do a INT
  1926  0a3a  cd0108                    CALL    C2E8D                   ; NEG DAC
  1927  0a3d  cd430a                    CALL    C30CF                   ; do INT
  1928  0a40  c3fa07                    JP      C2E86                   ; negate
  1929                          
  1930                          ;       Subroutine      INT function
  1931                          ;       Inputs          ________________________
  1932                          ;       Outputs         ________________________
  1933                          
  1934  0a43  ef                C30CF:  RST     GETYPR                  ; get DAC type
  1935  0a44  f8                        RET     M                       ; integer, quit doing nothing
  1936  0a45  21fef7                    LD      HL,DAC+8
  1937  0a48  0e0e                      LD      C,14
  1938  0a4a  3008                      JR      NC,J30E0                ; double real,
  1939  0a4c  ca0000                    JP      Z,J406D                 ; string, type mismatch error
  1940  0a4f  21faf7                    LD      HL,DAC+4
  1941  0a52  0e06                      LD      C,6
  1942  0a54  3af6f7            J30E0:  LD      A,(DAC)
  1943  0a57  b7                        OR      A
  1944  0a58  fa740a                    JP      M,J3100
  1945  0a5b  e67f                      AND     $7F
  1946  0a5d  d641                      SUB     $41
  1947  0a5f  daf107                    JP      C,J2E7D                 ; DAC = 0 and quit
  1948  0a62  3c                        INC     A
  1949  0a63  91                        SUB     C
  1950  0a64  d0                        RET     NC
  1951  0a65  2f                        CPL
  1952  0a66  3c                        INC     A
  1953  0a67  47                        LD      B,A
  1954  0a68  2b                J30F4:  DEC     HL
  1955  0a69  7e                        LD      A,(HL)
  1956  0a6a  e6f0                      AND     $F0
  1957  0a6c  77                        LD      (HL),A
  1958  0a6d  05                        DEC     B
  1959  0a6e  c8                        RET     Z
  1960  0a6f  af                        XOR     A
  1961  0a70  77                        LD      (HL),A
  1962  0a71  10f5                      DJNZ    J30F4
  1963  0a73  c9                        RET
  1964                          
  1965  0a74  e67f              J3100:  AND     $7F
  1966  0a76  d641                      SUB     $41
  1967  0a78  3006                      JR      NC,J310C
  1968  0a7a  21ffff                    LD      HL,-1
  1969  0a7d  c30d09                    JP      C2F99                   ; put HL in DAC
  1970                          
  1971  0a80  3c                J310C:  INC     A
  1972  0a81  91                        SUB     C
  1973  0a82  d0                        RET     NC
  1974  0a83  2f                        CPL
  1975  0a84  3c                        INC     A
  1976  0a85  47                        LD      B,A
  1977  0a86  1e00                      LD      E,$0
  1978  0a88  2b                J3114:  DEC     HL
  1979  0a89  7e                        LD      A,(HL)
  1980  0a8a  57                        LD      D,A
  1981  0a8b  e6f0                      AND     $F0
  1982  0a8d  77                        LD      (HL),A
  1983  0a8e  ba                        CP      D
  1984  0a8f  2801                      JR      Z,J311E
  1985  0a91  1c                        INC     E
  1986  0a92  05                J311E:  DEC     B
  1987  0a93  2808                      JR      Z,J3129
  1988  0a95  af                        XOR     A
  1989  0a96  77                        LD      (HL),A
  1990  0a97  ba                        CP      D
  1991  0a98  2801                      JR      Z,J3127
  1992  0a9a  1c                        INC     E
  1993  0a9b  10eb              J3127:  DJNZ    J3114
  1994  0a9d  1c                J3129:  INC     E
  1995  0a9e  1d                        DEC     E
  1996  0a9f  c8                        RET     Z
  1997  0aa0  79                        LD      A,C
  1998  0aa1  fe06                      CP      $6
  1999  0aa3  01c110                    LD      BC,$10C1
  2000  0aa6  110000                    LD      DE,0
  2001  0aa9  cac20b                    JP      Z,C324E                 ; single real addition
  2002  0aac  eb                        EX      DE,HL
  2003  0aad  224df8                    LD      (ARG+6),HL
  2004  0ab0  224bf8                    LD      (ARG+4),HL
  2005  0ab3  2249f8                    LD      (ARG+2),HL
  2006  0ab6  60                        LD      H,B
  2007  0ab7  69                        LD      L,C
  2008  0ab8  2247f8                    LD      (ARG),HL
  2009  0abb  c30e00                    JP      C269A                   ; DAC + ARG
  2010                          
  2011                          ;       Subroutine      UMULT (unsigned integer multiply)
  2012                          ;       Inputs          ________________________
  2013                          ;       Outputs         ________________________
  2014                          
  2015  0abe  e5                C314A:  PUSH    HL
  2016  0abf  210000                    LD      HL,0
  2017  0ac2  78                        LD      A,B
  2018  0ac3  b1                        OR      C
  2019  0ac4  2812                      JR      Z,J3164
  2020  0ac6  3e10                      LD      A,16
  2021  0ac8  29                J3154:  ADD     HL,HL
  2022  0ac9  da0000                    JP      C,J601D                 ; subscript out of range
  2023  0acc  eb                        EX      DE,HL
  2024  0acd  29                        ADD     HL,HL
  2025  0ace  eb                        EX      DE,HL
  2026  0acf  3004                      JR      NC,J3161
  2027  0ad1  09                        ADD     HL,BC
  2028  0ad2  da0000                    JP      C,J601D                 ; subscript out of range
  2029  0ad5  3d                J3161:  DEC     A
  2030  0ad6  20f0                      JR      NZ,J3154
  2031  0ad8  eb                J3164:  EX      DE,HL
  2032  0ad9  e1                        POP     HL
  2033  0ada  c9                        RET
  2034                          
  2035                          ;       Subroutine      ISUB (subtract integer)
  2036                          ;       Inputs          ________________________
  2037                          ;       Outputs         ________________________
  2038                          
  2039  0adb  7c                C3167:  LD      A,H
  2040  0adc  17                        RLA
  2041  0add  9f                        SBC     A,A
  2042  0ade  47                        LD      B,A
  2043  0adf  cd950b                    CALL    C3221
  2044  0ae2  79                        LD      A,C
  2045  0ae3  98                        SBC     A,B
  2046  0ae4  1803                      JR      J3175
  2047                          
  2048                          ;       Subroutine      IADD (add integer)
  2049                          ;       Inputs          ________________________
  2050                          ;       Outputs         ________________________
  2051                          
  2052  0ae6  7c                C3172:  LD      A,H
  2053  0ae7  17                        RLA
  2054  0ae8  9f                        SBC     A,A
  2055  0ae9  47                J3175:  LD      B,A
  2056  0aea  e5                        PUSH    HL
  2057  0aeb  7a                        LD      A,D
  2058  0aec  17                        RLA
  2059  0aed  9f                        SBC     A,A
  2060  0aee  19                        ADD     HL,DE
  2061  0aef  88                        ADC     A,B
  2062  0af0  0f                        RRCA
  2063  0af1  ac                        XOR     H
  2064  0af2  f22309                    JP      P,J2FAF
  2065  0af5  c5                        PUSH    BC
  2066  0af6  eb                        EX      DE,HL
  2067  0af7  cd3f09                    CALL    C2FCB                   ; convert to single precision real
  2068  0afa  f1                        POP     AF
  2069  0afb  e1                        POP     HL
  2070  0afc  cd2508                    CALL    C2EB1                   ; push DAC (single)
  2071  0aff  cd3f09                    CALL    C2FCB                   ; convert to single precision real
  2072  0b02  c1                        POP     BC
  2073  0b03  d1                        POP     DE
  2074  0b04  c3c20b                    JP      C324E                   ; single real addition
  2075                          
  2076                          ;       Subroutine      IMULT (multiply integer)
  2077                          ;       Inputs          ________________________
  2078                          ;       Outputs         ________________________
  2079                          
  2080  0b07  7c                C3193:  LD      A,H
  2081  0b08  b5                        OR      L
  2082  0b09  ca0d09                    JP      Z,C2F99                 ; put HL in DAC
  2083  0b0c  e5                        PUSH    HL
  2084  0b0d  d5                        PUSH    DE
  2085  0b0e  cd890b                    CALL    C3215
  2086  0b11  c5                        PUSH    BC
  2087  0b12  44                        LD      B,H
  2088  0b13  4d                        LD      C,L
  2089  0b14  210000                    LD      HL,0
  2090  0b17  3e10                      LD      A,16
  2091  0b19  29                J31A5:  ADD     HL,HL
  2092  0b1a  381f                      JR      C,J31C7
  2093  0b1c  eb                        EX      DE,HL
  2094  0b1d  29                        ADD     HL,HL
  2095  0b1e  eb                        EX      DE,HL
  2096  0b1f  3003                      JR      NC,J31B0
  2097  0b21  09                        ADD     HL,BC
  2098  0b22  3817                      JR      C,J31C7
  2099  0b24  3d                J31B0:  DEC     A
  2100  0b25  20f2                      JR      NZ,J31A5
  2101  0b27  c1                        POP     BC
  2102  0b28  d1                        POP     DE
  2103  0b29  7c                J31B5:  LD      A,H
  2104  0b2a  b7                        OR      A
  2105  0b2b  fa330b                    JP      M,J31BF
  2106  0b2e  d1                        POP     DE
  2107  0b2f  78                        LD      A,B
  2108  0b30  c3910b                    JP      J321D
  2109                          
  2110  0b33  ee80              J31BF:  XOR     $80
  2111  0b35  b5                        OR      L
  2112  0b36  2814                      JR      Z,J31D8
  2113  0b38  eb                        EX      DE,HL
  2114  0b39  1802                      JR      J31C9
  2115                          
  2116  0b3b  c1                J31C7:  POP     BC
  2117  0b3c  e1                        POP     HL
  2118  0b3d  cd3f09            J31C9:  CALL    C2FCB                   ; convert to single precision real
  2119  0b40  e1                        POP     HL
  2120  0b41  cd2508                    CALL    C2EB1                   ; push DAC (single)
  2121  0b44  cd3f09                    CALL    C2FCB                   ; convert to single precision real
  2122  0b47  c1                        POP     BC
  2123  0b48  d1                        POP     DE
  2124  0b49  c3d00b                    JP      C325C                   ; single real muliply
  2125                          
  2126  0b4c  78                J31D8:  LD      A,B
  2127  0b4d  b7                        OR      A
  2128  0b4e  c1                        POP     BC
  2129  0b4f  fa0d09                    JP      M,C2F99                 ; put HL in DAC
  2130  0b52  d5                        PUSH    DE
  2131  0b53  cd3f09                    CALL    C2FCB                   ; convert to single precision real
  2132  0b56  d1                        POP     DE
  2133  0b57  c30108                    JP      C2E8D                   ; NEG DAC
  2134                          
  2135                          ;       Subroutine      IDIV (integer divide)
  2136                          ;       Inputs          ________________________
  2137                          ;       Outputs         ________________________
  2138                          
  2139  0b5a  7c                C31E6:  LD      A,H
  2140  0b5b  b5                        OR      L
  2141  0b5c  ca0000                    JP      Z,J4058
  2142  0b5f  cd890b                    CALL    C3215
  2143  0b62  c5                        PUSH    BC
  2144  0b63  eb                        EX      DE,HL
  2145  0b64  cd950b                    CALL    C3221
  2146  0b67  44                        LD      B,H
  2147  0b68  4d                        LD      C,L
  2148  0b69  210000                    LD      HL,0
  2149  0b6c  3e11                      LD      A,17
  2150  0b6e  b7                        OR      A
  2151  0b6f  1809                      JR      J3206
  2152                          
  2153  0b71  e5                J31FD:  PUSH    HL
  2154  0b72  09                        ADD     HL,BC
  2155  0b73  3004                      JR      NC,J3205
  2156  0b75  33                        INC     SP
  2157  0b76  33                        INC     SP
  2158  0b77  37                        SCF
  2159  0b78  30                        DEFB    $30                    ; skip next instruction
  2160  0b79  e1                J3205:  POP     HL
  2161  0b7a  cb13              J3206:  RL      E
  2162  0b7c  cb12                      RL      D
  2163  0b7e  ed6a                      ADC     HL,HL
  2164  0b80  3d                        DEC     A
  2165  0b81  20ee                      JR      NZ,J31FD
  2166  0b83  eb                        EX      DE,HL
  2167  0b84  c1                        POP     BC
  2168  0b85  d5                        PUSH    DE
  2169  0b86  c3290b                    JP      J31B5
  2170                          
  2171                          ;       Subroutine      __________________________
  2172                          ;       Inputs          ________________________
  2173                          ;       Outputs         ________________________
  2174                          
  2175  0b89  7c                C3215:  LD      A,H
  2176  0b8a  aa                        XOR     D
  2177  0b8b  47                        LD      B,A
  2178  0b8c  cd900b                    CALL    C321C
  2179  0b8f  eb                        EX      DE,HL
  2180                          
  2181                          ;       Subroutine      __________________________
  2182                          ;       Inputs          ________________________
  2183                          ;       Outputs         ________________________
  2184                          
  2185  0b90  7c                C321C:  LD      A,H
  2186  0b91  b7                J321D:  OR      A
  2187  0b92  f20d09                    JP      P,C2F99                 ; put HL in DAC
  2188                          
  2189                          ;       Subroutine      __________________________
  2190                          ;       Inputs          ________________________
  2191                          ;       Outputs         ________________________
  2192                          
  2193  0b95  af                C3221:  XOR     A
  2194  0b96  4f                        LD      C,A
  2195  0b97  95                        SUB     L
  2196  0b98  6f                        LD      L,A
  2197  0b99  79                        LD      A,C
  2198  0b9a  9c                        SBC     A,H
  2199  0b9b  67                        LD      H,A
  2200  0b9c  c30d09                    JP      C2F99                   ; put HL in DAC
  2201                          
  2202  0b9f  2af8f7            J322B:  LD      HL,(DAC+2)
  2203  0ba2  cd950b                    CALL    C3221
  2204  0ba5  7c                        LD      A,H
  2205  0ba6  ee80                      XOR     $80
  2206  0ba8  b5                        OR      L
  2207  0ba9  c0                        RET     NZ
  2208                          
  2209                          ;       Subroutine      convert unsigned integer to single real
  2210                          ;       Inputs          ________________________
  2211                          ;       Outputs         ________________________
  2212                          
  2213  0baa  af                C3236:  XOR     A
  2214  0bab  c34009                    JP      J2FCC
  2215                          
  2216                          ;       Subroutine      IMOD (integer mod)
  2217                          ;       Inputs          ________________________
  2218                          ;       Outputs         ________________________
  2219                          
  2220  0bae  d5                C323A:  PUSH    DE
  2221  0baf  cd5a0b                    CALL    C31E6                   ; integer divide
  2222  0bb2  af                        XOR     A
  2223  0bb3  82                        ADD     A,D
  2224  0bb4  1f                        RRA
  2225  0bb5  67                        LD      H,A
  2226  0bb6  7b                        LD      A,E
  2227  0bb7  1f                        RRA
  2228  0bb8  6f                        LD      L,A
  2229  0bb9  cd1009                    CALL    C2F9C
  2230  0bbc  f1                        POP     AF
  2231  0bbd  18d2                      JR      J321D
  2232                          
  2233                          ;       Unused Code
  2234                          ;       Not called from anywhere, leftover from a early Microsoft BASIC
  2235                          
  2236  0bbf  cd5308            N324B:  CALL    C2EDF                   ; load from HL (single)
  2237                          
  2238                          ;       Subroutine      single real addition
  2239                          ;       Inputs          ________________________
  2240                          ;       Outputs         ________________________
  2241                          
  2242  0bc2  cdf40b            C324E:  CALL    C3280
  2243  0bc5  cdb609                    CALL    C3042
  2244  0bc8  c30e00                    JP      C269A                   ; DAC + ARG
  2245                          
  2246                          ;       Subroutine      single real subtract
  2247                          ;       Inputs          ________________________
  2248                          ;       Outputs         ________________________
  2249                          
  2250  0bcb  cd0108            C3257:  CALL    C2E8D                   ; NEG DAC
  2251  0bce  18f2                      JR      C324E                   ; single real addition
  2252                          
  2253                          ;       Subroutine      single real muliply
  2254                          ;       Inputs          ________________________
  2255                          ;       Outputs         ________________________
  2256                          
  2257  0bd0  cdf40b            C325C:  CALL    C3280
  2258  0bd3  cdb609                    CALL    C3042
  2259  0bd6  c35a01                    JP      C27E6                   ; DAC * ARG and quit
  2260                          
  2261  0bd9  c1                J3265:  POP     BC
  2262  0bda  d1                        POP     DE
  2263                          
  2264                          ;       Subroutine      single real divide
  2265                          ;       Inputs          ________________________
  2266                          ;       Outputs         ________________________
  2267                          
  2268  0bdb  2af8f7            C3267:  LD      HL,(DAC+2)
  2269  0bde  eb                        EX      DE,HL
  2270  0bdf  22f8f7                    LD      (DAC+2),HL
  2271  0be2  c5                        PUSH    BC
  2272  0be3  2af6f7                    LD      HL,(DAC)
  2273  0be6  e3                        EX      (SP),HL
  2274  0be7  22f6f7                    LD      (DAC),HL
  2275  0bea  c1                        POP     BC
  2276  0beb  cdf40b                    CALL    C3280
  2277  0bee  cdb609                    CALL    C3042
  2278  0bf1  c31302                    JP      C289F                   ; DAC / ARG and quit
  2279                          
  2280                          ;       Subroutine      __________________________
  2281                          ;       Inputs          ________________________
  2282                          ;       Outputs         ________________________
  2283                          
  2284  0bf4  eb                C3280:  EX      DE,HL
  2285  0bf5  2249f8                    LD      (ARG+2),HL
  2286  0bf8  60                        LD      H,B
  2287  0bf9  69                        LD      L,C
  2288  0bfa  2247f8                    LD      (ARG+0),HL
  2289  0bfd  210000                    LD      HL,0
  2290  0c00  224bf8                    LD      (ARG+4),HL
  2291  0c03  224df8                    LD      (ARG+6),HL
  2292  0c06  c9                        RET
  2293                          
  2294                          ;       Subroutine      __________________________
  2295                          ;       Inputs          ________________________
  2296                          ;       Outputs         ________________________
  2297                          
  2298  0c07  3d                C3293:  DEC     A
  2299  0c08  c9                        RET
  2300                          
  2301                          ;       Subroutine      __________________________
  2302                          ;       Inputs          ________________________
  2303                          ;       Outputs         ________________________
  2304                          
  2305  0c09  2b                C3295:  DEC     HL
  2306  0c0a  c9                        RET
  2307                          
  2308  0c0b  e1                J3297:  POP     HL
  2309  0c0c  c9                        RET
  2310                          
  2311                          ;       Subroutine      FIN (convert text to number)
  2312                          ;       Inputs          ________________________
  2313                          ;       Outputs         ________________________
  2314                          
  2315  0c0d  eb                C3299:  EX      DE,HL
  2316  0c0e  01ff00                    LD      BC,$00FF
  2317  0c11  60                        LD      H,B
  2318  0c12  68                        LD      L,B
  2319  0c13  cd0d09                    CALL    C2F99                   ; put HL in DAC
  2320  0c16  eb                        EX      DE,HL
  2321  0c17  7e                        LD      A,(HL)
  2322  0c18  fe26                      CP      '&'
  2323  0c1a  ca0000                    JP      Z,C4EB8                 ; convert text with radix indication to number
  2324  0c1d  fe2d                      CP      '-'
  2325  0c1f  f5                        PUSH    AF
  2326  0c20  2805                      JR      Z,J32B3
  2327  0c22  fe2b                      CP      '+'
  2328  0c24  2801                      JR      Z,J32B3
  2329  0c26  2b                        DEC     HL
  2330  0c27  d7                J32B3:  RST     CHRGTR                  ; get next BASIC character
  2331  0c28  dafa0c                    JP      C,J3386
  2332  0c2b  fe2e                      CP      '.'
  2333  0c2d  cac30c                    JP      Z,J334F
  2334  0c30  fe65                      CP      'e'
  2335  0c32  2802                      JR      Z,J32C2
  2336  0c34  fe45                      CP      'E'
  2337  0c36  201a              J32C2:  JR      NZ,J32DE
  2338  0c38  e5                        PUSH    HL
  2339  0c39  d7                        RST     CHRGTR                  ; get next BASIC character
  2340  0c3a  fe6c                      CP      'l'
  2341  0c3c  280a                      JR      Z,J32D4
  2342  0c3e  fe4c                      CP      'L'
  2343  0c40  2806                      JR      Z,J32D4
  2344  0c42  fe71                      CP      'q'
  2345  0c44  2802                      JR      Z,J32D4
  2346  0c46  fe51                      CP      'Q'
  2347  0c48  e1                J32D4:  POP     HL
  2348  0c49  2806                      JR      Z,J32DD
  2349  0c4b  ef                        RST     GETYPR                  ; get DAC type
  2350  0c4c  301b                      JR      NC,J32F5                ; double real,
  2351  0c4e  af                        XOR     A
  2352  0c4f  1819                      JR      J32F6
  2353                          
  2354  0c51  7e                J32DD:  LD      A,(HL)
  2355  0c52  fe25              J32DE:  CP      '%'
  2356  0c54  cad60c                    JP      Z,J3362
  2357  0c57  fe23                      CP      '#'
  2358  0c59  cae40c                    JP      Z,J3370
  2359  0c5c  fe21                      CP      '!'
  2360  0c5e  cae50c                    JP      Z,J3371
  2361  0c61  fe64                      CP      'd'
  2362  0c63  2804                      JR      Z,J32F5
  2363  0c65  fe44                      CP      'D'
  2364  0c67  2029                      JR      NZ,J331E
  2365  0c69  b7                J32F5:  OR      A
  2366  0c6a  cdeb0c            J32F6:  CALL    C3377
  2367  0c6d  d7                        RST     CHRGTR                  ; get next BASIC character
  2368  0c6e  d5                        PUSH    DE
  2369  0c6f  1600                      LD      D,$0
  2370  0c71  cd0000                    CALL    C4F47
  2371  0c74  4a                        LD      C,D
  2372  0c75  d1                        POP     DE
  2373  0c76  d7                J3302:  RST     CHRGTR                  ; get next BASIC character
  2374  0c77  3013                      JR      NC,J3318
  2375  0c79  7b                        LD      A,E
  2376  0c7a  fe0c                      CP      $C
  2377  0c7c  300a                      JR      NC,J3314
  2378  0c7e  07                        RLCA
  2379  0c7f  07                        RLCA
  2380  0c80  83                        ADD     A,E
  2381  0c81  07                        RLCA
  2382  0c82  86                        ADD     A,(HL)
  2383  0c83  d630                      SUB     $30
  2384  0c85  5f                        LD      E,A
  2385  0c86  18ee                      JR      J3302
  2386                          
  2387  0c88  1e80              J3314:  LD      E,$80
  2388  0c8a  18ea                      JR      J3302
  2389                          
  2390  0c8c  0c                J3318:  INC     C
  2391  0c8d  2003                      JR      NZ,J331E
  2392  0c8f  af                        XOR     A
  2393  0c90  93                        SUB     E
  2394  0c91  5f                        LD      E,A
  2395  0c92  ef                J331E:  RST     GETYPR                  ; get DAC type
  2396  0c93  faa80c                    JP      M,J3334                 ; integer,
  2397  0c96  3af6f7                    LD      A,(DAC+0)
  2398  0c99  b7                        OR      A                       ; DAC zero ?
  2399  0c9a  280c                      JR      Z,J3334                 ; yep,
  2400  0c9c  7a                        LD      A,D
  2401  0c9d  90                        SUB     B
  2402  0c9e  83                        ADD     A,E
  2403  0c9f  c640                      ADD     A,$40
  2404  0ca1  32f6f7                    LD      (DAC),A
  2405  0ca4  b7                        OR      A
  2406  0ca5  fcc00c                    CALL    M,C334C                 ; overflow error
  2407  0ca8  f1                J3334:  POP     AF
  2408  0ca9  e5                        PUSH    HL
  2409  0caa  ccfa07                    CALL    Z,C2E86                 ; negate
  2410  0cad  ef                        RST     GETYPR                  ; get DAC type
  2411  0cae  300b                      JR      NC,J3347                ; double real,
  2412  0cb0  e1                        POP     HL
  2413  0cb1  e8                        RET     PE                      ; no single real, quit
  2414  0cb2  e5                        PUSH    HL
  2415  0cb3  210b0c                    LD      HL,J3297
  2416  0cb6  e5                        PUSH    HL
  2417  0cb7  cd1609                    CALL    C2FA2
  2418  0cba  c9                        RET
  2419                          
  2420  0cbb  cdb000            J3347:  CALL    C273C                   ; round DAC
  2421  0cbe  e1                        POP     HL
  2422  0cbf  c9                        RET
  2423                          
  2424                          ;       Subroutine      __________________________
  2425                          ;       Inputs          ________________________
  2426                          ;       Outputs         ________________________
  2427                          
  2428  0cc0  c30000            C334C:  JP      J4067                   ; overflow error
  2429                          
  2430  0cc3  ef                J334F:  RST     GETYPR                  ; get DAC type
  2431  0cc4  0c                        INC     C
  2432  0cc5  20cb                      JR      NZ,J331E
  2433  0cc7  300a                      JR      NC,J335F                ; double real,
  2434  0cc9  cdeb0c                    CALL    C3377
  2435  0ccc  3af6f7                    LD      A,(DAC)
  2436  0ccf  b7                        OR      A
  2437  0cd0  2001                      JR      NZ,J335F
  2438  0cd2  57                        LD      D,A
  2439  0cd3  c3270c            J335F:  JP      J32B3
  2440                          
  2441  0cd6  d7                J3362:  RST     CHRGTR                  ; get next BASIC character
  2442  0cd7  f1                        POP     AF
  2443  0cd8  e5                        PUSH    HL
  2444  0cd9  210b0c                    LD      HL,J3297
  2445  0cdc  e5                        PUSH    HL
  2446  0cdd  21fe08                    LD      HL,C2F8A
  2447  0ce0  e5                        PUSH    HL                      ; convert DAC to integer
  2448  0ce1  f5                        PUSH    AF
  2449  0ce2  18ae                      JR      J331E
  2450                          
  2451  0ce4  b7                J3370:  OR      A
  2452  0ce5  cdeb0c            J3371:  CALL    C3377
  2453  0ce8  d7                        RST     CHRGTR                  ; get next BASIC character
  2454  0ce9  18a7                      JR      J331E
  2455                          
  2456                          ;       Subroutine      __________________________
  2457                          ;       Inputs          ________________________
  2458                          ;       Outputs         ________________________
  2459                          
  2460  0ceb  e5                C3377:  PUSH    HL
  2461  0cec  d5                        PUSH    DE
  2462  0ced  c5                        PUSH    BC
  2463  0cee  f5                        PUSH    AF
  2464  0cef  cc2609                    CALL    Z,C2FB2                 ; convert DAC to single real
  2465  0cf2  f1                        POP     AF
  2466  0cf3  c4ae09                    CALL    NZ,C303A                ; convert DAC to double real
  2467  0cf6  c1                        POP     BC
  2468  0cf7  d1                        POP     DE
  2469  0cf8  e1                        POP     HL
  2470  0cf9  c9                        RET
  2471                          
  2472  0cfa  d630              J3386:  SUB     $30
  2473  0cfc  c2070d                    JP      NZ,J3393
  2474  0cff  b1                        OR      C
  2475  0d00  ca070d                    JP      Z,J3393
  2476  0d03  a2                        AND     D
  2477  0d04  ca270c                    JP      Z,J32B3
  2478  0d07  14                J3393:  INC     D
  2479  0d08  7a                        LD      A,D
  2480  0d09  fe07                      CP      $7
  2481  0d0b  2004                      JR      NZ,J339D
  2482  0d0d  b7                        OR      A
  2483  0d0e  cdeb0c                    CALL    C3377
  2484  0d11  d5                J339D:  PUSH    DE
  2485  0d12  78                        LD      A,B
  2486  0d13  81                        ADD     A,C
  2487  0d14  3c                        INC     A
  2488  0d15  47                        LD      B,A
  2489  0d16  c5                        PUSH    BC
  2490  0d17  e5                        PUSH    HL
  2491  0d18  7e                        LD      A,(HL)
  2492  0d19  d630                      SUB     $30
  2493  0d1b  f5                        PUSH    AF
  2494  0d1c  ef                        RST     GETYPR                  ; get DAC type
  2495  0d1d  f2450d                    JP      P,J33D1                 ; not a integer,
  2496  0d20  2af8f7                    LD      HL,(DAC+2)
  2497  0d23  11cd0c                    LD      DE,3277
  2498  0d26  e7                        RST     DCOMPR
  2499  0d27  3019                      JR      NC,J33CE
  2500  0d29  54                        LD      D,H
  2501  0d2a  5d                        LD      E,L
  2502  0d2b  29                        ADD     HL,HL
  2503  0d2c  29                        ADD     HL,HL
  2504  0d2d  19                        ADD     HL,DE
  2505  0d2e  29                        ADD     HL,HL
  2506  0d2f  f1                        POP     AF
  2507  0d30  4f                        LD      C,A
  2508  0d31  09                        ADD     HL,BC
  2509  0d32  7c                        LD      A,H
  2510  0d33  b7                        OR      A
  2511  0d34  fa400d                    JP      M,J33CC
  2512  0d37  22f8f7                    LD      (DAC+2),HL
  2513  0d3a  e1                J33C6:  POP     HL
  2514  0d3b  c1                        POP     BC
  2515  0d3c  d1                        POP     DE
  2516  0d3d  c3270c                    JP      J32B3
  2517                          
  2518  0d40  79                J33CC:  LD      A,C
  2519  0d41  f5                        PUSH    AF
  2520  0d42  cd3c09            J33CE:  CALL    C2FC8
  2521  0d45  f1                J33D1:  POP     AF
  2522  0d46  e1                        POP     HL
  2523  0d47  c1                        POP     BC
  2524  0d48  d1                        POP     DE
  2525  0d49  200c                      JR      NZ,J33E3
  2526  0d4b  3af6f7                    LD      A,(DAC)
  2527  0d4e  b7                        OR      A
  2528  0d4f  3e00                      LD      A,$0
  2529  0d51  2004                      JR      NZ,J33E3
  2530  0d53  57                        LD      D,A
  2531  0d54  c3270c                    JP      J32B3
  2532                          
  2533  0d57  d5                J33E3:  PUSH    DE
  2534  0d58  c5                        PUSH    BC
  2535  0d59  e5                        PUSH    HL
  2536  0d5a  f5                        PUSH    AF
  2537  0d5b  21f6f7                    LD      HL,DAC
  2538  0d5e  3601                      LD      (HL),$1
  2539  0d60  7a                        LD      A,D
  2540  0d61  fe10                      CP      $10
  2541  0d63  3803                      JR      C,J33F4
  2542  0d65  f1                        POP     AF
  2543  0d66  18d2                      JR      J33C6
  2544                          
  2545  0d68  3c                J33F4:  INC     A
  2546  0d69  b7                        OR      A
  2547  0d6a  1f                        RRA
  2548  0d6b  0600                      LD      B,$0
  2549  0d6d  4f                        LD      C,A
  2550  0d6e  09                        ADD     HL,BC
  2551  0d6f  f1                        POP     AF
  2552  0d70  4f                        LD      C,A
  2553  0d71  7a                        LD      A,D
  2554  0d72  1f                        RRA
  2555  0d73  79                        LD      A,C
  2556  0d74  3004                      JR      NC,J3406
  2557  0d76  87                        ADD     A,A
  2558  0d77  87                        ADD     A,A
  2559  0d78  87                        ADD     A,A
  2560  0d79  87                        ADD     A,A
  2561  0d7a  b6                J3406:  OR      (HL)
  2562  0d7b  77                        LD      (HL),A
  2563  0d7c  18bc                      JR      J33C6
  2564                          
  2565                          ;       Subroutine      "in" number to interpreter output
  2566                          ;       Inputs          ________________________
  2567                          ;       Outputs         ________________________
  2568                          
  2569  0d7e  e5                C340A:  PUSH    HL
  2570  0d7f  210000                    LD      HL,I3FD2
  2571  0d82  cd0000                    CALL    C6678                   ; message to interpreter output
  2572  0d85  e1                        POP     HL
  2573                          
  2574                          ;       Subroutine      number to interpreter output
  2575                          ;       Inputs          ________________________
  2576                          ;       Outputs         ________________________
  2577                          
  2578  0d86  010000            C3412:  LD      BC,I6677
  2579  0d89  c5                        PUSH    BC                      ; after this: skip first char, message to interpreter
  2580  0d8a  cd0d09                    CALL    C2F99                   ; put HL in DAC
  2581  0d8d  af                        XOR     A
  2582  0d8e  329df6                    LD      (TEMP3),A
  2583  0d91  21c6f7                    LD      HL,FBUFFR+1
  2584  0d94  3620                      LD      (HL),' '
  2585  0d96  b6                        OR      (HL)
  2586  0d97  181c                      JR      J3441
  2587                          
  2588                          ;       Subroutine      FOUT (convert DAC to text, unformatted)
  2589                          ;       Inputs          ________________________
  2590                          ;       Outputs         ________________________
  2591                          
  2592                          
  2593  0d99  af                C3425:  XOR     A
  2594                          ;       Subroutine      PUFOUT (convert DAC to text, formatted)
  2595                          ;       Inputs          ________________________
  2596                          ;       Outputs         ________________________
  2597                          
  2598  0d9a  cdd310            C3426:  CALL    C375F
  2599  0d9d  e608                      AND     $8
  2600  0d9f  2802                      JR      Z,J342F
  2601  0da1  362b                      LD      (HL),'+'
  2602  0da3  eb                J342F:  EX      DE,HL
  2603  0da4  cd1508                    CALL    C2EA1                   ; get sign DAC
  2604  0da7  eb                        EX      DE,HL
  2605  0da8  f2b50d                    JP      P,J3441
  2606  0dab  362d                      LD      (HL),'-'
  2607  0dad  c5                        PUSH    BC
  2608  0dae  e5                        PUSH    HL
  2609  0daf  cdfa07                    CALL    C2E86                   ; negate
  2610  0db2  e1                        POP     HL
  2611  0db3  c1                        POP     BC
  2612  0db4  b4                        OR      H
  2613  0db5  23                J3441:  INC     HL
  2614  0db6  3630                      LD      (HL),$30
  2615  0db8  3a9df6                    LD      A,(TEMP3)
  2616  0dbb  57                        LD      D,A
  2617  0dbc  17                        RLA
  2618  0dbd  3a63f6                    LD      A,(VALTYP)
  2619  0dc0  da6b0e                    JP      C,J34F7
  2620  0dc3  ca630e                    JP      Z,J34EF
  2621  0dc6  fe04                      CP      $4
  2622  0dc8  d2150e                    JP      NC,J34A1
  2623  0dcb  010000                    LD      BC,0
  2624  0dce  cd4f10                    CALL    C36DB
  2625                          
  2626                          ;       Subroutine      __________________________
  2627                          ;       Inputs          ________________________
  2628                          ;       Outputs         ________________________
  2629                          
  2630  0dd1  21c6f7            C345D:  LD      HL,FBUFFR+1
  2631  0dd4  46                        LD      B,(HL)
  2632  0dd5  0e20                      LD      C,$20
  2633  0dd7  3a9df6                    LD      A,(TEMP3)
  2634  0dda  5f                        LD      E,A
  2635  0ddb  e620                      AND     $20
  2636  0ddd  280c                      JR      Z,J3477
  2637  0ddf  78                        LD      A,B
  2638  0de0  b9                        CP      C
  2639  0de1  0e2a                      LD      C,$2A
  2640  0de3  2006                      JR      NZ,J3477
  2641  0de5  7b                        LD      A,E
  2642  0de6  e604                      AND     $4
  2643  0de8  2001                      JR      NZ,J3477
  2644  0dea  41                        LD      B,C
  2645  0deb  71                J3477:  LD      (HL),C
  2646  0dec  d7                        RST     CHRGTR                  ; get next BASIC character
  2647  0ded  2814                      JR      Z,J348F
  2648  0def  fe45                      CP      'E'
  2649  0df1  2810                      JR      Z,J348F
  2650  0df3  fe44                      CP      'D'
  2651  0df5  280c                      JR      Z,J348F
  2652  0df7  fe30                      CP      $30
  2653  0df9  28f0                      JR      Z,J3477
  2654  0dfb  fe2c                      CP      ','
  2655  0dfd  28ec                      JR      Z,J3477
  2656  0dff  fe2e                      CP      '.'
  2657  0e01  2003                      JR      NZ,J3492
  2658  0e03  2b                J348F:  DEC     HL
  2659  0e04  3630                      LD      (HL),$30
  2660  0e06  7b                J3492:  LD      A,E
  2661  0e07  e610                      AND     $10
  2662  0e09  2803                      JR      Z,J349A
  2663  0e0b  2b                        DEC     HL
  2664  0e0c  3624                      LD      (HL),CHRCUR
  2665  0e0e  7b                J349A:  LD      A,E
  2666  0e0f  e604                      AND     $4
  2667  0e11  c0                        RET     NZ
  2668  0e12  2b                        DEC     HL
  2669  0e13  70                        LD      (HL),B
  2670  0e14  c9                        RET
  2671                          
  2672  0e15  e5                J34A1:  PUSH    HL
  2673  0e16  cdc610                    CALL    C3752
  2674  0e19  50                        LD      D,B
  2675  0e1a  14                        INC     D
  2676  0e1b  010003                    LD      BC,$0300
  2677  0e1e  3af6f7                    LD      A,(DAC)
  2678  0e21  d63f                      SUB     $3F
  2679  0e23  3808                      JR      C,J34B9
  2680  0e25  14                        INC     D
  2681  0e26  ba                        CP      D
  2682  0e27  3004                      JR      NC,J34B9
  2683  0e29  3c                        INC     A
  2684  0e2a  47                        LD      B,A
  2685  0e2b  3e02                      LD      A,$2
  2686  0e2d  d602              J34B9:  SUB     $2
  2687  0e2f  e1                        POP     HL
  2688  0e30  f5                        PUSH    AF
  2689  0e31  cd0210                    CALL    C368E
  2690  0e34  3630                      LD      (HL),$30
  2691  0e36  cc5a08                    CALL    Z,C2EE6
  2692  0e39  cd2710                    CALL    C36B3
  2693  0e3c  2b                J34C8:  DEC     HL
  2694  0e3d  7e                        LD      A,(HL)
  2695  0e3e  fe30                      CP      $30
  2696  0e40  28fa                      JR      Z,J34C8
  2697  0e42  fe2e                      CP      '.'
  2698  0e44  c45a08                    CALL    NZ,C2EE6
  2699  0e47  f1                        POP     AF
  2700  0e48  281a                      JR      Z,J34F0
  2701                          
  2702                          ;       Subroutine      __________________________
  2703                          ;       Inputs          ________________________
  2704                          ;       Outputs         ________________________
  2705                          
  2706  0e4a  3645              C34D6:  LD      (HL),'E'
  2707  0e4c  23                        INC     HL
  2708  0e4d  362b                      LD      (HL),'+'
  2709  0e4f  f2560e                    JP      P,J34E2
  2710  0e52  362d                      LD      (HL),'-'
  2711  0e54  2f                        CPL
  2712  0e55  3c                        INC     A
  2713  0e56  062f              J34E2:  LD      B,$2F
  2714  0e58  04                J34E4:  INC     B
  2715  0e59  d60a                      SUB     $A
  2716  0e5b  30fb                      JR      NC,J34E4
  2717  0e5d  c63a                      ADD     A,$3A
  2718  0e5f  23                        INC     HL
  2719  0e60  70                        LD      (HL),B
  2720  0e61  23                        INC     HL
  2721  0e62  77                        LD      (HL),A
  2722  0e63  23                J34EF:  INC     HL
  2723  0e64  3600              J34F0:  LD      (HL),$0
  2724  0e66  eb                        EX      DE,HL
  2725  0e67  21c6f7                    LD      HL,FBUFFR+1
  2726  0e6a  c9                        RET
  2727                          
  2728  0e6b  23                J34F7:  INC     HL
  2729  0e6c  c5                        PUSH    BC
  2730  0e6d  fe04                      CP      $4
  2731  0e6f  7a                        LD      A,D
  2732  0e70  d2da0e                    JP      NC,J3566
  2733  0e73  1f                        RRA
  2734  0e74  da630f                    JP      C,J35EF
  2735  0e77  010306                    LD      BC,$0603
  2736  0e7a  cdfa0f                    CALL    C3686
  2737  0e7d  d1                        POP     DE
  2738  0e7e  7a                        LD      A,D
  2739  0e7f  d605                      SUB     $5
  2740  0e81  f4da0f                    CALL    P,C3666
  2741  0e84  cd4f10                    CALL    C36DB
  2742  0e87  7b                J3513:  LD      A,E
  2743  0e88  b7                        OR      A
  2744  0e89  cc090c                    CALL    Z,C3295
  2745  0e8c  3d                        DEC     A
  2746  0e8d  f4da0f                    CALL    P,C3666
  2747  0e90  e5                J351C:  PUSH    HL
  2748  0e91  cdd10d                    CALL    C345D
  2749  0e94  e1                        POP     HL
  2750  0e95  2802                      JR      Z,J3525
  2751  0e97  70                        LD      (HL),B
  2752  0e98  23                        INC     HL
  2753  0e99  3600              J3525:  LD      (HL),$0
  2754  0e9b  21c5f7                    LD      HL,FBUFFR
  2755  0e9e  23                J352A:  INC     HL
  2756  0e9f  3abcf6            J352B:  LD      A,(TEMP2)
  2757  0ea2  95                        SUB     L
  2758  0ea3  92                        SUB     D
  2759  0ea4  c8                        RET     Z
  2760  0ea5  7e                        LD      A,(HL)
  2761  0ea6  fe20                      CP      ' '
  2762  0ea8  28f4                      JR      Z,J352A
  2763  0eaa  fe2a                      CP      '*'
  2764  0eac  28f0                      JR      Z,J352A
  2765  0eae  2b                        DEC     HL
  2766  0eaf  e5                        PUSH    HL
  2767  0eb0  f5                I353C:  PUSH    AF
  2768  0eb1  01b00e                    LD      BC,I353C
  2769  0eb4  c5                        PUSH    BC
  2770  0eb5  d7                        RST     CHRGTR                  ; get next BASIC character
  2771  0eb6  fe2d                      CP      '-'
  2772  0eb8  c8                        RET     Z
  2773  0eb9  fe2b                      CP      '+'
  2774  0ebb  c8                        RET     Z
  2775  0ebc  fe24                      CP      CHRCUR
  2776  0ebe  c8                        RET     Z
  2777  0ebf  c1                        POP     BC
  2778  0ec0  fe30                      CP      $30
  2779  0ec2  200f                      JR      NZ,J355F
  2780  0ec4  23                        INC     HL
  2781  0ec5  d7                        RST     CHRGTR                  ; get next BASIC character
  2782  0ec6  300b                      JR      NC,J355F
  2783  0ec8  2b                        DEC     HL
  2784  0ec9  1802                      JR      J3559
  2785                          
  2786  0ecb  2b                J3557:  DEC     HL
  2787  0ecc  77                        LD      (HL),A
  2788  0ecd  f1                J3559:  POP     AF
  2789  0ece  28fb                      JR      Z,J3557
  2790  0ed0  c1                        POP     BC
  2791  0ed1  18cc                      JR      J352B
  2792                          
  2793  0ed3  f1                J355F:  POP     AF
  2794  0ed4  28fd                      JR      Z,J355F
  2795  0ed6  e1                        POP     HL
  2796  0ed7  3625                      LD      (HL),'%'
  2797  0ed9  c9                        RET
  2798                          
  2799  0eda  e5                J3566:  PUSH    HL
  2800  0edb  1f                        RRA
  2801  0edc  da690f                    JP      C,J35F5
  2802  0edf  cdc610                    CALL    C3752
  2803  0ee2  50                        LD      D,B
  2804  0ee3  3af6f7                    LD      A,(DAC)
  2805  0ee6  d64f                      SUB     $4F
  2806  0ee8  380b                      JR      C,J3581
  2807  0eea  e1                        POP     HL
  2808  0eeb  c1                        POP     BC
  2809  0eec  cd990d                    CALL    C3425                   ; convert DAC to text, unformatted
  2810  0eef  21c5f7                    LD      HL,FBUFFR
  2811  0ef2  3625                      LD      (HL),'%'
  2812  0ef4  c9                        RET
  2813                          
  2814  0ef5  cde507            J3581:  CALL    C2E71                   ; get sign DAC
  2815  0ef8  c41611                    CALL    NZ,C37A2                ; DAC not zero,
  2816  0efb  e1                        POP     HL
  2817  0efc  c1                        POP     BC
  2818  0efd  fa1a0f                    JP      M,J35A6
  2819  0f00  c5                        PUSH    BC
  2820  0f01  5f                        LD      E,A
  2821  0f02  78                        LD      A,B
  2822  0f03  92                        SUB     D
  2823  0f04  93                        SUB     E
  2824  0f05  f4da0f                    CALL    P,C3666
  2825  0f08  cdee0f                    CALL    C367A
  2826  0f0b  cd2710                    CALL    C36B3
  2827  0f0e  b3                        OR      E
  2828  0f0f  c4e80f                    CALL    NZ,C3674
  2829  0f12  b3                        OR      E
  2830  0f13  c41410                    CALL    NZ,C36A0
  2831  0f16  d1                        POP     DE
  2832  0f17  c3870e                    JP      J3513
  2833                          
  2834  0f1a  5f                J35A6:  LD      E,A
  2835  0f1b  79                        LD      A,C
  2836  0f1c  b7                        OR      A
  2837  0f1d  c4070c                    CALL    NZ,C3293
  2838  0f20  83                        ADD     A,E
  2839  0f21  fa250f                    JP      M,J35B1
  2840  0f24  af                        XOR     A
  2841  0f25  c5                J35B1:  PUSH    BC
  2842  0f26  f5                        PUSH    AF
  2843  0f27  fcef10                    CALL    M,C377B
  2844  0f2a  c1                        POP     BC
  2845  0f2b  7b                        LD      A,E
  2846  0f2c  90                        SUB     B
  2847  0f2d  c1                        POP     BC
  2848  0f2e  5f                        LD      E,A
  2849  0f2f  82                        ADD     A,D
  2850  0f30  78                        LD      A,B
  2851  0f31  fa3f0f                    JP      M,J35CB
  2852  0f34  92                        SUB     D
  2853  0f35  93                        SUB     E
  2854  0f36  f4da0f                    CALL    P,C3666
  2855  0f39  c5                        PUSH    BC
  2856  0f3a  cdee0f                    CALL    C367A
  2857  0f3d  1811                      JR      J35DC
  2858                          
  2859  0f3f  cdda0f            J35CB:  CALL    C3666
  2860  0f42  79                        LD      A,C
  2861  0f43  cd1710                    CALL    C36A3
  2862  0f46  4f                        LD      C,A
  2863  0f47  af                        XOR     A
  2864  0f48  92                        SUB     D
  2865  0f49  93                        SUB     E
  2866  0f4a  cdda0f                    CALL    C3666
  2867  0f4d  c5                        PUSH    BC
  2868  0f4e  47                        LD      B,A
  2869  0f4f  4f                        LD      C,A
  2870  0f50  cd2710            J35DC:  CALL    C36B3
  2871  0f53  c1                        POP     BC
  2872  0f54  b1                        OR      C
  2873  0f55  2003                      JR      NZ,J35E6
  2874  0f57  2abcf6                    LD      HL,(TEMP2)
  2875  0f5a  83                J35E6:  ADD     A,E
  2876  0f5b  3d                        DEC     A
  2877  0f5c  f4da0f                    CALL    P,C3666
  2878  0f5f  50                        LD      D,B
  2879  0f60  c3900e                    JP      J351C
  2880                          
  2881  0f63  e5                J35EF:  PUSH    HL
  2882  0f64  d5                        PUSH    DE
  2883  0f65  cd3c09                    CALL    C2FC8
  2884  0f68  d1                        POP     DE
  2885  0f69  cdc610            J35F5:  CALL    C3752
  2886  0f6c  58                        LD      E,B
  2887  0f6d  cde507                    CALL    C2E71                   ; get sign DAC
  2888  0f70  f5                        PUSH    AF
  2889  0f71  c41611                    CALL    NZ,C37A2                ; DAC not zero,
  2890  0f74  f1                        POP     AF
  2891  0f75  e1                        POP     HL
  2892  0f76  c1                        POP     BC
  2893  0f77  f5                        PUSH    AF
  2894  0f78  79                        LD      A,C
  2895  0f79  b7                        OR      A
  2896  0f7a  f5                        PUSH    AF
  2897  0f7b  c4070c                    CALL    NZ,C3293
  2898  0f7e  80                        ADD     A,B
  2899  0f7f  4f                        LD      C,A
  2900  0f80  7a                        LD      A,D
  2901  0f81  e604                      AND     $4
  2902  0f83  fe01                      CP      $1
  2903  0f85  9f                        SBC     A,A
  2904  0f86  57                        LD      D,A
  2905  0f87  81                        ADD     A,C
  2906  0f88  4f                        LD      C,A
  2907  0f89  93                        SUB     E
  2908  0f8a  f5                        PUSH    AF
  2909  0f8b  f29c0f                    JP      P,J3628
  2910  0f8e  cdef10                    CALL    C377B
  2911  0f91  2009                      JR      NZ,J3628
  2912  0f93  e5                        PUSH    HL
  2913  0f94  cd4f01                    CALL    C27DB
  2914  0f97  21f6f7                    LD      HL,DAC
  2915  0f9a  34                        INC     (HL)
  2916  0f9b  e1                        POP     HL
  2917  0f9c  f1                J3628:  POP     AF
  2918  0f9d  c5                        PUSH    BC
  2919  0f9e  f5                        PUSH    AF
  2920  0f9f  faa30f                    JP      M,J362F
  2921  0fa2  af                        XOR     A
  2922  0fa3  2f                J362F:  CPL
  2923  0fa4  3c                        INC     A
  2924  0fa5  80                        ADD     A,B
  2925  0fa6  3c                        INC     A
  2926  0fa7  82                        ADD     A,D
  2927  0fa8  47                        LD      B,A
  2928  0fa9  0e00                      LD      C,$0
  2929  0fab  cc0210                    CALL    Z,C368E
  2930  0fae  cd2710                    CALL    C36B3
  2931  0fb1  f1                        POP     AF
  2932  0fb2  f4e20f                    CALL    P,C366E
  2933  0fb5  cd1410                    CALL    C36A0
  2934  0fb8  c1                        POP     BC
  2935  0fb9  f1                        POP     AF
  2936  0fba  200c                      JR      NZ,J3654
  2937  0fbc  cd090c                    CALL    C3295
  2938  0fbf  7e                        LD      A,(HL)
  2939  0fc0  fe2e                      CP      '.'
  2940  0fc2  c45a08                    CALL    NZ,C2EE6
  2941  0fc5  22bcf6                    LD      (TEMP2),HL
  2942  0fc8  f1                J3654:  POP     AF
  2943  0fc9  3af6f7                    LD      A,(DAC)
  2944  0fcc  2803                      JR      Z,J365D
  2945  0fce  83                        ADD     A,E
  2946  0fcf  90                        SUB     B
  2947  0fd0  92                        SUB     D
  2948  0fd1  c5                J365D:  PUSH    BC
  2949  0fd2  cd4a0e                    CALL    C34D6
  2950  0fd5  eb                        EX      DE,HL
  2951  0fd6  d1                        POP     DE
  2952  0fd7  c3900e                    JP      J351C
  2953                          
  2954                          ;       Subroutine      __________________________
  2955                          ;       Inputs          ________________________
  2956                          ;       Outputs         ________________________
  2957                          
  2958  0fda  b7                C3666:  OR      A
  2959  0fdb  c8                J3667:  RET     Z
  2960  0fdc  3d                        DEC     A
  2961  0fdd  3630                      LD      (HL),$30
  2962  0fdf  23                        INC     HL
  2963  0fe0  18f9                      JR      J3667
  2964                          
  2965                          ;       Subroutine      __________________________
  2966                          ;       Inputs          ________________________
  2967                          ;       Outputs         ________________________
  2968                          
  2969  0fe2  2004              C366E:  JR      NZ,C3674
  2970  0fe4  c8                J3670:  RET     Z
  2971  0fe5  cd1410                    CALL    C36A0
  2972                          
  2973                          ;       Subroutine      __________________________
  2974                          ;       Inputs          ________________________
  2975                          ;       Outputs         ________________________
  2976                          
  2977  0fe8  3630              C3674:  LD      (HL),$30
  2978  0fea  23                        INC     HL
  2979  0feb  3d                        DEC     A
  2980  0fec  18f6                      JR      J3670
  2981                          
  2982                          ;       Subroutine      __________________________
  2983                          ;       Inputs          ________________________
  2984                          ;       Outputs         ________________________
  2985                          
  2986  0fee  7b                C367A:  LD      A,E
  2987  0fef  82                        ADD     A,D
  2988  0ff0  3c                        INC     A
  2989  0ff1  47                        LD      B,A
  2990  0ff2  3c                        INC     A
  2991  0ff3  d603              J367F:  SUB     $3
  2992  0ff5  30fc                      JR      NC,J367F
  2993  0ff7  c605                      ADD     A,$5
  2994  0ff9  4f                        LD      C,A
  2995                          
  2996                          ;       Subroutine      __________________________
  2997                          ;       Inputs          ________________________
  2998                          ;       Outputs         ________________________
  2999                          
  3000  0ffa  3a9df6            C3686:  LD      A,(TEMP3)
  3001  0ffd  e640                      AND     $40
  3002  0fff  c0                        RET     NZ
  3003  1000  4f                        LD      C,A
  3004  1001  c9                        RET
  3005                          
  3006                          ;       Subroutine      __________________________
  3007                          ;       Inputs          ________________________
  3008                          ;       Outputs         ________________________
  3009                          
  3010  1002  05                C368E:  DEC     B
  3011  1003  f21510                    JP      P,J36A1
  3012  1006  22bcf6                    LD      (TEMP2),HL
  3013  1009  362e                      LD      (HL),'.'
  3014  100b  23                J3697:  INC     HL
  3015  100c  3630                      LD      (HL),'0'
  3016  100e  04                        INC     B
  3017  100f  48                        LD      C,B
  3018  1010  20f9                      JR      NZ,J3697
  3019  1012  23                        INC     HL
  3020  1013  c9                        RET
  3021                          
  3022                          ;       Subroutine      __________________________
  3023                          ;       Inputs          ________________________
  3024                          ;       Outputs         ________________________
  3025                          
  3026  1014  05                C36A0:  DEC     B
  3027  1015  2008              J36A1:  JR      NZ,J36AB
  3028                          
  3029                          ;       Subroutine      __________________________
  3030                          ;       Inputs          ________________________
  3031                          ;       Outputs         ________________________
  3032                          
  3033  1017  362e              C36A3:  LD      (HL),'.'
  3034  1019  22bcf6                    LD      (TEMP2),HL
  3035  101c  23                        INC     HL
  3036  101d  48                        LD      C,B
  3037  101e  c9                        RET
  3038                          
  3039  101f  0d                J36AB:  DEC     C
  3040  1020  c0                        RET     NZ
  3041  1021  362c                      LD      (HL),','
  3042  1023  23                        INC     HL
  3043  1024  0e03                      LD      C,$3
  3044  1026  c9                        RET
  3045                          
  3046                          ;       Subroutine      __________________________
  3047                          ;       Inputs          ________________________
  3048                          ;       Outputs         ________________________
  3049                          
  3050  1027  d5                C36B3:  PUSH    DE
  3051  1028  e5                        PUSH    HL
  3052  1029  c5                        PUSH    BC
  3053  102a  cdc610                    CALL    C3752
  3054  102d  78                        LD      A,B
  3055  102e  c1                        POP     BC
  3056  102f  e1                        POP     HL
  3057  1030  11f7f7                    LD      DE,DAC+1
  3058  1033  37                        SCF
  3059  1034  f5                J36C0:  PUSH    AF
  3060  1035  cd1410                    CALL    C36A0
  3061  1038  1a                        LD      A,(DE)
  3062  1039  3006                      JR      NC,J36CD
  3063  103b  1f                        RRA
  3064  103c  1f                        RRA
  3065  103d  1f                        RRA
  3066  103e  1f                        RRA
  3067  103f  1801                      JR      J36CE
  3068                          
  3069  1041  13                J36CD:  INC     DE
  3070  1042  e60f              J36CE:  AND     $F
  3071  1044  c630                      ADD     A,'0'
  3072  1046  77                        LD      (HL),A
  3073  1047  23                        INC     HL
  3074  1048  f1                        POP     AF
  3075  1049  3d                        DEC     A
  3076  104a  3f                        CCF
  3077  104b  20e7                      JR      NZ,J36C0
  3078  104d  182f                      JR      J370A
  3079                          
  3080                          ;       Subroutine      __________________________
  3081                          ;       Inputs          ________________________
  3082                          ;       Outputs         ________________________
  3083                          
  3084  104f  d5                C36DB:  PUSH    DE
  3085  1050  118410                    LD      DE,I3710
  3086  1053  3e05                      LD      A,$5
  3087  1055  cd1410            J36E1:  CALL    C36A0
  3088  1058  c5                        PUSH    BC
  3089  1059  f5                        PUSH    AF
  3090  105a  e5                        PUSH    HL
  3091  105b  eb                        EX      DE,HL
  3092  105c  4e                        LD      C,(HL)
  3093  105d  23                        INC     HL
  3094  105e  46                        LD      B,(HL)
  3095  105f  c5                        PUSH    BC
  3096  1060  23                        INC     HL
  3097  1061  e3                        EX      (SP),HL
  3098  1062  eb                        EX      DE,HL
  3099  1063  2af8f7                    LD      HL,(DAC+2)
  3100  1066  062f                      LD      B,$2F
  3101  1068  04                J36F4:  INC     B
  3102  1069  7d                        LD      A,L
  3103  106a  93                        SUB     E
  3104  106b  6f                        LD      L,A
  3105  106c  7c                        LD      A,H
  3106  106d  9a                        SBC     A,D
  3107  106e  67                        LD      H,A
  3108  106f  30f7                      JR      NC,J36F4
  3109  1071  19                        ADD     HL,DE
  3110  1072  22f8f7                    LD      (DAC+2),HL
  3111  1075  d1                        POP     DE
  3112  1076  e1                        POP     HL
  3113  1077  70                        LD      (HL),B
  3114  1078  23                        INC     HL
  3115  1079  f1                        POP     AF
  3116  107a  c1                        POP     BC
  3117  107b  3d                        DEC     A
  3118  107c  20d7                      JR      NZ,J36E1
  3119  107e  cd1410            J370A:  CALL    C36A0
  3120  1081  77                        LD      (HL),A
  3121  1082  d1                        POP     DE
  3122  1083  c9                        RET
  3123                          
  3124  1084  1027              I3710:  DEFW    10000
  3125  1086  e803                      DEFW    1000
  3126  1088  6400                      DEFW    100
  3127  108a  0a00                      DEFW    10
  3128  108c  0100                      DEFW    1
  3129                          
  3130                          ;       Subroutine      FOUTB (convert integer to binary text)
  3131                          ;       Inputs          ________________________
  3132                          ;       Outputs         ________________________
  3133                          
  3134  108e  0601              C371A:  LD      B,1
  3135  1090  1806                      JR      J3724
  3136                          
  3137                          ;       Subroutine      FOUTO (convert integer to octal text)
  3138                          ;       Inputs          ________________________
  3139                          ;       Outputs         ________________________
  3140                          
  3141  1092  0603              C371E:  LD      B,3
  3142  1094  1802                      JR      J3724
  3143                          
  3144                          ;       Subroutine      FOUTH (convert integer to hexadecimal text)
  3145                          ;       Inputs          ________________________
  3146                          ;       Outputs         ________________________
  3147                          
  3148  1096  0604              C3722:  LD      B,4
  3149  1098  c5                J3724:  PUSH    BC
  3150  1099  cd0000                    CALL    C5439                   ; convert address to integer
  3151  109c  11d6f7                    LD      DE,FBUFFR+17
  3152  109f  af                        XOR     A
  3153  10a0  12                        LD      (DE),A
  3154  10a1  c1                        POP     BC
  3155  10a2  4f                        LD      C,A
  3156  10a3  c5                J372F:  PUSH    BC
  3157  10a4  1b                        DEC     DE
  3158  10a5  a7                J3731:  AND     A
  3159  10a6  7c                        LD      A,H
  3160  10a7  1f                        RRA
  3161  10a8  67                        LD      H,A
  3162  10a9  7d                        LD      A,L
  3163  10aa  1f                        RRA
  3164  10ab  6f                        LD      L,A
  3165  10ac  79                        LD      A,C
  3166  10ad  1f                J3739:  RRA
  3167  10ae  4f                        LD      C,A
  3168  10af  10f4                      DJNZ    J3731
  3169  10b1  c1                        POP     BC
  3170  10b2  c5                        PUSH    BC
  3171  10b3  07                J373F:  RLCA
  3172  10b4  10fd                      DJNZ    J373F
  3173  10b6  c630                      ADD     A,'0'
  3174  10b8  fe3a                      CP      '9'+1
  3175  10ba  3802                      JR      C,J374A
  3176  10bc  c607                      ADD     A,$7
  3177  10be  12                J374A:  LD      (DE),A
  3178  10bf  c1                        POP     BC
  3179  10c0  7d                        LD      A,L
  3180  10c1  b4                        OR      H
  3181  10c2  20df                      JR      NZ,J372F
  3182  10c4  eb                        EX      DE,HL
  3183  10c5  c9                        RET
  3184                          
  3185                          ;       Subroutine      __________________________
  3186                          ;       Inputs          ________________________
  3187                          ;       Outputs         ________________________
  3188                          
  3189  10c6  ef                C3752:  RST     GETYPR                  ; get DAC type
  3190  10c7  21fdf7                    LD      HL,DAC+7
  3191  10ca  060e                      LD      B,14
  3192  10cc  d0                        RET     NC                      ; double real, quit
  3193  10cd  21f9f7                    LD      HL,DAC+3
  3194  10d0  0606                      LD      B,6
  3195  10d2  c9                        RET
  3196                          
  3197                          ;       Subroutine      __________________________
  3198                          ;       Inputs          ________________________
  3199                          ;       Outputs         ________________________
  3200                          
  3201  10d3  329df6            C375F:  LD      (TEMP3),A
  3202  10d6  f5                        PUSH    AF
  3203  10d7  c5                        PUSH    BC
  3204  10d8  d5                        PUSH    DE
  3205  10d9  cdae09                    CALL    C303A                   ; convert DAC to double real
  3206  10dc  218706                    LD      HL,I2D13
  3207  10df  3af6f7                    LD      A,(DAC)
  3208  10e2  a7                        AND     A
  3209  10e3  ccd005                    CALL    Z,C2C5C                 ; ?, DAC = 0
  3210  10e6  d1                        POP     DE
  3211  10e7  c1                        POP     BC
  3212  10e8  f1                        POP     AF
  3213  10e9  21c6f7                    LD      HL,FBUFFR+1
  3214  10ec  3620                      LD      (HL),$20
  3215  10ee  c9                        RET
  3216                          
  3217                          ;       Subroutine      __________________________
  3218                          ;       Inputs          ________________________
  3219                          ;       Outputs         ________________________
  3220                          
  3221  10ef  e5                C377B:  PUSH    HL
  3222  10f0  d5                        PUSH    DE
  3223  10f1  c5                        PUSH    BC
  3224  10f2  f5                        PUSH    AF
  3225  10f3  2f                        CPL
  3226  10f4  3c                        INC     A
  3227  10f5  5f                        LD      E,A
  3228  10f6  3e01                      LD      A,$1
  3229  10f8  ca1011                    JP      Z,J379C
  3230  10fb  cdc610                    CALL    C3752
  3231  10fe  e5                        PUSH    HL
  3232  10ff  cd4f01            J378B:  CALL    C27DB
  3233  1102  1d                        DEC     E
  3234  1103  20fa                      JR      NZ,J378B
  3235  1105  e1                        POP     HL
  3236  1106  23                        INC     HL
  3237  1107  78                        LD      A,B
  3238  1108  0f                        RRCA
  3239  1109  47                        LD      B,A
  3240  110a  cdb500                    CALL    C2741
  3241  110d  cd2811                    CALL    C37B4
  3242  1110  c1                J379C:  POP     BC
  3243  1111  80                        ADD     A,B
  3244  1112  c1                        POP     BC
  3245  1113  d1                        POP     DE
  3246  1114  e1                        POP     HL
  3247  1115  c9                        RET
  3248                          
  3249                          ;       Subroutine      __________________________
  3250                          ;       Inputs          ________________________
  3251                          ;       Outputs         ________________________
  3252                          
  3253  1116  c5                C37A2:  PUSH    BC
  3254  1117  e5                        PUSH    HL
  3255  1118  cdc610                    CALL    C3752
  3256  111b  3af6f7                    LD      A,(DAC)
  3257  111e  d640                      SUB     $40
  3258  1120  90                        SUB     B
  3259  1121  32f6f7                    LD      (DAC),A
  3260  1124  e1                        POP     HL
  3261  1125  c1                        POP     BC
  3262  1126  b7                        OR      A
  3263  1127  c9                        RET
  3264                          
  3265                          ;       Subroutine      __________________________
  3266                          ;       Inputs          ________________________
  3267                          ;       Outputs         ________________________
  3268                          
  3269  1128  c5                C37B4:  PUSH    BC
  3270  1129  cdc610                    CALL    C3752
  3271  112c  7e                J37B8:  LD      A,(HL)
  3272  112d  e60f                      AND     $F
  3273  112f  2008                      JR      NZ,J37C5
  3274  1131  05                        DEC     B
  3275  1132  7e                        LD      A,(HL)
  3276  1133  b7                        OR      A
  3277  1134  2003                      JR      NZ,J37C5
  3278  1136  2b                        DEC     HL
  3279  1137  10f3                      DJNZ    J37B8
  3280  1139  78                J37C5:  LD      A,B
  3281  113a  c1                        POP     BC
  3282  113b  c9                        RET
  3283                          
  3284                          ;       Subroutine      SGNEXP (single real to the power)
  3285                          ;       Inputs          ________________________
  3286                          ;       Outputs         ________________________
  3287                          
  3288  113c  cdf40b            C37C8:  CALL    C3280
  3289  113f  cdb609                    CALL    C3042
  3290  1142  cd3b06                    CALL    C2CC7                   ; push ARG
  3291  1145  cde305                    CALL    C2C6F                   ; exchange DAC with stack
  3292  1148  cd5006                    CALL    C2CDC                   ; pop ARG
  3293                          
  3294                          ;       Subroutine      DBLEXP (double real to the power)
  3295                          ;       Inputs          ________________________
  3296                          ;       Outputs         ________________________
  3297                          
  3298  114b  3a47f8            C37D7:  LD      A,(ARG)
  3299  114e  b7                        OR      A
  3300  114f  cab711                    JP      Z,J3843
  3301  1152  67                        LD      H,A
  3302  1153  3af6f7                    LD      A,(DAC)
  3303  1156  b7                        OR      A
  3304  1157  cac111                    JP      Z,J384D
  3305  115a  cd4006                    CALL    C2CCC                   ; push DAC
  3306  115d  cd8e12                    CALL    C391A
  3307  1160  383c                      JR      C,J382A
  3308  1162  eb                        EX      DE,HL
  3309  1163  229ff6                    LD      (TEMP8),HL
  3310  1166  cdc309                    CALL    C304F
  3311  1169  cd5006                    CALL    C2CDC                   ; pop ARG
  3312  116c  cd8e12                    CALL    C391A
  3313  116f  cdc309                    CALL    C304F
  3314  1172  2a9ff6                    LD      HL,(TEMP8)
  3315  1175  d2ce11                    JP      NC,J385A
  3316  1178  3a47f8                    LD      A,(ARG)
  3317  117b  f5                        PUSH    AF
  3318  117c  e5                        PUSH    HL
  3319  117d  cdcd05                    CALL    C2C59                   ; DAC = ARG
  3320  1180  21c5f7                    LD      HL,FBUFFR
  3321  1183  cddb05                    CALL    C2C67                   ; = DAC
  3322  1186  218f06                    LD      HL,I2D1B
  3323  1189  cdd005                    CALL    C2C5C                   ; DAC = 1.0
  3324  118c  e1                        POP     HL
  3325  118d  7c                        LD      A,H
  3326  118e  b7                        OR      A
  3327  118f  f5                        PUSH    AF
  3328  1190  f29a11                    JP      P,J3826
  3329  1193  af                        XOR     A
  3330  1194  4f                        LD      C,A
  3331  1195  95                        SUB     L
  3332  1196  6f                        LD      L,A
  3333  1197  79                        LD      A,C
  3334  1198  9c                        SBC     A,H
  3335  1199  67                        LD      H,A
  3336  119a  e5                J3826:  PUSH    HL
  3337  119b  c30812                    JP      J3894
  3338                          
  3339  119e  cdc309            J382A:  CALL    C304F
  3340  11a1  cdcd05                    CALL    C2C59                   ; DAC = ARG
  3341  11a4  cde305                    CALL    C2C6F                   ; exchange DAC with stack
  3342  11a7  cde603                    CALL    C2A72                   ; LOG DAC
  3343  11aa  cd5006                    CALL    C2CDC                   ; pop ARG
  3344  11ad  cd5a01                    CALL    C27E6                   ; DAC * ARG
  3345  11b0  c3be04                    JP      C2B4A                   ; EXP DAC
  3346                          
  3347                          ;       Subroutine      INTEXP (integer to the power)
  3348                          ;       Inputs          ________________________
  3349                          ;       Outputs         ________________________
  3350                          
  3351  11b3  7c                C383F:  LD      A,H
  3352  11b4  b5                        OR      L
  3353  11b5  2006                      JR      NZ,J3849
  3354  11b7  210100            J3843:  LD      HL,1
  3355  11ba  c3cb11                    JP      J3857
  3356                          
  3357  11bd  7a                J3849:  LD      A,D
  3358  11be  b3                        OR      E
  3359  11bf  200d                      JR      NZ,J385A
  3360  11c1  7c                J384D:  LD      A,H
  3361  11c2  17                        RLA
  3362  11c3  3003                      JR      NC,J3854
  3363  11c5  c30000                    JP      J4058
  3364                          
  3365  11c8  210000            J3854:  LD      HL,0
  3366  11cb  c30d09            J3857:  JP      C2F99                   ; put HL in DAC
  3367                          
  3368  11ce  229ff6            J385A:  LD      (TEMP8),HL
  3369  11d1  d5                        PUSH    DE
  3370  11d2  7c                        LD      A,H
  3371  11d3  b7                        OR      A
  3372  11d4  f5                        PUSH    AF
  3373  11d5  fc950b                    CALL    M,C3221
  3374  11d8  44                        LD      B,H
  3375  11d9  4d                        LD      C,L
  3376  11da  210100                    LD      HL,1
  3377  11dd  b7                J3869:  OR      A
  3378  11de  78                        LD      A,B
  3379  11df  1f                        RRA
  3380  11e0  47                        LD      B,A
  3381  11e1  79                        LD      A,C
  3382  11e2  1f                        RRA
  3383  11e3  4f                        LD      C,A
  3384  11e4  3005                      JR      NC,J3877
  3385  11e6  cd8112                    CALL    C390D
  3386  11e9  204c                      JR      NZ,J38C3
  3387  11eb  78                J3877:  LD      A,B
  3388  11ec  b1                        OR      C
  3389  11ed  2863                      JR      Z,J38DE
  3390  11ef  e5                        PUSH    HL
  3391  11f0  62                        LD      H,D
  3392  11f1  6b                        LD      L,E
  3393  11f2  cd8112                    CALL    C390D
  3394  11f5  eb                        EX      DE,HL
  3395  11f6  e1                        POP     HL
  3396  11f7  28e4                      JR      Z,J3869
  3397  11f9  c5                        PUSH    BC
  3398  11fa  e5                        PUSH    HL
  3399  11fb  21c5f7                    LD      HL,FBUFFR
  3400  11fe  cddb05                    CALL    C2C67                   ; = DAC
  3401  1201  e1                        POP     HL
  3402  1202  cd3f09                    CALL    C2FCB                   ; convert to single precision real
  3403  1205  cdb609                    CALL    C3042
  3404  1208  c1                J3894:  POP     BC
  3405  1209  78                        LD      A,B
  3406  120a  b7                        OR      A
  3407  120b  1f                        RRA
  3408  120c  47                        LD      B,A
  3409  120d  79                        LD      A,C
  3410  120e  1f                        RRA
  3411  120f  4f                        LD      C,A
  3412  1210  3008                      JR      NC,J38A6
  3413  1212  c5                        PUSH    BC
  3414  1213  21c5f7                    LD      HL,FBUFFR
  3415  1216  cdaf05                    CALL    C2C3B                   ; DAC = DAC * .
  3416  1219  c1                        POP     BC
  3417  121a  78                J38A6:  LD      A,B
  3418  121b  b1                        OR      C
  3419  121c  2834                      JR      Z,J38DE
  3420  121e  c5                        PUSH    BC
  3421  121f  cd4006                    CALL    C2CCC                   ; push DAC
  3422  1222  21c5f7                    LD      HL,FBUFFR
  3423  1225  e5                        PUSH    HL
  3424  1226  cdd005                    CALL    C2C5C                   ; DAC =
  3425  1229  e1                        POP     HL
  3426  122a  e5                        PUSH    HL
  3427  122b  cdaf05                    CALL    C2C3B                   ; DAC = DAC * .
  3428  122e  e1                        POP     HL
  3429  122f  cddb05                    CALL    C2C67                   ; = DAC
  3430  1232  cd5506                    CALL    C2CE1                   ; pop DAC
  3431  1235  18d1                      JR      J3894
  3432                          
  3433  1237  c5                J38C3:  PUSH    BC
  3434  1238  d5                        PUSH    DE
  3435  1239  cdae09                    CALL    C303A                   ; convert DAC to double real
  3436  123c  cdc105                    CALL    C2C4D                   ; ARG = DAC
  3437  123f  e1                        POP     HL
  3438  1240  cd3f09                    CALL    C2FCB                   ; convert to single precision real
  3439  1243  cdb609                    CALL    C3042
  3440  1246  21c5f7                    LD      HL,FBUFFR
  3441  1249  cddb05                    CALL    C2C67                   ; = DAC
  3442  124c  cdcd05                    CALL    C2C59                   ; DAC = ARG
  3443  124f  c1                        POP     BC
  3444  1250  18c8                      JR      J38A6
  3445                          
  3446  1252  f1                J38DE:  POP     AF
  3447  1253  c1                        POP     BC
  3448  1254  f0                        RET     P
  3449  1255  3a63f6                    LD      A,(VALTYP)
  3450  1258  fe02                      CP      2
  3451  125a  2008                      JR      NZ,J38F0
  3452  125c  c5                        PUSH    BC
  3453  125d  cd3f09                    CALL    C2FCB                   ; convert to single precision real
  3454  1260  cdb609                    CALL    C3042
  3455  1263  c1                        POP     BC
  3456  1264  3af6f7            J38F0:  LD      A,(DAC)
  3457  1267  b7                        OR      A
  3458  1268  200b                      JR      NZ,J3901
  3459  126a  2a9ff6                    LD      HL,(TEMP8)
  3460  126d  b4                        OR      H
  3461  126e  f0                        RET     P
  3462  126f  7d                        LD      A,L
  3463  1270  0f                        RRCA
  3464  1271  a0                        AND     B
  3465  1272  c30000                    JP      J4067                   ; overflow error
  3466                          
  3467  1275  cdc105            J3901:  CALL    C2C4D                   ; ARG = DAC
  3468  1278  218f06                    LD      HL,I2D1B
  3469  127b  cdd005                    CALL    C2C5C                   ; DAC = 1.0
  3470  127e  c31302                    JP      C289F                   ; DAC / ARG
  3471                          
  3472                          ;       Subroutine      __________________________
  3473                          ;       Inputs          ________________________
  3474                          ;       Outputs         ________________________
  3475                          
  3476  1281  c5                C390D:  PUSH    BC
  3477  1282  d5                        PUSH    DE
  3478  1283  cd070b                    CALL    C3193                   ; integer multiply
  3479  1286  3a63f6                    LD      A,(VALTYP)
  3480  1289  fe02                      CP      2
  3481  128b  d1                        POP     DE
  3482  128c  c1                        POP     BC
  3483  128d  c9                        RET
  3484                          
  3485                          ;       Subroutine      __________________________
  3486                          ;       Inputs          ________________________
  3487                          ;       Outputs         ________________________
  3488                          
  3489  128e  cdcd05            C391A:  CALL    C2C59                   ; DAC = ARG
  3490  1291  cd3b06                    CALL    C2CC7                   ; push ARG
  3491  1294  cd430a                    CALL    C30CF
  3492  1297  cd5006                    CALL    C2CDC                   ; pop ARG
  3493  129a  cdd008                    CALL    C2F5C                   ; compare double real
  3494  129d  37                        SCF
  3495  129e  c0                        RET     NZ
  3496  129f  c3d109                    JP      C305D
  3497                          
  3498                          
